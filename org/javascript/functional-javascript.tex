% Created 2015-11-06 Fri 17:51
\documentclass[a5paper]{book}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{fixltx2e}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{textcomp}
\usepackage{amssymb}
\usepackage{capt-of}
\usepackage{hyperref}
\usepackage[unicode,dvipdfm]{hyperref}
\usepackage{fontspec}
\usepackage{xeCJK}
\setCJKmainfont{SimSun}
\setcounter{secnumdepth}{3}
\author{Jichao Ouyang}
\date{\textit{<2015-05-13 Wed>}}
\title{Functional JavaScript Mini Book}
\hypersetup{
 pdfauthor={Jichao Ouyang},
 pdftitle={Functional JavaScript Mini Book},
 pdfkeywords={},
 pdfsubject={},
 pdfcreator={Emacs 24.5.1 (Org mode 8.3.2)}, 
 pdflang={English}}
\begin{document}

\maketitle
\tableofcontents

\begin{quote}
å¦‚æœä½ è§‰å¾—è¿™æœ¬ä¹¦å¯¹ä½ æœ‰å¸®åŠ©,å¿ä¸ä½è¦è¯·\href{https://gum.co/fpjs}{æˆ‘ä¸€æ¯å’–å•¡}, é‚£ä¹ˆä½ å°†åŒæ—¶è·å¾—ä¸€æœ¬pdfç‰ˆæœ¬çš„FPJS mini nook
\end{quote}

\part{Preface}
\label{sec:orgheadline1}
è¿™æ˜¯æœ¬å¯èƒ½2å°æ—¶å°±èƒ½çœ‹å®Œçš„å°ä¹¦ï¼Œä½†æ˜¯æ¶µç›–äº†åŸºæœ¬æ‰€æœ‰å‡½æ•°å¼ç¼–ç¨‹çš„å†…å®¹ï¼Œè¿˜åŒ…å«äº†ä¸€äº›
ECMAScript 6 å®šä¹‰çš„å‡½æ•°å¼æ–°ç‰¹æ€§, å¦‚ç®­å¤´å‡½æ•°, æ¨¡å¼åŒ¹é…ç­‰ç­‰.
è¿˜ä¼šä»‹ç»å‡½æ•°å¼ä¸€äº›é‡è¦æ¦‚å¿µåœ¨ JavaScriptæ˜¯å¦‚ä½•å®ç°å³åº”ç”¨,
ä»¥åŠå¦‚ä½•ä»¥å‡½æ•°å¼çš„æ€æƒ³ç¼–å†™ JavaScript ä»£ç .

\begin{quote}
æœ¬ä¹¦è™½ç„¶ä¸æˆ‘ç¿»è¯‘çš„Michael Fogusçš„\href{http://book.douban.com/subject/22733640/}{Functional JavaScript}åŒå, ä½†æ˜¯è¯·ä¸è¦å½“æˆæ˜¯Foguså¤§å¸ˆçš„miniç‰ˆæœ¬, 
è¿™é‡Œçš„å†…å®¹å®Œå…¨è·ŸFoguså¤§å¸ˆçš„ä¸ä¸€æ ·, å¯èƒ½æ¯”å¤§å¸ˆçš„è¦å†"å‡½æ•°å¼"ä¸€äº›\footnote{FogusåŒæ—¶æ˜¯The Joy of Clojureçš„ä½œè€…,æˆ‘
ç‰¹åˆ«å¥‡æ€ªä¸ºä»€ä¹ˆä¸æŠŠClojureçœŸæ­£Good partå†™è¿›Functional JavaScripté‡Œ}, ç”¨jså®ç°äº†ä¸€äº›å…¶ä»–å‡½æ•°å¼è¯­è¨€(Clojure, Haskell)ç‰¹æœ‰çš„å‡½æ•°å¼features.
\end{quote}

å¯¹æœJavaScriptçš„åŸºæœ¬æ¦‚å¿µå¯¹ä½ æ¥è¯´:

\url{./images/preface/what_you_talking.gif}

å¯èƒ½æœ¬ä¹¦å¹¶ä¸é€‚åˆä½ , è¯·å…ˆç§»æ­¥ \href{https://leanpub.com/javascript-allonge}{JavaScript Allonge},
ä½†æ˜¯å¦‚æœä½ å­¦ä¹ å‡½æ•°å¼ç¼–ç¨‹æ—¶æ„Ÿåˆ°è´¹è§£:

\url{./images/preface/summarize_in_one_word.gif}

é‚£ä¹ˆè¿™æœ¬ä¹¦å°†ä¼šå¯¹ä½ ä¼šæœ‰æ‰€å¸®åŠ©.

æˆ‘é€‰ç”¨çš„ JavaScript å‡½æ•°å¼åº“æ˜¯
\href{https://rawgit.com/CrossEye/eweda/master/docs/eweda.html}{Eweda}(\href{https://ramdajs.com}{Ramda} çš„æœ€åˆå®ç°ï¼Œæ›´éµå®ˆå‡½æ•°å¼æ•™æ¡ï¼Œä½†ç”±äº
javascript çš„æ ˆå¾ˆå®¹æ˜“çˆ†ï¼ŒRamdaçš„å®ç°è¦æ›´ pratical
ä¸€äº›è€Œä¸”å¯ä»¥ç”¨çš„äº§å“ä»£ç ä¸­ï¼Œ åƒä¸‡ä¸è¦åœ¨äº§å“ä¸­ç”¨
eweda,è¿™é‡Œåªç”¨ewedaåšä»‹ç»ç›®çš„)

\begin{quote}
\href{http://fr.umio.us/why-ramda/}{ä¸ºä»€ä¹ˆä¸ç”¨ Underscore/Lodash} è¯·ç§»æ­¥ç¬¬äºŒç« 
\end{quote}

\begin{quote}
ç”±äºä¼šä»‹ç» ECMAScript 6 çš„æ–°ç‰¹æ€§, ä¹¦ä¸­å¾ˆå¤šå†™æ³•éƒ½æ˜¯ ECMAScript
6 æ ‡å‡†, åªèƒ½åœ¨å®ç°è¿™äº› feature çš„æµè§ˆå™¨(å¦‚ Firefox,
è¯·ç›®å‰å‚ç…§å„æµè§ˆå™¨çš„\href{http://kangax.github.io/compat-table/es6/}{å®ç°æƒ…å†µ}) é‡Œè¿è¡Œ.
å¦å¤–, å¤§å¤šæ•°çš„ä¾‹å­æºç éƒ½ä¼šåœ¨æ–‡ç« é‡Œçš„ jsbin é“¾æ¥é‡Œ.
\end{quote}

\part{Lambda}
\label{sec:orgheadline9}
ä¸ºä»€ä¹ˆè®² lambda, å¦‚æœå°æ—¶å€™ç©è¿‡æ¸¸æˆ"åŠæ¡å‘½",é‚£ä¹ˆä½ æ—©éƒ½è§è¿‡ lambda äº†.

\includegraphics[width=.9\linewidth]{./images/lambda/Lambda_reactor_complex_logo.png}

æˆ‘ä»wikipediaé‡Œé¢ç²˜å‡ºæ¥äº†è¿™ä¹ˆä¸€æ®µå®šä¹‰:
\begin{quote}
lambdaåŒ…æ‹¬ä¸€æ¡å˜æ¢è§„åˆ™ï¼ˆå˜é‡æ›¿æ¢ï¼‰å’Œä¸€æ¡å‡½æ•°å®šä¹‰æ–¹å¼ï¼ŒLambdaæ¼”ç®—ä¹‹é€šç”¨åœ¨äºï¼Œä»»ä½•ä¸€ä¸ªå¯è®¡ç®—å‡½æ•°éƒ½èƒ½ç”¨è¿™ç§å½¢å¼æ¥è¡¨è¾¾å’Œæ±‚å€¼ã€‚å› è€Œï¼Œå®ƒæ˜¯ç­‰ä»·äºå›¾çµæœºçš„.
\end{quote}

å¥½å§, è·Ÿæ²¡è§£é‡Šä¸€æ ·. ç®€å•æ¥è¯´lambdaå…¶å®å°±æ˜¯ \texttt{x} åˆ° \texttt{y} çš„æ˜ å°„å…³ç³», ä½†åœ¨å¤§éƒ¨åˆ†æ”¯æŒå‡½æ•°å¼çš„ç¼–ç¨‹è¯­è¨€ä¸­,
å®ƒç­‰ä»·äºåŒ¿åå‡½æ•°. è¢«ç§°ä¸º lambda è¡¨è¾¾å¼.
å› ä¸ºè¿™äº›å‡½æ•°åªéœ€è¦ç”¨ä¸€æ¬¡, è€Œä¸”å˜æ¢ä¸å¤æ‚, å®Œå…¨ä¸éœ€è¦å‘½å.

\url{./images/lambda/parallel-universe.gif}

åŒ¿åå‡½æ•°åœ¨ç¨‹åºä¸­çš„ä½œç”¨æ˜¯å¯ä»¥ä½œä¸ºå‚æ•°ä¼ ç»™é«˜é˜¶å‡½æ•°\footnote{ç¬¬äºŒç« ä¼šè¯¦ç»†è§£é‡Šé«˜é˜¶å‡½æ•°å’Œé—­åŒ….}, æˆ–è€…ä½œä¸ºé—­åŒ…è¢«è¿”å›.

ä½†æ˜¯åŒ¿åå‡½æ•°å¹¶ä¸æ˜¯åŸæœ¬çš„ lambda ç®—å­, å› ä¸ºåŒ¿åå‡½æ•°ä¹Ÿå¯ä»¥æ¥å—å¤šä¸ªå‚æ•°, å¦‚

\begin{verbatim}
multiple(x, y) = x*y
\end{verbatim}

å†™æˆç®€å•æ˜ å°„çš„å½¢å¼, æŠŠåå­—å»æ‰

\begin{verbatim}
(x,y) -> x*y
\end{verbatim}

è¿™å°±æ˜¯ lambda äº†å—, ä¸æ˜¯, lambdaçš„ç”¨æ„æ˜¯ç®€åŒ–è¿™ä¸ªæ˜ å°„å…³ç³»ä»¥è‡³ä¸éœ€è¦åå­—,
æ›´é‡è¦çš„æ˜¯åªæ˜ å°„ä¸€ä¸ª x.

ä»€ä¹ˆæ„æ€å‘¢? è®©æˆ‘ä»¬æ¥åˆ†è§£ä¸€ä¸‹ä¸Šé¢çš„è¿™ä¸ªæ˜ å°„çš„è¿‡ç¨‹.

\begin{enumerate}
\item lambda æ¥å—ç¬¬ä¸€ä¸ªå‚æ•° \texttt{5}, è¿”å›å¦ä¸€ä¸ª lambda

\begin{verbatim}
(5) -> (y -> 5*y)
\end{verbatim}

\item è¯¥è¿”å›çš„ lambda \texttt{y -> 5*y} æ¥æ”¶ \texttt{y} å¹¶ä¸”è¿”å› \texttt{5*y}, è‹¥åœ¨ç”¨ \texttt{4} è°ƒç”¨è¯¥ lambda
\end{enumerate}

\begin{verbatim}
es6 -> 5*4
\end{verbatim}

å› æ­¤è¿™é‡Œçš„åŒ¿åå‡½æ•° \texttt{(x,y)->x*y} çœ‹ä¼¼ä¸€ä¸ª lambda, å…¶å®æ˜¯ä¸¤ä¸ª lambda
çš„ç»“åˆ.

è€Œè¿™ç§æ¥å—ä¸€ä¸ªå‚æ•°è¿”å›å¦ä¸€ä¸ªæ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°çš„å‡½æ•°å«æŸ¯é‡ŒåŒ–\footnote{æŸ¯é‡ŒåŒ–ä¼šåœ¨ç¬¬äºŒç« è¯¦ç»†è®¨è®º.}.

è¿™é‡Œæˆ‘ä»¬å…ˆå¿ä¸€å¿, æ¥çœ‹ä¸‹ JavaScript ä¸­çš„ lambda è¡¨è¾¾å¼.
\chapter{ç®­å¤´å‡½æ•°(arrow function)}
\label{sec:orgheadline5}

æ¥çœ‹çœ‹è¶Šæ¥è¶Šå‡½æ•°å¼ã® JavaScript

æ–°çš„è‰æ¡ˆ\href{http://kangax.github.io/compat-table/es6/}{ECMAScript 6}
(è™½ç„¶è¯´æ˜¯è‰æ¡ˆ,ä½†ä½ å¯ä»¥çœ‹åˆ° Firefox å…¶å®å·²ç»å®ç°å¤§éƒ¨åˆ†çš„
feature)é‡Œæˆ‘ä»¬è¶Šæ¥è¶Šè¿‘äº†, å€ŸåŠ©ä¸€ä¸‹transcompilerä¾‹å¦‚\href{https://babeljs.io}{Babel} æˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨é¡¹ç›®ä¸­å¼€å§‹ä½¿ç”¨es6äº†\footnote{å¯ä»¥çœ‹çœ‹es6æ¯”è¾ƒæœ‰æ„æ€çš„æ–°ç‰¹æ€§ \url{http://blog.oyanglul.us/javascript/essential-ecmascript6.html}}ã€‚

çœ‹çœ‹é‡Œé¢æœ‰ä¸€è¡Œ arrow
functionï¼Œä¸ºä»€ä¹ˆå«ç®­å¤´å‡½æ•°ï¼Œè¿˜è®°å¾—å‰é¢è¯´lambdaæ˜¯æåˆ°çš„ç®­å¤´å—ã€‚è€Œä¸”å¦‚æœä½ ä¹‹å‰ç”¨è¿‡
Haskell(å•ç®­å¤´) æˆ–è€…Scala(åŒç®­å¤´), ä¼šå‘ç°éƒ½ç”¨çš„æ˜¯ç®­å¤´æ¥è¡¨ç¤ºç®€å•æ˜ å°„å…³ç³».

\begin{quote}
ç”±äº arrow function åªåœ¨Firefox 22ä»¥ä¸Šç‰ˆæœ¬å®ç°,
æœ¬èŠ‚çš„æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨Firefoxçš„Consoleä¸­è°ƒè¯•, å…¶ä»–chrome ä»€ä¹ˆçš„éƒ½æ²¡æœ‰å®ç°(å®Œå…¨)\footnote{Chromeæœ‰ä¸€ä¸ª feature toggle å¯ä»¥æ‰“å¼€éƒ¨åˆ† es6 åŠŸèƒ½ \texttt{chrome://flags/\#enable-javascript-harmony}}.
å¦å¤–æ¯èŠ‚çš„æœ€åæˆ‘éƒ½ä¼šç»™å‡ºå®Œæ•´ä»£ç çš„å¯æ‰§è¡Œçš„ jsbin é“¾æ¥.
\end{quote}

\section{å£°æ˜ä¸€ä¸ªç®­å¤´å‡½æ•°}
\label{sec:orgheadline2}

ä½ å¯ä»¥ç”¨ä¸¤ç§æ–¹å¼å®šä¹‰ä¸€ä¸ªç®­å¤´å‡½æ•°

\begin{verbatim}
([param] [, param]) => {
   statements
}
// or
param => expression
\end{verbatim}

å•ä¸ªè¡¨è¾¾å¼å¯ä»¥å†™æˆä¸€è¡Œ, è€Œå¤šè¡Œè¯­å¥åˆ™éœ€è¦ block \texttt{\{\}} æ‹¬èµ·æ¥.

\section{ä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°}
\label{sec:orgheadline3}

çœ‹çœ‹æ—§çš„åŒ¿åå‡½æ•°æ€ä¹ˆå†™ä¸€ä¸ªä½¿æ•°ç»„ä¸­æ•°å­—éƒ½ä¹˜2çš„å‡½æ•°.

\begin{verbatim}
var a = [1,2,curry,es6,5];
a.map(function(x){ return x*2 });
\end{verbatim}

ç”¨ç®­å¤´å‡½æ•°ä¼šå˜æˆ

\begin{verbatim}
a.map(x => x*2);
\end{verbatim}

åªæ˜¯å°‘äº† \texttt{function} å’Œ \texttt{return} ä»¥åŠ block, ä¸æ˜¯å—? å¦‚æœè§‰å¾—å·®ä¸å¤š,
å› ä¸ºä½ çœ‹æƒ¯äº† JavaScript çš„åŒ¿åå‡½æ•°,
ä½ çš„å¤§è„‘ç¼–è¯‘å™¨è‡ªåŠ¨çš„å¿½ç•¥äº†,å› ä¸ºä»–ä»¬ä¸éœ€è¦æ˜¾ç¤ºçš„å­˜åœ¨.

è€Œ \texttt{map(x => x*2)} è¦æ›´ make sense,
å› ä¸ºæˆ‘ä»¬éœ€è¦çš„åŒ¿åå‡½æ•°åªéœ€è¦åšä¸€ä»¶äº‹æƒ…, æˆ‘ä»¬éœ€è¦çš„æ˜¯ ä¸€ä¸ªå‡½æ•° \texttt{f},
å¯ä»¥å°†ç»™å®š \texttt{x}, æ˜ å°„åˆ° \texttt{y}.
ç¿»è¯‘è¿™å¥è¯çš„æœ€ç®€å•çš„æ–¹å¼ä¸å°±æ˜¯ \texttt{f = (x => x*2)}

\section{Lexical \texttt{this}}
\label{sec:orgheadline4}

å¦‚æœä½ è§‰å¾—è¿™è¿˜ä¸è¶³ä»¥è¯´æœæ”¹å˜åŒ¿åå‡½æ•°çš„å†™æ³•,
é‚£ä¹ˆæƒ³æƒ³ä»¥å‰å†™åŒ¿åå‡½æ•°ä¸­çš„ç»å¸¸éœ€è¦ \texttt{var self=this} çš„è‹¦æ¼.

\begin{verbatim}
    var Multipler = function(inc){
      this.inc = inc;
    }
    Multipler.prototype.multiple = function(numbers){
      return numbers.map(function(number){
        return this.inc * number;
      })
    }
    new Multipler(2).multiple([1,2,curry,es6]) 
// => [NaN, NaN, NaN, NaN]  ä¸ work, å› ä¸º map é‡Œé¢çš„ this æŒ‡å‘çš„æ˜¯å…¨å±€å˜é‡( window)

    Multipler.prototype.multiple = function(numbers){
      var self = this; // ä¿æŒ Multipler çš„ this çš„ç¼“å­˜
      return numbers.map(function(number){
        return self.inc * number;
      })
    }
    new Multipler(2).multiple([1,2,curry,es6]) // => [ 2, es6, 6, 8 ]
\end{verbatim}

å¾ˆæ€ªä¸æ˜¯å—, ç¡®å®æ˜¯ Javascript çš„ä¸€ä¸ª bug, å› æ­¤ç»å¸¸å‡ºç°åœ¨å„ç§é¢è¯•é¢˜ä¸­, é—® \texttt{this} åˆ°åº•æ˜¯è°.

\url{./images/lambda/which-leela.gif}

è¯•è¯•æ›¿æ¢æˆ arrow function

\begin{verbatim}
Multipler.prototype.multiple = function(numbers){
  return numbers.map((number) => number*this.inc);
};

console.log(new Multipler(2).multiple([1,2,curry,es6]));// => [ 2, es6, 6, 8 ]
\end{verbatim}

ä¸éœ€è¦ \texttt{var self=this} äº†æ˜¯ä¸æ˜¯å¾ˆå¼€å¿ƒâ˜ºï¸ç°åœ¨, arrow function é‡Œé¢çš„
this ä¼šè‡ªåŠ¨ capture å¤–å±‚å‡½æ•°çš„ \texttt{this} å€¼.

\chapter{JavaScriptçš„åŒ¿åå‡½æ•°(anonymous function)}
\label{sec:orgheadline8}

æ”¯æŒåŒ¿åå‡½æ•°, ä¹Ÿå°±æ„å‘³ç€å‡½æ•°å¯ä»¥ä½œä¸ºä¸€ç­‰å…¬æ°‘. å¯ä»¥è¢«å½“åšå‚æ•°,
ä¹Ÿå¯ä»¥è¢«å½“åšè¿”å›å€¼.å› æ­¤, JavaScript çš„æ”¯æŒä¸€ç­‰å‡½æ•°çš„å‡½æ•°å¼è¯­è¨€,
è€Œä¸”å®šä¹‰ä¸€ä¸ªåŒ¿åå‡½æ•°å¼å¦‚æ­¤ç®€å•.

\section{åˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°}
\label{sec:orgheadline6}

åœ¨JavaScripté‡Œåˆ›å»ºä¸€ä¸ªå‡½æ•°æ˜¯å¦‚æ­¤çš„ \sout{ç®€å•} \ldots{} æ¯”å¦‚:
\begin{verbatim}
function(x){
    return x*x;
}// => SyntaxError: function statement requires a name
\end{verbatim}

ä½†æ˜¯, ä¸ºä»€ä¹ˆæŠ¥é”™äº†è¿™é‡Œ. å› ä¸ºåˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°éœ€è¦ç”¨è¡¨è¾¾å¼(function
expression). è¡¨è¾¾å¼æ˜¯ä¼šè¿”å›å€¼çš„:

\begin{verbatim}
var a = new Array() // new Array æ˜¯è¡¨è¾¾å¼, è€Œè¿™æ•´è¡Œå«è¯­å¥ statement
\end{verbatim}

ä½†ä¸ºä»€ä¹ˆè¯´ \texttt{function statement requires a name}. å› ä¸º JavaScript
\textbf{è¿˜æœ‰ä¸€ç§} åˆ›å»ºå‡½æ•°çš„æ–¹æ³•--/function statement/.
è€Œåœ¨ä¸Šé¢è¿™ç§å†™æ³•ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ª function è¯­å¥, å› ä¸ºå¹¶æ²¡æœ‰æœŸå¾…å€¼. è€Œ
function è¯­å¥å£°æ˜æ˜¯éœ€è¦åå­—çš„.

ç®€å•å°†è¿™ä¸ªå‡½æ•°èµ‹ç»™ä¸€ä¸ªå˜é‡æˆ–å½“å‚æ•°ä¼ éƒ½ä¸ä¼šæŠ¥é”™,
å› ä¸ºè¿™æ—¶ä»–æ²¡æœ‰æ­§ä¹‰,åªèƒ½æ˜¯è¡¨è¾¾å¼.æ¯”å¦‚:

\begin{verbatim}
var squareA = function(x){
    return x*x;
}
\end{verbatim}

ä½†æ˜¯è¿™é‡Œæ¯”è¾ƒ tricky çš„æ˜¯è¿™ä¸‹ \texttt{squareA} å…¶å®æ˜¯ä¸€ä¸ªå…·åå‡½æ•°äº†.

\begin{verbatim}
console.log(squareA) // => function squareA()
\end{verbatim}

è™½ç„¶ç»“æœæ˜¯å…·åå‡½æ•°,ä½†æ˜¯è¿‡ç¨‹å´ä¸ä¸‹é¢è¿™ç§å£°æ˜çš„æ–¹å¼ä¸ä¸€æ ·.

\begin{verbatim}
function squareB(x){
    return x*x;
} // => undefined
\end{verbatim}

\texttt{squareB} ç”¨çš„æ˜¯ function statement ç›´æ¥å£°æ˜(æ˜¾ç„¶ statement æ²¡æœ‰è¿”å›),
è€Œ \texttt{squareA} åˆ™æ˜¯å…ˆç”¨ function expression åˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°,
ç„¶åå°†è¿”å›çš„å‡½æ•°èµ‹ç»™äº†åä¸º \texttt{squareA} çš„å˜é‡. å› ä¸ºè¡¨è¾¾å¼æ˜¯æœ‰è¿”å›çš„:

\begin{verbatim}
console.log(function(x){ return x*x});
// => undefined
// => function ()
\end{verbatim}

ç¬¬ä¸€ä¸ª \texttt{undefined} æ˜¯ \texttt{console.log} çš„è¿”å›å€¼, å› æ­¤
\texttt{function()} åˆ™æ˜¯æ‰“å°å‡ºæ¥çš„ function è¡¨è¾¾å¼åˆ›å»ºçš„åŒ¿åå‡½æ•°.

\section{ä½¿ç”¨åŒ¿åå‡½æ•°}
\label{sec:orgheadline7}

JavaScript çš„å‡½æ•°æ˜¯ä¸€ç­‰å‡½æ•°. è¿™æ„å‘³ç€æˆ‘ä»¬çš„å‡½æ•°è·Ÿå€¼çš„å¾…é‡æ˜¯ä¸€æ ·çš„,äºæ˜¯å®ƒ

å¯ä»¥èµ‹ç»™å˜é‡:

\begin{verbatim}
var square = function(x) {return x*x}
\end{verbatim}

å¯ä»¥å½“å‚æ•°, å¦‚åˆšæ‰è§åˆ°çš„:

\begin{verbatim}
console.log(function(x){return x*x})
\end{verbatim}

å°†å‡½æ•°ä¼ ç»™äº† \texttt{console.log}

å¯ä»¥è¢«è¿”å›:

\begin{verbatim}
function multiply(x){
    return function(y){
        return x*y;
    }
}
multiply(1)(2) // => 2
\end{verbatim}

\part{é«˜é˜¶å‡½æ•°(Higher-order function)}
\label{sec:orgheadline23}

æˆ‘ä»¬å·²ç»è§è¯†åˆ°äº†åŒ¿åå‡½æ•°å’Œç®­å¤´å‡½æ•°çš„ç”¨æ³•, åŒ¿åçš„ä¸€ç­‰å‡½æ•°åˆ°åº•æœ‰ä»€ä¹ˆç”¨å‘¢?
æ¥çœ‹çœ‹é«˜é˜¶å‡½æ•°çš„åº”ç”¨.

é«˜é˜¶å‡½æ•°æ„æ€æ˜¯å®ƒæ¥æ”¶å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°. ä¸ºä»€ä¹ˆå« \textbf{é«˜é˜¶}: æ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°
\texttt{f(x, y) = x(y)} æŒ‰ç…§ lambda çš„ç®€åŒ–è¿‡ç¨‹åˆ™æ˜¯

\begin{verbatim}
f(x) => (y -> x(y))
(y) => x(y)
\end{verbatim}

å¯ä»¥çœ‹å‡ºæ¥è°ƒç”¨ f æ—¶å´åˆè¿”å›äº†ä¸€ä¸ªå‡½æ•°x.

è¿˜è®°å¾—é«˜ç­‰æ•°å­¦é‡Œé¢çš„å¯¼æ•°å—, ä¸¤é˜¶ä»¥ä¸Šçš„å¯¼æ•°å«é«˜é˜¶å¯¼æ•°.
å› ä¸ºæ±‚å¯¼ä¸€æ¬¡ä»¥åè¿”å›çš„å¯ä»¥æ±‚å¯¼.

æ¦‚å¿µæ˜¯ä¸€æ ·çš„,
å¦‚åŒ\href{https://en.wikipedia.org/wiki/Matryoshka_doll}{ä¿„ç½—æ–¯å¥—å¨ƒ} å½“å‡½æ•°æ‰§è¡Œä»¥åè¿˜éœ€æ‰§è¡Œæˆ–è€…è¦å¯¹å‚æ•°æ‰§è¡Œ,
å› æ­¤å«é«˜é˜¶å‡½æ•°.

\includegraphics[width=.9\linewidth]{./images/higherorder/recursion.png}

é«˜é˜¶å‡½æ•°æœ€å¸¸è§çš„åº”ç”¨å¦‚ \texttt{map}, \texttt{reduce}.
ä»–ä»¬éƒ½æ˜¯ä»¥ä¼ å…¥ä¸åŒçš„å‡½æ•°æ¥ä»¥ä¸åŒçš„æ–¹å¼æ“ä½œæ•°ç»„å…ƒç´ .

å¦å¤– \emph{æŸ¯é‡ŒåŒ–}, åˆ™æ˜¯æ¯æ¬¡æ¶ˆè´¹ä¸€ä¸ªå‚æ•°å¹¶è¿”å›ä¸€ä¸ªé€æ­¥è¢«é…ç½®å¥½çš„å‡½æ•°.
\index{æŸ¯é‡ŒåŒ–}
\index{currying}

é«˜é˜¶å‡½æ•°çš„è¿™äº›åº”ç”¨éƒ½æ˜¯ä¸ºå‡½æ•°çš„ç»„åˆæä¾›çµæ´»æ€§.
åœ¨æœ¬ç« ç»“æŸç›¸ä¿¡ä½ ä¼šå¾ˆå¥½çš„ä½“ä¼šåˆ°å‡½æ•°ç»„åˆçš„å¼ºå¤§ä¹‹å¤„.

\chapter{Higher-order function}
\label{sec:orgheadline12}

å‡½æ•°åœ¨ JavaScript ä¸­æ˜¯ä¸€ç­‰å…¬æ°‘, å› æ­¤åœ¨ JavaScript ä¸­, ä½¿ç”¨é«˜é˜¶å‡½æ•°æ˜¯éå¸¸æ–¹ä¾¿çš„.

\section{å‡½æ•°ä½œä¸ºå‚æ•°}
\label{sec:orgheadline10}

å‡è®¾æˆ‘ç°åœ¨è¦å¯¹ä¸€ä¸ªæ•°ç»„æ’åº, ç”¨æˆ‘ä»¬ç†Ÿæ‚‰çš„ \texttt{sort}

\begin{verbatim}
[1,3,2,5,4].sort( (x, y) => x - y )
\end{verbatim}

å¦‚æœæˆ‘ä»¬è¦é€†åºçš„æ’åº, æŠŠå‡å·å·¦å³çš„ \texttt{x} å’Œ \texttt{y} å‘¼å”¤,å°±è¿™ä¹ˆç®€å•,
ä½†å¦‚æœæˆ‘æ˜¯ä¸€ä¸ªå¯¹è±¡æ•°ç»„, è¦æ ¹æ®å¯¹è±¡çš„ \texttt{id} æ’åº:

\begin{verbatim}
[{id:1, name:'one'},
 {id:3, name:'three'}, 
 {id:2, name:'two'}, 
 {id:5, name:'five'},  
 {id:4, name:'four'}].sort((x,y) => x.id - y.id)
\end{verbatim}

æ˜¯ä¸æ˜¯å·²ç»èƒ½å¤Ÿæ„Ÿå—åˆ°é«˜é˜¶å‡½æ•°ä¸åŒ¿åå‡½æ•°ç»„åˆçš„çµæ´»æ€§.

\section{å‡½æ•°ä½œä¸ºè¿”å›å€¼}
\label{sec:orgheadline11}

å‡½æ•°çš„è¿”å›å€¼å¯ä»¥ä¸åªæ˜¯å€¼, åŒæ ·ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°, æ¥çœ‹ Eweda
å†…éƒ¨çš„ä¸€ä¸ªå·¥å…·å‡½æ•° \texttt{aliasFor}, ä»–çš„ä½œç”¨æ˜¯ç»™å‡½æ•° E çš„ä¸€äº›æ–¹æ³•èµ·ä¸€äº›åˆ«å:

\begin{quote}
å¬èµ·æ¥å¾ˆæ€ªä¸æ˜¯å—, å‡½æ•°æ€ä¹ˆæœ‰æ–¹æ³•, å®é™…ä¸Š JavaScript çš„ \texttt{function}
æ˜¯ä¸€ä¸ªç‰¹æ®Š \textbf{å¯¹è±¡}, è¯•è¯•åœ¨ Firefox console é‡Œæ•² \texttt{console.log.}
æ˜¯ä¸æ˜¯çœ‹åˆ°äº†ä¸€äº›æ–¹æ³•, ä½†æ˜¯ \texttt{typeof console.log} æ˜¯ function
\end{quote}

\begin{verbatim}
var E = () => {}
var aliasFor = oldName => {
    var fn = newName => {
      E[newName] = E[oldName];
      return fn;
    };
    return (fn.is = fn.are = fn.and = fn);
};
\end{verbatim}

è¿™é‡Œæœ‰ä¸¤ä¸ª \texttt{return}, ä¸€ä¸ªæ˜¯ \texttt{fn} è¿”å›è‡ªå·±, å¦ä¸€ä¸ªæ˜¯ \texttt{aliasFor} ä¹Ÿè¿”å›
\texttt{fn}, å¹¶ä¸”ç»™ \texttt{fn} äº†å‡ ä¸ªåˆ«å \texttt{fn.is} \texttt{fn.are}\ldots{}

ä»€ä¹ˆæ„æ€å‘¢? \texttt{fn} è¿”å› \texttt{fn}. å¾ˆç®€å•å°±æ˜¯ \texttt{fn() => fn},
é‚£ä¹ˆ \texttt{fn()()=>fn()=>fn} \ldots{}ä»¥æ­¤ç±»æ¨, æ— è®ºè°ƒç”¨ fn å¤šå°‘æ¬¡,éƒ½æœ€ç»ˆè¿”å› fn.

\includegraphics[width=.9\linewidth]{./images/higherorder/1qUCC8s.png}

è¿™åˆ°åº•æœ‰ä»€ä¹ˆç”¨å‘¢, ç”±äºè¿™é‡Œä½¿ç”¨äº† \texttt{fn} çš„å‰¯ä½œç”¨(side affect)
æ¥å¹²äº†ä¸€äº›äº‹æƒ… \texttt{E[newName]=E[oldName]}, ä¹Ÿå°±æ˜¯ç»™ E çš„æ–¹æ³•èµ·ä¸€ä¸ªåˆ«å,
å› æ­¤æ¯æ¬¡è°ƒç”¨ fn éƒ½ä¼šç»™ \texttt{E} èµ·ä¸€ä¸ªåˆ«å. \texttt{aliasFor} æœ€åè¿”å›çš„æ˜¯ \texttt{fn}
è‡ªå·±çš„ä¸€äº›åˆ«å, ä½¿å¾—å¯ä»¥ chain èµ·æ¥æ›´å¯è¯»ä¸€äº›:

\begin{verbatim}
aliasFor('reduce').is('reduceLeft').is('foldl')
\end{verbatim}

\begin{quote}
å¦å¤–, å‡½æ•°ä½œä¸ºè¿”å›å€¼çš„é‡è¦åº”ç”¨, æŸ¯é‡ŒåŒ–ä¸é—­åŒ…,
å°†ä¼šåœ¨åœ¨åé¢ä¸“é—¨ä»‹ç». æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ä»¥å‡½æ•°ä½œä¸ºå‚æ•°çš„é«˜é˜¶å‡½æ•°çš„å…¸å‹åº”ç”¨.
\end{quote}

\chapter{æŸ¯é‡ŒåŒ– currying}
\label{sec:orgheadline19}

è¿˜è®°å¾— Haskell Curryå—

\includegraphics[width=.9\linewidth]{./images/higherorder/curry.png}

å¤šå·§å•Š, äººå®¶å§“ Curry å Haskell, éš¾æ€ª Haskell è¯­è¨€ä¼šè‡ªåŠ¨æŸ¯é‡ŒåŒ–, å‘µå‘µ.
ä½†æ˜¯ä¸å¥‡æ€ªå—, ä¸ºä»€ä¹ˆè¦æŸ¯é‡ŒåŒ–å‘¢. ä¸ºä»€ä¹ˆå¦‚æ­¤é‡è¦å¾—è®© Haskell
ä¼šé»˜è®¤è‡ªåŠ¨æŸ¯é‡ŒåŒ–æ‰€æœ‰å‡½æ•°, ä¸å°±æ˜¯è¿”å›ä¸€ä¸ªéƒ¨åˆ†é…ç½®å¥½çš„å‡½æ•°å—.

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ª Haskell çš„ä»£ç .

\begin{verbatim}
max 3 4
(max 3) 4
\end{verbatim}

ç»“æœéƒ½æ˜¯4, è¿™æœ‰ä»€ä¹ˆç”¨å‘¢.

è¿™é‡Œçœ‹ä¸å‡ºæ¥, æ”¾åˆ° \texttt{é«˜é˜¶å‡½æ•°} è¯•è¯•. ä»€ä¹ˆ? çœ‹ä¸æ‡‚å¤©ä¹¦ Haskell, æ¥çœ‹çœ‹
JavaScript å§.

\section{æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªé—®é¢˜}
\label{sec:orgheadline16}

\begin{itemize}
\item å†™ä¸€ä¸ªå‡½æ•°, å¯ä»¥è¿æ¥å­—ç¬¦æ•°ç»„, å¦‚ f(['1','2']) => '12'
\label{sec:orgheadline13}

å¥½å§,å¦‚æœä¸ç”¨æŸ¯é‡ŒåŒ–, æ€ä¹ˆå†™? å•Šå“ˆ \texttt{reduce}

\begin{verbatim}
var concatArray = function(chars){
  return chars.reduce(function(a, b){
    return a.concat(b);
  });
}
concat(['1','2','3']) // => '123'
\end{verbatim}

å¾ˆç®€å•,å¯¹å§.

\item ç°åœ¨æˆ‘è¦å…¶ä¸­æ‰€æœ‰æ•°å­—åŠ 1, ç„¶ååœ¨è¿æ¥
\label{sec:orgheadline14}

\begin{verbatim}
var concatArray = function(chars, inc){
  return chars.map(function(char){
    return (+char)+inc + '';
  }).reduce(function(a,b){
      return a.concat(b)
  });
}
console.log(concatArray(['1','2','3'], 1))// => '234'
\end{verbatim}

\item æ‰€æœ‰æ•°å­—ä¹˜ä»¥2, å†é‡æ„è¯•è¯•çœ‹
\label{sec:orgheadline15}

\begin{verbatim}
var multiple = function(a, b){
  return +a*b + ''
}
var concatArray = function(chars, inc){
  return chars.map(function(char){
    return multiple(char, inc);
  }).reduce(function(a,b){
      return a.concat(b)
  });
}
console.log(concatArray(['1','2','3'], 2)) // => '246'
\end{verbatim}

æ˜¯ä¸æ˜¯å·²ç»çœ‹å‡ºé—®é¢˜äº†å‘¢?
å¦‚æœæˆ‘åœ¨éœ€è¦æ¯ä¸ªæ•°å­—éƒ½å‡2,æ˜¯ä¸æ˜¯å¾ˆéº»çƒ¦å‘¢.éœ€è¦å°† \texttt{map} å‚æ•°åŒ¿åå‡½æ•°ä¸­çš„
multiple å‡½æ•°æ¢æ‰. è¿™æ ·ä¸€æ¥ \texttt{concatArray} å°±ä¸èƒ½åŒæ—¶å¤„ç†åŠ , ä¹˜å’Œå‡?
é‚£ä¹ˆæ€ä¹ˆèƒ½æŠŠä»–æå–å‡ºæ¥å‘¢? æ¥å¯¹æ¯”ä¸‹æŸ¯é‡ŒåŒ–çš„è§£æ³•.
\end{itemize}

\section{æŸ¯é‡ŒåŒ–å‡½æ•°æ¥å£}
\label{sec:orgheadline17}

\begin{verbatim}
var multiple = function(a){
  return function(b){
    return +b*a + ''
  }
}

var plus = function(a){
  return function(b){
    return (+b)+a + ''
  }
}
var concatArray = function(chars, stylishChar){
  return chars.map(stylishChar)
    .reduce(function(a,b){
      return a.concat(b)
  });
}
console.log(concatArray(['1','2','3'], multiple(2)))
console.log(concatArray(['1','2','3'], plus(2)))
\end{verbatim}

æœ‰ä»€ä¹ˆä¸ä¸€æ ·å‘¢ 1. å¤„ç†æ•°ç»„ä¸­å­—ç¬¦çš„å‡½æ•°è¢«æå–å‡ºæ¥, ä½œä¸ºå‚æ•°ä¼ å…¥ 2.
æå–æˆæŸ¯é‡ŒåŒ–çš„å‡½æ•°, éƒ¨åˆ†é…ç½®å¥½åä¼ å…¥, å¥½å¤„æ˜¾è€Œæ˜“è§, è¿™ä¸‹æ¥å£éå¸¸é€šç•…
æ— è®ºæ˜¯å¤–å±‚è°ƒç”¨

\begin{verbatim}
concatArray(['1','2','3'], multiple(2))
\end{verbatim}

è¿˜æ˜¯å†…éƒ¨çš„ map å‡½æ•°

\begin{verbatim}
chars.map(stylishChar)
\end{verbatim}

è¿™äº›æ¥å£éƒ½æ¸…æ™°äº†å¾ˆå¤š, ä¸æ˜¯å—

è¿™å°±æ˜¯å‡½æ•°å¼çš„æ€æƒ³, ç”¨å·²æœ‰çš„å‡½æ•°ç»„åˆå‡ºæ–°çš„å‡½æ•°, è€ŒæŸ¯é‡ŒåŒ–æ¯æ¶ˆè´¹ä¸€ä¸ªå‚æ•°,
éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„éƒ¨åˆ†é…ç½®çš„å‡½æ•°, è¿™ä¸ºå‡½æ•°ç»„åˆæä¾›äº†æ›´çµæ´»çš„æ‰‹æ®µ,
å¹¶ä¸”ä½¿å¾—æ¥å£æ›´ä¸ºæµç•….

\section{è‡ªåŠ¨æŸ¯é‡ŒåŒ–}
\label{sec:orgheadline18}

åœ¨ Haskell è¯­è¨€ä¸­, å‡½æ•°æ˜¯ä¼šè‡ªåŠ¨æŸ¯é‡ŒåŒ–çš„:

\begin{verbatim}
max 3 4
\end{verbatim}

å…¶å®å°±æ˜¯

\begin{verbatim}
(max 3) 4
\end{verbatim}

å¯ä»¥çœ‹çœ‹ \texttt{max} ä¸ \texttt{max 3} å‡½æ•°çš„ ç±»å‹

\begin{verbatim}
ghci> :t max
max :: Ord a => a -> a -> a
\end{verbatim}

çœ‹æ˜ç™½äº†ä¹ˆ, \texttt{Ord a =>} è¡¨ç¤ºç±»å‹çº¦æŸä¸ºå¯ä»¥æ¯”è¾ƒå¤§å°çš„ç±»å‹, å› æ­¤ \texttt{max}
çš„ç±»å‹å¯ä»¥ç¿»è¯‘æˆ: å½“ç»™å®šä¸€ä¸ª \texttt{a}, ä¼šå¾—åˆ° \texttt{a -> a},
å†çœ‹çœ‹ \texttt{max 3} çš„ç±»å‹å°±å¥½ç†è§£äº†

\begin{verbatim}
ghci> :t max 3
(Num a, Ord a) => a -> a
\end{verbatim}

å·¦ä¾§è¡¨ç¤ºç±»å‹çº¦æŸ \texttt{a} å¯ä»¥æ˜¯ \texttt{Ord} æˆ–è€… \texttt{Num},
æ„æ€æ˜¯ \texttt{max 3} è¿˜æ˜¯ä¸€ä¸ªå‡½æ•°,å¦‚æœç»™å®šä¸€ä¸ª \texttt{Ord} æˆ–è€… \texttt{Num} ç±»å‹çš„å‚æ•°
åˆ™è¿”å›ä¸€ä¸ª \texttt{Ord} æˆ–è€… \texttt{Num}.

ç°åœ¨æ˜¯ä¸æ˜¯æ¸…æ™°äº†, åœ¨ Haskell ä¸­æ¯ç»™å®šä¸€ä¸ªå‚æ•°, å‡½æ•°å¦‚æœæ˜¯å¤šå‚æ•°çš„,
è¯¥å‡½æ•°è¿˜ä¼šè¿”å›ä¸€ä¸ªå¤„ç†ä½™ä¸‹å‚æ•°çš„å‡½æ•°. è¿™å°±æ˜¯è‡ªåŠ¨æŸ¯é‡ŒåŒ–.

è€Œåœ¨ Javascript(ä»¥åŠå¤§å¤šæ•°è¯­è¨€) ä¸­ä¸æ˜¯çš„, å¦‚æœç»™å®šå¤šå‚å‡½æ•°çš„éƒ¨åˆ†å‚æ•°,
å‡½æ•°ä¼šé»˜è®¤å…¶ä»–å‚æ•°æ˜¯ \texttt{undefined}, è€Œä¸ä¼šè¿”å›å¤„ç†å‰©ä½™å‚æ•°çš„å‡½æ•°.

\begin{verbatim}
function willNotCurry(a, b, c) {
    console.log(a, b, c)
    return a*b-c;
}
willNotCurry(1)
// => NaN
// => 1 undefined undefined
\end{verbatim}

å¦‚æœä½¿ç”¨è‡ªåŠ¨æŸ¯é‡ŒåŒ–çš„åº“ \href{https://github.com/CrossEye/eweda}{eweda},
å‰é¢çš„ä¾‹å­ç®€ç›´å°±å®Œç¾äº†

\begin{verbatim}
var multiple = curry(function(a, b){
  return +b*a + ''
})
var plus = curry(function(a, b){
  return (+b)+a + ''
})
\end{verbatim}

\chapter{å‡½æ•°ç»„åˆ function composition}
\label{sec:orgheadline22}

é€šè¿‡å‰é¢ä»‹ç»çš„é«˜é˜¶å‡½æ•°, map, fold ä»¥åŠæŸ¯é‡ŒåŒ–,
å…¶å®å·²ç»è§è¯†åˆ°ä»€ä¹ˆæ˜¯å‡½æ•°ç»„åˆäº†. å¦‚ä¹‹å‰ä¾‹å­ä¸­çš„ map å°±æ˜¯ ç”± fold å‡½æ•°ä¸
reverse å‡½æ•°ç»„åˆå‡ºæ¥çš„.

è¿™å°±æ˜¯å‡½æ•°å¼çš„æ€æƒ³, ä¸æ–­åœ°ç”¨å·²æœ‰å‡½æ•°, æ¥ç»„åˆå‡ºæ–°çš„å‡½æ•°.

\includegraphics[width=.9\linewidth]{./images/higherorder/composition.jpg}

å¦‚å›¾å°±æ˜¯å‡½æ•°ç»„åˆï¼Œæ¥è‡ª
\href{https://en.wikipedia.org/wiki/Category_theory}{Catgory Theory}ï¼ˆFuntor ä¹Ÿæ˜¯ä»è¿™æ¥çš„ï¼Œåé¢ä¼šè®²åˆ°ï¼‰, æ—¢ç„¶ä» Aåˆ°B
æœ‰å¯¹åº”çš„æ˜ å°„fï¼ŒBåˆ° Cæœ‰å¯¹åº”çš„æ˜ å°„gï¼Œ é‚£ä¹ˆ \texttt{(g.f)(x)} ä¹Ÿå°±æ˜¯ \texttt{f} ä¸ \texttt{g}
çš„ç»„åˆ \texttt{g(f(x))} å°±æ˜¯ Aåˆ° C çš„æ˜ å°„ã€‚ä¸Šä¸€ç« å®ç°çš„ map å‡½æ•°å°±ç›¸å½“äº
\texttt{reverse.fold}.

\section{Compose}
\label{sec:orgheadline20}

æˆ‘ä»¬å¯ä»¥ç”¨ Eweda éå¸¸æ–¹ä¾¿çš„ compose æ–¹æ³•æ¥ç»„åˆå‡½æ•°

\begin{verbatim}
var gf = E.compose(f, g)
\end{verbatim}

è¯´åˆ°äº†å‡½æ•°ç»„åˆ, æŸ¯é‡ŒåŒ–, æˆ‘æƒ³ç°åœ¨ç»ˆäºå¯ä»¥è§£é‡Šæ¸…æ¥šä¸ºä»€ä¹ˆåœ¨è¿™é‡Œé€‰ç”¨
Eweda/Ramda è€Œä¸æ˜¯ Underscore äº†.

ä¸¾ä¸ªä¾‹å­ğŸŒ° å¦‚æœæˆ‘ç°åœ¨æƒ³è¦ tasks åˆ—è¡¨ä¸­æ‰€æœ‰å±æ€§ä¸º \texttt{completed} ä¸º \texttt{true}
çš„å…ƒç´ , å¹¶æŒ‰ç…§ \texttt{id} æ’åº.

underscore é‡Œä¼šè¿™æ ·å†™:

\begin{verbatim}
_(tasks)
    .chain()
    .filter( task => task.completed===true)
    .sortBy( task => task.id)
    .value();
\end{verbatim}

è¿™ç§æ–¹å¼æ€ä¹ˆçœ‹éƒ½ä¸æ˜¯å‡½æ•°å¼, è€Œæ˜¯ä»¥å¯¹è±¡/å®¹å™¨ä¸ºä¸­å¿ƒçš„ä¸²è”ï¼Œæœ‰äº›åƒ jquery
å¯¹è±¡çš„é“¾å¼è°ƒç”¨, æˆ–è€…æˆ‘ä»¬å¯ä»¥å†™çš„å‡½æ•°å¼ä¸€äº›, å¦‚

\begin{verbatim}
_.sortBy(_.filter(tasks, task => task.completed===true), task => task.id)
\end{verbatim}

æ©æ©, çœ‹èµ·æ¥ä¸é”™å˜›, ä½†æ˜¯æœ‰è°æ˜¯è¿™ä¹ˆç”¨ underscoreçš„å‘¢. ä¸€èˆ¬éƒ½ä¼šåªè§è¿‡
é“¾å¼è°ƒç”¨æ‰æ˜¯ underscore çš„æ ‡å‡†å†™æ³•ã€‚

æ¥å¯¹æ¯”ä¸€ä¸‹ç”¨ Eweda/Ramda è§£å†³çš„è¿‡ç¨‹ :

\begin{verbatim}
compose(sortBy(task=>task.id), filter(task=>task.completed===true))(tasks)
\end{verbatim}

å¥½åƒæ²¡ä»€ä¹ˆåŒºåˆ«å•Š? ä¸å°±æ˜¯ç”¨äº† compose å—?

åŒºåˆ«å¤§äº†è¿™, çœ‹è§ \texttt{tasks} æ˜¯æœ€åå½“å‚æ•°ä¼ ç»™ \texttt{E.compose()} çš„å—?
è€Œä¸æ˜¯å†™æ­»åœ¨filter çš„å‚æ•°ä¸­. è¿™æ„å‘³ç€åœ¨æ¥åˆ°éœ€è¦å¤„ç†çš„æ•°æ®å‰,
æˆ‘å·²ç»ç»„åˆå¥½ä¸€ä¸ªæ–°çš„å‡½æ•°åœ¨ç­‰å¾…æ•°æ®, è€Œä¸æ˜¯æŠŠæ•°æ®æ··æ‚åœ¨ä¸­é—´,
æˆ–æ˜¯ä¿æŒåœ¨ä¸€ä¸ªä¸­é—´å¯¹è±¡ä¸­. è€Œ underscore
çš„å†™æ³•å¯¼è‡´è¿™ä¸€é•¿ä¸² \texttt{\_.sortBy(\_.filter())} å…¶å®æ ¹æœ¬æ— æ³•é‡ç”¨ã€‚

å¥½å§å¦‚æœä½ è¿˜çœ‹ä¸å‡ºæ¥è¿™æ ·åšçš„å¥½å¤„. é‚£ä¹ˆæ¥å¦‚æœæˆ‘æœ‰ä¸€ä¸ªåŒ…å«å‡ ç»„ tasksçš„åˆ—è¡¨
groupedTasks, æˆ‘è¦æŒ‰ç±»å‹é€‰å‡º completed ä¸º true å¹¶æŒ‰ id æ’åº.
å¦‚æˆ‘ç°åœ¨æ•°æ®æ˜¯è¿™ä¸ªï¼š

\begin{verbatim}
groupedTasks = [
  [{completed:false, id:1},{completed:true, id:2}],
  [{completed:false, id:4},{completed:true, id:3}]
]
\end{verbatim}

underscore:

\begin{verbatim}
_.map(groupedTasks,
   tasks => _.sortBy(_.filter(tasks, task => task.completed===true), task => task.id))
\end{verbatim}

çœ‹è§æˆ‘ä»¬åˆæŠŠ \texttt{\_.sortBy(\_.filter())} è¿™ä¸€é•¿ä¸²åŸå°ä¸åŠ¨çš„æ‹·è´åˆ°äº† map é‡Œã€‚
å› ä¸º underscore
ä¸€å¼€å§‹å°±è¦æ¶ˆè´¹æ•°æ®ï¼Œä½¿å¾—å¾ˆéš¾é‡ç”¨ï¼Œé™¤éåœ¨å¥—åœ¨å¦ä¸€ä¸ªå‡½æ•°é‡Œï¼š

\begin{verbatim}
function completedAndSorted(tasks){
  return _.sortBy(_.filter(tasks, task => task.completed===true), task => task.id))
}
_.map(groupedTasks, completedAndSorted)
\end{verbatim}

åªæœ‰è¿™æ ·æ‰èƒ½é‡ç”¨å·²æœ‰çš„ä¸€äº›å‡½æ•°ã€‚æˆ–è€…è™½ç„¶ underscore ä¹Ÿæœ‰ \texttt{\_.compose}
æ–¹æ³•ï¼Œä½†æ˜¯ å‡ ä¹æ‰€æœ‰ underscore
çš„æ–¹æ³•éƒ½æ˜¯å…ˆæ¶ˆè´¹æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•°æ®ï¼‰ï¼Œä½¿å¾—å¾ˆéš¾æ”¾åˆ° \texttt{compose}
æ–¹æ³•ä¸­ï¼Œä¸ä¿¡å¯ä»¥å°è¯•æŠŠ filter å’Œ sortBy æè¿›å»ï¼Œåæ­£æˆ‘æ˜¯åšä¸åˆ°ã€‚

æ¥çœ‹çœ‹çœŸæ­£çš„å‡½æ•°ç»„åˆ

\begin{verbatim}
var completedAndSorted = compose(sortBy(task=>task.id),
                                 filter(task=>task.completed===true))
map(completedAndSorted, groupedTasks)
\end{verbatim}

çœ‹å‡ºæ¥æ€æƒ³å®Œå…¨ä¸ä¸€æ ·äº†å§.

ç”±äº Eweda/Ramda çš„å‡½æ•°éƒ½æ˜¯è‡ªåŠ¨æŸ¯é‡ŒåŒ–,è€Œä¸”æ•°æ®æ€»æ˜¯æœ€åä¸€ä¸ªå‚æ•°,
å› æ­¤å¯ä»¥éšæ„ç»„åˆ, æœ€ç»ˆå°†éœ€è¦å¤„ç†çš„æ•°æ®æ‰”ç»™ç»„åˆå¥½çš„å‡½æ•°å°±å¥½äº†.
è¿™æ‰æ˜¯å‡½æ•°å¼çš„æ€æƒ³. å…ˆå†™å¥½ä¸€ä¸ªå…¬å¼ï¼Œåœ¨æŠŠæ•°æ®æ‰”ç»™
å…¬å¼ã€‚è€Œä¸æ˜¯ç®—å¥½ä¸€éƒ¨åˆ†å†æŠŠç»“æœç»™å¦ä¸€ä¸ªå…¬å¼ã€‚

\includegraphics[width=.9\linewidth]{./images/higherorder/ThreeFunctionMachines.jpg}

è€Œ underscore è¦ä¹ˆæ˜¯ä»¥å¯¹è±¡ä¿æŒä¸­é—´æ•°æ®, ç”¨ chaining
çš„æ–¹å¼å¯¹ç›®æ ‡åº”ç”¨å„ç§å‡½æ•°ï¼ˆä¹¦ä¸Šä¼šå†™è¿™æ˜¯Flow-Base
programmingï¼Œä½†æˆ‘è§‰å¾—å…¶å®æ˜¯ Monadï¼Œä¼šåœ¨ä¸‹ä¸€ç« ä¸­ä»‹ç»ï¼‰,
è¦ä¹ˆç”¨å‡½æ•°åµŒå¥—å‡½æ•°, å°†ç›®æ ‡ä¸€å±‚å±‚ä¼ é€’ä¸‹å».

\section{pipe}
\label{sec:orgheadline21}

ç±»ä¼¼ compose, eweda/ramda è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å« pipe, pipe çš„å‡½æ•°æ‰§è¡Œæ–¹å‘åˆšå¥½ä¸
compose ç›¸å. æ¯”å¦‚ \texttt{pipe(f, g)}, \texttt{f} ä¼šå…ˆæ‰§è¡Œ, ç„¶åç»“æœä¼ ç»™ \texttt{g},
æ˜¯ä¸æ˜¯è®©ä½ æƒ³èµ·äº† bash çš„ pipe

\begin{verbatim}
find / | grep porno
\end{verbatim}

å®é™…ä¸Šå°±æ˜¯ \texttt{pipe(find, grep(porno))(/)}

æ²¡é”™,ä»–ä»¬éƒ½æ˜¯ä¸€ä¸ªæ„æ€. è€Œä¸”è¿™ä¸ªå‡½æ•°æ‰§è¡Œçš„æ–¹å‘æ›´é€‚åˆäººè„‘ç¼–è¯‘(å¯è¯»)ä¸€äº›.

å¦‚æœä½ å·²ç»ä¹ æƒ¯ underscore çš„è¿™ç§å†™æ³•

\begin{verbatim}
_(data)
  .chain()
  .map(data1,fn1)
  .filter(data2, fn2)
  .value()
\end{verbatim}

é‚£ä¹ˆè½¬æ¢æˆ pipe æ˜¯å¾ˆå®¹æ˜“çš„ä¸€ä»¶äº‹æƒ…ï¼Œè€Œä¸”æ›´ç®€å•æ˜äº†æ˜“äºé‡ç”¨å’Œç»„åˆã€‚

\begin{verbatim}
pipe(
  map(fn1),
  filter(fn2)
)(data)
\end{verbatim}
\part{Transducers}
\label{sec:orgheadline31}
é€šè¿‡ä¸Šä¸€ç¯‡\href{./clojure-core.async-essence-in-native-javascript.org}{Clojureé£æ ¼çš„JavaScriptå¹¶å‘ç¼–ç¨‹}ä»‹ç»äº†å¦‚ä½•ç”¨JavaScriptäº«å—åˆ°Clojureåœ¨å¹¶å‘ç¼–ç¨‹çš„ä¼˜åŠ¿. æˆ‘å†³å®š
å†™ä¸€ç³»åˆ—å…³äºå¦‚ä½•ç”¨JavaScriptç©è½¬Clojureå¤§æ³•çš„æ–‡ç« . è¿™å›è¦ç”¨JavaScriptç©è½¬å¦ä¸€ä¸ª
Clojureå…¨æ–°çš„æ¦‚å¿µ -- \emph{Transducer}.

Transducer æ˜¯ Rich Hickey\footnote{Clojureçš„ä½œè€…} \href{http://blog.cognitect.com/blog/2014/8/6/transducers-are-coming}{é«˜è°ƒå®£å¸ƒ} çš„åœ¨Clojure 1.7 ç‰ˆæœ¬åŠ å…¥çš„åˆä¸€å¤§æ³•. åœ¨ä¹‹å‰çš„å¦ä¸€ä¸ªæ¦‚å¿µ
\href{http://clojure.com/blog/2012/05/15/anatomy-of-reducer.html}{Reducer} å´æ²¡é‚£ä¹ˆ \textbf{é«˜è°ƒ}. åœ¨è§£é‡Štransducerä¹‹å‰, å…ˆçœ‹çœ‹ä»€ä¹ˆæ˜¯Reducer, å¦‚æœèƒ½çœ‹æ‡‚, å†æ¥ç€çœ‹Transducer.

\chapter{Reducer}
\label{sec:orgheadline27}
\index{reducer}
è¯´é“reduceè¿™ä¸ªè¯, æƒ³å¿…JS Developerå¤§å¤šä¼šç”¨è¿‡underscore\footnote{æˆ‘æ˜¯æ•…æ„å§reduceçš„å‚æ•°é¡ºåºå†™"å"çš„, åŸæ¥underscoreæ˜¯å…ˆæ¶ˆè´¹collectionçš„. è‡³äºä¸ºä»€ä¹ˆè¦åè¿‡æ¥
å¯ä»¥å‚è€ƒ\href{http://blog.oyanglul.us/javascript/functional-javascript.html#sec-3-2}{è¿™ä¸ªè§£é‡Š}}(æˆ–ç±»ä¼¼)çš„reduceæ–¹æ³•, å¤§æ¦‚å½¢å¼æ˜¯è¿™æ ·
\begin{verbatim}
_.reduce(fn, 0, [1,2,3])
\end{verbatim}
å¤§æ¦‚æ„æ€æ˜¯åˆå§‹ä¸º0, åº”ç”¨fnåˆ°æ¯ä¸€ä¸ªcollection(æ£€æµ‹coll)å…ƒç´ ä¸Š,å¾—åˆ°ä¸€ä¸ªæ–°çš„å€¼.

å¦‚æœåŠ ä¸Šmap, æ¯”å¦‚(æˆ‘è¦å¼€å§‹ç”¨\href{https://github.com/swannodette/mori}{mori}\footnote{clojurescriptä½œè€…æŠŠclojurescriptçš„ä¸€äº›æ•°æ®ç»“æ„å’Œå‡½æ•°ç¼–è¯‘æˆjavascript, è¿™æ ·å°±å¯ä»¥ç”¨æ™®é€šjsä½¿ç”¨
clojureä¸­çš„æ•°æ®ç»“æ„å’Œå‡½æ•°. documentä¸¥é‡è¿‡æ—¶, å»ºè®®çœ‹å¯¼å…¥çš„\href{https://github.com/swannodette/mori/blob/master/src/mori.cljs}{æºä»£ç }, ä»¥åŠclojureçš„æ–‡æ¡£, æ¥å£å’ŒclojureåŸºæœ¬ä¸€è‡´.} äº†)
\begin{verbatim}
reduce(sum, 0, map(inc [1,2,3]))
\end{verbatim}

\begin{quote}
Terminology:
\begin{enumerate}
\item reducing å‡½æ•°: ç”¨æ¥reduceçš„å‡½æ•°, æ¯”å¦‚sum
\item transform: å˜æ¢, ä»ä¸€ä¸ªå‡½æ•°å˜å¦ä¸€ä¸ªå‡½æ•°
\item xf: xform, transform å‡½æ•°
\item reducible: å¯è¢«reduceçš„,ä¹Ÿå°±æ˜¯å®ç°reduceæ¥å£çš„,æ¯”å¦‚æ‰€æœ‰çš„collection
\end{enumerate}
\end{quote}

è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åˆ†æä¸€ä¸‹è¿™æ¬¡reduceåˆ°åº•å¹²äº†ä»€ä¹ˆ
\begin{enumerate}
\item map å‡½æ•° inc åˆ° coll æ¯ä¸€ä¸ªå…ƒç´ , å¾—åˆ°ä¸€ä¸ªæ–°çš„ coll \texttt{[2,3,4]}
\item reduce æŠŠæ–°collçš„æ¯ä¸ªå…ƒç´ ç”¨sumå‡½æ•°, å¾—åˆ°ä¸€ä¸ªæ–°çš„å€¼.
\end{enumerate}

å¥½å§è¿™å°±æ˜¯reduceäº†, ç”¨ä¸€ä¸ªreducingå‡½æ•°sumå»è®¡ç®—collå¾—å‡ºä¸€ä¸ªæ–°çš„å€¼.

æ¥çœ‹çœ‹æ›´å¥½çš„è§£æ³•
\section{transform}
\label{sec:orgheadline24}
\index{xform}
reduceå‡½æ•°éœ€è¦ç­‰å¾…mapè¿”å›æ–°çš„collåæ‰èƒ½reduce, é‚£ä¹ˆå¯ä¸å¯ä»¥ä¸€æ­¥ç›´æ¥ç®—å‡ºæ¥å‘¢?

å‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°xfå¯ä»¥å˜æ¢reducingå‡½æ•°(ä¸Šä¾‹çš„sumæ˜¯reducingå‡½æ•°)çš„å½¢å¼, æ¯”å¦‚
\begin{verbatim}
xf(reduceFn) -> anotherReduceFn
\end{verbatim}

å†å‡å¦‚æˆ‘ä»¬çš„æ–°mapå‡½æ•°å¯ä»¥åšè¿™ç§è½¬æ¢
\begin{verbatim}
map(inc)(sum) -> aShinyNewReduceFn
\end{verbatim}

\begin{quote}
map å‡½æ•°çš„ç®€å•transformå®ç°å¯ä»¥è¿™æ ·å®ç°,å¦‚æœä½ æ„Ÿå…´è¶£çš„è¯
\begin{verbatim}
function map(fn){
  return function(reduceFn){
    return function(result, input){
      reduceFn(result, fn(input))
    }
  }
}
\end{verbatim}
\end{quote}

é‚£ä¹ˆæˆ‘ä»¬ä¹‹å‰çš„reduceå°±å¯ä»¥å†™æˆ

\begin{verbatim}
reduce(map(inc)(sum),0,[1,2,3])
\end{verbatim}

yeah, ç°åœ¨åªéœ€è¦ä¸€æ­¥å°±reduceå‡ºæ¥ç»“æœäº†, reduceåº”ç”¨ \texttt{map(inc)(sum)} æ¥è®¡ç®—å€¼, åªéœ€è¦éå†ä¸€écoll

\section{\href{http://clojure.org/reducers}{Reducer}}
\label{sec:orgheadline26}
ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸æƒ³æ”¹å˜mapå‡½æ•°çš„æ¥å£, åŸå§‹å½¢å¼çš„æ¥å£è¿˜æ˜¯æ¯”è¾ƒå¥½å†™å¥½è¯»çš„
\begin{verbatim}
reduce(sum, 0, map(inc [1,2,3]))
\end{verbatim}
é‚£ä¹ˆéœ€è¦è¿›ä¸€æ­¥çš„æŠ½è±¡, æˆ‘æŠŠæ–°çš„mapå‡½æ•°å«åšrmapå¥½äº†
\begin{verbatim}
function rmap(fn, coll){
  reducer(coll, map(fn))
}
\end{verbatim}
è·Ÿä»¥å‰æ¥å£ä¸€æ ·,æ¥æ”¶å‡½æ•°å’Œcoll,ä½†æ˜¯è¿”å›ä¸€ä¸ªç”±reducerç”Ÿæˆçš„reducible, æ‰€ä»¥å°±å˜æˆäº†
\begin{verbatim}
reduce(sum, 0, reducer([1,2,3], map(inc)))
\end{verbatim}

ç­‰ç­‰,æ€ä¹ˆåšåˆ°çš„\ldots{}ä½ å·²ç»æ¶ˆè´¹äº†colläº†, é‚£reducingå‡½æ•°æ€ä¹ˆè¿›æ¥çš„, reduceræ€ä¹ˆçŸ¥é“ç”¨sumå»reduceå‘¢.


\begin{itemize}
\item Reducible
\label{sec:orgheadline25}
\index{reducible}
ç­”æ¡ˆæ˜¯, åè½¬reduceçš„å…³ç³», åŸæ¥reduceç”¨sumå»è®¡ç®—ç»“æœ, ç°åœ¨,æˆ‘ä»¬è°ƒç”¨reducibleçš„reduceæ–¹æ³•æ¥è®¡ç®—ç»“æœ

\url{./images/came-out.gif}

å¦‚æœä½ è¿˜æ²¡æœ‰è¢«æˆ‘å¼„æ™•çš„è¯, å‡†å¤‡å¥½, åˆæ¥ä¸€ä¸ªæ–°å•è¯ \emph{reducible}. ä¹Ÿå°±æ˜¯å¯ä»¥è¢«reduceçš„ä¸œè¥¿.

äºæ˜¯æˆ‘ä»¬éœ€è¦collå®ç°reduceæ–¹æ³•,è¿™æ ·å°±æˆä¸ºreducibleäº†.

ä¹Ÿå°±æ˜¯reduceå‡½æ•°ç°åœ¨åº”è¯¥é•¿è¿™æ ·, æˆ‘ä»¬æš‚ä¸”å«å®ƒ \texttt{rreduce}
\begin{verbatim}
function rreduce(reduceFn, init, reducible){
  reducible(reduceFn, init)
}
\end{verbatim}
é‚£ä¹ˆæˆ‘ä»¬çš„ä¾‹å­å°±å˜æˆäº†è¿™æ ·
\begin{verbatim}
reducer([1,2,3], map(inc))(sum, 0)
\end{verbatim}
reduceræ¥æ”¶collå’Œxf, è¿”å›reducibleå‡½æ•°. è¿™ä¸€åˆ‡éƒ½æ˜¯lazyçš„, ç›´åˆ°rreduceè°ƒç”¨ç¬¬collè¡Œæ‰æ‰§è¡Œ.
\begin{verbatim}
function reducer(coll, xf){
  return function(reduceFn, init){
    return coll.reduce(xf(reduceFn), init)      (coll)
  }
}
\end{verbatim}
\end{itemize}

\chapter{Transducer}
\label{sec:orgheadline28}
\index{transducer}
è¯´äº†åŠå¤©Reducer,æ˜æ˜è¯´å¥½çš„è¦è§£é‡Šçš„Transducerå‘¢?

å¦‚æœä½ è¿˜èƒ½follow, é‚£ä¹ˆç°åœ¨è¦å¼€å§‹è§£é‡ŠTransduceräº†

å…¶å®ä½ å·²ç»è§è¿‡Transduceräº†, å†å›é¡¾ä¸€ä¸‹ä¹‹å‰è¯´çš„Reducer
\begin{enumerate}
\item æ¥æ”¶ä¸€ä¸ªxfå‡½æ•°å’Œä¸€ä¸ªcoll
\item ç”¨xfè½¬æ¢reducingå‡½æ•°, å¹¶åº”ç”¨åˆ°coll
\end{enumerate}

Transducerå°±æ˜¯é‚£ä¸ªxf
\begin{verbatim}
reduce(map(inc)(sum),0,[1,2,3])
\end{verbatim}
ä¹Ÿå°±æ˜¯è¿™é‡Œé¢çš„ \texttt{map(inc)}

é , å°±è¿™ä¹ˆç®€å•?

å°±æ˜¯è¿™ä¹ˆç®€å•, å‰é¢è¯´äº†reducerçš„å‡ºç°æ˜¯å› ä¸ºæƒ³ä¿æŒåŸå§‹reduceçš„apiä¸ä¾¿, é‚£ä¹ˆtranduceråˆ™æä¾›äº†
å¦å¤–ä¸€ç§reduce api

\begin{verbatim}
transduce(map(inc), sum, 0, [1,2,3])
\end{verbatim}
transduceæ¥æ”¶ä¸€ä¸ªtransducer,ä¸€ä¸ªreducing function, ä¸€ä¸ªåˆå§‹å€¼, ä¸€ä¸ªcoll. è¿™æ®µä»£ç è·Ÿå‰é¢å¹²çš„äº‹æƒ…ä¸€æ¨¡ä¸€æ ·.

å¦å¤–ç‰›é€¼çš„æ˜¯transducerè·Ÿcontextå®Œå…¨æ²¡æœ‰å…³ç³», å°±æ˜¯å®Œå…¨ä¸æ•°æ®è§£è€¦å¼€æ¥, æ¯”å¦‚æˆ‘ä»¬ç»„è£…å¥½ä¸€ä¸ªtransducer xf

å¯ä»¥ç”¨åœ¨ä»»ä½•åœ°æ–¹
\begin{verbatim}
seq(xf data) //ç”Ÿæˆä¸€ä¸ªlazyçš„åºåˆ—, åŒæ—¶lazy transform, æ¯æ¬¡å–çš„æ—¶å€™dataä¼šè¢«transform
into([], xf data) //æŠŠ data transformåæ”¾åˆ°ä¸€ä¸ªæ•°ç»„é‡Œ
chan(1, xform) // å½“æ•°æ®ç»è¿‡CSPçš„channelæ—¶è¢«transform
\end{verbatim}


\chapter{Is it Curry?}
\label{sec:orgheadline29}
æ€ä¹ˆçœ‹ç€æœ‰ç‚¹åƒæŸ¯é‡ŒåŒ–, ä¸€æ ·ä¹ˆ?

å½“ç„¶ä¸æ˜¯, æŸ¯é‡ŒåŒ–æˆ–è€…éƒ¨åˆ†å‚æ•°åªæ˜¯éƒ¨åˆ†é…ç½®å‚æ•°, è€Œtransduceræ˜¯ä¸€æ¬¡å¤šnæ¬¡è½¬æ¢çš„ç»„åˆ

æ¯”å¦‚ä¸€ä¸ªæŸ¯é‡ŒåŒ–çš„mapå¯ä»¥
\begin{verbatim}
var mapinc = map(inc)
mapinc([1,2,3])
\end{verbatim}

è€Œä¸èƒ½
\begin{verbatim}
mapinc(sum)
\end{verbatim}
å› ä¸ºmapå°±ä¿©å‚æ•°, ç¬¬ä¸€ä¸ªæ˜¯å‡½æ•°ç¬¬äºŒä¸ªæ˜¯data, å¦‚æœå†ç»™dataä¼šé”™è¯¯

ä½†æ˜¯tranceduceråªæ˜¯è½¬æ¢, æ‰€ä»¥åªæ¥å—reducingå‡½æ•°
\begin{verbatim}
reduce(mapinc(sum), 0, [1,2,3])
// => 9
\end{verbatim}

\chapter{å®Œæ•´ä¾‹å­}
\label{sec:orgheadline30}

\part{Functor}
\label{sec:orgheadline35}

\chapter{Functor}
\label{sec:orgheadline32}

Functor æ˜¯ å¯ä»¥è¢« map over çš„ç±»å‹. ä»€ä¹ˆå« map over\ldots{}

æ¯”å¦‚ list å°±å¯ä»¥è¯´æ˜¯å¯ä»¥è¢«map over\ldots{} é‚£ä¹ˆæ˜¯ä¸æ˜¯å¯æšä¸¾ç±»å‹?

ä¸æ˜¯çš„, æ¥çœ‹çœ‹ Haskell ä¸­å¦‚ä½•è§£é‡Š(å…¶å®æ‰€æœ‰å‡½æ•°å¼çš„æ¦‚å¿µå¯èƒ½ç”¨ haskell
æ˜¯æœ€èƒ½è¯´æ˜é—®é¢˜çš„äº†).

\begin{verbatim}
ghci > :t fmap
fmap :: (a -> b) -> fa -> f b
\end{verbatim}

\texttt{fmap} åˆæ˜¯ä»€ä¹ˆä¸œè¥¿, fmap æ˜¯ map over Functor çš„å‡½æ•°.
è¿™ä¸ªå‡½æ•°åªå¹²ä¸€ä¸ªäº‹æƒ…, å¯èƒ½é€šè¿‡å‰é¢è§£é‡Šçš„ä¸€ç‚¹ç‚¹
HaskellåŠŸå¤«,ä½ å¯èƒ½èƒ½ç¿»è¯‘ \texttt{(a -> b) -> fa -> f b} äº†æŠŠ. ç»™å®šä¸€ä¸ªä» \texttt{a} åˆ° \texttt{b}
çš„æ˜ å°„å‡½æ•°, å†ç»™å®šä¸€ä¸ª a çš„ Functor, è¿”å›ä¸€ä¸ª b çš„ Functor.

è™½ç„¶ä¸ªä¸ªå­—éƒ½è®¤è¯†, ä½†æ€ä¹ˆå°±ä¸çŸ¥é“å•¥æ„æ€.

å¦‚æœæˆ‘å†è¯´ä¸€ä¸ªæ–°è¯, ä½ æ˜¯ä¸æ˜¯ä¼šç–¯æ‰äº†-- Lift.

å¥½å§, æŠŠä»–ä»¬éƒ½ä¸²èµ·æ¥, ä½ å°±æ˜ç™½äº†. 
\begin{enumerate}
\item å¹³å¸¸æˆ‘ä»¬å¯ä»¥æŠŠ \texttt{a} åˆ° \texttt{b} çš„æ˜ å°„å¯ä»¥å«åš map, æ˜ å°„çš„æ–¹å¼å°±æ˜¯å‡½æ•°äº†.
\item é‚£ä¹ˆç±»ä¼¼çš„å¯¹äºå‡½æ•°æˆ–è€…å…¶ä»–å¯ä»¥åšè¿™ç§ map æ“ä½œçš„ç±»å‹æˆ–ä¸€ç§è®¡ç®—æ–¹å¼, å«åš Functor.
\item è€Œè¿™ç§ map å°±å«åš fmap, ç»™å®š a é›†åˆåˆ° b é›†åˆçš„æ˜ å°„æ–¹å¼(ä¹Ÿå°±æ˜¯ä¸€ä¸ªå‡½æ•°), å°±èƒ½æ‰¾åˆ° å¯¹ a çš„ä¸€ç§è®¡ç®—(computation, ä»»ä½•å¯å˜æ¢çš„ç±»å‹, è¿™å°±æ˜¯ Functor) çš„å˜æ¢ -- å¯¹ b çš„å¯¹åº”è®¡ç®—æ–¹å¼.
\item å¦‚æœè¯¥è®¡ç®—æ˜¯ä¸€ä¸ªå‡½æ•°, é‚£ä¹ˆè¿™ä¸ªæ“ä½œå«åš lifting. éå¸¸å½¢è±¡çš„, æ ¹æ® a åˆ° b çš„æ˜ å°„ lift(ä¸¾) åˆ°å¦ä¸€ä¸ªå±‚é¢ä¸Š.
\end{enumerate}

\url{http://learnyouahaskell-zh-tw.csie.org/img/lifter.png}

è™½ç„¶ lifting å¾ˆå½¢è±¡, ä½†æ˜¯è¿˜æ˜¯è¶Šè¯´è¶ŠæŠ½è±¡äº†, æ¥ä¸¾ä¸ªæ —å­. 
\chapter{ä¸¾ä¸ªæ —å­ğŸŒ°}
\label{sec:orgheadline33}
\begin{quote}
æ³¨æ„æˆ‘ä»¬è¿˜æ²¡æœ‰å®ç° Functor, å› æ­¤ä¸‹é¢çš„æ —å­è¿˜ä¸èƒ½è¿è¡Œåœ¨ä½ çš„
console.
\end{quote}

å‰é¢è¯´äº†, Functor å¯ä»¥æ˜¯æ•°ç»„, å› ä¸ºæ•°ç»„å¯ä»¥è¢« map over

\begin{verbatim}
var plus1 = n => n+1;
fmap(plus1, [2, 4, 6, 8])// => [3,5,7,9]
\end{verbatim}

è¿™é‡Œ,æ•°ç»„ Array å°±æ˜¯ Functor ç±»å‹, è€Œ fmap æŠŠ 2 -> 3 çš„æ˜ å°„æ–¹å¼å¯¹ Array
[2,4,6,8] è¿›è¡Œäº†å˜æ¢, å¾—åˆ° [3,5,7,9]. è¿™è·Ÿæ•°ç»„çš„ map æ–¹æ³•ä¸€æ ·,
æ¯”è¾ƒå¥½ç†è§£.

å†è¯•è¯•æ¢ä¸€ç§ Functor ç±»å‹, è¯•è¯•å‡½æ•°

\begin{verbatim}
var times2 = m => m*2;
fmap(plus1, times2) // => function(){}
fmap(plus1, times2)(3) // => 7 (3*2+1)
\end{verbatim}

çœ‹åˆ° fmap è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°, å› ä¸ºä½  map over çš„æ˜¯ä¸€ä¸ªå‡½æ•° \texttt{times2}. è¿˜è®°å¾—
\texttt{(a -> b) -> f a -> f b} çš„å…¬å¼ä¹ˆ, å› ä¸ºç°åœ¨çš„ Functor ä¸º Function ç±»å‹,
æˆ‘ä»¬å¯ä»¥æŠŠ=f=æ›¿æ¢æˆå‡½æ•°ä¹Ÿå°±æ˜¯ x åˆ° y çš„æ˜ å°„, å› æ­¤æˆ‘ä»¬å¯ä»¥å°†è¯¥å…¬å¼æ›¿æ¢ä¸º

\begin{verbatim}
(a -> b) -> (x -> a) -> (x -> b)
\end{verbatim}

å†ç”¨æˆ‘ä»¬å…·ä½“çš„å‡½æ•° plus1 æ›¿æ¢è¿›å»

\begin{verbatim}
(n->n*2) -> plus1(n) -> plus1(n*2)
\end{verbatim}

ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸ª fmap ä¼šæŠŠå‡½æ•° times2 åº”ç”¨åˆ° plus1 çš„ä»»ä½•ç»“æœä¸Š.

è¿™ä¸å°±æ˜¯å‡½æ•°ç»„åˆå— \texttt{plus1(times2(3))}, ç¡®å®æ˜¯çš„. ä½†è¿™åªæ˜¯ Functor
çš„å†°å±±ä¸€è§’, danåœ¨æ¥çœ‹çœ‹åˆ«çš„Functor

Functor è¿˜å¯ä»¥æ˜¯åˆ«çš„ä¸œè¥¿\ldots{}æ¯”å¦‚

\begin{verbatim}
fmap(plus1, Either(10, 20))
\end{verbatim}

Eitherä¹Ÿæ˜¯ Functor, æ…¢ç€, Either æ˜¯ä»€ä¹ˆç±»å‹, å¥½å§,åœ¨è§£é‡Š Either ä¹‹å‰,
æˆ‘ä»¬å…ˆå¿ä¸€å¿, æ¥å…ˆçœ‹çœ‹ JavaScript ä¸­æ€ä¹ˆå®ç°ä»¥åŠä½¿ç”¨ä¸€ä¸ª Functor.

\chapter{Functor in JavaScript}
\label{sec:orgheadline34}

é¦–å…ˆ, æˆ‘ä»¬ç”¨å®šä¹‰ä¸€ä¸ªç¡®å®š Functor ç±»å‹çš„å‡½æ•°, å¦‚æœæ²¡æœ‰æ³¨å†Œçš„ç±»å‹æŠ›å‡ºå¼‚å¸¸.

\begin{verbatim}
var types = function(obj) {
  throw new TypeError("fmap called on unregistered type: " + obj);
};
\end{verbatim}

ç„¶åå®ç°æ³¨å†Œ Functor çš„å‡½æ•°.

\begin{verbatim}
 Functor = function(type, defs) {
        var oldTypes = types;
        types = (obj) => {
            if (type.prototype.isPrototypeOf(obj)) {
                return defs; // è¿™æ˜¯é€’å½’çš„å‡ºå£, åˆ¤æ–­ç±»å‹, ç¡®å®š fmap çš„ Functor å®ä¾‹å±äºæ³¨å†Œçš„å“ªä¸€ä¸ª Functor
            }
            return oldTypes(obj); //ä¸æ–­é€’å½’å¯»æ‰¾ types, è¿™ä¸ªæ•ˆç‡ä¼šå¾ˆä½, å› ä¸ºè°ƒç”¨æ ˆä¸Šå¥½å¤šé—­åŒ…, æ¯ä¸ªé—­åŒ…éƒ½ä¿æŒç€ type å’Œ defs
        }
};
\end{verbatim}

è¿™æ ·å¯ä»¥ç”¨ Functor å‡½æ•°æ³¨å†Œä¸€ä¸ªæ–°çš„ Functor ç±»å‹å¹¶å®šä¹‰å®ƒè‡ªå·±çš„ fmap
æ–¹æ³•(è¿˜è®°å¾—å‰é¢è¯´çš„ Functor åªæœ‰ä¸€ä¸ªæ–¹æ³•å—). æ¯”å¦‚æˆ‘ä»¬è¦æŠŠ Array å˜æˆ
Functor

\begin{verbatim}
Functor(Array, {
    fmap: (fn, array) => {
        arr.map(x => fn(x))
    }
})
\end{verbatim}

å¥½åƒå¿«è¦å®Œæˆçš„æ ·å­. ç°åœ¨è¿˜å·® fmap Functor ç±»å‹å‡½æ•°äº†.
è¿™ä¸ªå‡½æ•°å¹²ä¸¤ä»¶äº‹æƒ…, æ‰¾åˆ°å®ä¾‹å±äºå“ªä¸ª Functor ç±»å‹, å¹¶è°ƒç”¨ä»–çš„ fmap æ–¹æ³•.

\begin{verbatim}
fmap = eweda.curry((fn, obj) => {
    return types(obj).fmap(f, obj)
})
\end{verbatim}

åŒæ ·çš„, æˆ‘ä»¬å¾ˆå¿«å¯ä»¥æŠŠ Function ä¹Ÿå˜æˆ Functor

\begin{verbatim}
Functor(Function, {
    fmap: (f, g) => {
        return eweda.compose(f, g);
}})
\end{verbatim}

è¿˜è®°å¾—å‰é¢è¯´ fmap å‡½æ•°åƒå‡½æ•°ç»„åˆå—, å‘µå‘µ, æˆ‘ä»¬è¿™é‡Œå°±æŒ‰å‡½æ•°ç»„åˆå®ç°.

\rule{\linewidth}{0.5pt}

æ¥æ€»ç»“ä¸€ä¸‹ fmap å’Œ Functor åˆ°åº•æ˜¯ä»€ä¹ˆ, fmap å¯ä»¥å°†å‡½æ•°åº”ç”¨åˆ° Functor ä¸Š,
Functor å¯ä»¥çœ‹åšæ˜¯å®¹å™¨æˆ–è€…æ˜¯å¸¦ context çš„å€¼. ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬æƒ³å˜æ¢ x
çš„å€¼, ç›´æ¥ç»™ä¸€ä¸ªå‡½æ•°æ˜ å°„ \texttt{x=> x*2} å³å¯. å¦‚æœæˆ‘æƒ³å˜æ¢ä¸€ä¸ªæ•°ç»„, ä¸€ä¸ªå‡½æ•°,
æˆ–è€… Either è¿™ç§å¸¦æœ‰ context çš„æˆ–è€…è¯´å®¹å™¨é‡Œé¢çš„å€¼,
æ€»ä¸èƒ½ç›´æ¥æŠŠè¿™äº›å®¹å™¨ç›´æ¥ç»™å‡½æ•°å§ï¼Œè¿™æ—¶å°±éœ€è¦ fmap
å°†å‡½æ•°çš„æ˜ å°„å…³ç³»åº”ç”¨åˆ°å®¹å™¨é‡Œé¢çš„å€¼.
å…¶å®å°±æ˜¯æ‰“å¼€ï¼Œè°ƒä¸€ä¸‹å‡½æ•°ï¼Œå®Œäº†å†åŒ…å¥½ã€‚

å¥½å§, é€šè¿‡å¦‚ä½•å®ç°å’Œä½¿ç”¨ä¸€ä¸ªç®€å•çš„ Functor, æ¦‚å¿µä¸Šå·²ç»ä¼°è®¡å¯ä»¥ç†è§£äº†,
æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹çœ‹ Either æ˜¯ç¥é©¬ç©æ„.

\href{http://jsbin.com/xezun/1/embed?js,console}{å®Œæ•´ä»£ç }
\part{Monad}
\label{sec:orgheadline42}

è¿™ä¸ªæ¦‚å¿µå¥½éš¾è§£é‡Š, ä½ å¯ä»¥ç†è§£ä¸ºä¸€ä¸ª Lazy æˆ–è€…æ˜¯çŠ¶æ€æœªçŸ¥çš„ç›’å­.
å¬èµ·æ¥åƒæ˜¯\href{http://zh.wikipedia.org/wiki/\%E8\%96\%9B\%E5\%AE\%9A\%E8\%B0\%94\%E7\%8C\%AB}{è–›å®šè°”çŒ«}(ä¼°è®¡ç‚¹è¿›å»ä½ ä¼šæ›´æ™•äº†).
å…¶å®å°±æ˜¯çš„, åœ¨ä½ æ‰“å¼€è¿™ä¸ªç›’å­ä¹‹å‰, ä½ æ˜¯ä¸çŸ¥é“é‡Œé¢çš„çŒ«å¤„åœ¨é‚£ç§çŠ¶æ€.

Monad è¿™ä¸ªé»‘ç›’å­, é‡Œé¢åˆ°åº•å–çš„ç¥é©¬è¯,æˆ‘ä»¬è¦æ‰“å¼€å–äº†æ‰çŸ¥é“.

ç­‰ç­‰, ä¸æ˜¯è¯´å¥½è¦è§£é‡Š Either çš„å—, å—¯å—¯, è¿™é‡Œå°±æ˜¯åœ¨è§£é‡Š Either. ä¸ŠèŠ‚è¯´
Either æ˜¯ä¸€ä¸ª Functor, å¯ä»¥è¢« fmap over. æ€ä¹ˆè¿™é‡Œåˆè¯´é“é»‘ç›’å­äº†? å¥½å§,
Monad å…¶å®ä¹Ÿæ˜¯ Functor. è¿˜è®°å¾—æˆ‘è¯´çš„ Functor å…¶å®æ˜¯ä¸€ä¸ªå¸¦ context
çš„ç›’å­å—. è€Œ fmap ä½¿å¾—å¾€ç›’å­é‡Œåº”ç”¨å‡½æ•°å˜æ¢æˆä¸ºäº†å¯èƒ½.

\chapter{Either}
\label{sec:orgheadline36}

å…ˆæ¥çœ‹çœ‹ Either è¿™ç§ç±»å‹ä¼šå¹²ä»€ä¹ˆäº‹æƒ….
\href{http://hackage.haskell.org/package/base-4.7.0.0/docs/Data-Either.html#t:Either}{Either}è¡¨ç¤ºè¦ä¸æ˜¯å·¦è¾¹å°±æ˜¯å³è¾¹çš„å€¼,
å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è¡¨ç¤ºè–›å®šè°”çŒ«, è¦ä¸æ˜¯æ´»ç€, è¦ä¸æ­»äº†. Either è¿˜æœ‰ä¸ªæ–¹æ³•:
either

\begin{verbatim}
(a -> c) -> (b -> c) -> Either a b -> c
\end{verbatim}

æƒ³å¿…ä½ å·²ç»å¯¹ç®­å¤´ \texttt{->} éå¸¸ç†Ÿäº†å§.å¦‚æœå‰é¢å‡ ç« ä½ éƒ½è·³è¿‡äº†,æˆ‘å†ç¿»è¯‘ä¸‹å¥½äº†.
è¿™é‡Œè¡¨ç¤ºæ¥æ”¶å‡½æ•° \texttt{a->c} å’Œå‡½æ•° \texttt{b->c}, å†æ¥æ”¶ä¸€ä¸ª Either, å¦‚æœ Either
çš„å€¼åœ¨å·¦è¾¹,åˆ™ä½¿ç”¨å‡½æ•°æ˜ å°„ \texttt{a->c}, è‹¥å€¼åœ¨å³è¾¹,åˆ™åº”ç”¨ç¬¬äºŒä¸ªå‡½æ•°æ˜ å°„ \texttt{b->c}.

ä½œä¸º Monad, å®ƒè¿˜å¿…é¡»å…·å¤‡ä¸€ä¸ªæ–¹æ³• '>>='(è¿™ä¸ªç¬¦å·å¥½çœ¼ç†Ÿçš„è¯´, çœ‹çœ‹ haskell
çš„ logo, ä½ å°±çŸ¥é“ Monad æ˜¯æœ‰å¤šé‡è¦), ä¹Ÿå°±æ˜¯ bind æ–¹æ³•.

\url{http://www.haskell.org/wikistatic/haskellwiki_logo.png}

bind æ–¹æ³•çš„æ„æ€å¾ˆç®€å•, å°±æ˜¯ç»™è¿™ä¸ªç›’å­åŠ ä¸€ä¸ªæ“ä½œ,
æ¯”å¦‚å¾€ç›’å­åœ¨åŠ æ”¾å°„æ€§åŸå­,å¦‚æœçŒ«æ´»ç€,å°±æ˜¯ç»¿å·¨çŒ«,
å¦‚æœçŒ«æ˜¯æ­»çš„,é‚£å°±æ˜¯ç»¿å·¨æ­»çŒ«.

\begin{verbatim}
Left("cat").bind(cat => Right('hulk'+cat))
// => Left "hulkcat"
Right("deadcat").bind(cat => Left('hulk' + cat))
// => Right "hulkdeadcat"
\end{verbatim}

è¿™æœ‰ä¸ªæ¯›ç”¨å•Š. è¡¨æ€¥\ldots{} æ¥çœ‹ä¸ªç»å…¸ä¾‹å­ 

\chapter{èµ°é’¢ç´¢}
\label{sec:orgheadline39}

çš®å°”æ–¯å†³å®šè¦è¾æ‰ä»–çš„å·¥ä½œæ”¹è¡Œè¯•ç€èµ°é’¢ç´¢ã€‚ä»–å¯¹èµ°é’¢ç´¢è›®åœ¨è¡Œçš„ï¼Œä¸è¿‡ä»æœ‰ä¸ªå°é—®é¢˜ã€‚å°±æ˜¯é¸Ÿä¼šåœåœ¨ä»–æ‹¿çš„å¹³è¡¡ç«¿ä¸Šã€‚ä»–ä»¬ä¼šé£è¿‡æ¥åœä¸€å°ä¼šå„¿ï¼Œç„¶åå†é£èµ°ã€‚è¿™æ ·çš„æƒ…å†µåœ¨ä¸¤è¾¹çš„é¸Ÿçš„æ•°é‡ä¸€æ ·æ—¶å¹¶ä¸æ˜¯ä¸ªå¤ªå¤§çš„é—®é¢˜ã€‚ä½†æœ‰æ—¶å€™ï¼Œæ‰€æœ‰çš„é¸Ÿéƒ½ä¼šæƒ³è¦åœåœ¨åŒä¸€è¾¹ï¼Œçš®å°”æ–¯å°±å¤±å»äº†å¹³è¡¡ï¼Œå°±ä¼šè®©ä»–ä»é’¢ç´¢ä¸Šæ‰ä¸‹å»ã€‚

\url{http://learnyouahaskell-zh-tw.csie.org/img/pierre.png}

æˆ‘ä»¬è¿™è¾¹å‡è®¾ä¸¤è¾¹çš„é¸Ÿå·®å¼‚åœ¨ä¸‰ä¸ªä¹‹å†…çš„æ—¶å€™ï¼Œçš®å°”æ–¯ä»èƒ½ä¿æŒå¹³è¡¡ã€‚

\section{ä¸€èˆ¬è§£æ³•}
\label{sec:orgheadline37}

é¦–å…ˆçœ‹çœ‹ä¸ç”¨ Monad æ€ä¹ˆè§£

\begin{verbatim}
eweda.installTo(this);
var landLeft = eweda.curry(function(n, pole){
    return [pole[0]+n, pole[1]];
});
var landRight = eweda.curry(function(n, pole){
    return eweda.reverse(landLeft(n, eweda.reverse(pole)));
});
var result = eweda.pipe(landLeft(1), landRight(1), landLeft(2))([0,0]);
console.log(result);
// => [3, 1]
\end{verbatim}

è¿˜å·®ä¸€ä¸ªåˆ¤æ–­çš®å°”æ–¯æ˜¯å¦æ‰ä¸‹æ¥çš„æ“ä½œ.

\begin{verbatim}
var landLeft = eweda.curry(function(n, pole){
    if(pole==='dead') return pole;
    if(Math.abs(pole[0]-pole[1]) > 3)
      return 'dead';
    return [pole[0]+n, pole[1]];
});
var landRight = eweda.curry(function(n, pole){
    if(pole==='dead') return pole;
    return eweda.reverse(landLeft(n, eweda.reverse(pole)));
});
var result = eweda.pipe(landLeft(10), landRight(1), landRight(8))([0,0]);
console.log(result);
// => dead
\end{verbatim}

\href{http://jsbin.com/pozim/8/watch?js,console,output}{å®Œæ•´ä»£ç }

\rule{\linewidth}{0.5pt}

\section{ç°åœ¨æ¥è¯•è¯•ç”¨ Either}
\label{sec:orgheadline38}

æˆ‘ä»¬å…ˆæŠŠçš®å°”æ–¯æ”¾è¿› Either ç›’å­é‡Œ, è¿™æ ·çš®å°”æ–¯çš„çŠ¶æ€åªæœ‰æ‰“å¼€ Either
æ‰èƒ½çœ‹è§. å‡è®¾ Either Right æ˜¯æ´»ç€, Left çš„è¯çš®å°”æ–¯æŒ‚äº†.

\begin{verbatim}
var land = eweda.curry(function(lr, n, pole){
    pole[lr] = pole[lr] + n;
    if(Math.abs(pole[0]-pole[1]) > 3) {
      return new Left("dead when land " + n + " became " + pole);
    }
    return new Right(pole);
});

var landLeft = land(0)
var landRight = land(1);
\end{verbatim}

ç°åœ¨è½é¸Ÿåä¼šè¿”å›ä¸€ä¸ª Either, è¦ä¸æ´»ç€, è¦ä¸æŒ‚äº†.
æ‰“å¼€ç›’å­çš„å‡½æ•°å¯ä»¥æ˜¯è¿™æ ·çš„

\begin{verbatim}
var stillAlive = function(x){
    console.log(x)
}
var dead = function(x){
    console.log('çš®å°”æ–¯' + x);
}
either(dead, stillAlive, landLeft(2, [0,0]))
\end{verbatim}

å¥½å§, å¥½åƒæœ‰ä¸€ç‚¹ç‚¹åƒäº†, ä½†æ˜¯è¿™åªè½äº†ä¸€æ¬¡é¸Ÿ, å¦‚æœæˆ‘è¦è½å¥½å‡ æ¬¡å‘¢.
è¿™å°±éœ€è¦å®ç° Either çš„ >>= bind æ–¹æ³•äº†, å¦‚æœä½ è¿˜è®°å¾—å‰é¢å®ç°çš„ Functor,
è¿™é‡Œéå¸¸åƒ :

\begin{verbatim}
var Monad = function(type, defs) {
  for (name in defs){
    type.prototype[name] = defs[name];
  }
  return type;
};
function Left(value){
  this.value = value
}
function Right(value){
  this.value=value;
}

Monad(Right, {
  bind:function(fn){
    return fn(this.value)
  }
})

Monad(Left, {
  bind: function(fn){
    return this;
  }
})
\end{verbatim}

å“¦, å¯¹äº†, either:

\begin{verbatim}
either = function(left, right, either){
    if(either.constructor.name === 'Right')
        return right(either.value)
    else
        return left(either.value)
}
\end{verbatim}

æˆ‘ä»¬æ¥è¯•è¯•å·¥ä½œä¸å·¥ä½œ.

\begin{verbatim}
var walkInLine = new Right([0,0]);
eitherDeadOrNot = walkInLine.bind(landLeft(2))
    .bind(landRight(5))
either(dead, stillAlive, eitherDeadOrNot)
// => [2,5]
eitherDeadOrNot = walkInLine.bind(landLeft(2))
  .bind(landRight(5))
  .bind(landLeft(3))
  .bind(landLeft(10)
  .bind(landRight(10)))

either(dead, stillAlive, eitherDeadOrNot)
// => "çš®å°”æ–¯dead when land 10 became 15,5"
\end{verbatim}

\href{http://jsbin.com/giyig/3/watch}{å®Œæ•´ä»£ç }

\chapter{åˆ°åº•æœ‰ä»€ä¹ˆç”¨å‘¢, Monad}
\label{sec:orgheadline40}

æˆ‘ä»¬æ¥æ€»ç»“ä¸‹ä¸¤ç§åšæ³•æœ‰ä»€ä¹ˆåŒºåˆ«:

\begin{enumerate}
\item ä¸€èˆ¬åšæ³•æ¯æ¬¡éƒ½ä¼šæ£€æŸ¥æŸ¥å°”æ–¯æŒ‚äº†æ²¡æŒ‚, ä¹Ÿå°±æ˜¯é‡å¤è·å¾—ä¹‹å‰æ“ä½œçš„ context
\item Monad ä¸å¯¹å¼‚å¸¸åšå¤„ç†, åªæ˜¯ä¸åœåœ°å¾€ç›’å­é‡ŒåŠ æ“ä½œ. ä½ å¯ä»¥çœ‹åˆ°å¯¹é”™è¯¯çš„å¤„ç†æ¨åˆ°äº†æœ€åå–å€¼çš„ either.
\item Monad äº’ç›¸ä¼ é€’çš„åªæ˜¯ç›’å­, è€Œä¸€èˆ¬å†™æ³•ä¼šæŠŠå¼‚å¸¸å¾€ä¸‹ä¼ å¦‚ \texttt{dead}, è¿™æ ·å¯¼è‡´åé¢çš„æ“ä½œéƒ½å¾—å…ˆåˆ¤æ–­è¿™ä¸ªå¼‚å¸¸.
\end{enumerate}

\begin{quote}
ç”±äºæ˜¯ç”¨ JavaScript, pole ä¸é™å®šç±»å‹,
æ‰€ä»¥è¿™é‡Œå•çº¯çš„ç”¨å­—ç¬¦ä¸²ä»£è¡¨ pole çš„å¼‚å¸¸çŠ¶æ€. ä½†å¦‚æœæ¢æˆå¼ºç±»å‹çš„ Java,
å¯èƒ½å®ç°å°±æ²¡è¿™ä¹ˆç®€å•äº†.
\end{quote}

çœ‹æ¥å·²ç»ä¼˜åŠ¿å·²ç»é€æ­¥æ˜æ˜¾äº†å‘¢, Monad é‡Œé¢ä¿ç•™äº†å€¼çš„ context,
ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯¹è¿™ä¸ª Monad å¯ä»¥é›†ä¸­åœ¨å•ç‹¬çš„æœ¬æ¬¡å¦‚ä½•æ“ä½œvalue, è€Œä¸ç”¨å…³å¿ƒ
context.

\begin{quote}
è¿˜æœ‰ä¸€ä¸ª Monad å«åš Maybe, å®é™…ä¸Šçš®å°”æ–¯çš„ğŸŒ°ç”¨ Maybe æ›´ä¸ºåˆé€‚, å› ä¸º
Maybe æœ‰ä¸¤ç§çŠ¶æ€, ä¸€ç§æ˜¯æœ‰å€¼ Just, ä¸€ç§æ˜¯æ²¡ä¸œè¥¿ Nothing,
å¯ä»¥è‡ªå·±å®ç°è¯•è¯•.
\end{quote}

\chapter{Monad åœ¨ JavaScript ä¸­çš„åº”ç”¨}
\label{sec:orgheadline41}

ä½ çŸ¥é“ ES6æœ‰ä¸ªæ–°çš„ ç±»å‹
\href{https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise#Browser_compatibility}{Promise}
å—, å¦‚æœä¸çŸ¥é“, æƒ³å¿…ä¹Ÿå¬è¿‡ jQuery çš„ \texttt{\$.ajax} å§, ä½†å¦‚æœä½ æ²¡å¬è¿‡ promise,
è¯´æ˜ä½ æ²¡æœ‰è®¤çœŸçœ‹è¿‡ä»–çš„è¿”å›å€¼:

\begin{verbatim}
var aPromise = $.ajax({
    url: "https://api.github.com/users/jcouyang/gists"
    dataType: 'jsonp'
    })
aPromise /***
=> Object { state: .Deferred/r.state(),
    always: .Deferred/r.always(),
    then: .Deferred/r.then(),
    promise: .Deferred/r.promise(),
    pipe: .Deferred/r.then(),
    done: b.Callbacks/p.add(),
    fail: b.Callbacks/p.add(),
    progress: b.Callbacks/p.add() }
***/
\end{verbatim}

æˆ‘ä»¬çœ‹åˆ°è¿”å›äº†å¥½å¤š \texttt{Deferred} ç±»å‹çš„ç©æ„, æˆ‘ä»¬æ¥è¯•è¯•è¿™ç©æ„æœ‰ä»€ä¹ˆç”¨

\begin{verbatim}
anotherPromise = aPromise.then(_ => _.data.forEach(y=> console.log(y.description)))
/* =>
Object { state: .Deferred/r.state(),
    always: .Deferred/r.always(),
    then: .Deferred/r.then(),
    promise: .Deferred/r.promise(),
    pipe: .Deferred/r.then(),
    done: b.Callbacks/p.add(),
    fail: b.Callbacks/p.add(),
    progress: b.Callbacks/p.add() }

"connect cisco anyconnect in terminal"
"ä¸ºä»€ä¹ˆè¦æŸ¯é‡ŒåŒ–ï¼ˆcurryï¼‰"
"æ‰¹é‡è·å–äººäººå½±è§†ä¸‹è½½é“¾æ¥"
......
*/
\end{verbatim}

çœ‹è§æ²¡æœ‰, ä»–åˆè¿”å›äº†åŒæ ·ä¸€ä¸ªä¸œè¥¿, è€Œä¸”ä¼ ç»™ then
çš„å‡½æ•°å¯ä»¥æ“ä½œè¿™ä¸ªå¯¹è±¡é‡Œé¢çš„å€¼. è¿™ä¸ªå¯¹è±¡å…¶å®å°±æ˜¯ Promise äº†.
ä¸ºä»€ä¹ˆè¯´è¿™æ˜¯ Monad å‘¢, æ¥è¯•è¯•å†å†™ä¸€æ¬¡ \texttt{èµ°é’¢ä¸}:

\begin{quote}
è¿™é‡Œæˆ‘ä»¬ç”¨çš„æ˜¯ ES6 çš„ Promise, è€Œä¸ç”¨ jQuery Defered, è®°å¾—ç”¨ firefox
å“¦. å¦å¤– eweda å¯ä»¥è¿™æ ·è£…
\end{quote}

\begin{verbatim}
var ewd = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            ewd.src = 'https://rawgit.com/CrossEye/eweda/master/eweda.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ewd);
eweda.installTo(this);
\end{verbatim}

\begin{verbatim}
var land = eweda.curry(function(lr, n, pole){
    pole[lr] = pole[lr] + n;
    if(Math.abs(pole[0]-pole[1]) > 3) {
      return new Promise((resovle,reject)=>reject("dead when land " + n + " became " + pole));
    }
    return new Promise((resolve,reject)=>resolve(pole));
});

var landLeft = land(0)
var landRight = land(1);

Promise.all([0,0])
.then(landLeft(2), _=>_)
.then(landRight(3), _=>_) // => Array [ 2, 3 ]
.then(landLeft(10), _=>_)
.then(landRight(10), _=>_)
.then(_=>console.log(_),_=>console.log(_))
// => "dead when land 10 became 12,3"
\end{verbatim}

è¿™ä¸‹æ˜¯ä¸æ‰¿è®¤ Promise å°±æ˜¯ Monad äº†. åŸæ¥æˆ‘ä»¬æ—©å·²åœ¨ä½¿ç”¨è¿™ä¸ªç¥ç§˜çš„ Monad,
å†æƒ³æƒ³ Promise,ä¹Ÿæ²¡æœ‰é‚£ä¹ˆæŠ½è±¡å’Œç¥ç§˜äº†.
\end{document}
