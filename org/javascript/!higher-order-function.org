#+TITLE: é«˜é˜¶å‡½æ•° Higher-order function
#+description: èƒ½ä½œä¸ºå‚æ•°æˆ–è€…è¿”å›å€¼çš„å‡½æ•°
#+keys: é«˜é˜¶å‡½æ•°, javascript, æŸ¯é‡ŒåŒ–, lambda, é—­åŒ…, clojure

* é«˜é˜¶å‡½æ•°(Higher-order function)

æˆ‘ä»¬å·²ç»è§è¯†åˆ°äº†åŒ¿åå‡½æ•°å’Œç®­å¤´å‡½æ•°çš„ç”¨æ³•, åŒ¿åçš„ä¸€ç­‰å‡½æ•°åˆ°åº•æœ‰ä»€ä¹ˆç”¨å‘¢?
æ¥çœ‹çœ‹é«˜é˜¶å‡½æ•°çš„åº”ç”¨.

é«˜é˜¶å‡½æ•°æ„æ€æ˜¯å®ƒæ¥æ”¶å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°. ä¸ºä»€ä¹ˆå« *é«˜é˜¶*: æ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°
=f(x, y) = x(y)= æŒ‰ç…§ lambda çš„ç®€åŒ–è¿‡ç¨‹åˆ™æ˜¯

#+BEGIN_EXAMPLE
    f(x) => (y -> x(y))
    (y) => x(y)
#+END_EXAMPLE

å¯ä»¥çœ‹å‡ºæ¥è°ƒç”¨ f æ—¶å´åˆè¿”å›äº†ä¸€ä¸ªå‡½æ•°x.

è¿˜è®°å¾—é«˜ç­‰æ•°å­¦é‡Œé¢çš„å¯¼æ•°å—, ä¸¤é˜¶ä»¥ä¸Šçš„å¯¼æ•°å«é«˜é˜¶å¯¼æ•°.
å› ä¸ºæ±‚å¯¼ä¸€æ¬¡ä»¥åè¿”å›çš„å¯ä»¥æ±‚å¯¼.

æ¦‚å¿µæ˜¯ä¸€æ ·çš„,
å¦‚åŒ[[https://en.wikipedia.org/wiki/Matryoshka_doll][ä¿„ç½—æ–¯å¥—å¨ƒ]] å½“å‡½æ•°æ‰§è¡Œä»¥åè¿˜éœ€æ‰§è¡Œæˆ–è€…è¦å¯¹å‚æ•°æ‰§è¡Œ,
å› æ­¤å«é«˜é˜¶å‡½æ•°.

[[./images/higherorder/recursion.png]]

é«˜é˜¶å‡½æ•°æœ€å¸¸è§çš„åº”ç”¨å¦‚ =map=, =reduce=.
ä»–ä»¬éƒ½æ˜¯ä»¥ä¼ å…¥ä¸åŒçš„å‡½æ•°æ¥ä»¥ä¸åŒçš„æ–¹å¼æ“ä½œæ•°ç»„å…ƒç´ .

å¦å¤– /æŸ¯é‡ŒåŒ–/, åˆ™æ˜¯æ¯æ¬¡æ¶ˆè´¹ä¸€ä¸ªå‚æ•°å¹¶è¿”å›ä¸€ä¸ªé€æ­¥è¢«é…ç½®å¥½çš„å‡½æ•°.
#+INDEX: æŸ¯é‡ŒåŒ–
#+INDEX: currying

é«˜é˜¶å‡½æ•°çš„è¿™äº›åº”ç”¨éƒ½æ˜¯ä¸ºå‡½æ•°çš„ç»„åˆæä¾›çµæ´»æ€§.
åœ¨æœ¬ç« ç»“æŸç›¸ä¿¡ä½ ä¼šå¾ˆå¥½çš„ä½“ä¼šåˆ°å‡½æ•°ç»„åˆçš„å¼ºå¤§ä¹‹å¤„.

** Higher-order function

å‡½æ•°åœ¨ JavaScript ä¸­æ˜¯ä¸€ç­‰å…¬æ°‘, å› æ­¤åœ¨ JavaScript ä¸­, ä½¿ç”¨é«˜é˜¶å‡½æ•°æ˜¯éå¸¸æ–¹ä¾¿çš„.

*** å‡½æ•°ä½œä¸ºå‚æ•°

å‡è®¾æˆ‘ç°åœ¨è¦å¯¹ä¸€ä¸ªæ•°ç»„æ’åº, ç”¨æˆ‘ä»¬ç†Ÿæ‚‰çš„ =sort=

#+BEGIN_SRC js
    [1,3,2,5,4].sort( (x, y) => x - y )
#+END_SRC

å¦‚æœæˆ‘ä»¬è¦é€†åºçš„æ’åº, æŠŠå‡å·å·¦å³çš„ =x= å’Œ =y= å‘¼å”¤,å°±è¿™ä¹ˆç®€å•,
ä½†å¦‚æœæˆ‘æ˜¯ä¸€ä¸ªå¯¹è±¡æ•°ç»„, è¦æ ¹æ®å¯¹è±¡çš„ =id= æ’åº:

#+BEGIN_SRC js
  [{id:1, name:'one'},
   {id:3, name:'three'}, 
   {id:2, name:'two'}, 
   {id:5, name:'five'},  
   {id:4, name:'four'}].sort((x,y) => x.id - y.id)
#+END_SRC

æ˜¯ä¸æ˜¯å·²ç»èƒ½å¤Ÿæ„Ÿå—åˆ°é«˜é˜¶å‡½æ•°ä¸åŒ¿åå‡½æ•°ç»„åˆçš„çµæ´»æ€§.

*** å‡½æ•°ä½œä¸ºè¿”å›å€¼

å‡½æ•°çš„è¿”å›å€¼å¯ä»¥ä¸åªæ˜¯å€¼, åŒæ ·ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°, æ¥çœ‹ Eweda
å†…éƒ¨çš„ä¸€ä¸ªå·¥å…·å‡½æ•° =aliasFor=, ä»–çš„ä½œç”¨æ˜¯ç»™å‡½æ•° E çš„ä¸€äº›æ–¹æ³•èµ·ä¸€äº›åˆ«å:

#+BEGIN_QUOTE
å¬èµ·æ¥å¾ˆæ€ªä¸æ˜¯å—, å‡½æ•°æ€ä¹ˆæœ‰æ–¹æ³•, å®é™…ä¸Š JavaScript çš„ =function=
æ˜¯ä¸€ä¸ªç‰¹æ®Š *å¯¹è±¡*, è¯•è¯•åœ¨ Firefox console é‡Œæ•² =console.log.=
æ˜¯ä¸æ˜¯çœ‹åˆ°äº†ä¸€äº›æ–¹æ³•, ä½†æ˜¯ =typeof console.log= æ˜¯ function
#+END_QUOTE

#+BEGIN_SRC js
    var E = () => {}
    var aliasFor = oldName => {
        var fn = newName => {
          E[newName] = E[oldName];
          return fn;
        };
        return (fn.is = fn.are = fn.and = fn);
    };
#+END_SRC

è¿™é‡Œæœ‰ä¸¤ä¸ª =return=, ä¸€ä¸ªæ˜¯ =fn= è¿”å›è‡ªå·±, å¦ä¸€ä¸ªæ˜¯ =aliasFor= ä¹Ÿè¿”å›
=fn=, å¹¶ä¸”ç»™ =fn= äº†å‡ ä¸ªåˆ«å =fn.is= =fn.are=...

ä»€ä¹ˆæ„æ€å‘¢? =fn= è¿”å› =fn=. å¾ˆç®€å•å°±æ˜¯ =fn() => fn=,
é‚£ä¹ˆ =fn()()=>fn()=>fn= ...ä»¥æ­¤ç±»æ¨, æ— è®ºè°ƒç”¨ fn å¤šå°‘æ¬¡,éƒ½æœ€ç»ˆè¿”å› fn.

[[./images/higherorder/1qUCC8s.png]]

è¿™åˆ°åº•æœ‰ä»€ä¹ˆç”¨å‘¢, ç”±äºè¿™é‡Œä½¿ç”¨äº† =fn= çš„å‰¯ä½œç”¨(side affect)
æ¥å¹²äº†ä¸€äº›äº‹æƒ… =E[newName]=E[oldName]=, ä¹Ÿå°±æ˜¯ç»™ E çš„æ–¹æ³•èµ·ä¸€ä¸ªåˆ«å,
å› æ­¤æ¯æ¬¡è°ƒç”¨ fn éƒ½ä¼šç»™ =E= èµ·ä¸€ä¸ªåˆ«å. =aliasFor= æœ€åè¿”å›çš„æ˜¯ =fn=
è‡ªå·±çš„ä¸€äº›åˆ«å, ä½¿å¾—å¯ä»¥ chain èµ·æ¥æ›´å¯è¯»ä¸€äº›:

#+BEGIN_SRC js
    aliasFor('reduce').is('reduceLeft').is('foldl')
#+END_SRC

#+HTML: <a class="jsbin-embed" href="http://jsbin.com/qohil/1/embed?js,console">å®Œæ•´ä»£ç </a><script src="http://static.jsbin.com/js/embed.js"></script>

#+BEGIN_QUOTE
  å¦å¤–, å‡½æ•°ä½œä¸ºè¿”å›å€¼çš„é‡è¦åº”ç”¨, æŸ¯é‡ŒåŒ–ä¸é—­åŒ…,
  å°†ä¼šåœ¨åœ¨åé¢ä¸“é—¨ä»‹ç». æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ä»¥å‡½æ•°ä½œä¸ºå‚æ•°çš„é«˜é˜¶å‡½æ•°çš„å…¸å‹åº”ç”¨.
#+END_QUOTE

** æŸ¯é‡ŒåŒ– currying

è¿˜è®°å¾— Haskell Curryå—

 [[./images/higherorder/curry.png]]

å¤šå·§å•Š, äººå®¶å§“ Curry å Haskell, éš¾æ€ª Haskell è¯­è¨€ä¼šè‡ªåŠ¨æŸ¯é‡ŒåŒ–, å‘µå‘µ.
ä½†æ˜¯ä¸å¥‡æ€ªå—, ä¸ºä»€ä¹ˆè¦æŸ¯é‡ŒåŒ–å‘¢. ä¸ºä»€ä¹ˆå¦‚æ­¤é‡è¦å¾—è®© Haskell
ä¼šé»˜è®¤è‡ªåŠ¨æŸ¯é‡ŒåŒ–æ‰€æœ‰å‡½æ•°, ä¸å°±æ˜¯è¿”å›ä¸€ä¸ªéƒ¨åˆ†é…ç½®å¥½çš„å‡½æ•°å—.

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ª Haskell çš„ä»£ç .

#+BEGIN_SRC haskell
    max 3 4
    (max 3) 4
#+END_SRC

ç»“æœéƒ½æ˜¯4, è¿™æœ‰ä»€ä¹ˆç”¨å‘¢.

è¿™é‡Œçœ‹ä¸å‡ºæ¥, æ”¾åˆ° =é«˜é˜¶å‡½æ•°= è¯•è¯•. ä»€ä¹ˆ? çœ‹ä¸æ‡‚å¤©ä¹¦ Haskell, æ¥çœ‹çœ‹
JavaScript å§.

*** æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªé—®é¢˜

**** å†™ä¸€ä¸ªå‡½æ•°, å¯ä»¥è¿æ¥å­—ç¬¦æ•°ç»„, å¦‚ f(['1','2']) => '12'

å¥½å§,å¦‚æœä¸ç”¨æŸ¯é‡ŒåŒ–, æ€ä¹ˆå†™? å•Šå“ˆ =reduce=

#+BEGIN_SRC js
    var concatArray = function(chars){
      return chars.reduce(function(a, b){
        return a.concat(b);
      });
    }
    concat(['1','2','3']) // => '123'
#+END_SRC

å¾ˆç®€å•,å¯¹å§.

**** ç°åœ¨æˆ‘è¦å…¶ä¸­æ‰€æœ‰æ•°å­—åŠ 1, ç„¶ååœ¨è¿æ¥

#+BEGIN_SRC js
    var concatArray = function(chars, inc){
      return chars.map(function(char){
        return (+char)+inc + '';
      }).reduce(function(a,b){
          return a.concat(b)
      });
    }
    console.log(concatArray(['1','2','3'], 1))// => '234'
#+END_SRC

**** æ‰€æœ‰æ•°å­—ä¹˜ä»¥2, å†é‡æ„è¯•è¯•çœ‹

#+BEGIN_SRC js
    var multiple = function(a, b){
      return +a*b + ''
    }
    var concatArray = function(chars, inc){
      return chars.map(function(char){
        return multiple(char, inc);
      }).reduce(function(a,b){
          return a.concat(b)
      });
    }
    console.log(concatArray(['1','2','3'], 2)) // => '246'
#+END_SRC

æ˜¯ä¸æ˜¯å·²ç»çœ‹å‡ºé—®é¢˜äº†å‘¢?
å¦‚æœæˆ‘åœ¨éœ€è¦æ¯ä¸ªæ•°å­—éƒ½å‡2,æ˜¯ä¸æ˜¯å¾ˆéº»çƒ¦å‘¢.éœ€è¦å°† =map= å‚æ•°åŒ¿åå‡½æ•°ä¸­çš„
multiple å‡½æ•°æ¢æ‰. è¿™æ ·ä¸€æ¥ =concatArray= å°±ä¸èƒ½åŒæ—¶å¤„ç†åŠ , ä¹˜å’Œå‡?
é‚£ä¹ˆæ€ä¹ˆèƒ½æŠŠä»–æå–å‡ºæ¥å‘¢? æ¥å¯¹æ¯”ä¸‹æŸ¯é‡ŒåŒ–çš„è§£æ³•.

*** æŸ¯é‡ŒåŒ–å‡½æ•°æ¥å£

#+BEGIN_SRC js
    var multiple = function(a){
      return function(b){
        return +b*a + ''
      }
    }

    var plus = function(a){
      return function(b){
        return (+b)+a + ''
      }
    }
    var concatArray = function(chars, stylishChar){
      return chars.map(stylishChar)
        .reduce(function(a,b){
          return a.concat(b)
      });
    }
    console.log(concatArray(['1','2','3'], multiple(2)))
    console.log(concatArray(['1','2','3'], plus(2)))
#+END_SRC

æœ‰ä»€ä¹ˆä¸ä¸€æ ·å‘¢ 1. å¤„ç†æ•°ç»„ä¸­å­—ç¬¦çš„å‡½æ•°è¢«æå–å‡ºæ¥, ä½œä¸ºå‚æ•°ä¼ å…¥ 2.
æå–æˆæŸ¯é‡ŒåŒ–çš„å‡½æ•°, éƒ¨åˆ†é…ç½®å¥½åä¼ å…¥, å¥½å¤„æ˜¾è€Œæ˜“è§, è¿™ä¸‹æ¥å£éå¸¸é€šç•…
æ— è®ºæ˜¯å¤–å±‚è°ƒç”¨

#+BEGIN_EXAMPLE
    concatArray(['1','2','3'], multiple(2))
#+END_EXAMPLE

è¿˜æ˜¯å†…éƒ¨çš„ map å‡½æ•°

#+BEGIN_EXAMPLE
    chars.map(stylishChar)
#+END_EXAMPLE

è¿™äº›æ¥å£éƒ½æ¸…æ™°äº†å¾ˆå¤š, ä¸æ˜¯å—

è¿™å°±æ˜¯å‡½æ•°å¼çš„æ€æƒ³, ç”¨å·²æœ‰çš„å‡½æ•°ç»„åˆå‡ºæ–°çš„å‡½æ•°, è€ŒæŸ¯é‡ŒåŒ–æ¯æ¶ˆè´¹ä¸€ä¸ªå‚æ•°,
éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„éƒ¨åˆ†é…ç½®çš„å‡½æ•°, è¿™ä¸ºå‡½æ•°ç»„åˆæä¾›äº†æ›´çµæ´»çš„æ‰‹æ®µ,
å¹¶ä¸”ä½¿å¾—æ¥å£æ›´ä¸ºæµç•….

*** è‡ªåŠ¨æŸ¯é‡ŒåŒ–

åœ¨ Haskell è¯­è¨€ä¸­, å‡½æ•°æ˜¯ä¼šè‡ªåŠ¨æŸ¯é‡ŒåŒ–çš„:

#+BEGIN_SRC haskell
    max 3 4
#+END_SRC

å…¶å®å°±æ˜¯

#+BEGIN_EXAMPLE
     (max 3) 4
#+END_EXAMPLE

å¯ä»¥çœ‹çœ‹ =max= ä¸ =max 3= å‡½æ•°çš„ ç±»å‹

#+BEGIN_SRC haskell
    ghci> :t max
    max :: Ord a => a -> a -> a
#+END_SRC

çœ‹æ˜ç™½äº†ä¹ˆ, =Ord a =>= è¡¨ç¤ºç±»å‹çº¦æŸä¸ºå¯ä»¥æ¯”è¾ƒå¤§å°çš„ç±»å‹, å› æ­¤ =max=
çš„ç±»å‹å¯ä»¥ç¿»è¯‘æˆ: å½“ç»™å®šä¸€ä¸ª =a=, ä¼šå¾—åˆ° =a -> a=,
å†çœ‹çœ‹ =max 3= çš„ç±»å‹å°±å¥½ç†è§£äº†

#+BEGIN_EXAMPLE
    ghci> :t max 3
    (Num a, Ord a) => a -> a
#+END_EXAMPLE

å·¦ä¾§è¡¨ç¤ºç±»å‹çº¦æŸ =a= å¯ä»¥æ˜¯ =Ord= æˆ–è€… =Num=,
æ„æ€æ˜¯ =max 3= è¿˜æ˜¯ä¸€ä¸ªå‡½æ•°,å¦‚æœç»™å®šä¸€ä¸ª =Ord= æˆ–è€… =Num= ç±»å‹çš„å‚æ•°
åˆ™è¿”å›ä¸€ä¸ª =Ord= æˆ–è€… =Num=.

ç°åœ¨æ˜¯ä¸æ˜¯æ¸…æ™°äº†, åœ¨ Haskell ä¸­æ¯ç»™å®šä¸€ä¸ªå‚æ•°, å‡½æ•°å¦‚æœæ˜¯å¤šå‚æ•°çš„,
è¯¥å‡½æ•°è¿˜ä¼šè¿”å›ä¸€ä¸ªå¤„ç†ä½™ä¸‹å‚æ•°çš„å‡½æ•°. è¿™å°±æ˜¯è‡ªåŠ¨æŸ¯é‡ŒåŒ–.

è€Œåœ¨ Javascript(ä»¥åŠå¤§å¤šæ•°è¯­è¨€) ä¸­ä¸æ˜¯çš„, å¦‚æœç»™å®šå¤šå‚å‡½æ•°çš„éƒ¨åˆ†å‚æ•°,
å‡½æ•°ä¼šé»˜è®¤å…¶ä»–å‚æ•°æ˜¯ =undefined=, è€Œä¸ä¼šè¿”å›å¤„ç†å‰©ä½™å‚æ•°çš„å‡½æ•°.

#+BEGIN_SRC js
    function willNotCurry(a, b, c) {
        console.log(a, b, c)
        return a*b-c;
    }
    willNotCurry(1)
    // => NaN
    // => 1 undefined undefined
#+END_SRC

å¦‚æœä½¿ç”¨è‡ªåŠ¨æŸ¯é‡ŒåŒ–çš„åº“ [[https://github.com/CrossEye/eweda][eweda]],
å‰é¢çš„ä¾‹å­ç®€ç›´å°±å®Œç¾äº†

#+BEGIN_EXAMPLE js
    var multiple = curry(function(a, b){
      return +b*a + ''
    })
    var plus = curry(function(a, b){
      return (+b)+a + ''
    })
#+END_EXAMPLE

#+HTML: <a class="jsbin-embed" href="http://jsbin.com/hamoq/6/embed?js,console">å®Œæ•´ä»£ç </a><script src="http://static.jsbin.com/js/embed.js"></script>

** å‡½æ•°ç»„åˆ function composition

é€šè¿‡å‰é¢ä»‹ç»çš„é«˜é˜¶å‡½æ•°, map, fold ä»¥åŠæŸ¯é‡ŒåŒ–,
å…¶å®å·²ç»è§è¯†åˆ°ä»€ä¹ˆæ˜¯å‡½æ•°ç»„åˆäº†. å¦‚ä¹‹å‰ä¾‹å­ä¸­çš„ map å°±æ˜¯ ç”± fold å‡½æ•°ä¸
reverse å‡½æ•°ç»„åˆå‡ºæ¥çš„.

è¿™å°±æ˜¯å‡½æ•°å¼çš„æ€æƒ³, ä¸æ–­åœ°ç”¨å·²æœ‰å‡½æ•°, æ¥ç»„åˆå‡ºæ–°çš„å‡½æ•°.

[[./images/higherorder/composition.jpg]]

å¦‚å›¾å°±æ˜¯å‡½æ•°ç»„åˆï¼Œæ¥è‡ª
[[https://en.wikipedia.org/wiki/Category_theory][Catgory Theory]]ï¼ˆFuntor ä¹Ÿæ˜¯ä»è¿™æ¥çš„ï¼Œåé¢ä¼šè®²åˆ°ï¼‰, æ—¢ç„¶ä» Aåˆ°B
æœ‰å¯¹åº”çš„æ˜ å°„fï¼ŒBåˆ° Cæœ‰å¯¹åº”çš„æ˜ å°„gï¼Œ é‚£ä¹ˆ =(g.f)(x)= ä¹Ÿå°±æ˜¯ =f= ä¸ =g=
çš„ç»„åˆ =g(f(x))= å°±æ˜¯ Aåˆ° C çš„æ˜ å°„ã€‚ä¸Šä¸€ç« å®ç°çš„ map å‡½æ•°å°±ç›¸å½“äº
=reverse.fold=.

*** Compose

æˆ‘ä»¬å¯ä»¥ç”¨ Eweda éå¸¸æ–¹ä¾¿çš„ compose æ–¹æ³•æ¥ç»„åˆå‡½æ•°

#+BEGIN_SRC js
    var gf = E.compose(f, g)
#+END_SRC

è¯´åˆ°äº†å‡½æ•°ç»„åˆ, æŸ¯é‡ŒåŒ–, æˆ‘æƒ³ç°åœ¨ç»ˆäºå¯ä»¥è§£é‡Šæ¸…æ¥šä¸ºä»€ä¹ˆåœ¨è¿™é‡Œé€‰ç”¨
Eweda/Ramda è€Œä¸æ˜¯ Underscore äº†.

ä¸¾ä¸ªä¾‹å­ğŸŒ° å¦‚æœæˆ‘ç°åœ¨æƒ³è¦ tasks åˆ—è¡¨ä¸­æ‰€æœ‰å±æ€§ä¸º =completed= ä¸º =true=
çš„å…ƒç´ , å¹¶æŒ‰ç…§ =id= æ’åº.

underscore é‡Œä¼šè¿™æ ·å†™:

#+BEGIN_SRC js
  _(tasks)
      .chain()
      .filter( task => task.completed===true)
      .sortBy( task => task.id)
      .value();
#+END_SRC

è¿™ç§æ–¹å¼æ€ä¹ˆçœ‹éƒ½ä¸æ˜¯å‡½æ•°å¼, è€Œæ˜¯ä»¥å¯¹è±¡/å®¹å™¨ä¸ºä¸­å¿ƒçš„ä¸²è”ï¼Œæœ‰äº›åƒ jquery
å¯¹è±¡çš„é“¾å¼è°ƒç”¨, æˆ–è€…æˆ‘ä»¬å¯ä»¥å†™çš„å‡½æ•°å¼ä¸€äº›, å¦‚

#+BEGIN_SRC js
    _.sortBy(_.filter(tasks, task => task.completed===true), task => task.id)
#+END_SRC

æ©æ©, çœ‹èµ·æ¥ä¸é”™å˜›, ä½†æ˜¯æœ‰è°æ˜¯è¿™ä¹ˆç”¨ underscoreçš„å‘¢. ä¸€èˆ¬éƒ½ä¼šåªè§è¿‡
é“¾å¼è°ƒç”¨æ‰æ˜¯ underscore çš„æ ‡å‡†å†™æ³•ã€‚

æ¥å¯¹æ¯”ä¸€ä¸‹ç”¨ Eweda/Ramda è§£å†³çš„è¿‡ç¨‹ :

#+BEGIN_SRC js
    compose(sortBy(task=>task.id), filter(task=>task.completed===true))(tasks)
#+END_SRC

å¥½åƒæ²¡ä»€ä¹ˆåŒºåˆ«å•Š? ä¸å°±æ˜¯ç”¨äº† compose å—?

åŒºåˆ«å¤§äº†è¿™, çœ‹è§ =tasks= æ˜¯æœ€åå½“å‚æ•°ä¼ ç»™ =E.compose()= çš„å—?
è€Œä¸æ˜¯å†™æ­»åœ¨filter çš„å‚æ•°ä¸­. è¿™æ„å‘³ç€åœ¨æ¥åˆ°éœ€è¦å¤„ç†çš„æ•°æ®å‰,
æˆ‘å·²ç»ç»„åˆå¥½ä¸€ä¸ªæ–°çš„å‡½æ•°åœ¨ç­‰å¾…æ•°æ®, è€Œä¸æ˜¯æŠŠæ•°æ®æ··æ‚åœ¨ä¸­é—´,
æˆ–æ˜¯ä¿æŒåœ¨ä¸€ä¸ªä¸­é—´å¯¹è±¡ä¸­. è€Œ underscore
çš„å†™æ³•å¯¼è‡´è¿™ä¸€é•¿ä¸² =_.sortBy(_.filter())= å…¶å®æ ¹æœ¬æ— æ³•é‡ç”¨ã€‚

å¥½å§å¦‚æœä½ è¿˜çœ‹ä¸å‡ºæ¥è¿™æ ·åšçš„å¥½å¤„. é‚£ä¹ˆæ¥å¦‚æœæˆ‘æœ‰ä¸€ä¸ªåŒ…å«å‡ ç»„ tasksçš„åˆ—è¡¨
groupedTasks, æˆ‘è¦æŒ‰ç±»å‹é€‰å‡º completed ä¸º true å¹¶æŒ‰ id æ’åº.
å¦‚æˆ‘ç°åœ¨æ•°æ®æ˜¯è¿™ä¸ªï¼š

#+BEGIN_EXAMPLE js
    groupedTasks = [
      [{completed:false, id:1},{completed:true, id:2}],
      [{completed:false, id:4},{completed:true, id:3}]
    ]
#+END_EXAMPLE

underscore:

#+BEGIN_SRC js
    _.map(groupedTasks,
       tasks => _.sortBy(_.filter(tasks, task => task.completed===true), task => task.id))
#+END_SRC

çœ‹è§æˆ‘ä»¬åˆæŠŠ =_.sortBy(_.filter())= è¿™ä¸€é•¿ä¸²åŸå°ä¸åŠ¨çš„æ‹·è´åˆ°äº† map é‡Œã€‚
å› ä¸º underscore
ä¸€å¼€å§‹å°±è¦æ¶ˆè´¹æ•°æ®ï¼Œä½¿å¾—å¾ˆéš¾é‡ç”¨ï¼Œé™¤éåœ¨å¥—åœ¨å¦ä¸€ä¸ªå‡½æ•°é‡Œï¼š

#+BEGIN_SRC js
    function completedAndSorted(tasks){
      return _.sortBy(_.filter(tasks, task => task.completed===true), task => task.id))
    }
    _.map(groupedTasks, completedAndSorted)
#+END_SRC

åªæœ‰è¿™æ ·æ‰èƒ½é‡ç”¨å·²æœ‰çš„ä¸€äº›å‡½æ•°ã€‚æˆ–è€…è™½ç„¶ underscore ä¹Ÿæœ‰ =_.compose=
æ–¹æ³•ï¼Œä½†æ˜¯ å‡ ä¹æ‰€æœ‰ underscore
çš„æ–¹æ³•éƒ½æ˜¯å…ˆæ¶ˆè´¹æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•°æ®ï¼‰ï¼Œä½¿å¾—å¾ˆéš¾æ”¾åˆ° =compose=
æ–¹æ³•ä¸­ï¼Œä¸ä¿¡å¯ä»¥å°è¯•æŠŠ filter å’Œ sortBy æè¿›å»ï¼Œåæ­£æˆ‘æ˜¯åšä¸åˆ°ã€‚

æ¥çœ‹çœ‹çœŸæ­£çš„å‡½æ•°ç»„åˆ

#+BEGIN_SRC js
    var completedAndSorted = compose(sortBy(task=>task.id),
                                     filter(task=>task.completed===true))
    map(completedAndSorted, groupedTasks)
#+END_SRC

çœ‹å‡ºæ¥æ€æƒ³å®Œå…¨ä¸ä¸€æ ·äº†å§.

ç”±äº Eweda/Ramda çš„å‡½æ•°éƒ½æ˜¯è‡ªåŠ¨æŸ¯é‡ŒåŒ–,è€Œä¸”æ•°æ®æ€»æ˜¯æœ€åä¸€ä¸ªå‚æ•°,
å› æ­¤å¯ä»¥éšæ„ç»„åˆ, æœ€ç»ˆå°†éœ€è¦å¤„ç†çš„æ•°æ®æ‰”ç»™ç»„åˆå¥½çš„å‡½æ•°å°±å¥½äº†.
è¿™æ‰æ˜¯å‡½æ•°å¼çš„æ€æƒ³. å…ˆå†™å¥½ä¸€ä¸ªå…¬å¼ï¼Œåœ¨æŠŠæ•°æ®æ‰”ç»™
å…¬å¼ã€‚è€Œä¸æ˜¯ç®—å¥½ä¸€éƒ¨åˆ†å†æŠŠç»“æœç»™å¦ä¸€ä¸ªå…¬å¼ã€‚

[[./images/higherorder/ThreeFunctionMachines.jpg]]

è€Œ underscore è¦ä¹ˆæ˜¯ä»¥å¯¹è±¡ä¿æŒä¸­é—´æ•°æ®, ç”¨ chaining
çš„æ–¹å¼å¯¹ç›®æ ‡åº”ç”¨å„ç§å‡½æ•°ï¼ˆä¹¦ä¸Šä¼šå†™è¿™æ˜¯Flow-Base
programmingï¼Œä½†æˆ‘è§‰å¾—å…¶å®æ˜¯ Monadï¼Œä¼šåœ¨ä¸‹ä¸€ç« ä¸­ä»‹ç»ï¼‰,
è¦ä¹ˆç”¨å‡½æ•°åµŒå¥—å‡½æ•°, å°†ç›®æ ‡ä¸€å±‚å±‚ä¼ é€’ä¸‹å».

*** pipe

ç±»ä¼¼ compose, eweda/ramda è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å« pipe, pipe çš„å‡½æ•°æ‰§è¡Œæ–¹å‘åˆšå¥½ä¸
compose ç›¸å. æ¯”å¦‚ =pipe(f, g)=, =f= ä¼šå…ˆæ‰§è¡Œ, ç„¶åç»“æœä¼ ç»™ =g=,
æ˜¯ä¸æ˜¯è®©ä½ æƒ³èµ·äº† bash çš„ pipe

#+BEGIN_EXAMPLE
    find / | grep porno
#+END_EXAMPLE

å®é™…ä¸Šå°±æ˜¯ =pipe(find, grep(porno))(/)=

æ²¡é”™,ä»–ä»¬éƒ½æ˜¯ä¸€ä¸ªæ„æ€. è€Œä¸”è¿™ä¸ªå‡½æ•°æ‰§è¡Œçš„æ–¹å‘æ›´é€‚åˆäººè„‘ç¼–è¯‘(å¯è¯»)ä¸€äº›.

å¦‚æœä½ å·²ç»ä¹ æƒ¯ underscore çš„è¿™ç§å†™æ³•

#+BEGIN_SRC js
    _(data)
      .chain()
      .map(data1,fn1)
      .filter(data2, fn2)
      .value()
#+END_SRC

é‚£ä¹ˆè½¬æ¢æˆ pipe æ˜¯å¾ˆå®¹æ˜“çš„ä¸€ä»¶äº‹æƒ…ï¼Œè€Œä¸”æ›´ç®€å•æ˜äº†æ˜“äºé‡ç”¨å’Œç»„åˆã€‚

#+BEGIN_SRC js
  pipe(
    map(fn1),
    filter(fn2)
  )(data)
#+END_SRC

#+HTML: <a class="jsbin-embed" href="http://jsbin.com/hivaje/2/embed?js,console">å®Œæ•´ä»£ç </a><script src="http://static.jsbin.com/js/embed.js"></script>
