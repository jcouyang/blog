<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- 2021-08-15 Sun 01:49 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>çœ‹æˆ‘ä»¬3å¤© hackday éƒ½å¹²äº†äº›ä»€ä¹ˆ</title>
<meta name="generator" content="Org mode">
<meta name="author" content="æ¬§é˜³ç»§è¶…">
<meta name="keywords" content="hackday, clojure,clojurescript,javascript,react,flux,redux,transdux">
<link rel="icon" href="/favicon.ico">
<meta name="theme-color" content="#ffffff">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/toc.css"/>
<link rel="stylesheet" href="/style/tufte.css"/>
<link rel="alternate" type="application/rss+xml" title="Jichao Ouyang" href="https://feeds.oyanglul.us/JichaoOuyangsBlog"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJRFJGX"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<header>
    <a accesskey="h" href="/index.html"> HOME </a> |
    <a href="#" id="edit-in-github">EDIT</a> |
    <a href="https://feeds.oyanglul.us/JichaoOuyangsBlog">RSS</a> |
    <a href="https://blog.oyanglul.us/theindex">INDEX</a> |
    <a accesskey="H" href="/jichao.ouyang.html">ABOUT</a> |
    <a href="https://github.com/jcouyang/blog">GITHUB</a>
</header>
</div>
<div id="content">
<header>
<h1 class="title">çœ‹æˆ‘ä»¬3å¤© hackday éƒ½å¹²äº†äº›ä»€ä¹ˆ</h1>
</header><nav id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org8ce3d9e">Rationale</a>
<ul>
<li><a href="#orgad687d2">flux</a></li>
<li><a href="#org4653f5a">redux</a></li>
</ul>
</li>
<li><a href="#org1c783ff">Clojure Avengers æ¥ç›¸åŠ©</a>
<ul>
<li><a href="#orgcad52f6">Channels</a></li>
<li><a href="#orge254e02">PubSub</a></li>
<li><a href="#org4719e2c">Transducers</a></li>
<li><a href="#org8db57d4">Atom</a></li>
</ul>
</li>
<li><a href="#orgc07f4bd">Day 0 - Inception</a></li>
<li><a href="#org3f1f200">Day 1 - Hack Hack Hack&#x2026;</a>
<ul>
<li><a href="#org8eb096b">åˆç‰ˆï¼Œåªå®ç°ä¸€ä¸ªåŠŸèƒ½</a></li>
<li><a href="#orge136126">æå–æ¡†æ¶</a>
<ul>
<li><a href="#org005a4bc">ä¼ é€’ inputChan å’Œ action çš„ publication</a></li>
<li><a href="#orge982b4e">åˆ†è¾¨ä¸åŒçš„ ReactClass</a></li>
<li><a href="#org64beae9">bindActions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org91ea635">Day 2 - Show Case</a></li>
<li><a href="#orgc13dec7">Recap</a>
<ul>
<li><a href="#org3322f68">1. æŠŠä½ çš„ component åŒ…åˆ° Transdux é‡Œ</a></li>
<li><a href="#orgb64b2bf">2. å®šä¹‰ä½ çš„ component èƒ½å¹²ä»€ä¹ˆï¼Ÿä½ çš„çŠ¶æ€èƒ½æ€ä¹ˆå˜ï¼Ÿ</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<p>
å¥½ä¸å®¹æ˜“æœ‰3å¤©å±äº hacker çš„æ—¥å­ï¼Œ ä» idea åˆ°äº§å“ï¼Œæˆ‘ä»¬åˆ°åº•èƒ½åšäº›ä»€ä¹ˆï¼Ÿä» <b>ç—›ç‚¹</b> å‡ºå‘ï¼Œæœ€è¿‘çš„é¡¹ç›®è¢« React å’Œ React Router è™çš„ä¸ç®—è½»ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå› ä¸ºæˆ‘ä»¬æ˜¯åŠè·¯æ¥æ‰‹çš„ã€‚çœŸçš„ç®—æ˜¯å‰äºº <del>ç“¦ğŸ––è‚¯</del> åäºº <del>æ¤æ ‘</del> æ“¦å±è‚¡ã€‚
</p>

<div class="epigraph"><blockquote>
<p>
åˆ°åº•å¹²äº†äº›ä»€ä¹ˆå‘¢ï¼Ÿ ä¸“ä¸šå‰§é€ ğŸ¶ 30å¹´æç¤ºæ‚¨è¯·çœ‹ url ğŸ‘†ï¸ å¹¶ç‚¹è¿™é‡Œ ğŸ‘‰ <a href="https://github.com/jcouyang/transdux">https://github.com/jcouyang/transdux</a>
</p>

</blockquote></div>
<div id="outline-container-org8ce3d9e" class="outline-2">
<h2 id="org8ce3d9e">Rationale</h2>
<div class="outline-text-2" id="text-org8ce3d9e">
<p>
é‰´äºå¤§éƒ¨åˆ† React åˆå­¦è€…éƒ½å›°æƒ‘çš„é—®é¢˜ï¼Œæˆ‘åœ¨<a href="http://blog.oyanglul.us/javascript/react-cookbook-mini.html#orgheadline39">æµ“ç¼© React ç…®ä¹¦</a>ä¸­ä¹Ÿè®²è¿‡
</p>

<div class="epigraph"><blockquote>
<p>
å¦‚æœä¸¤ä¸ª Component ä¸æ˜¯çˆ¶å­å…³ç³»æˆ–è€…å…„å¼Ÿæˆ–è€…ä¼¯çˆ¶ä¾„å¥³ï¼Œè¯¥å¦‚ä½•äº¤äº’
</p>

</blockquote></div>

<p>
æˆ‘å½“æ—¶çš„å›ç­”æ˜¯
</p>
<div class="epigraph"><blockquote>
<p>
å¦‚æœä¸¤ä¸ª Component ä¸æ˜¯çˆ¶å­å…³ç³»æˆ–è€…å…„å¼Ÿæˆ–è€…ä¼¯çˆ¶ä¾„å¥³ï¼Œä»–ä»¬çœŸçš„éœ€è¦äº¤äº’å—ï¼Ÿ
</p>

</blockquote></div>

<p>
æ‰€ä»¥æ¯«æ— æ¡†æ¶çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æ‰¾åˆ°ä¸¤ä¸ª component çš„å…±åŒçˆ¶å…ƒç´ ï¼Œä¸€å±‚ä¸€å±‚å›è°ƒä¸Šå»ï¼Œåœ¨ä¸€å±‚ä¸€å±‚ props ä¼ å¯¼ å¦ä¸€ä¸ª componentã€‚
</p>


<figure>
<img src="images/share-parent-components.png" alt="share-parent-components.png">

</figure>


<p>
å¥½å§ï¼Œå¦‚æœ component æ ‘çš„å±‚æ¬¡å¤ªå¤šï¼Œé‚£ä¹ˆå†™ callback å°±ä¼šè·Ÿè¿™ä¸ªå›¾ä¸Šå¿äº²æˆšä¸€æ ·æ™•ï¼Œè€Œä¸”ä¸€æ—¦ä¸­é—´è°åœ¨å¾€äº†ä¼ è¿™ä¸ª callback å°±ä¼šæŒ‚æ‰ã€‚
</p>
</div>

<div id="outline-container-orgad687d2" class="outline-3">
<h3 id="orgad687d2">flux</h3>
<div class="outline-text-3" id="text-orgad687d2">
<p>
äºæ˜¯ï¼Œå¯¹äºå¤æ‚ component äº¤äº’çš„æƒ…æ™¯ï¼Œfacebook æä¾›äº† flux æ¶æ„è®¾è®¡ï¼ˆå½“ç„¶ä¹Ÿå®ç°äº†<a href="https://github.com/facebook/flux">https://github.com/facebook/flux</a>ï¼‰
</p>


<figure>
<img src="https://raw.githubusercontent.com/facebook/flux/master/docs/img/flux-diagram-white-background.png" alt="flux-diagram-white-background.png">

<figcaption><span class="figure-number">&#22270;2&nbsp; </span>flux æ¶æ„</figcaption>
</figure>

<p>
è¿™ä¸ªå›¾ä¼°è®¡å¤§å®¶è¢«å„ç§ facebook çš„ jsconf æ´—è¿‡è„‘äº†ï¼Œå•å‘çš„æ•°æ®æµï¼Œä¸­é—´åŠ äº†ä¸€å¤§å †ä¸œè¥¿
</p>


<figure>
<img src="./images/brainwashing-frog.gif" alt="brainwashing-frog.gif">

</figure>

<ul class="org-ul">
<li>actionï¼šè¦å¹²ä»€ä¹ˆ</li>
<li>dispatcherï¼šåˆ°å“ªé‡Œå»</li>
<li>storeï¼šå˜ä»€ä¹ˆ/å¦‚ä½•å˜</li>
</ul>


<p>
åŸºæœ¬æ€æƒ³å°±æ˜¯æŠŠä¸€ä¸ª component æƒ³å¹²çš„äº‹æƒ…å¼„æˆ actionï¼Œdispatcher ä¼šä¸ºä¸åŒçš„ action è°ƒç”¨ä¸ç”¨çš„ store ä¸­çš„ reducerï¼Œstore çœŸæ­£ç®¡ç†ç€ component çš„çŠ¶æ€ã€‚ æŠŠå¼•èµ·çŠ¶æ€å˜åŒ–çš„æ¯ä¸€éƒ¨éƒ½åˆ†è§£å‡ºæ¥ã€‚æ©ï¼Œå¤§å‹é¡¹ç›®ä¸€å®šè¦è¿™ä¹ˆåˆ†è§£æ‰ç®—å¤§å‹ï¼Œæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚
</p>

<p>
åŸæ–‡æ€æƒ³å¦‚ä¸‹ï¼Œfacebook çš„è¡¨è¾¾èƒ½åŠ›æˆ‘ä¹Ÿæ˜¯ç»™è·ªäº†:
</p>
<div class="epigraph"><blockquote>
<p>
All data flows through the dispatcher as a central hub. Actions most often originate from user interactions with the views, and action creators are nothing more than a call into the dispatcher. The dispatcher then invokes the callbacks that the stores have registered with it, effectively dispatching the data payload contained in the actions to all stores. Within their registered callbacks, stores determine which actions they are interested in, and respond accordingly. The stores then emit a "change" event to alert the controller-views that a change to the data layer has occurred. Controller-views listen for these events and retrieve data from the stores in an event handler. The controller-views call their own render() method via setState() or forceUpdate(), updating themselves and all of their children.
</p>

</blockquote></div>

<p>
æ€æƒ³æ˜¯ä¸é”™ï¼Œä½†æ˜¯çœ‹çœ‹ä¾‹å­ï¼Œè¿™ä¸ªdispacher æ˜¯æ€ä¹ˆä¸ªå›äº‹
</p>
<div class="org-src-container">
<pre class="src src-js">AppDispatcher.register(<span style="color: #00008b;">function</span>(<span style="color: #b8860b;">action</span>) {
  <span style="color: #00008b;">var</span> <span style="color: #b8860b;">text</span>;

  <span style="color: #00008b;">switch</span>(action.actionType) {
    <span style="color: #00008b;">case</span> TodoConstants.TODO_CREATE:
      text = action.text.trim();
      <span style="color: #00008b;">if</span> (text !== <span style="color: #8b0000;">''</span>) {
        create(text);
        TodoStore.emitChange();
      }
      <span style="color: #00008b;">break</span>;

    <span style="color: #00008b;">case</span> TodoConstants.TODO_TOGGLE_COMPLETE_ALL:
      <span style="color: #00008b;">if</span> (TodoStore.areAllComplete()) {
        updateAll({complete: <span style="color: #6b8e23;">false</span>});
      } <span style="color: #00008b;">else</span> {
        updateAll({complete: <span style="color: #6b8e23;">true</span>});
      }
      TodoStore.emitChange();
      <span style="color: #00008b;">break</span>;
...
</pre>
</div>
<p>
æˆ‘ä¸€ç›´ä»¥ä¸º dispatcher åº”è¯¥è‡ªåŠ¨ç»™æˆ‘ dispatcher æ‰å¯¹ï¼Œæˆ‘è‡ªå·±éƒ½ dispatcher å®Œäº†è¿˜è¦ dispatcher å¹²ä»€ä¹ˆï¼Ÿ
</p>
</div>
</div>

<div id="outline-container-org4653f5a" class="outline-3">
<h3 id="org4653f5a">redux</h3>
<div class="outline-text-3" id="text-org4653f5a">
<p>
äºæ˜¯ redux å‡ºæ¥æŠŠ dispatcher è¿™ä¸€æ­¥å»æ‰äº†ï¼Œç„¶åæ”¾åˆ°äº† reducer é‡Œï¼š
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #00008b;">function</span> <span style="color: #6a5acd;">counter</span>(<span style="color: #b8860b;">state</span> = 0, <span style="color: #b8860b;">action</span>) {
  <span style="color: #00008b;">switch</span> (action.type) {
  <span style="color: #00008b;">case</span> <span style="color: #8b0000;">'INCREMENT'</span>:
    <span style="color: #00008b;">return</span> state + 1
  <span style="color: #00008b;">case</span> <span style="color: #8b0000;">'DECREMENT'</span>:
    <span style="color: #00008b;">return</span> state - 1
  <span style="color: #00008b;">default</span>:
    <span style="color: #00008b;">return</span> state
  }
}
</pre>
</div>


<p>
ç„¶åå°±è·å¾—äº†ä¸€ç‰‡å¥½è¯„
</p>
<div class="epigraph"><blockquote>
<p>
â€œLove what youâ€™re doing with Reduxâ€
Jing Chen, creator of Flux
</p>

<p>
â€œI asked for comments on Redux in FB's internal JS discussion group, and it was universally praised. Really awesome work.â€
Bill Fisher, author of Flux documentation
</p>

<p>
   â€œIt's cool that you are inventing a better Flux by not doing Flux at all.â€
AndrÃ© Staltz, creator of Cycle
</p>

</blockquote></div>

<p>
æˆ‘ç«Ÿæ— è¨€ä»¥å¯¹&#x2026;
</p>


<figure>
<img src="./images/wait-your-serious.gif" alt="wait-your-serious.gif">

</figure>
</div>
</div>
</div>

<div id="outline-container-org1c783ff" class="outline-2">
<h2 id="org1c783ff">Clojure Avengers æ¥ç›¸åŠ©</h2>
<div class="outline-text-2" id="text-org1c783ff">
<p>
å¥½äº†ï¼Œç°åœ¨çš„é—®é¢˜å¾ˆæ˜ç¡®ï¼Œç”¨ä¸€å † <b>switch case</b> æ¥ <b>dispatch</b> ä¸ç®¡æ”¾åˆ° dispatcher é‡Œè¿˜æ˜¯ store é‡Œéƒ½ä¸€æ ·çš„ <b>éš¾çœ‹ï¼éš¾çœ‹ï¼éš¾çœ‹ï¼</b> è€Œä¸” ç”¨æˆ·ä¸ºä»€ä¹ˆéœ€è¦åšä¸€äº›è·Ÿä¸šåŠ¡æ— å…³çš„äº‹æƒ…ï¼Œå¦‚æœä½ çœ‹ä¸€ä¸‹ redux todomvc çš„ä¾‹å­ï¼š
</p>

<ul class="org-ul">
<li>ç”¨æˆ·éœ€è¦è‡ªå·±åˆ›å»ºä¸€ä¸ªå…¨å±€çš„ storeï¼Ÿ</li>
</ul>

<figure>
<img src="https://www.evernote.com/l/ABf1E2CyquRCkZOYQjiSKL5ycV3_OiR1inMB/image.png" alt="image.png">

</figure>

<ul class="org-ul">
<li>ç”¨æˆ·éœ€è¦â€œè¿æ¥â€å¸¦æœ‰ action çš„ props å’Œ App Componentï¼Ÿ</li>
</ul>

<figure>
<img src="https://www.evernote.com/l/ABeCF0zsoQhPPJnRP4wQK0hxMbkT8zuBsS0B/image.png" alt="image.png">

</figure>

<ul class="org-ul">
<li>ç”¨æˆ·éœ€è¦æŠŠ action å½“ props ä¼ ä¸‹å»ï¼Ÿè·Ÿä¼  callback ä¸€æ ·ï¼Ÿ</li>
</ul>

<figure>
<img src="https://www.evernote.com/l/ABccOUGGTZVMxoqeT3GOAsoQNX1-S0b4r4MB/image.png" alt="image.png">

</figure>

<p>
æ¥çœ‹çœ‹ Clojure æä¾›äº†å“ªäº›ä¼˜é›…çš„ä¸œè¥¿èƒ½å¸®åŠ©æˆ‘ä»¬æ¶ˆé™¤è¿™äº›çœ‹èµ·æ¥ä¸é¡ºçœ¼çš„è®¾è®¡&#x2026;
</p>
</div>

<div id="outline-container-orgcad52f6" class="outline-3">
<h3 id="orgcad52f6">Channels</h3>
<div class="outline-text-3" id="text-orgcad52f6">
<p>
Channel æ˜¯ CSP<label for="1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="1" class="margin-toggle"/><span class="sidenote">
å…·ä½“å¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç«  <a href="http://blog.oyanglul.us/javascript/clojure-core.async-essence-in-native-javascript.html">http://blog.oyanglul.us/javascript/clojure-core.async-essence-in-native-javascript.html</a>
</span> çš„æ¦‚å¿µï¼Œç±»ä¼¼ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¸€è¾¹è¿›ï¼Œä¸€è¾¹å‡ºã€‚ ä¸è¿‡è¿›å’Œå‡ºéƒ½æ˜¯å¼‚æ­¥çš„
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #00008b;">const</span> {chan, take, put} = require(<span style="color: #8b0000;">'con.js/async'</span>).<span style="color: #00008b;">async</span>
<span style="color: #00008b;">let</span> <span style="color: #b8860b;">c</span> = chan()
take(c).then(_=&gt;console.log(_))
put(c, <span style="color: #8b0000;">'hehe'</span>)
<span style="color: #8c8c8c; font-style: italic;">// </span><span style="color: #8c8c8c; font-style: italic;">"hehe"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge254e02" class="outline-3">
<h3 id="orge254e02">PubSub</h3>
<div class="outline-text-3" id="text-orge254e02">
<p>
Pub(blication) å¯ä»¥æŒ‡å®šæŠŠ Channel çš„æŸä¸€éƒ¨åˆ†å‘å¸ƒå‡ºå»ï¼Œè®© Sub(scribe) æ¥ è®¢é˜…ã€‚
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #00008b;">const</span> {chan, take, put, pub, sub} = require(<span style="color: #8b0000;">'con.js/async'</span>).<span style="color: #00008b;">async</span>
<span style="color: #00008b;">let</span> <span style="color: #b8860b;">inputChan</span> = chan()
<span style="color: #00008b;">let</span> <span style="color: #b8860b;">actionPub</span> = pub(inputChan, _=&gt;_.action)
<span style="color: #00008b;">let</span> <span style="color: #b8860b;">outputChan</span> = chan()
<span style="color: #00008b;">let</span> <span style="color: #b8860b;">actionSub</span> = sub(actionPub, <span style="color: #8b0000;">'greeting'</span>, outputChan)
put(inputChan, {action: <span style="color: #8b0000;">'greeting'</span>, value: <span style="color: #8b0000;">'Hello Clojure pubsub'</span>})
put(inputChan, {action: <span style="color: #8b0000;">'party'</span>, value: <span style="color: #8b0000;">'wheeeee'</span>})
take(outputChan).then(_=&gt;console.log(_))
<span style="color: #8c8c8c; font-style: italic;">// </span><span style="color: #8c8c8c; font-style: italic;">{action: 'greeting', value: 'Hello Clojure pubsub'}</span>
</pre>
</div>

<p>
ç»‘å®šåˆ° outputChan çš„ sub åªä¼šæ¥æ”¶ action ä¸º greeting çš„æ¶ˆæ¯
</p>
</div>
</div>

<div id="outline-container-org4719e2c" class="outline-3">
<h3 id="org4719e2c">Transducers</h3>
<div class="outline-text-3" id="text-org4719e2c">
<p>
é¦–å…ˆå£°æ˜ï¼šTransducer ä¸æ˜¯æŸ¯é‡ŒåŒ–ï¼Œä¸æ˜¯æŸ¯é‡ŒåŒ–ï¼Œä¸æ˜¯æŸ¯é‡ŒåŒ–ï¼
</p>

<p>
åœ¨ Clojure 1.7 ä¹‹åï¼Œå½“ mapï¼Œfilterä¹‹ç±»çš„å‡½æ•°åªæ¥æ”¶ä¸€ä¸ªå‡½æ•°æ—¶è¿”å› transducerã€‚transducers æ˜¯å¯ä»¥é‡ç”¨ï¼Œç»„åˆï¼Œåº”ç”¨åˆ°å„ç§é›†åˆä¸ Channel ä¸Šçš„ç‰¹æ®Šå‡½æ•°ã€‚<label for="2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="2" class="margin-toggle"/><span class="sidenote">
ä¸“é—¨å†™è¿‡ä¸€ç¯‡æ–‡ç« ä»‹ç»è¿‡ <a href="http://blog.oyanglul.us/javascript/clojure-essence-in-javascript-transducer.html">http://blog.oyanglul.us/javascript/clojure-essence-in-javascript-transducer.html</a>
</span>
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #00008b;">const</span> {chan, map, take, put} = require(<span style="color: #8b0000;">'con.js/async'</span>).<span style="color: #00008b;">async</span>
<span style="color: #00008b;">let</span> <span style="color: #b8860b;">xf</span> = map(_=&gt;_*2)
<span style="color: #00008b;">let</span> <span style="color: #b8860b;">c</span> = chan(32, xf)
put(c, 3)
take(c, _=&gt;console.log(_))
<span style="color: #8c8c8c; font-style: italic;">// </span><span style="color: #8c8c8c; font-style: italic;">6</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8db57d4" class="outline-3">
<h3 id="org8db57d4">Atom</h3>
<div class="outline-text-3" id="text-org8db57d4">
<p>
åŸå­è¿™ä¸ªåå­—èµ·å¾—å¥½ï¼Œå‡½æ•°å¼ç¼–ç¨‹çš„æ•°æ®ç»“æ„éƒ½æ˜¯ immutable çš„ï¼Œå¦‚æœå¤šçº¿ç¨‹éœ€è¦å…±äº«èµ„æºï¼Œé‚£ä¹ˆå‡½æ•°å¼å¦‚ä½•è§£å†³ï¼Ÿ
</p>

<p>
è§£å†³å¤šçº¿ç¨‹é€šå¸¸æˆ‘ä»¬ä¼šåŠ é”ï¼Œæœ‰é”çš„æ“ä½œå°±ç›¸å½“äºåŸå­æ“ä½œï¼Œåœ¨æ“ä½œå…±äº«èµ„æºçš„æ—¶å€™ï¼Œä¸ç”¨æ“å¿ƒå€¼ä¼šçªç„¶è¢«åˆ«çš„çº¿ç¨‹æ”¹æ‰ã€‚
</p>

<p>
ä½†æ˜¯ atom ä½¿ç”¨å¦å¤–ä¸€ç§æ–¹å¼å®ç°åŸå­æ“ä½œï¼Œ atom ç±»ä¼¼å®¹å™¨ï¼Œref ä¼šæŒ‡åˆ°å½“å‰çš„å€¼åˆ°åº•æ˜¯å“ªä¸€ä¸ªã€‚ç„¶åï¼Œæ“ä½œ atom å¿…é¡»ä½¿ç”¨åŸå­æ“ä½œ swap!ï¼Œswap! èƒ½ä¿éšœ åŸå­æ€§çš„åŸç†éå¸¸ç®€å•ï¼Œå°±æ˜¯å°è¯•å°†æ–°å€¼æ”¾åˆ° atom ä¸­ï¼Œå¦‚æœå½“å‰ ref å’Œ æ¢å‡ºæ¥çš„å€¼ä¸ä¸€æ ·äº†ï¼Œè¯´æ˜å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿåœ¨ swap!  è¿™ä¸ª atomã€‚swap! ä¼šä»å¤´å†æ¥ä¸€éã€‚
</p>

<p>
å½“æˆ‘ä»¬æœ‰å¾ˆå¤šçš„ channel æ˜¯ä¼šå¹¶å‘çš„æ“ä½œ stateï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ atom æ¥ä¿è¯æˆ‘ä»¬çš„ setState æ˜¯åŸå­æ“ä½œã€‚
</p>

<p>
<i>ç”±äºæ˜¯ä½¿ç”¨ transducer æ¥æ›¿ä»£ redux çš„ reducerï¼Œæˆ‘ç»™æ–°æ¡†æ¶ <del>å±±å¯¨</del> å“äº®çš„å«åš Transdux ï¼</i>
</p>
</div>
</div>
</div>

<div id="outline-container-orgc07f4bd" class="outline-2">
<h2 id="orgc07f4bd">Day 0 - Inception</h2>
<div class="outline-text-2" id="text-orgc07f4bd">
<p>
åœ¨è§£é‡Šäº†ä¸€é€šæˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„ Clojure æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¼€å§‹è¯•è¯•å°†ä»–ä»¬èåˆåˆ°ä¸€èµ·ï¼Œæ¥ç®¡ç†æˆ‘ä»¬çš„ Component çš„ stateã€‚
</p>

<p>
ç»è¿‡æˆ‘ä»¬ä¸€ä¸‹åˆï¼ˆæ—©ä¸Šæ˜¯ kickoffå’Œè§£é‡Šä¸Šé¢è¿™ä¸€å †æ•°æ®ç»“æ„) æ¿€ <del>æƒ…</del> çƒˆçš„è®¨è®ºï¼Œç»ˆäºåˆæ­¥æœ‰äº† transdux çš„é›å½¢
</p>


<figure>
<img src="https://www.evernote.com/l/ABd31BSoVoxMGJ66lygc0t2mK0cAmW3VQ60B/image.png" alt="image.png">

<figcaption><span class="figure-number">&#22270;8&nbsp; </span>transdux åŸå‹è‰ç¨¿</figcaption>
</figure>

<ol class="org-ol">
<li>ä» ClojureScript æŠŠ transducerï¼Œchannelï¼Œpubï¼Œsub ä¹‹ç±»çš„ export å‡ºæ¥ï¼Œcompile æˆ JavaScriptã€‚å€Ÿç”¨ moriï¼Œ<a href="https://medium.com/@oyanglulu/i-just-fork-mori-and-add-core-async-to-it-3cea689e9259#.fzwrn6ofm">fork ä¸€ä¸‹æ”¹æ”¹å®Œæˆäº†</a>ï¼Œæˆ‘æŠŠå®ƒå« <a href="http://github.com/jcouyang/conjs">conjs</a></li>
<li>ä½¿ç”¨ pubsub æ¥æ›¿ä»£ dispatcherï¼Œå½“ sub äº† action çš„ä¸åŒç±»å‹ä¹‹åï¼Œè‡ªç„¶ä¹Ÿè‡ªåŠ¨åªæ¥æ”¶ subscribe çš„æ¶ˆæ¯ã€‚æ‰€ä»¥è¿™é‡Œæ¡†æ¶ä¼šä¸ºæ¯ä¸€ä¸ª action ç”Ÿæˆä¸€ä¸ª sub</li>
<li>æ¡†æ¶è¿˜éœ€è¦ä¸ºæ¯ä¸€ä¸ª sub å‡†å¤‡ä¸€ä¸ªè¾“å‡º channelï¼Œç„¶åä½¿ç”¨ transducer å°†ç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘ç»‘åˆ°è¾“å‡º channel ä¸Šã€‚è¿™æ ·æ¯æ¬¡ç»è¿‡è¿™ä¸ªè¾“å‡ºçš„ channel çš„æ¶ˆæ¯ï¼Œéƒ½ä¼šè¢«ç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œå¾—å‡ºæ–°çš„ stateã€‚</li>
</ol>

<p>
å¥½äº†ï¼Œå¤§è‡´å°±è¿™æ ·äº†ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•å¼€å§‹åšå‘¢ï¼Ÿå›åˆ°æˆ‘ä»¬åšè¿™ä¸ªæ¡†æ¶çš„åˆå¿ƒï¼Œæ˜¯ä¸ºäº†ç”¨æˆ·å†™å‡ºæ›´ç®€æ´çš„ä»£ç ï¼ŒåŒæ—¶è¿˜èƒ½è·å¾— [fl|re]dux çš„å¥½å¤„ã€‚
</p>

<p>
é‚£ä¹ˆæˆ‘ä»¬å°± EDDï¼ˆExample Driven Developmentï¼Œéªšå¹´ï¼Œåˆ«æŸ¥äº†ï¼Œæˆ‘éšä¾¿ç¼–çš„è¯ï¼‰ ä¸€æŠŠå¥½äº†ã€‚EDD çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„
</p>
<ol class="org-ol">
<li>å» redux çš„ repo æŠŠé‚£ä¸ªä¸‘ä¸‘çš„ todomvc ä¾‹å­è€ƒè¿‡æ¥</li>
<li>æŠŠæ‰€æœ‰ redux æ¡†æ¶ <del>æ±¡æŸ“</del> è¦†ç›–çš„åœ°æ–¹éƒ½åˆ æ‰ï¼Œéƒ½åˆ æ‰ï¼Œåˆ æ‰ï¼Œæ‰&#x2026;</li>
<li>å¥½äº†ï¼Œä¾‹å­åœ¨æ²¡æœ‰ redux ä¹‹åè‚¯å®šä¼šæŒ‚æ‰äº†ï¼Œé‚£ä¹ˆç°åœ¨ï¼Œç”¨å‰é¢è§£é‡Šçš„æ‹‰ä¸€å¤§å † Clojure çš„æ•°æ®ç»“æ„æŠŠ todomvc åœ¨ç»™å®ç°äº†ã€‚</li>
</ol>
</div>
</div>

<div id="outline-container-org3f1f200" class="outline-2">
<h2 id="org3f1f200">Day 1 - Hack Hack Hack&#x2026;</h2>
<div class="outline-text-2" id="text-org3f1f200">
<div class="epigraph"><blockquote>
<p>
æ³¨æ„ï¼Œæˆ‘å·²ç»æŠŠè¦ç”¨åˆ°çš„è¿™ä¸€å † Clojure æ•°æ®æœºæ„éƒ½ export å¹¶ compile æˆäº† javascriptã€‚æƒ³å…·ä½“äº†è§£çš„å¯ä»¥çœ‹<a href="https://medium.com/@oyanglulu/i-just-fork-mori-and-add-core-async-to-it-3cea689e9259#.fzwrn6ofm">è¿™ç¯‡æ–‡ç« </a>å’Œ <a href="http://github.com/jcouyang/conjs">conjs æºç </a>
</p>

</blockquote></div>
</div>

<div id="outline-container-org8eb096b" class="outline-3">
<h3 id="org8eb096b">åˆç‰ˆï¼Œåªå®ç°ä¸€ä¸ªåŠŸèƒ½</h3>
<div class="outline-text-3" id="text-org8eb096b">
<p>
æ¥çœ‹çœ‹æˆ‘ä»¬ EDD çš„<a href="https://github.com/jcouyang/transdux/blob/5da5107cb2de11414c5b3c2659cf19e790264ff9/src/components/MainSection.jsx#L33">ç¬¬ä¸€ç‰ˆå®ç°</a>ï¼Œæ˜¯å¤šä¹ˆçš„ç®€å•
</p>
<div class="org-src-container">
<pre class="src src-js"><span class="linenr"> 1: </span>componentDidMount(){
<span class="linenr"> 2: </span>  <span style="color: #8c8c8c; font-style: italic;">// </span><span style="color: #8c8c8c; font-style: italic;">-------vv code user should write vv------------------</span>
<span id="coderef-complete" class="coderef-off"><span class="linenr"> 3: </span>  <span style="color: #00008b;">function</span> <span style="color: #6a5acd;">complete</span>(<span style="color: #b8860b;">msg</span>){</span>
<span class="linenr"> 4: </span>    <span style="color: #00008b;">return</span> state=&gt;map(todo=&gt;{
<span class="linenr"> 5: </span>      <span style="color: #00008b;">if</span>(todo.get(<span style="color: #8b0000;">'id'</span>)==msg.id)
<span class="linenr"> 6: </span>        <span style="color: #00008b;">return</span> updateIn(todo, [<span style="color: #8b0000;">'completed'</span>], _=&gt;!_ )
<span class="linenr"> 7: </span>        <span style="color: #00008b;">return</span> todo
<span class="linenr"> 8: </span>    }, state)
<span class="linenr"> 9: </span>  }
<span class="linenr">10: </span>  <span style="color: #8c8c8c; font-style: italic;">// </span><span style="color: #8c8c8c; font-style: italic;">---------------------------------</span>
<span class="linenr">11: </span>
<span class="linenr">12: </span>  <span style="color: #8c8c8c; font-style: italic;">// </span><span style="color: #8c8c8c; font-style: italic;">---------- code should extract to transdux -------------------</span>
<span class="linenr">13: </span>  <span style="color: #00008b;">let</span> <span style="color: #b8860b;">tx</span> = map((msg)=&gt;{
<span class="linenr">14: </span>    <span style="color: #00008b;">return</span> toJs(complete(msg)(extra.toClj(<span style="color: #6b8e23;">this</span>.state.todos)))
<span class="linenr">15: </span>  });
<span class="linenr">16: </span>
<span class="linenr">17: </span>  <span style="color: #00008b;">let</span> <span style="color: #b8860b;">completeChan</span> = chan(1, tx);
<span class="linenr">18: </span>
<span class="linenr">19: </span>  sub(<span style="color: #6b8e23;">this</span>.props.pub, <span style="color: #8b0000;">"Todo.complete"</span>, completeChan);
<span class="linenr">20: </span>
<span class="linenr">21: </span>  <span style="color: #00008b;">function</span> <span style="color: #6a5acd;">takeloop</span>(<span style="color: #b8860b;">chan</span>, <span style="color: #b8860b;">action</span>){
<span class="linenr">22: </span>    take(chan).then(action).then(takeloop.bind(<span style="color: #6b8e23;">null</span>, chan,action))
<span class="linenr">23: </span>  }
<span class="linenr">24: </span>  takeloop(completeChan, (newtodos)=&gt;{
<span class="linenr">25: </span>    <span style="color: #6b8e23;">this</span>.setState({todos: newtodos})
<span class="linenr">26: </span>  })
<span class="linenr">27: </span>  <span style="color: #8c8c8c; font-style: italic;">// </span><span style="color: #8c8c8c; font-style: italic;">----------</span>
<span class="linenr">28: </span>}
</pre>
</div>

<p>
 æ²¡æœ‰é”™ï¼Œè·Ÿ TDD ä¸€æ ·ï¼Œå…ˆå®ç°ï¼Œåœ¨é‡æ„
ç›®çš„éå¸¸æ˜ç¡®ï¼Œç”¨æˆ·åªéœ€è¦å®šä¹‰ï¼Œæˆ‘è¿™ä¸ª component èƒ½å¹²ä»€ä¹ˆï¼Œæ‰€ä»¥è¿™é‡Œç¬¬<a href="#coderef-complete" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-complete');" onmouseout="CodeHighlightOff(this, 'coderef-complete');">3</a>è¡Œï¼Œå°±è¯´æˆ‘ æ˜¯ todo æˆ‘èƒ½ complete
</p>

<p>
ç„¶ååä¸½çš„åˆ†å‰²çº¿ä¸‹é¢æ˜¯æˆ‘ä»¬æ¡†æ¶è¦åšçš„äº‹æƒ…
</p>
<ol class="org-ol">
<li>ä¸€ä¸ªç”¨ç”¨æˆ·æä¾›çš„ action ç»„æˆçš„ transducer</li>
<li>ä¸€ä¸ª action channelï¼Œç”¨æ¥ç»‘å®š transducer</li>
<li>ä¸€ä¸ª subï¼Œ åªè®¢é˜… â€œtodo.completeâ€ çš„æ¶ˆæ¯</li>
<li>ä¸€ä¸ª loopï¼Œä¸åœçš„å» action channel é‚£æ–°çš„ state</li>
</ol>

<p>
é‚£ä¹ˆåœ¨ä½¿ç”¨çš„åœ°æ–¹ï¼Œåªéœ€è¦å‘ä¸€ä¸ª action ä¸ºâ€œtodo.completeâ€ çš„æ¶ˆæ¯å³å¯
</p>
</div>
</div>

<div id="outline-container-orge136126" class="outline-3">
<h3 id="orge136126">æå–æ¡†æ¶</h3>
<div class="outline-text-3" id="text-orge136126">
<p>
å½“ç„¶æˆ‘ä»¬éœ€è¦å°è£…è¿™äº›è£¸è£¸çš„å®ç°ï¼Œå½“ç„¶æå–è¿™ä¸€ç¥¨ä»£ç å—ç‰¹åˆ«ç®€å•ï¼Œå†™ä¸€ä¸ª mixin è®©éœ€è¦ç”¨åˆ°çš„ component è‡ªå·± mixin è¿›æ¥å°±å¥½ã€‚
</p>

<p>
é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“è¿™ä¸ª Component ç”¨åˆ°çš„ input channnel å’Œ publication æ˜¯è°ã€‚
</p>
</div>
<div id="outline-container-org005a4bc" class="outline-4">
<h4 id="org005a4bc">ä¼ é€’ inputChan å’Œ action çš„ publication</h4>
<div class="outline-text-4" id="text-org005a4bc">
<p>
æˆ‘ä¸ä¼šä½¿ç”¨ redux é‚£æ ·ç¬¨ç¬¨çš„è®©ç”¨æˆ·ä¸€å±‚å±‚ä¼ ä¸‹å»çš„æ–¹å¼ï¼Œæœ‰è¿™åŠŸå¤«æˆ‘å¯ä»¥ä¼  callbackï¼Œé‚£æ¡†æ¶åˆ°åº•ä¸ºæˆ‘åšäº†ä»€ä¹ˆï¼Ÿ
</p>

<p>
æ‰€ä»¥ï¼Œtransdux æä¾›ä¸€ä¸ª wrapper component <i>Transdux</i>
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #6a5acd;">Transdux</span>&gt;
    &lt;<span style="color: #6a5acd;">App</span>/&gt;
&lt;/<span style="color: #6a5acd;">Transdux</span>&gt;
</pre>
</div>

<p>
åªéœ€è¦ç”¨ Transdux component åŒ…ä½ä½ çš„ component å³å¯ï¼Œå¦‚æœä½ æœ‰ä¸¤ä¸ª Appï¼Œé‚£ä¹ˆåˆ†åˆ« wrap å¯ä»¥ä¿è¯ä»–ä»¬ç”¨çš„æ˜¯ä¸¤å¥— transdux çš„ channelï¼Œpubsubè€Œäº’ç›¸ä¸å—å¹²æ‰°ã€‚
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #6a5acd;">div</span>&gt;
  &lt;<span style="color: #6a5acd;">Transdux</span>&gt;
    &lt;<span style="color: #6a5acd;">App</span>/&gt;
  &lt;/<span style="color: #6a5acd;">Transdux</span>&gt;
  &lt;<span style="color: #6a5acd;">Transdux</span>&gt;
    &lt;<span style="color: #6a5acd;">App2</span>/&gt;
  &lt;/<span style="color: #6a5acd;">Transdux</span>&gt;
&lt;/<span style="color: #6a5acd;">div</span>&gt; 
</pre>
</div>

<p>
å…·ä½“å®ç°ä¹Ÿä¸éš¾ï¼Œåˆ©ç”¨ React çš„ child context
</p>

<div class="org-src-container">
<pre class="src src-js">childContextTypes: {
    transduxChannel: React.PropTypes.object,
    transduxPublication: React.PropTypes.object,
  },
  getChildContext(){
    <span style="color: #00008b;">let</span> <span style="color: #b8860b;">inputchan</span> = chan();
    <span style="color: #00008b;">return</span> {
      transduxChannel: inputchan,
      transduxPublication: pub(inputchan, _=&gt;_[<span style="color: #8b0000;">'action'</span>]),
    }
  },
</pre>
</div>

<p>
<a href="https://facebook.github.io/react/docs/context.html">child context</a> æ˜¯ React ä¸€ä¸ª ç»™å­ component ä¼ é€’ context æ˜¯ä¸€ç§æ–¹å¼ï¼Œ é€šè¿‡è¿™æ ·å°±æ— éœ€çˆ¶ component ä¸€å±‚ä¸€å±‚ä¼ ä¸‹å»ï¼Œè€Œåœ¨æ‰€æœ‰çš„å­ component éƒ½éšæ—¶å¯ä»¥ä» <code>this.context</code> ä¸­æ‰¾åˆ°çˆ¶ component <code>getChildContext</code>  è¿”å›çš„å€¼ã€‚
</p>

<p>
äºæ˜¯æ— éœ€ä»»ä½•ä¼ é€’ï¼Œ æ‰€æœ‰å­ componentéƒ½èƒ½è·å¾— transdux çš„ channel ä»¥åŠ publicationã€‚
</p>
</div>
</div>

<div id="outline-container-orge982b4e" class="outline-4">
<h4 id="orge982b4e">åˆ†è¾¨ä¸åŒçš„ ReactClass</h4>
<div class="outline-text-4" id="text-orge982b4e">
<p>
å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬åœ¨ dispatch çš„æ—¶å€™ï¼Œå¦‚ä½•çŸ¥é“ç»™é‚£ä¸ª component å‘æ¶ˆæ¯å‘¢ï¼Ÿæœ€ç›´æ¥çš„æ–¹å¼æ˜¯ï¼ŒæŠŠéœ€è¦æ¥å—æ¶ˆæ¯çš„ component require è¿›æ¥
</p>
<div class="epigraph"><blockquote>
<p>
ä½ è¿‡æ¥ï¼Œæˆ‘ä¿è¯ä¸æ‰“ä½ 
</p>

</blockquote></div>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #00008b;">import</span> MainSection from <span style="color: #8b0000;">'./MainSection'</span>
<span style="color: #00008b;">let</span> <span style="color: #b8860b;">TodoItem</span> = React.createClass({
    mixins: [TxMixin],
 ...
           <span style="color: #6b8e23;">this</span>.dispatch(MainSection, <span style="color: #8b0000;">'complete'</span>,{id:todo.id})
...
    }
})
</pre>
</div>

<p>
è¿™æ ·çš„æ¶ˆæ¯éå¸¸æ¸…æ™°ï¼Œè€Œä¸”æ°¸è¿œä¸å¯èƒ½å‘é”™æ¶ˆæ¯ï¼Œé™¤é require é”™äº† componentã€‚
</p>

<p>
é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œdispatch å¿…é¡»èƒ½æ ¹æ®è¿™ä¸ª React Class åˆ†è¾¨ï¼Ÿ
</p>

<p>
<b>transdux</b> ä¸ºæ¯ä¸€ç»‘å®š actions çš„ component ç”Ÿæˆä¸€ä¸ª uuid
</p>
</div>
</div>
<div id="outline-container-org64beae9" class="outline-4">
<h4 id="org64beae9">bindActions</h4>
<div class="outline-text-4" id="text-org64beae9">
<p>
åœ¨æœ‰äº† channel å’Œ publication ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ç»‘å®šç”¨æˆ·çš„ action åˆ° action channel ä¸Šï¼Œå¹¶ç”Ÿæˆç›¸å¯¹åº”çš„ sub
</p>

<p>
æŠŠç¬¬ä¸€ç‰ˆå®ç°çš„ä»£ç åŒ…åˆ° mixin ä¸­ï¼Œä¼šæ˜¯è¿™æ ·çš„ï¼š
</p>
<div class="org-src-container">
<pre class="src src-js"><span class="linenr"> 1: </span>bindActions(actions, imm=id, unimm=id) {
<span class="linenr"> 2: </span>  <span style="color: #00008b;">let</span> <span style="color: #b8860b;">atomState</span> = atom(imm(<span style="color: #6b8e23;">this</span>.getInitialState()))
<span class="linenr"> 3: </span>  <span style="color: #00008b;">for</span>(<span style="color: #00008b;">let</span> <span style="color: #b8860b;">name</span> <span style="color: #00008b;">in</span> actions){
<span class="linenr"> 4: </span>    <span style="color: #00008b;">let</span> <span style="color: #b8860b;">tx</span> = map((msg)=&gt;{
<span id="coderef-swap" class="coderef-off"><span class="linenr"> 5: </span>      <span style="color: #00008b;">let</span> <span style="color: #b8860b;">result</span> = swap(atomState, (state,v)=&gt;actions[name](v,state), msg.value)</span>
<span class="linenr"> 6: </span>      <span style="color: #6b8e23;">this</span>.setState(unimm(result))
<span class="linenr"> 7: </span>      <span style="color: #00008b;">return</span> result
<span class="linenr"> 8: </span>    });
<span id="coderef-actionChan" class="coderef-off"><span class="linenr"> 9: </span>    <span style="color: #00008b;">let</span> <span style="color: #b8860b;">actionChan</span> = chan(32,tx);</span>
<span id="coderef-sub" class="coderef-off"><span class="linenr">10: </span>    sub(<span style="color: #6b8e23;">this</span>.context.transduxPublication, genUuid(<span style="color: #6b8e23;">this</span>.constructor)+name, actionChan);</span>
<span id="coderef-observe" class="coderef-off"><span class="linenr">11: </span>    observe(actionChan, (newstate)=&gt;{});</span>
<span class="linenr">12: </span>  }
<span class="linenr">13: </span>},
</pre>
</div>

<ul class="org-ul">
<li>è¿˜è®°å¾—ä¹‹å‰è¯´çš„ atom å—ï¼Ÿ<a href="#coderef-swap" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-swap');" onmouseout="CodeHighlightOff(this, 'coderef-swap');">è¿™é‡Œ</a> swap å°è¯•å°† <code>msg.value</code> å’Œ <code>state</code> ä¼ å…¥ <code>actions[name]</code> ï¼Œå°†å…¶è¿”å›å€¼æ¢å…¥ atom å†…ã€‚</li>
<li>ç¬¬<a href="#coderef-actionChan" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-actionChan');" onmouseout="CodeHighlightOff(this, 'coderef-actionChan');">9</a>è¡Œå°†ä¹‹å‰ map è¿”å›çš„ transducer æ”¾åˆ° actionChan ä¸Šï¼Œå…¶ä¸­çš„32ä»£è¡¨ channel çš„é•¿åº¦ä¸º32ã€‚ <b>æ³¨æ„ä»€ä¹ˆæ—¶å€™è¿™ä¸ª transducer æ˜¯ lazy çš„ï¼Œæ‰€ä»¥åªæœ‰ take çš„æ—¶å€™ä¼šåº”ç”¨ action åˆ° channel çš„å…ƒç´ ä¸Š</b> ã€‚æ‰€ä»¥ transducer çœŸä¸æ˜¯æŸ¯é‡ŒåŒ–ï¼Œä¸æ˜¯æŸ¯é‡ŒåŒ–ï¼ŒæŸ¯é‡ŒåŒ–ï¼Œé‡ŒåŒ–ï¼ŒåŒ–&#x2026;</li>
<li>åœ¨ç¬¬<a href="#coderef-sub" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-sub');" onmouseout="CodeHighlightOff(this, 'coderef-sub');">10</a>è¡ŒæŠŠè¯¥ class ç”Ÿæˆçš„ uuid å’Œ action çš„åå­—ä½œä¸º action çš„å”¯ä¸€æ ‡è¯†ã€‚ç”±äºæ˜¯ mixinï¼Œæ‰€ä»¥ç›´æ¥èƒ½è·å¾—è¯¥ component ä¸Šçš„ publication</li>
<li>æœ€å observe ä¸€ä¸‹å°±å¥½äº†ï¼Œå…¶å® observer ä»€ä¹ˆéƒ½æ²¡å¹²ï¼Œå…¶å®å¯ä»¥çœ‹çœ‹æˆ‘çš„ <a href="https://github.com/jcouyang/conjs/blob/master/src/mori/core.async.cljs#L17">observe å®ç°</a>ï¼Œåªæ˜¯ä¸€ä¸ªç®€å•çš„ go-loopï¼Œä¸åœçš„ take channel çš„æ¶ˆæ¯ã€‚ä¸ç„¶æ²¡äºº take æ¶ˆæ¯ä¼šå †ç§¯æ»¡ï¼Œå°±å†ä¹Ÿ put ä¸è¿›æ¥äº†ã€‚</li>
</ul>
<div class="org-src-container">
<pre class="src src-clojure">(<span style="color: #00008b;">defn</span> ^<span style="color: #6b8e23;">:export</span> <span style="color: #6a5acd;">observe</span> [chan cb]
  (go-loop []
    (<span style="color: #00008b;">let</span> [v (<span style="color: #36648b;">async</span>/&lt;! chan)]
      (cb v)
      (<span style="color: #00008b;">recur</span>))))
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-org91ea635" class="outline-2">
<h2 id="org91ea635">Day 2 - Show Case</h2>
<div class="outline-text-2" id="text-org91ea635">
<p>
æ‰˜äº† clojure çš„ç¦ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å†™å¤šå°‘ä»£ç ï¼Œå°±è½»æ¾å®ç°äº†ä¸€ä¸ªå¯¹ç”¨æˆ·æ›´å‹å¥½çš„ flux like æ¡†æ¶ã€‚åœ¨æ ¸å¿ƒåŠŸèƒ½å®ç°åï¼Œæˆ‘ä»¬å¼€å§‹è¿›è¡Œ opensource project çš„ routine
</p>
<ul class="org-ul">
<li>å†™ <a href="https://github.com/jcouyang/transdux/blob/master/README.org">readme</a></li>
<li>å†™ä¾‹å­ <a href="https://github.com/jcouyang/transdux/tree/master/examples/todomvc">todomvc</a></li>
<li>é€‰ä¸ª <a href="http://choosealicense.com/">license</a></li>
<li><a href="https://www.npmjs.com/package/transdux">npm publish</a></li>
<li>å‡†å¤‡èƒ½æŠŠå¤§å®¶å°†æ‡‚çš„ slide</li>
</ul>


<figure>
<img src="./images/applause.jpg" alt="applause.jpg">

<figcaption><span class="figure-number">&#22270;9&nbsp; </span>æ­¤å¤„åº”æœ‰æŒå£°</figcaption>
</figure>
</div>
</div>

<div id="outline-container-orgc13dec7" class="outline-2">
<h2 id="orgc13dec7">Recap</h2>
<div class="outline-text-2" id="text-orgc13dec7">

<figure>
<img src="https://www.evernote.com/l/ABe_8eE6o2dGlZMCmNnBap_fXy83GvJe6gcB/image.jpg" alt="image.jpg">

<figcaption><span class="figure-number">&#22270;10&nbsp; </span>The Big Picture of Transdux</figcaption>
</figure>

<p>
æ‰€ä»¥ï¼Œä½¿ç”¨ transdux  ç»™ react component äº¤äº’ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸ºæ¡†æ¶æä¾›ä¸¤ä»¶äº‹æƒ…
</p>
</div>
<div id="outline-container-org3322f68" class="outline-3">
<h3 id="org3322f68">1. æŠŠä½ çš„ component åŒ…åˆ° Transdux é‡Œ</h3>
<div class="outline-text-3" id="text-org3322f68">
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #6a5acd;">Transdux</span>&gt;
    &lt;<span style="color: #6a5acd;">App</span>/&gt;
&lt;/<span style="color: #6a5acd;">Transdux</span>&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb64b2bf" class="outline-3">
<h3 id="orgb64b2bf">2. å®šä¹‰ä½ çš„ component èƒ½å¹²ä»€ä¹ˆï¼Ÿä½ çš„çŠ¶æ€èƒ½æ€ä¹ˆå˜ï¼Ÿ</h3>
<div class="outline-text-3" id="text-orgb64b2bf">
<div class="org-src-container">
<pre class="src src-js"><span style="color: #8c8c8c; font-style: italic;">// </span><span style="color: #8c8c8c; font-style: italic;">MainSection.jsx</span>
<span style="color: #00008b;">import</span> {TxMixin} from <span style="color: #8b0000;">'transdux'</span>
<span style="color: #00008b;">let</span> <span style="color: #b8860b;">actions</span> = {
  complete(msg, state){
    <span style="color: #00008b;">return</span> {
      todos:state.todos.map(todo=&gt;{
        <span style="color: #00008b;">if</span>(todo.id==msg.id)
          todo.completed = !todo.completed
        <span style="color: #00008b;">return</span> todo
      })
    }
  },
  clear(msg,state){
    <span style="color: #00008b;">return</span> {
      todos: state.todos.filter(todo=&gt;todo.completed==<span style="color: #6b8e23;">false</span>)
    }
  }
}
<span style="color: #00008b;">let</span> <span style="color: #b8860b;">MainSection</span> = React.createClass({
  mixins: [TxMixin],
  componentDidMount(){
    <span style="color: #6b8e23;">this</span>.bindActions(actions)
  },
  ...
})
</pre>
</div>

<p>
ç„¶åï¼Œå°±å¯ä»¥å¼€å§‹ <b>å‘æ¶ˆæ¯</b> äº†
</p>
<div class="org-src-container">
<pre class="src src-jsx">//TodoItem.jsx
import MainSection from './MainSection'
let TodoItem = React.createClass({
    mixins: [TxMixin],
    ...
      this.dispatch(MainSection, 'complete',{id:todo.id})
    ...
    }
})
</pre>
</div>

<p>
æœ€åï¼Œè¦æ„Ÿè°¢æˆ‘ä»¬æ£’æ£’çš„ Team member <a href="https://github.com/SanCoder-Q">@SanCoder-Q</a> <a href="https://github.com/zhangyaxuan">@zhangyaxuan</a> <a href="https://github.com/nihaokid">@nihaokid</a> <a href="https://github.com/xiaoyanzhuzzh">@xiaoyanzhuzzh</a> 
</p>

æœ€åï¼Œæ¬¢è¿ <a aria-label="Star jcouyang/transdux on GitHub" data-count-aria-label="# stargazers on GitHub" data-count-api="/repos/jcouyang/transdux#stargazers_count" data-count-href="/jcouyang/transdux/stargazers" data-style="mega" href="https://github.com/jcouyang/transdux" class="github-button">Fork me on Github</a>

<p>
<i>æ‰€æœ‰å›¾ç‰‡æ¥æºäº giphy.com, copyright</i> @<a href="http://www.cc.com/shows/futurama">Futurama</a>
</p>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">&#33050;&#27880;: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
å…·ä½“å¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç«  <a href="http://blog.oyanglul.us/javascript/clojure-core.async-essence-in-native-javascript.html">http://blog.oyanglul.us/javascript/clojure-core.async-essence-in-native-javascript.html</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
ä¸“é—¨å†™è¿‡ä¸€ç¯‡æ–‡ç« ä»‹ç»è¿‡ <a href="http://blog.oyanglul.us/javascript/clojure-essence-in-javascript-transducer.html">http://blog.oyanglul.us/javascript/clojure-essence-in-javascript-transducer.html</a>
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<footer>
  <p>Author: æ¬§é˜³ç»§è¶…
    <a class="github-button" href="https://github.com/sponsors/jcouyang" data-icon="octicon-heart" aria-label="Sponsor @jcouyang on GitHub">Sponsor</a>
    <a aria-label="Follow @jcouyang on GitHub" data-count-aria-label="# followers on GitHub" data-count-api="/users/jcouyang#followers" data-count-href="/jcouyang/followers" href="https://github.com/jcouyang" class="github-button">Follow</a>
    <a href="https://twitter.com/oyanglulu" class="twitter-follow-button" data-show-screen-name="false" data-show-count="false">Follow @oyanglulu</a>
  </p>
  <p>Created: 2015-11-22 Sun 00:00</p>
  <p>Generated by: <a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.3 (<a href="https://orgmode.org">Org</a> mode 9.3.6) &#215; <a href="https://github.com/jcouyang/orgpress">OrgPress</a></p>
  <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Unported License</a>.
  <input type="swiftype" class="st-default-search-input" placeholder="Search"/>
  <a class="gumroad-button" href="https://gum.co/grokking-monad?wanted=true" target="_blank" data-gumroad-single-product="true">èŒƒç•´è®ºè£…é€¼æŒ‡å—ï¼Œè¯·è‡ªè§‰æ’é˜Ÿè£…é€¼</a>
  <div id="danmaku-comments"></div>
  <div id="disqus_thread"></div>
</footer>
</div>
</body>
</html>
