<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2021-08-16 Mon 09:21 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>2019 Year in Review</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Jichao Ouyang">
<meta name="description" content="Highlights about what happened last year."
>
<meta name="keywords" content="Scala,Free,Monad,MTL,ReaderT,Kleisli,Grokking Monad,Zhuyu,Jujiu,Luci">
<link rel="icon" href="/favicon.ico">
<meta name="theme-color" content="#ffffff">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/toc.css"/>
<link rel="stylesheet" href="/style/tufte.css"/>
<link rel="alternate" type="application/rss+xml" title="Jichao Ouyang" href="https://feeds.oyanglul.us/JichaoOuyangsBlog"/>
<meta property="og:title" content="2019 Year in Review" />
<meta property="og:description" content="2019 Year in Review" />
<meta property="og:type" content="article" />
<meta content="https://blog.oyanglul.us/images/Screenshot_2020-01-01%20jcouyang%20-%20Overview.png" property="og:image">
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJRFJGX"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<header>
    <a accesskey="h" href="/index.html"> HOME </a> |
    <a href="#" id="edit-in-github">EDIT</a> |
    <a href="https://feeds.oyanglul.us/JichaoOuyangsBlog">RSS</a> |
    <a href="https://blog.oyanglul.us/theindex">INDEX</a> |
    <a accesskey="H" href="/jichao.ouyang.html">ABOUT</a> |
    <a href="https://github.com/jcouyang/blog">GITHUB</a>
</header>
</div>
<div id="content">
<header>
<h1 class="title">2019 Year in Review</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org0d5918f">3 Layer Scala Cake</a></li>
<li><a href="#org162a9df">Grokking Monad</a></li>
<li><a href="#orga224c82">Kleisli{F{_}, -A, B}</a></li>
<li><a href="#org04cd33a">Zhuyu</a></li>
<li><a href="#orga1cff1a">IndexOf at Type Level</a></li>
<li><a href="#org32d1285">Type Driven Development with PureScript</a></li>
<li><a href="#orgde53a05">Functional Scala Cachinng</a></li>
<li><a href="#org2443914">Owlet</a></li>
</ul>
</div>
</nav>
<p>
I've 2210 commits over the whole year.
</p>


<figure>
<img src="./images/Screenshot_2020-01-01%20jcouyang%20-%20Overview.png" alt="Screenshot_2020-01-01%20jcouyang%20-%20Overview.png">

</figure>

<p>
But actually only 450 is for open source, it is been a busy year in MYOB.
</p>

<div id="outline-container-org0d5918f" class="outline-2">
<h2 id="org0d5918f"><a href="./scala/3-layer-cake.html">3 Layer Scala Cake</a></h2>
<div class="outline-text-2" id="text-org0d5918f">
<p>
By introducing the 3 layer cake concept to Scala,
I also published the <a href="https://github.com/jcouyang/luci">luci</a> lib to help building extensible Free Monad effects.
</p>
</div>
</div>

<div id="outline-container-org162a9df" class="outline-2">
<h2 id="org162a9df"><a href="https://gumroad.com/l/grokking-monad">Grokking Monad</a></h2>
<div class="outline-text-2" id="text-org162a9df">

<figure>
<img src="./images/Screenshot_2020-01-01%20Gumroad%20-%20Analytics.png" alt="Screenshot_2020-01-01%20Gumroad%20-%20Analytics.png">

</figure>

<p>
I was not actively updating this book in 2019.
I hope all my readers are happy, I was told it is the best book
about Category Theory in Chinese.
Hoping there will be more time can be focus on updating it in 2020.
</p>

<p>
<a href="https://gumroad.com/l/grokking-monad">Buy one</a> if you can read Chinese and curious about Monad, now examples are available in
both Haskell and Scala.
</p>
</div>
</div>

<div id="outline-container-orga224c82" class="outline-2">
<h2 id="orga224c82"><a href="https://typelevel.org/cats/api/cats/data/Kleisli.html">Kleisli{F{_}, -A, B}</a></h2>
<div class="outline-text-2" id="text-orga224c82">
<p>
I made a change to the <code>Kleisli</code> type so <code>A</code> is now contravariant <code>-A</code>.
By Scala subtyping system, we can save a lot of contramaping.
</p>

<p>
If you want to flatmap different input type of Kleisli before:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #00008b;">val</span> <span style="color: #b8860b;">program</span> <span style="color: #00008b;">=</span> <span style="color: #00008b;">for</span> {
  k1 <span style="color: #00008b;">&lt;-</span> <span style="color: #6b8e23;">Kleisli</span>((a<span style="color: #00008b;">:</span> <span style="color: #36648b;">A1</span>) <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">List</span>(<span style="color: #6b8e23;">1</span>)).local(identity[<span style="color: #6b8e23;">A1</span> <span style="color: #00008b;">with</span> <span style="color: #36648b;">A2</span> <span style="color: #00008b;">with</span> <span style="color: #36648b;">A3</span>])
  k2 <span style="color: #00008b;">&lt;-</span> <span style="color: #6b8e23;">Kleisli</span>((a<span style="color: #00008b;">:</span> <span style="color: #36648b;">A2</span>) <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">List</span>(<span style="color: #8b0000;">"2"</span>)).local(identity[<span style="color: #6b8e23;">A1</span> <span style="color: #00008b;">with</span> <span style="color: #36648b;">A2</span> <span style="color: #00008b;">with</span> <span style="color: #36648b;">A3</span>])
  k3 <span style="color: #00008b;">&lt;-</span> <span style="color: #6b8e23;">Kleisli</span>((a<span style="color: #00008b;">:</span> <span style="color: #36648b;">A3</span>) <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">List</span>(<span style="color: #6b8e23;">true</span>)).local(identity[<span style="color: #6b8e23;">A1</span> <span style="color: #00008b;">with</span> <span style="color: #36648b;">A2</span> <span style="color: #00008b;">with</span> <span style="color: #36648b;">A3</span>])
} <span style="color: #00008b;">yield</span> (k1, k2, k3)
</pre>
</div>

<p>
after cats 2.0 you can just:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #00008b;">val</span> <span style="color: #b8860b;">program</span> <span style="color: #00008b;">=</span> <span style="color: #00008b;">for</span> {
  k1 <span style="color: #00008b;">&lt;-</span> <span style="color: #6b8e23;">Kleisli</span>((a<span style="color: #00008b;">:</span> <span style="color: #36648b;">A1</span>) <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">List</span>(<span style="color: #6b8e23;">1</span>))
  k2 <span style="color: #00008b;">&lt;-</span> <span style="color: #6b8e23;">Kleisli</span>((a<span style="color: #00008b;">:</span> <span style="color: #36648b;">A2</span>) <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">List</span>(<span style="color: #8b0000;">"2"</span>))
  k3 <span style="color: #00008b;">&lt;-</span> <span style="color: #6b8e23;">Kleisli</span>((a<span style="color: #00008b;">:</span> <span style="color: #36648b;">A3</span>) <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">List</span>(<span style="color: #6b8e23;">true</span>))
} <span style="color: #00008b;">yield</span> (k1, k2, k3)
</pre>
</div>

<p>
since <code>-A</code> is contravariant, Scala can tell the <code>program</code> has type <code>Kleisli[List, A1 with A2 with A3, (Int, String, Boolean)]</code>
</p>

<p>
The power of Kleisli subtyping lead to a very powerful lib that I recently
published for our team - Zhuyu.
</p>
</div>
</div>

<div id="outline-container-org04cd33a" class="outline-2">
<h2 id="org04cd33a"><a href="https://github.com/jcouyang/zhuyu">Zhuyu</a></h2>
<div class="outline-text-2" id="text-org04cd33a">
<p>
With the power of Kleisli, now all kind of effect is composable:
</p>
<div class="org-src-container">
<pre class="src src-scala"><span style="color: #00008b;">val</span> <span style="color: #b8860b;">program</span> <span style="color: #00008b;">=</span> <span style="color: #00008b;">for</span> {
 <span style="color: #00008b;">_</span> <span style="color: #00008b;">&lt;-</span> effects.<span style="color: #6b8e23;">Http4s</span>(<span style="color: #00008b;">_</span>.status(<span style="color: #6b8e23;">GET</span>(uri<span style="color: #8b0000;">"https://blog.oyanglul.us"</span>)))
 <span style="color: #00008b;">_</span> <span style="color: #00008b;">&lt;-</span> effects.<span style="color: #6b8e23;">S3</span>(<span style="color: #00008b;">_</span>.putObject(<span style="color: #8b0000;">"example-bucket"</span>, <span style="color: #8b0000;">"filename"</span>, <span style="color: #8b0000;">"content"</span>))
 <span style="color: #00008b;">_</span> <span style="color: #00008b;">&lt;-</span> effects.<span style="color: #6b8e23;">Doobie</span>(sql<span style="color: #8b0000;">"select 250"</span>.query[<span style="color: #6b8e23;">Int</span>].unique)
} <span style="color: #00008b;">yield</span>()
<span style="color: #8c8c8c; font-style: italic;">// </span><span style="color: #8c8c8c; font-style: italic;">Kleisli[IO, HasHttp4s with HasS3 with HasDoobie, Unit]</span>
</pre>
</div>

<p>
More importantly Zhuyu provide a typesafe SQS worker, so you can safely consume
messages from SQS, even spread more message back to the SQS, without worry about
causing any loop in the queue, because now we can count at type level with shapeless.
All these check happen in compile time so you know your code will cause a loop
if it didn't compile.
</p>

<p>
If you need a worker that consume SQS, just
</p>

<pre class="example">
sbt new jcouyang/zhuyu.g8
</pre>

<p>
There is also a simple tutorial video in <a href="https://github.com/jcouyang/zhuyu.g8">README</a>
</p>
</div>
</div>

<div id="outline-container-orga1cff1a" class="outline-2">
<h2 id="orga1cff1a"><a href="https://github.com/milessabin/shapeless/blob/8626f15ed92b922a6381a9e11c3a34b76b55e337/core/src/main/scala/shapeless/ops/coproduct.scala#L107">IndexOf at Type Level</a></h2>
<div class="outline-text-2" id="text-orga1cff1a">
<p>
Since zhuyu needs to find out the position of a type in coproduct type,
I also made change to <a href="https://github.com/milessabin/shapeless">shapeless</a> so we can find out the index of
a specific type in coproduct
</p>
<div class="org-src-container">
<pre class="src src-scala">  <span style="color: #00008b;">type</span> <span style="color: #6b8e23;">S</span> <span style="color: #00008b;">=</span> <span style="color: #6b8e23;">String</span>; <span style="color: #00008b;">type</span> <span style="color: #6b8e23;">I</span> <span style="color: #00008b;">=</span> <span style="color: #6b8e23;">Int</span>; <span style="color: #00008b;">type</span> <span style="color: #6b8e23;">D</span> <span style="color: #00008b;">=</span> <span style="color: #6b8e23;">Double</span>; <span style="color: #00008b;">type</span> <span style="color: #6b8e23;">C</span> <span style="color: #00008b;">=</span> <span style="color: #6b8e23;">Char</span>
  <span style="color: #00008b;">type</span> <span style="color: #6b8e23;">SIDC</span> <span style="color: #00008b;">=</span> <span style="color: #6b8e23;">S</span> :+: <span style="color: #6b8e23;">I</span> :+: <span style="color: #6b8e23;">D</span> :+: <span style="color: #6b8e23;">C</span> :+: <span style="color: #6b8e23;">CNil</span>

  {
    <span style="color: #00008b;">val</span> <span style="color: #b8860b;">r1</span> <span style="color: #00008b;">=</span> <span style="color: #6b8e23;">IndexOf</span>[<span style="color: #6b8e23;">SIDC</span>, <span style="color: #6b8e23;">S</span>].value
    assertTypedEquals(<span style="color: #6b8e23;">0</span>, r1)

    <span style="color: #00008b;">val</span> <span style="color: #b8860b;">r2</span><span style="color: #00008b;">:</span> <span style="color: #36648b;">Nat</span> <span style="color: #00008b;">=</span> <span style="color: #6b8e23;">IndexOf</span>[<span style="color: #6b8e23;">SIDC</span>, <span style="color: #6b8e23;">I</span>].apply()
    assertTypedEquals(<span style="color: #6b8e23;">Nat</span>._1, r2)

    <span style="color: #00008b;">val</span> <span style="color: #b8860b;">r3</span> <span style="color: #00008b;">=</span> <span style="color: #6b8e23;">Coproduct</span>[<span style="color: #6b8e23;">SIDC</span>](<span style="color: #6b8e23;">1</span>).indexOf[<span style="color: #6b8e23;">D</span>]
    assertTypedEquals(<span style="color: #6b8e23;">Nat</span>._2, r3)

    <span style="color: #00008b;">val</span> <span style="color: #b8860b;">r4</span> <span style="color: #00008b;">=</span> <span style="color: #6b8e23;">IndexOf</span>[<span style="color: #6b8e23;">SIDC</span>, <span style="color: #6b8e23;">C</span>].value
    assertTypedEquals(<span style="color: #6b8e23;">3</span>, r4)
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org32d1285" class="outline-2">
<h2 id="org32d1285"><a href="./purescript/type-driven-development-with-purescript/index.html">Type Driven Development with PureScript</a></h2>
<div class="outline-text-2" id="text-org32d1285">
<p>
We are migrating our production UI codebase from TypeScript to PureScript.
</p>

<p>
<a href="https://paper.dropbox.com/doc/PureScript-on-Production--AriMP07VB6jhwgqcUJnKSnaLAg-ST0wPhRDvFST3UemcvdVY">Here is detail why and how.</a>
</p>

<p>
At the end
</p>
<ul class="org-ul">
<li>we have 10% of PureScript on production.</li>
<li>code quality are increasing</li>
<li>bug rate decreasing</li>
<li>members are uplifted with functional programming skill</li>
<li>line of code decresing</li>
<li>React eco system and purescript coexist well so far</li>
</ul>

<p>
Read the <a href="https://blog.oyanglul.us/purescript/cheatsheet">cheatsheet</a> to find out how easy to convert from JS to PureScript
</p>
</div>
</div>

<div id="outline-container-orgde53a05" class="outline-2">
<h2 id="orgde53a05"><a href="https://blog.oyanglul.us/scala/functional-caching">Functional Scala Cachinng</a></h2>
<div class="outline-text-2" id="text-orgde53a05">
<p>
We need to cache a lot of stuff on production, but it is hard to find a
caching library with good functional DSL.
</p>

<p>
So here is my answer <a href="https://github.com/jcouyang/jujiu">Jujiu</a>
</p>

<p>
It is just Kleisli and with fine with Tagless final as well.
</p>

<p>
It is easy to compose your caching logic into your existing logic using the DSL
, and run it on different interpreter later on. The builtin interpreter is <a href="https://github.com/ben-manes/caffeine">Caffeine</a>
and it's easy to <a href="https://github.com/jcouyang/jujiu#extensible">add Reddis support as well.</a>
</p>
</div>
</div>

<div id="outline-container-org2443914" class="outline-2">
<h2 id="org2443914">Owlet</h2>
<div class="outline-text-2" id="text-org2443914">
<p>
<a href="https://github.com/jcouyang/owlet">Owlet</a> is now available in <a href="https://scalafiddle.io/sf/mDggvjd">ScalaFiddle</a>, please try it out online.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<footer>
  <p>Author: Jichao Ouyang
    <a class="github-button" href="https://github.com/sponsors/jcouyang" data-icon="octicon-heart" aria-label="Sponsor @jcouyang on GitHub">Sponsor</a>
    <a aria-label="Follow @jcouyang on GitHub" data-count-aria-label="# followers on GitHub" data-count-api="/users/jcouyang#followers" data-count-href="/jcouyang/followers" href="https://github.com/jcouyang" class="github-button">Follow</a>
    <a href="https://twitter.com/oyanglulu" class="twitter-follow-button" data-show-screen-name="false" data-show-count="false">Follow @oyanglulu</a>
  </p>
  <p>Created: 2020-01-01 Wed 00:00</p>
  <p>Generated by: <a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.3 (<a href="https://orgmode.org">Org</a> mode 9.3.6) &#215; <a href="https://github.com/jcouyang/orgpress">OrgPress</a></p>
  <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Unported License</a>.
  <input type="swiftype" class="st-default-search-input" placeholder="Search"/>
  <a class="gumroad-button" href="https://gum.co/grokking-monad?wanted=true" target="_blank" data-gumroad-single-product="true">范畴论装逼指南，请自觉排队装逼</a>
  <div id="danmaku-comments"></div>
  <div id="disqus_thread"></div>
</footer>
</div>
</body>
</html>
