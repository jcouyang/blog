<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2019-03-27 Wed 02:21 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Functional Ruby</title>
<meta name="generator" content="Org mode">
<meta name="author" content="æ¬§é˜³ç»§è¶…">
<link rel="icon" href="/favicon.ico">
<meta name="theme-color" content="#ffffff">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/toc.css"/>
<link rel="stylesheet" href="/style/tufte.css"/>
<link rel="alternate" type="application/rss+xml" title="Jichao Ouyang" href="https://feeds.oyanglul.us/JichaoOuyangsBlog"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJRFJGX"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<header>
    <a accesskey="h" href="/index.html"> HOME </a> |
    <a href="#" id="edit-in-github">EDIT</a> |
    <a href="https://feeds.oyanglul.us/JichaoOuyangsBlog">RSS</a> |
    <a accesskey="H" href="/jichao.ouyang.html">ABOUT</a> |
    <a href="https://github.com/jcouyang/blog">GITHUB</a>
</header>
</div>
<div id="content">
<header>
<h1 class="title">Functional Ruby</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgab0edb6">lambda</a></li>
<li><a href="#orgdda9313">ç¥å¥‡çš„ <code>&amp;</code></a></li>
<li><a href="#org6add339">ä¸ºä»€ä¹ˆ lambda æ˜¯ proc</a>
<ul>
<li><a href="#orgb226950">return</a></li>
<li><a href="#org14c0ee4">å‚æ•°æ£€æŸ¥</a></li>
</ul>
</li>
<li><a href="#orgd0e2213">é—­åŒ…</a></li>
<li><a href="#org19246e3">pattern matching</a>
<ul>
<li><a href="#org248f573">destructure</a></li>
<li><a href="#orge45566b">case when</a>
<ul>
<li><a href="#org30d4c6b">å€¼</a></li>
<li><a href="#org13ae9d7">ç±»å‹</a></li>
<li><a href="#org2c96d81">è¡¨è¾¾å¼</a></li>
<li><a href="#org2857ccb">lambda ï¼ˆaka guardï¼‰</a></li>
<li><a href="#org9227186"><i>æ­£åˆ™</i></a></li>
<li><a href="#orgc265ddc">å…¶å®åªæ˜¯ä¸ªç®€å•çš„è¯­æ³•ç³–</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org249a800">ä¸€ä¸ªç®€å•çš„ä¾‹å­</a>
<ul>
<li><a href="#org309c002">ä¸€ä¸ªç®€å•çš„ Either Monad</a>
<ul>
<li><a href="#orga67426a">Functor</a></li>
<li><a href="#org7e75c76">Monad</a></li>
<li><a href="#orga2ecbe3">ä¸€ä¸ªå¥½çœ‹çš„ inspect</a></li>
<li><a href="#org2eb00e0">è”åˆç±»å‹ Left | Right</a></li>
</ul>
</li>
<li><a href="#org5a2f16a">ç”¨ Either åšæ§åˆ¶æµ</a></li>
</ul>
</li>
<li><a href="#org1d5c094">actor model å¤šçº¿ç¨‹</a>
<ul>
<li><a href="#org6d8dd4c">pmap</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<div class="org-center">
<p>

</p>

<p>
è¯é¢˜å·²å…¥é€‰ <a href="http://rubyconfchina2016.sxl.cn/">Rubyconf 2016</a>, æ²¡çœ‹æ‡‚çš„åŒå­¦ <del>ä¸æœæ¥æˆ˜</del> æˆ‘ä»¬æˆéƒ½è§ ğŸ˜‰
</p>

<ul class="org-ul">
<li>slides ğŸ‘‰ <a href="http://git.io/fprb">http://git.io/fprb</a></li>
<li>cats.rb <a href="https://github.com/jcouyang/cats.rb">https://github.com/jcouyang/cats.rb</a></li>
<li>hehe</li>
</ul>
</div>


<figure>
<img src="./images/data-port.gif" alt="data-port.gif">

</figure>

<p>
è¯´åˆ° ruby éƒ½ä¼šè§‰å¾—æ˜¯çº¯é¢å‘å¯¹è±¡è¯­è¨€ï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œå‡½æ•°å¼ä¸é¢å‘å¯¹è±¡å¹¶æ— å†²çªï¼ˆä½ çœ‹çœ‹Scalaï¼‰ã€‚æœ€è¿‘ä¸€ä¸ªé¡¹ç›®ç”¨ ruby å†™äº†ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„ feederï¼Œä¸€ä¸å°å¿ƒå†™å¾—å‡½æ•°å¼äº†äº›ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹fancyçš„rubyåˆ°åº•èƒ½å¹²äº›ä»€ä¹ˆfancyçš„å‡½æ•°å¼ã€‚
</p>

<div id="outline-container-orgab0edb6" class="outline-2">
<h2 id="orgab0edb6">lambda</h2>
<div class="outline-text-2" id="text-orgab0edb6">
<p>
ä¸å‡ºæ‰€æ–™ï¼Œå‡½æ•°å¼ä¸€å®šè¦å…ˆæœ‰ lambdaï¼Œè·Ÿæ‰€æœ‰çš„ ruby å¯¹è±¡ä¸€æ ·ï¼Œlambda ä¹Ÿå°±æ˜¯ä¸€ä¸ªæ­£å¸¸çš„å¯¹è±¡
</p>
<pre class="code"><code>plus1 = -&gt;(x) { x + 1 }
</code></pre>

<p>
æ˜æ˜¾ï¼Œlambda æ„é€ å‡ºä¸€ä¸ª Proc çš„å®ä¾‹ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨è¿™ä¸ª lambdaï¼Œæ•ˆæœè·Ÿ method æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š
</p>

<pre class="code"><code>plus1 = -&gt;(x) { x + 1 }
plus1.(3)
</code></pre>

<p>
å¥½ç©çš„æ˜¯ï¼Œmethod ä¸èƒ½é«˜é˜¶
</p>
<pre class="code"><code><span style="font-weight: bold;">def</span> <span style="font-weight: bold;">plus1</span> x
  x + 1
<span style="font-weight: bold;">end</span>
[1,2,3,4].map &amp;plus1
</code></pre>

<pre class="example">
`plus1': wrong number of arguments (0 for 1) (ArgumentError)
</pre>


<p>
å› ä¸º plus1 åœ¨å¼•ç”¨æ—¶å°±å·²ç»è°ƒç”¨äº†ï¼Œè§£é‡Šå™¨åœ¨è°ƒç”¨ <code>plus1</code> æ—¶å‘ç°å¹¶æ²¡æœ‰ä¼ å‚æ•°ï¼Œäºæ˜¯æŠ›å‡ºå‚æ•°ä¸åŒ¹é…é”™è¯¯ã€‚ç”±äºmethod å¼•ç”¨å³invokeï¼Œä½ æ°¸è¿œæ— æ³•å†™å‡ºé«˜é˜¶å‡½æ•°çš„æ•ˆæœã€‚
</p>

<p>
è€Œ lambda å°±å¯ä»¥ï¼š
</p>

<pre class="code"><code>plus1 = -&gt;(x) { x + 1 }
[1,2,3,4].map &amp;plus1
</code></pre>
</div>
</div>

<div id="outline-container-orgdda9313" class="outline-2">
<h2 id="orgdda9313">ç¥å¥‡çš„ <code>&amp;</code></h2>
<div class="outline-text-2" id="text-orgdda9313">
<p>
è¿™é‡Œçš„ magic æ˜¯ <code>&amp;</code> æŠŠ <code>plus1</code> å˜æˆ Block å‘ç»™æ•°ç»„äº†ï¼ŒBlock ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è§çš„ <code>{}</code> ï¼Œç­‰ä»·äºï¼š
</p>
<pre class="code"><code>[1,2,3,4].map {|x| x + 1}
</code></pre>

<p>
ä¹Ÿç­‰ä»·äºï¼š
</p>
<pre class="code"><code>[1,2,3,4].map &amp;<span style="font-weight: bold; text-decoration: underline;">Proc</span>.new{|x| x + 1 }
</code></pre>

<p>
æ³¨æ„å¦‚æœæ²¡æœ‰ <code>&amp;</code> ï¼Œè§£é‡Šå™¨æ— æ³•åˆ†è¾¨åˆ°åº•åœ¨è°ƒç”¨ <code>map</code> æ—¶ï¼ŒæŠŠ Proc å½“æˆæ­£å¸¸å‚æ•°ï¼Œè€Œä¸æ˜¯ block
</p>

<p>
å½“å¾—çŸ¥ <code>&amp;</code> çš„é­”æ³•ä¹‹åï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“è§£é‡Š <code>&amp;:symbol</code> è¿™ä¸ªè¯­æ³•ç³–
</p>
<pre class="code"><code><span style="font-style: italic;">%w(ouyang jichao)</span>.map &amp;<span style="font-weight: bold; text-decoration: underline;">:capitalize</span> 
</code></pre>

<p>
desuger å®Œå…¶å®å°±æ˜¯
</p>
<pre class="code"><code><span style="font-style: italic;">%w(ouyang jichao)</span>.map &amp;<span style="font-weight: bold; text-decoration: underline;">Proc</span>.new(|x| x.send(<span style="font-weight: bold; text-decoration: underline;">:capitalize</span>))
</code></pre>

<p>
ä¸ºä»€ä¹ˆå¯ä»¥äº§ç”Ÿè¿™æ ·çš„è¯­æ³•ç³–ï¼Œæ˜¯ Symbol ç±»å‹æœ‰ <code>to_proc</code> æ–¹æ³•ï¼Œå½“ <code>&amp;</code> å°è¯•å°†åé¢çš„ä¸œè¥¿å˜æˆ Proc ç±»å‹åä¼ ç»™ map å½“ Blockï¼Œ <code>to_proc</code> å°±æ˜¯ç”¨æ¥è½¬æ¢æˆ proc çš„æ–¹æ³•ã€‚
</p>

<p>
æ‰€ä»¥å°±æ˜¯ï¼š
</p>
<pre class="code"><code><span style="font-style: italic;">%w(ouyang jichao)</span>.map &amp;<span style="font-weight: bold; text-decoration: underline;">:capitalize</span>.to_proc
</code></pre>
</div>
</div>

<div id="outline-container-org6add339" class="outline-2">
<h2 id="org6add339">ä¸ºä»€ä¹ˆ lambda æ˜¯ proc</h2>
<div class="outline-text-2" id="text-org6add339">
<p>
è¯è¯´å›æ¥ï¼Œæ—¢ç„¶ lambda ä¹Ÿè¿”å› Proc å®ä¾‹ï¼Œ <code>Proc.new</code> ä¹Ÿè¿”å› Proc å®ä¾‹ï¼Œä¸ºä½•è¦è®¾è®¡è¿™ä¸¤ç§åŒ¿åå‡½æ•°å‘¢ï¼Ÿ
</p>

<p>
ç®€å•æ¥è¯´ï¼Œ Proc åªæ˜¯ä¸€æ®µä»£ç å—ï¼Œä½ å¯ä»¥æƒ³è±¡å¼•ç”¨çš„åœ°æ–¹ä¼šå˜æˆè¿™å—ä»£ç å—ï¼Œè€Œ lambda ä¸ä»…æ˜¯ä¸€å—ä»£ç å—ï¼Œè¡¨ç°å¾—æ›´åƒä¸€ä¸ªå‡½æ•°ã€‚å…·ä½“æ¥è®²ï¼Œå°±æ˜¯ return ä¸å‚æ•°æ£€æŸ¥ï¼š
</p>
</div>
<div id="outline-container-orgb226950" class="outline-3">
<h3 id="orgb226950">return</h3>
<div class="outline-text-3" id="text-orgb226950">
<p>
æ¥çœ‹ä¸ªè¯¡å¼‚çš„ï¼Œä¸‹é¢è¿™æ®µä»£ç æˆ‘ä»¬å¯èƒ½ä¼šæœŸæœ›æ˜¯è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œåªæ˜¯ <code>jichao</code> ä¼šå˜æˆ <code>lulu</code> è€Œå·²
</p>

<pre class="code"><code><span style="font-style: italic;">%w(ouyang jichao)</span>.map { |x| <span style="font-weight: bold;">return</span> <span style="font-style: italic;">'lulu'</span> <span style="font-weight: bold;">if</span> x == <span style="font-style: italic;">'jichao'</span>; x}
</code></pre>

<p>
æ˜¾ç„¶ return ä¹‹åçš„ä»£ç å°±å†ä¹Ÿèµ°ä¸åˆ°äº†ï¼Œæ•´ä¸ªmapä¼šç›´æ¥è¿”å›
</p>

<p>
ä½†æ˜¯å¦‚æœä½ ç”¨ lambda è€Œä¸æ˜¯æ™®é€š Procï¼Œä½ ä¼šå‘ç°
</p>
<pre class="code"><code><span style="font-style: italic;">%w(ouyang jichao)</span>.map &amp;-&gt;(x){ <span style="font-weight: bold;">return</span> <span style="font-style: italic;">'lulu'</span> <span style="font-weight: bold;">if</span> x == <span style="font-style: italic;">'jichao'</span>; x}
</code></pre>

<p>
å—’å“’ï¼Œè¾“å‡ºæˆ‘ä»¬çš„æœŸæœ›äº†ï¼Œlambda çš„è¡¨ç°è·Ÿä¸€ä¸ªæ™®é€šå‡½æ•°æ˜¯ä¸€æ ·çš„ï¼Œå‡½æ•°çš„ return å½“ç„¶ä¸ä¼šå¯¼è‡´è°ƒç”¨è€…çš„è¿”å›ã€‚
</p>
</div>
</div>

<div id="outline-container-org14c0ee4" class="outline-3">
<h3 id="org14c0ee4">å‚æ•°æ£€æŸ¥</h3>
<div class="outline-text-3" id="text-org14c0ee4">
<p>
ç¡®åˆ‡çš„è¯´æ˜¯å‚æ•°å…ƒæ•° arity çš„æ£€æŸ¥ï¼Œæ¯”å¦‚éšä¾¿å®šä¹‰ä¸€ä¸ªmethodï¼Œå¦‚æœä½ ç»™çš„å‚æ•°å…ƒæ•°ä¸åŒ¹é…ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªå¼‚å¸¸
</p>
<pre class="code"><code><span style="font-weight: bold;">def</span> <span style="font-weight: bold;">heheda</span> who
  <span style="font-style: italic;">"heheda </span><span style="font-weight: bold; font-style: italic;">#{who}</span><span style="font-style: italic;">"</span>
<span style="font-weight: bold;">end</span>
heheda
</code></pre>

<pre class="example">
`heheda': wrong number of arguments (0 for 1) (ArgumentError)
</pre>


<p>
å› ä¸ºå®šä¹‰çš„æ˜¯ä¸€å…ƒçš„å‡½æ•°ï¼Œè°ƒç”¨æ—¶å¹¶æ²¡æœ‰ç»™ä»»ä½•å‚æ•°ï¼Œå°±æŒ‚äº†
</p>

<p>
ä½†æ˜¯ Proc æ˜¯ä¸ä¼šç®¡è¿™ä¸ªçš„
</p>
<pre class="code"><code>heheda = <span style="font-weight: bold; text-decoration: underline;">Proc</span>.new{|who| <span style="font-weight: bold;">p</span> <span style="font-style: italic;">"heheda </span><span style="font-weight: bold; font-style: italic;">#{who}</span><span style="font-style: italic;">"</span>}
heheda.()
</code></pre>

<p>
Proc å®Œå…¨ä¸ä¼šç†ä¼šå‚æ•°ï¼Œå¦‚æœbindingèƒ½æ‰¾åˆ°ï¼Œå°±ç”¨äº†ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¹Ÿç»§ç»­è¿è¡Œã€‚
</p>

<p>
lambdaï¼Œåˆ™æ›´åƒä¸€ä¸ªmethod
</p>
<pre class="code"><code>heheda = <span style="font-weight: bold;">lambda</span> {|who| <span style="font-weight: bold;">p</span> <span style="font-style: italic;">"heheda </span><span style="font-weight: bold; font-style: italic;">#{who}</span><span style="font-style: italic;">"</span>}
heheda.()
</code></pre>

<pre class="example">
`block in main': wrong number of arguments (0 for 1) (ArgumentError)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0e2213" class="outline-2">
<h2 id="orgd0e2213">é—­åŒ…</h2>
<div class="outline-text-2" id="text-orgd0e2213">
<p>
é€šå¸¸é¢å‘å¯¹è±¡çš„æ•æ‰ä¸€ä¸ªç»‘å®šé€šå¸¸ä¼šé€šè¿‡ <code>@</code>
</p>
<pre class="code"><code><span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">HeHe</span>
<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span> who
  <span style="font-weight: bold; font-style: italic;">@who</span> = who
<span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">heheda</span>
  <span style="font-style: italic;">"heheda </span><span style="font-weight: bold; font-style: italic;">#{@who}</span><span style="font-style: italic;">"</span>
<span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>
</code></pre>

<p>
<code>HeHe</code> å¯¹ who è¿›è¡Œäº†å°è£…ï¼Œå¦‚æœéœ€è¦è®¿é—® <code>who</code> éœ€è¦é€šè¿‡ <code>heheda</code> æ–¹æ³•ã€‚
</p>

<p>
åŒæ ·çš„ä¸œè¥¿ï¼Œåœ¨å‡½æ•°å¼å«é—­åŒ…ï¼Œé€šè¿‡é—­åŒ…æˆ‘ä»¬ä¾ç„¶èƒ½æ‰¾åˆ°é—­åŒ…å†…çš„ç»‘å®š
</p>
<pre class="code"><code>who = <span style="font-style: italic;">'jichao'</span>
heheda = -&gt;(){ <span style="font-style: italic;">"heheda </span><span style="font-weight: bold; font-style: italic;">#{who}</span><span style="font-style: italic;">"</span> }
<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">hehedaToOuyang</span> &amp;heheda
  who = <span style="font-style: italic;">'ouyang'</span>
  heheda.()
<span style="font-weight: bold;">end</span>
hehedaToOuyang &amp;heheda
</code></pre>

<p>
æ³¨æ„çœ‹ heheda æ‰¾åˆ°çš„ç»‘å®šä¸æ˜¯ç¦»ä»–è°ƒç”¨æœ€è¿‘çš„ <code>who</code>, è€Œæ˜¯å½“åˆå®šä¹‰çš„ <code>who=jichao</code>
</p>

<p>
æ‰€ä»¥è·Ÿé¢å‘å¯¹è±¡ä¸€æ ·ï¼Œ <code>heheda</code> å®Œç¾çš„å°è£…äº† <code>who</code> ,è°ƒç”¨è€…å³æ— æ³•ç›´æ¥è·å–åˆ°ä»–ç»‘å®šçš„ <code>who</code> , ä¹Ÿæ— æ³•é‡æ–°ç»™ä»–æ–°çš„ç»‘å®š
</p>
</div>
</div>

<div id="outline-container-org19246e3" class="outline-2">
<h2 id="org19246e3">pattern matching</h2>
<div class="outline-text-2" id="text-org19246e3">
<p>
ruby æ”¯æŒç®€å•çš„å‡ ç§æ¨¡å¼åŒ¹é…
</p>
</div>

<div id="outline-container-org248f573" class="outline-3">
<h3 id="org248f573">destructure</h3>
<div class="outline-text-3" id="text-org248f573">
<pre class="code"><code>first, *middle_and_last = [<span style="font-style: italic;">'Phillip'</span>, <span style="font-style: italic;">'Jay'</span>, <span style="font-style: italic;">'Fry'</span>]
<span style="font-weight: bold;">p</span> first, middle_and_last
</code></pre>

<p>
destructuring ä¸€ä¸ªæ•°ç»„å¦‚æ­¤ç®€å•ï¼Œä½†æ˜¯hashå°±ä¸è¿™ä¹ˆå®¹æ˜“ï¼Œå¥½åœ¨ï¼Œæ–¹æ³•çš„å‚æ•°ä¼šè‡ªå¸¦ destructureçš„åŠŸèƒ½ï¼š
</p>
<pre class="code"><code>  fry = {<span style="font-weight: bold; text-decoration: underline;">first:</span> <span style="font-style: italic;">'Phillip'</span>, <span style="font-weight: bold; text-decoration: underline;">middle:</span> <span style="font-style: italic;">'Jay'</span>, <span style="font-weight: bold; text-decoration: underline;">last:</span> <span style="font-style: italic;">'Fry'</span>}
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">printFirstName</span> <span style="font-weight: bold; text-decoration: underline;">first:</span>, **rest
    <span style="font-weight: bold;">p</span> first, rest
  <span style="font-weight: bold;">end</span>
printFirstName fry
</code></pre>

<p>
è¿™ç©æ„ ruby å«å®ƒ keyword arguments, <code>first:</code> ä¼šåŒ¹é… <code>fry</code> ä¸­çš„ <code>first</code> å¹¶å°†å€¼ç»‘å®šåˆ° <code>first</code> ï¼Œ <code>**rest</code> ç»‘å®šå‰©ä¸‹çš„æ‰€æœ‰ä¸œè¥¿ã€‚
</p>

<p>
æ•°ç»„ä¹Ÿå¯ä»¥è¿™æ ·æï¼š
</p>

<pre class="code"><code><span class="linenr">1: </span>fry = [<span style="font-style: italic;">'Phillip'</span>, <span style="font-style: italic;">'Jay'</span>, <span style="font-style: italic;">'Fry'</span>]
<span class="linenr">2: </span><span style="font-weight: bold;">def</span> <span style="font-weight: bold;">printFirstName</span> first, *rest
<span class="linenr">3: </span><span style="font-weight: bold;">p</span> first, rest
<span class="linenr">4: </span><span style="font-weight: bold;">end</span>
<span id="coderef-star" class="coderef-off"><span class="linenr">5: </span>printFirstName *fry</span>
</code></pre>

<p>
è¦æ³¨æ„ç¬¬<a href="#coderef-star" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-star');" onmouseout="CodeHighlightOff(this, 'coderef-star');">5</a>è¡Œ, è°ƒç”¨æ—¶è®°å¾—ç»™æ•°ç»„åŠ  <code>*</code>, è¿™æ ·è§£é‡Šå™¨æ‰çŸ¥é“ä¸æ˜¯æŠŠæ•´ä¸ª fry æ‰”ç»™ <code>printFirstName</code> å½“å‚æ•°ï¼Œè€Œæ˜¯æŠŠ fry çš„å†…å®¹æ‰”è¿‡å»å½“å‚æ•°ã€‚
</p>
</div>
</div>

<div id="outline-container-orge45566b" class="outline-3">
<h3 id="orge45566b">case when</h3>
<div class="outline-text-3" id="text-orge45566b">
<p>
ruby ä¸­çš„ case<label for="1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="1" class="margin-toggle"/><span class="sidenote">
<a href="http://docs.ruby-lang.org/en/2.2.0/syntax/control_expressions_rdoc.html#label-case+Expression">http://docs.ruby-lang.org/en/2.2.0/syntax/control_expressions_rdoc.html#label-case+Expression</a>
</span> å¯ä»¥æå®šå››ç§æ¨¡å¼åŒ¹é…
</p>
</div>

<div id="outline-container-org30d4c6b" class="outline-4">
<h4 id="org30d4c6b">å€¼</h4>
<div class="outline-text-4" id="text-org30d4c6b">
<p>
è¿™ä¸ªå¾ˆç®€å•ï¼Œåº”è¯¥éƒ½æœ‰ç”¨è¿‡
</p>
<pre class="code"><code>me = <span style="font-style: italic;">'ouyang'</span>
<span style="font-weight: bold;">case</span> me
<span style="font-weight: bold;">when</span> <span style="font-style: italic;">'ouyang'</span> 
  <span style="font-style: italic;">"hehe </span><span style="font-weight: bold; font-style: italic;">#{me}</span><span style="font-style: italic;">"</span>
<span style="font-weight: bold;">else</span> <span style="font-style: italic;">'hehe jichao'</span>
<span style="font-weight: bold;">end</span>
</code></pre>
</div>
</div>

<div id="outline-container-org13ae9d7" class="outline-4">
<h4 id="org13ae9d7">ç±»å‹</h4>
<div class="outline-text-4" id="text-org13ae9d7">
<pre class="code"><code><span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Me</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span> name
    <span style="font-weight: bold; font-style: italic;">@name</span> = name
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">heheda</span>
    <span style="font-style: italic;">"heheda </span><span style="font-weight: bold; font-style: italic;">#{@name}</span><span style="font-style: italic;">"</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

me = <span style="font-weight: bold; text-decoration: underline;">Me</span>.new <span style="font-style: italic;">'ouyang'</span>

<span style="font-weight: bold;">case</span> me
<span style="font-weight: bold;">when</span> <span style="font-weight: bold; text-decoration: underline;">Me</span>
  me.heheda
<span style="font-weight: bold;">else</span>
  <span style="font-style: italic;">'hehedale'</span>
<span style="font-weight: bold;">end</span>
</code></pre>

<pre class="example">
"heheda ouyang"
</pre>
</div>
</div>

<div id="outline-container-org2c96d81" class="outline-4">
<h4 id="org2c96d81">è¡¨è¾¾å¼</h4>
<div class="outline-text-4" id="text-org2c96d81">
<p>
è·Ÿ <code>if else</code> ä¸€æ ·ç”¨
</p>
<pre class="code"><code><span style="font-weight: bold;">require</span> <span style="font-style: italic;">'ostruct'</span>
  me = <span style="font-weight: bold; text-decoration: underline;">OpenStruct</span>.new(<span style="font-weight: bold; text-decoration: underline;">name:</span> <span style="font-style: italic;">'jichao'</span>, <span style="font-weight: bold; text-decoration: underline;">first_name:</span> <span style="font-style: italic;">'ouyang'</span>)
  <span style="font-weight: bold;">case</span>
  <span style="font-weight: bold;">when</span> me.name == <span style="font-style: italic;">'jichao'</span>
    <span style="font-style: italic;">"hehe </span><span style="font-weight: bold; font-style: italic;">#{me}</span><span style="font-style: italic;">"</span>
  <span style="font-weight: bold;">else</span> <span style="font-style: italic;">'gewuen'</span>
  <span style="font-weight: bold;">end</span>
</code></pre>
</div>
</div>

<div id="outline-container-org2857ccb" class="outline-4">
<h4 id="org2857ccb">lambda ï¼ˆaka guardï¼‰</h4>
<div class="outline-text-4" id="text-org2857ccb">
<pre class="code"><code><span style="font-weight: bold;">require</span> <span style="font-style: italic;">'ostruct'</span>
  me = <span style="font-weight: bold; text-decoration: underline;">OpenStruct</span>.new(<span style="font-weight: bold; text-decoration: underline;">name:</span> <span style="font-style: italic;">'jichao'</span>, <span style="font-weight: bold; text-decoration: underline;">first_name:</span> <span style="font-style: italic;">'ouyang'</span>)
  <span style="font-weight: bold;">case</span> me
  <span style="font-weight: bold;">when</span> -&gt;(who){who.name==<span style="font-style: italic;">'jichao'</span>}
    <span style="font-style: italic;">"hehe </span><span style="font-weight: bold; font-style: italic;">#{me}</span><span style="font-style: italic;">"</span>
  <span style="font-weight: bold;">end</span>
</code></pre>
</div>
</div>

<div id="outline-container-org9227186" class="outline-4">
<h4 id="org9227186"><i>æ­£åˆ™</i></h4>
<div class="outline-text-4" id="text-org9227186">
<pre class="code"><code><span style="font-weight: bold;">case</span> <span style="font-style: italic;">'jichao ouyang'</span>
<span style="font-weight: bold;">when</span> <span style="font-style: italic;">/ouyang/</span>
<span style="font-style: italic;">"heheda"</span>
<span style="font-weight: bold;">end</span>
</code></pre>
</div>
</div>

<div id="outline-container-orgc265ddc" class="outline-4">
<h4 id="orgc265ddc">å…¶å®åªæ˜¯ä¸ªç®€å•çš„è¯­æ³•ç³–</h4>
<div class="outline-text-4" id="text-orgc265ddc">
<p>
case when å¹¶ä¸æ˜¯magicï¼Œå…¶å®åªæ˜¯ if else çš„è¯­æ³•ç³–, æ¯”å¦‚ä¸Šé¢è¯´çš„æ­£åˆ™
</p>
<pre class="code"><code><span style="font-weight: bold;">if</span>(<span style="font-style: italic;">/ouyang/</span> === <span style="font-style: italic;">'jichao'</span>)
  <span style="font-style: italic;">"heheda"</span>
<span style="font-weight: bold;">end</span>
</code></pre>

<p>
æ‰€ä»¥ magic åˆ™æ˜¯æ‰€æœ‰ when çš„å¯¹è±¡éƒ½å®ç°äº† <code>===</code> æ–¹æ³•è€Œå·²
</p>
<ul class="org-ul">
<li>å€¼ï¼š <code>object.===</code> ä¼šä»£ç†åˆ° <code>==</code></li>
<li>ç±»å‹ï¼š <code>Module.===</code> ä¼šçœ‹æ˜¯å¦æ˜¯å…¶ instance</li>
<li>æ­£åˆ™ï¼š <code>regex.===</code> å¦‚æœåŒ¹é…è¿”å› true</li>
<li>è¡¨è¾¾å¼ï¼šå–å†³äºè¡¨è¾¾å¼è¿”å›çš„å€¼çš„ <code>===</code> æ–¹æ³•</li>
<li>lambdaï¼š <code>proc.===</code> ä¼šè¿è¡Œ lambda æˆ–è€… proc</li>
</ul>

<p>
è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥éšæ„ç»™ä»»ä½•ç±»åŠ ä¸Š <code>===</code> æ–¹æ³•, ä¸ä»…å¦‚æ­¤ï¼Œå®ç°ä¸€ä¸ªæŠ½è±¡æ•°æ®ç±»å‹ï¼ˆADTï¼‰ä¼šå˜å¾—æ˜¯åˆ†ç®€å•
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org249a800" class="outline-2">
<h2 id="org249a800">ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2>
<div class="outline-text-2" id="text-org249a800">
<p>
ä¸€ä¸ªç®€å•çš„ feeder æµç¨‹å¤§æ¦‚æ˜¯ï¼Œä»ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®æºè·å–æ•°æ®å¹¶ feed åˆ°ä¸€ä¸ªåœ°æ–¹ï¼ˆDB, S3, ElasticSearchä¹‹ç±»)ã€‚é€šå¸¸æ˜¯ä¸€ä¸ªå®šæœŸçš„ä»»åŠ¡ï¼Œæ¯”å¦‚æ²¡å¤šä¹…å°± feed é‚£ä¹ˆä¸€æ¬¡ã€‚
</p>

<p>
ä½œä¸ºå®šæœŸè·‘çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ç›‘æ§ä¸¤ä¸ªæ–¹é¢
</p>
<ul class="org-ul">
<li>feed å¤±è´¥äº†å¤šå°‘</li>
<li>feeder è·‘äº†æ²¡</li>
</ul>

<p>
ä¸ç®¡æ˜¯ä»€ä¹ˆå½¢å¼ï¼Œç›‘æ§éƒ½ä¸åº”è¯¥è·Ÿæˆ‘ä»¬çš„ä¸šåŠ¡æåˆ°ä¸€èµ·å»ï¼Œæ¯”å¦‚
</p>
</div>
<div id="outline-container-org309c002" class="outline-3">
<h3 id="org309c002">ä¸€ä¸ªç®€å•çš„ Either Monad<label for="2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="2" class="margin-toggle"/><span class="sidenote">
<a href="http://hackage.haskell.org/package/base-4.8.2.0/docs/src/Data.Either.html#Either">http://hackage.haskell.org/package/base-4.8.2.0/docs/src/Data.Either.html#Either</a>
</span></h3>
<div class="outline-text-3" id="text-org309c002">
<p>
åˆ›å»ºä¸€ä¸ªåˆšå¥½å¤Ÿç”¨çš„ Either éå¸¸ç®€å•
</p>
</div>
<div id="outline-container-orga67426a" class="outline-4">
<h4 id="orga67426a">Functor</h4>
<div class="outline-text-4" id="text-orga67426a">
<pre class="code"><code><span style="font-weight: bold;">module</span> <span style="font-weight: bold; text-decoration: underline;">Either</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span> v
    <span style="font-weight: bold; font-style: italic;">@v</span> = v
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">map</span>
    <span style="font-weight: bold;">case</span> <span style="font-weight: bold;">self</span>
    <span style="font-weight: bold;">when</span> <span style="font-weight: bold; text-decoration: underline;">Right</span>
      <span style="font-weight: bold; text-decoration: underline;">Right</span>.new(<span style="font-weight: bold;">yield</span> <span style="font-weight: bold; font-style: italic;">@v</span>)
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold;">self</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">alias</span> <span style="font-weight: bold; text-decoration: underline;">:fmap</span> <span style="font-weight: bold; text-decoration: underline;">:map</span>
</code></pre>
</div>
</div>
<div id="outline-container-org7e75c76" class="outline-4">
<h4 id="org7e75c76">Monad</h4>
<div class="outline-text-4" id="text-org7e75c76">
<pre class="code"><code><span style="font-weight: bold;">def</span> <span style="font-weight: bold;">bind</span>
  <span style="font-weight: bold;">case</span> <span style="font-weight: bold;">self</span>
  <span style="font-weight: bold;">when</span> <span style="font-weight: bold; text-decoration: underline;">Right</span>
    <span style="font-weight: bold;">yield</span> <span style="font-weight: bold; font-style: italic;">@v</span>
  <span style="font-weight: bold;">else</span>
    <span style="font-weight: bold;">self</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">alias</span> <span style="font-weight: bold; text-decoration: underline;">:chain</span> <span style="font-weight: bold; text-decoration: underline;">:bind</span>
<span style="font-weight: bold;">alias</span> <span style="font-weight: bold; text-decoration: underline;">:flat_map</span> <span style="font-weight: bold; text-decoration: underline;">:bind</span>
</code></pre>
</div>
</div>
<div id="outline-container-orga2ecbe3" class="outline-4">
<h4 id="orga2ecbe3">ä¸€ä¸ªå¥½çœ‹çš„ inspect</h4>
<div class="outline-text-4" id="text-orga2ecbe3">
<pre class="code"><code>  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">inspect</span>
    <span style="font-weight: bold;">case</span> <span style="font-weight: bold;">self</span>
    <span style="font-weight: bold;">when</span> <span style="font-weight: bold; text-decoration: underline;">Left</span>
      <span style="font-style: italic;">"#&lt;Left value=</span><span style="font-weight: bold; font-style: italic;">#{@v}</span><span style="font-style: italic;">&gt;"</span>
    <span style="font-weight: bold;">else</span>
      <span style="font-style: italic;">"#&lt;Right value=</span><span style="font-weight: bold; font-style: italic;">#{@v}</span><span style="font-style: italic;">&gt;"</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>
</code></pre>
</div>
</div>
<div id="outline-container-org2eb00e0" class="outline-4">
<h4 id="org2eb00e0">è”åˆç±»å‹ Left | Right</h4>
<div class="outline-text-4" id="text-org2eb00e0">
<p>
åœ¨å®ç°äº† Either æ¥å£ä¹‹å,æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å®ç°  Left | Right
</p>
<pre class="code"><code><span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Left</span>
  <span style="font-weight: bold;">include</span> <span style="font-weight: bold; text-decoration: underline;">Either</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">initialize</span> v=<span style="font-weight: bold; text-decoration: underline;">nil</span>
    <span style="font-weight: bold; font-style: italic;">@v</span>=v
  <span style="font-weight: bold;">end</span>

  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">==</span> other
    <span style="font-weight: bold;">case</span> other
    <span style="font-weight: bold;">when</span> <span style="font-weight: bold; text-decoration: underline;">Left</span>
      other.left_map { |v| <span style="font-weight: bold;">return</span> v == <span style="font-weight: bold; font-style: italic;">@v</span> }
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Right</span>
  <span style="font-weight: bold;">include</span> <span style="font-weight: bold; text-decoration: underline;">Either</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">==</span> other
    <span style="font-weight: bold;">case</span> other
    <span style="font-weight: bold;">when</span> <span style="font-weight: bold; text-decoration: underline;">Right</span>
      other.map { |v| <span style="font-weight: bold;">return</span> v == <span style="font-weight: bold; font-style: italic;">@v</span> }
    <span style="font-weight: bold;">else</span>
      <span style="font-weight: bold; text-decoration: underline;">false</span>
    <span style="font-weight: bold;">end</span>
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>
</code></pre>

<p>
è¿™ä¸ªEitheréå¸¸è½»é‡, æˆ‘è¿˜æ˜¯æŠŠå®ƒæŠ½æˆgemä»¥ä¾¿å•ç‹¬ç®¡ç†, ä¸å…¶ä»–ä¸€äº› Maybe å’Œ Free ä¸€å—æ”¶åˆ° <a href="https://github.com/jcouyang/cats.rb">cats.rb</a> ä¸­.
</p>
</div>
</div>
</div>

<div id="outline-container-org5a2f16a" class="outline-3">
<h3 id="org5a2f16a">ç”¨ Either åšæ§åˆ¶æµ</h3>
<div class="outline-text-3" id="text-org5a2f16a">
<pre class="code"><code><span class="linenr">1: </span><span style="font-weight: bold;">def</span> <span style="font-weight: bold;">run</span>
<span class="linenr">2: </span>  list_of_error_or_detail =
<span id="coderef-listof_error_or_id" class="coderef-off"><span class="linenr">3: </span>    listof_error_or_id.map <span style="font-weight: bold;">do</span> |error_or_id| <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">&lt;-</span></span>
<span id="coderef-error_or_id" class="coderef-off"><span class="linenr">4: </span>    error_or_id.flat_map <span style="font-weight: bold;">do</span> |id| <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">&lt;-</span></span>
<span id="coderef-error_or_detail" class="coderef-off"><span class="linenr">5: </span>      error_or_detail_of(id) <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">&lt;-</span></span>
<span class="linenr">6: </span>    <span style="font-weight: bold;">end</span>
<span class="linenr">7: </span>  <span style="font-weight: bold;">end</span>
<span id="coderef-error_or_saved" class="coderef-off"><span class="linenr">8: </span>  list_of_error_or_detail.map { |error_or_detail| error_or_saved error_or_detail} <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">&lt;-</span></span>
<span class="linenr">9: </span><span style="font-weight: bold;">end</span>
</code></pre>

<ol class="org-ol">
<li><a href="#coderef-listof_error_or_id" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-listof_error_or_id');" onmouseout="CodeHighlightOff(this, 'coderef-listof_error_or_id');"><code>listof_error_or_id</code></a> æ˜¯ä¸€ä¸ª IO, å»æŸä¸ªåœ°æ–¹æ‹¿ä¸€ä¸² id, æˆ–è€…è¿”å›ä¸€ä¸²é”™è¯¯, æ‰€ä»¥ç±»å‹æ˜¯ <code>[Either error id]</code></li>
<li>æ‰€ä»¥ <a href="#coderef-error_or_id" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-error_or_id');" onmouseout="CodeHighlightOff(this, 'coderef-error_or_id');"><code>error_or_id</code></a> çš„ç±»å‹æ˜¯ <code>Either error id</code>, <code>flat_map</code> å¯ä»¥æŠŠ <code>id</code> å–å‡ºæ¥, å¦‚æœæœ‰çš„è¯</li>
<li>å–å‡ºæ¥çš„ <code>id</code> äº¤ç»™ <a href="#coderef-error_or_detail" class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-error_or_detail');" onmouseout="CodeHighlightOff(this, 'coderef-error_or_detail');"><code>error_or_detail_of</code></a>, è¯¥å‡½æ•°ä¹Ÿæ˜¯ IO, å¤æ‚è·å¾—å¯¹åº” id çš„ è¯¦ç»†ä¿¡æ¯, æ˜¯IOå°±æœ‰å¯èƒ½ä¼šæœ‰é”™è¯¯, æ‰€ä»¥è¿”å›å€¼ç±»å‹ä¹Ÿæ˜¯ <code>Either error detail</code></li>
<li>è¿™æ—¶, å¦‚æœæ˜¯ç”¨ <code>fmap</code> è½¬æ¢å®Œæˆåä¼šå˜æˆä¸€ä¸ª <code>Either error (Either error detail)</code>. ä½†æ˜¾ç„¶æˆ‘ä»¬ä¸éœ€è¦åµŒå¥—è¿™ä¹ˆå¤šå±‚, <code>flat</code> ä¸€äº›ä¼šå˜æˆ <code>Either error detail</code></li>
<li>åé¢çš„ save å‡½æ•°ä¹Ÿæ˜¯ç±»ä¼¼çš„ IO æ“ä½œ, è¿”å› <code>Either error saved</code></li>
</ol>

<p>
é‚£ä¹ˆæˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘çš„æµç¨‹èµ°å®Œäº†ï¼Œè¯¥è´Ÿè´£ç›‘æ§çš„é€»è¾‘äº†ï¼Œæ³¨æ„ç°åœ¨ run çš„è¿”å›å€¼ç±»å‹æ˜¯ <code>Either[Error, [Either[Error, Data]]]</code>
</p>

<pre class="code"><code>failures, success = run.partition {|lr| !lr.is_a? <span style="font-weight: bold; text-decoration: underline;">Right</span>}
error_msg = failures.map <span style="font-weight: bold;">do</span> |failure|
  failure.left_map &amp;<span style="font-weight: bold; text-decoration: underline;">:message</span>
<span style="font-weight: bold;">end</span>.join <span style="font-style: italic;">"\n"</span>
logger.error <span style="font-style: italic;">"processing failure </span><span style="font-weight: bold; font-style: italic;">#{failues.length}</span><span style="font-style: italic;">:\n</span><span style="font-weight: bold; font-style: italic;">#{error_msg}</span><span style="font-style: italic;">"</span> <span style="font-weight: bold;">unless</span> error_msg.blank?
logger.info <span style="font-style: italic;">"processing success </span><span style="font-weight: bold; font-style: italic;">#{success.length}</span><span style="font-style: italic;">: </span><span style="font-weight: bold; font-style: italic;">#{success}</span><span style="font-style: italic;">"</span>
</code></pre>
</div>
</div>
</div>

<div id="outline-container-org1d5c094" class="outline-2">
<h2 id="org1d5c094">actor model å¤šçº¿ç¨‹</h2>
<div class="outline-text-2" id="text-org1d5c094">
<p>
å½“ä½ çš„æ•°æ®å¤„ç†éƒ½æ˜¯å‡½æ•°å¼çš„ä¹‹åï¼Œæˆ–è€…è¯´ immutableï¼Œåº”ç”¨å¤šçº¿ç¨‹å°†æ˜¯ååˆ†ç®€å•è€Œä¸”å®‰å…¨çš„äº‹æƒ…, ä¸‹é¢ä¹Ÿæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä½¿ç”¨ <a href="https://github.com/celluloid/celluloid">Celluloid</a> æŠŠæˆ‘ä»¬çš„ feeder æ”¹æˆå¤šçº¿ç¨‹
</p>
</div>

<div id="outline-container-org6d8dd4c" class="outline-3">
<h3 id="org6d8dd4c">pmap</h3>
<div class="outline-text-3" id="text-org6d8dd4c">
<pre class="code"><code><span style="font-weight: bold;">require</span> <span style="font-style: italic;">"celluloid/autostart"</span>
<span style="font-weight: bold;">module</span> <span style="font-weight: bold; text-decoration: underline;">Enumerable</span>
  <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">pmap</span>(&amp;block)
    futures = map { |elem| <span style="font-weight: bold; text-decoration: underline;">Celluloid</span>::<span style="font-weight: bold; text-decoration: underline;">Future</span>.new(elem, &amp;block) }
    futures.map(&amp;<span style="font-weight: bold; text-decoration: underline;">:value</span>)
  <span style="font-weight: bold;">end</span>
<span style="font-weight: bold;">end</span>
</code></pre>

<p>
ä½ æ‡‚çš„ï¼ŒæŠŠæˆ‘ä»¬feederçš„ <code>map</code> éƒ½æ¢æˆ <code>pmap</code> ,å¤šçº¿ç¨‹å°±è¿™ä¹ˆç®€å•
</p>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="http://docs.ruby-lang.org/en/2.2.0/syntax/control_expressions_rdoc.html#label-case+Expression">http://docs.ruby-lang.org/en/2.2.0/syntax/control_expressions_rdoc.html#label-case+Expression</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
<a href="http://hackage.haskell.org/package/base-4.8.2.0/docs/src/Data.Either.html#Either">http://hackage.haskell.org/package/base-4.8.2.0/docs/src/Data.Either.html#Either</a>
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<footer>
  <p>Author: æ¬§é˜³ç»§è¶… <a aria-label="Follow @jcouyang on GitHub" data-count-aria-label="# followers on GitHub" data-count-api="/users/jcouyang#followers" data-count-href="/jcouyang/followers" href="https://github.com/jcouyang" class="github-button">Follow @jcouyang</a></p>
  <p>Modified: 2019-03-27 Wed 02:21</p>
  <p>Generated by: <a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.1 (<a href="https://orgmode.org">Org</a> mode 9.2.2) &#215; <a href="https://github.com/jcouyang/orgpress">OrgPress</a></p>
  <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Unported License</a>.
  <input type="swiftype" class="st-default-search-input" placeholder="Search"/>
  <a class="gumroad-button" href="https://gum.co/grokking-monad?wanted=true" target="_blank" data-gumroad-single-product="true">èŒƒç•´è®ºè£…é€¼æŒ‡å—ï¼Œè¯·è‡ªè§‰æ’é˜Ÿè£…é€¼</a>
  <div id="danmaku-comments"></div>
  <div id="disqus_thread"></div>
</footer>
</div>
</body>
</html>
