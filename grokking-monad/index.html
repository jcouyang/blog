<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2019-03-27 Wed 06:03 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>èŒƒç•´è®ºå®Œå…¨è£…é€¼æ‰‹å†Œ / Grokking Monad</title>
<meta name="generator" content="Org mode">
<meta name="author" content="æ¬§é˜³ç»§è¶…">
<link rel="icon" href="/favicon.ico">
<meta name="theme-color" content="#ffffff">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/toc.css"/>
<link rel="stylesheet" href="/style/tufte.css"/>
<link rel="alternate" type="application/rss+xml" title="Jichao Ouyang" href="https://feeds.oyanglul.us/JichaoOuyangsBlog"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJRFJGX"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<header>
    <a accesskey="h" href="/index.html"> HOME </a> |
    <a href="#" id="edit-in-github">EDIT</a> |
    <a href="https://feeds.oyanglul.us/JichaoOuyangsBlog">RSS</a> |
    <a accesskey="H" href="/jichao.ouyang.html">ABOUT</a> |
    <a href="https://github.com/jcouyang/blog">GITHUB</a>
</header>
</div>
<div id="content">
<header>
<h1 class="title">èŒƒç•´è®ºå®Œå…¨è£…é€¼æ‰‹å†Œ / Grokking Monad</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgca9b67e">1. ç¬¬ä¸€éƒ¨åˆ†ï¼š<ruby>çŒ«è®º<rt>Catergory Theory</rt></ruby></a>
<ul>
<li><a href="#orgad04abb">1.1. <i>Category</i></a>
<ul>
<li><a href="#orgafb8e40">1.1.1. <i>Hask</i></a></li>
<li><a href="#org0fd3034">1.1.2. <i>Duel</i></a></li>
</ul>
</li>
<li><a href="#org883b6c3">1.2. <i><ruby>å‡½å­<rt> Functor</rt></ruby></i></a></li>
<li><a href="#org47bd54a">1.3. <i><ruby>Cat<rt> +çŒ«+</rt></ruby></i></a></li>
<li><a href="#orgf52b923">1.4. /<ruby>è‡ªç„¶å˜æ¢<rt>Natural Transformations</rt></ruby>/</a></li>
<li><a href="#orgfcc68b9">1.5. String Diagram</a></li>
<li><a href="#org62a6367">1.6. <i>Adjunction Functor</i> ä¼´éšå‡½å­</a></li>
<li><a href="#org90c31b6">1.7. ä»ä¼´éšå‡½å­åˆ° <ruby>å•å­<rt> Monad</rt></ruby></a>
<ul>
<li><a href="#orgce319bb">1.7.1. ä¸‰è§’ç­‰å¼</a></li>
<li><a href="#orgd2e88b9">1.7.2. ç»“åˆå¾‹</a></li>
</ul>
</li>
<li><a href="#org60e1894">1.8. Yoneda lemma / <del>ç±³ç”°å…±</del> ç±³ç”°å¼•ç†</a>
<ul>
<li><a href="#orgdab7084">1.8.1. Rank N Type</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgdb03fd2">2. ç¬¬äºŒéƒ¨åˆ†ï¼š<ruby>é£Ÿç”¨çŒ«å‘¢<rt> Practical Monads</rt></ruby></a>
<ul>
<li><a href="#orgb1009ea">2.1. Identity</a></li>
<li><a href="#orgf09dbeb">2.2. Maybe</a></li>
<li><a href="#org9155a94">2.3. Either</a>
<ul>
<li><a href="#org71e011b">2.3.1. Product &amp; Coproduct</a></li>
<li><a href="#org5b8ddea">2.3.2. Either Monad</a></li>
</ul>
</li>
<li><a href="#org8822b66">2.4. Reader</a>
<ul>
<li><a href="#orgca4f5da">2.4.1. do notation</a></li>
</ul>
</li>
<li><a href="#org34fe8c3">2.5. Writer</a></li>
<li><a href="#orge48dcf3">2.6. State</a></li>
<li><a href="#org26de6b2">2.7. Validation</a>
<ul>
<li><a href="#orgb29cfa0">2.7.1. <ruby>å«å¹ºåŠç¾¤<rt>Monoid</rt></ruby></a></li>
<li><a href="#orgc96495d">2.7.2. å›åˆ° Validation</a></li>
</ul>
</li>
<li><a href="#org97478b7">2.8. Cont</a></li>
</ul>
</li>
<li><a href="#org4624c6a">3. ç¬¬ä¸‰éƒ¨åˆ†:<ruby>æåŸºçŒ«å‘¢<rt>Advanced Monads</rt></ruby></a>
<ul>
<li><a href="#orgeb61fb5">3.1. RWS</a></li>
<li><a href="#orgb9ad244">3.2. Monad Transform</a>
<ul>
<li><a href="#org8bbcf26">3.2.1. ReaderT</a></li>
</ul>
</li>
<li><a href="#org89b5397">3.3. Alternative</a></li>
<li><a href="#orgc4f6987">3.4. MonadPlus</a></li>
<li><a href="#orgb2e026f">3.5. ST Monad</a></li>
<li><a href="#orge48b2c0">3.6. Free Monad</a>
<ul>
<li><a href="#orge5eedb7">3.6.1. Free</a></li>
<li><a href="#orge26c319">3.6.2. Coyoneda</a></li>
<li><a href="#orgded5027">3.6.3. Free Functor</a></li>
<li><a href="#org6a6fe6e">3.6.4. Interpreter</a></li>
</ul>
</li>
<li><a href="#orgd2bf013">3.7. Free Monoid</a></li>
<li><a href="#org1cda92c">3.8. Eff</a></li>
<li><a href="#orgc20f404">3.9. Comonad</a></li>
</ul>
</li>
<li><a href="#orgc6d2063">4. References</a></li>
</ul>
</div>
</nav>
<div class="org-center">
<p>
FBI Warning
</p>
æœ¬æ–‡æ‰€æœ‰æ–‡å­—ä¸å›¾ç‰‡éµå¾ª <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">CC ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 3.0 è®¸å¯åè®®</a><br/><a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png" /></a>
</div>

<p>
ğŸ‘‡PDFï¼Œkindleï¼Œ epubæ ¼å¼çš„ä¹¦ç°å·²å¼€æ”¾è´­ä¹°&#x2026;
</p>

<p>
è´­ä¹°é“¾æ¥æ˜¯ gumroadï¼Œéœ€è¦ç§‘å­¦ä¸Šç½‘æ‰èƒ½ç‚¹å¼€ï¼Œå¦‚æœä½ ä¸èƒ½ç§‘å­¦ä¸Šç½‘ï¼Œå°±ä¸è¦ä¹°äº†ï¼ˆå½“ç„¶ä¹Ÿæ²¡æ³•ä¹°ï¼‰ï¼ŒæŠŠè¿™å…­å—é’±æŠ•èµ„åˆ°ç§‘å­¦ä¸Šç½‘ä¸Šå§ã€‚
</p>

<script src="https://gumroad.com/js/gumroad-embed.js"></script><div class="gumroad-product-embed" data-gumroad-product-id="grokking-monad"><a href="https://gumroad.com/l/grokking-monad"><img src="https://blog.oyanglul.us/grokking-monad/cover.jpg"></img></a></div>


<div id="outline-container-orgca9b67e" class="outline-2">
<h2 id="orgca9b67e"><span class="section-number-2">1</span> ç¬¬ä¸€éƒ¨åˆ†ï¼š<ruby>çŒ«è®º<rt>Catergory Theory</rt></ruby></h2>
<div class="outline-text-2" id="text-1">
<p>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/54/De_Alice%27s_Abenteuer_im_Wunderland_Carroll_pic_23_edited_1_of_2.png/1920px-De_Alice%27s_Abenteuer_im_Wunderland_Carroll_pic_23_edited_1_of_2.png" alt="1920px-De_Alice%27s_Abenteuer_im_Wunderland_Carroll_pic_23_edited_1_of_2.png"> <label for="1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="1" class="margin-toggle"/><span class="sidenote">
<a href="https://en.wikipedia.org/wiki/Cheshire_Cat">https://en.wikipedia.org/wiki/Cheshire_Cat</a>
</span>
</p>

<div class="epigraph"><blockquote>
<p>
`But I donâ€™t want to go among mad people,â€™ Alice remarked.
</p>

<p>
`Oh, you canâ€™t help that,â€™ said the Cat: `weâ€™re all mad here. Iâ€™m mad. Youâ€™re mad.â€™
</p>

<p>
`How do you know Iâ€™m mad?â€™ said Alice.
`You must be,â€™ said the Cat, `or you wouldnâ€™t have come here.â€™
</p>

<p>
Alice didnâ€™t think that proved it at all; however, she went on `And how do you know that youâ€™re mad?â€™
</p>

<p>
&#x2013; Alice's Adventures in Wonderland
</p>

</blockquote></div>

<p>
<ruby>å•å­<rt>Monad</rt></ruby>æ˜¯ä»€ä¹ˆ? ä½ ä¹Ÿä¸æ‡‚, æˆ‘ä¹Ÿä¸æ‡‚, æˆ‘ä»¬éƒ½ä¸æ‡‚.
</p>

<p>
è¯è¯´, æˆ‘åˆæ€ä¹ˆçŸ¥é“ä½ ä¸æ‡‚å‘¢?
</p>

<p>
å½“ç„¶ä¸æ‡‚, ä¸ç„¶, ä½ æ€ä¹ˆä¼šæ¥åˆ°è¿™é‡Œ?
</p>

<p>
æˆ‘åˆæ˜¯æ€ä¹ˆçŸ¥é“è‡ªå·±ä¸æ‡‚å‘¢?
</p>

<p>
å› ä¸º, æˆ‘çŸ¥é“æ‡‚çš„äººä»€ä¹ˆæ ·å­. æ˜¾ç„¶, æˆ‘ä¸æ˜¯.
</p>

<p>
æ‡‚çš„äººä¸€å®šçŸ¥é“<ruby>çŒ«è®º<rt> Category Theory</rt></ruby>.
</p>

<p>
æ‡‚çŒ«è®ºçš„äººåˆä¸ä¸€å®šçŸ¥é“ç¼–ç¨‹. ä½†æ˜¯æ‡‚ç¼–ç¨‹çš„äººå¯ä»¥ç•¥æ‡‚çŒ«è®º.
</p>

<p>
ç¼–ç¨‹æ˜¯é¡¹æŠ€æœ¯, å³ç†è®ºçš„é™ç»´. æ‰€ä»¥è¦é™ä½é—¨æ§›, æ¯”å¦‚æˆ‘åœ¨ä¹¦ä¸­ä¹Ÿ<a href="https://book.douban.com/subject/26883736/">å†™è¿‡ä¸€ç« </a>ç”¨JavaScriptæ¥è§£é‡Šï¼ŒæŸäººä¹Ÿå°è¯•è¿‡<a href="http://www.ruanyifeng.com/blog/2017/02/fp-tutorial.html">å†™åšå®¢è§£é‡Š</a>ï¼Œ<label for="2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="2" class="margin-toggle"/><span class="sidenote">
å¦‚æœæ²¡çœ‹å°±åˆšå¥½ä¸è¦çœ‹äº†, ç¡®å®æœ‰äº›è¯¯å¯¼
</span>æ²¡æƒ³åˆ°é‚£äº›ä¹Ÿä¸çŸ¥é“ä¼šä¸ä¼š Haskell/Scala çš„äººå°±è·‘å‡ºæ¥å–·ä½ ä»¬å‰ç«¯<label for="3" class="margin-toggle sidenote-number"></label><input type="checkbox" id="3" class="margin-toggle"/><span class="sidenote">
ç­‰ç­‰, å†™å‰ç«¯æ€ä¹ˆäº†? JavaScript åªæ˜¯æˆ‘è§‰å¾—é¡ºæ‰‹çš„è‹¥å¹²è¯­è¨€ä¹‹ä¸€, JSç”¨æˆ·é‚£ä¹ˆå¤š, å†™ä¹¦å½“ç„¶è¦ç”¨ JS å•¦, éš¾é“ç”¨ Idris é‚£è¿˜èƒ½å–å¾—æ‰å—? <del>å½“ç„¶æœ€åç”¨JSä¹Ÿæ²¡æ€ä¹ˆå–æ‰&#x2026;</del>
</span>è¿™äº›ä¸æ‡‚å‡½æ•°å¼çš„æ¸£æ¸£ä¹±æå‡ºæ¥çš„ä¸œè¥¿æ ¹æœ¬å°±ä¸æ˜¯å•å­ã€‚
</p>

<p>
æˆ‘ä¹Ÿç”»è¿‡ä¸€äº›å›¾æ¥è§£é‡Šï¼Œåˆä¼šè¢«å«Œå¼ƒç”»é£ä¸å¥½ã€‚ä½†æ˜¯ï¼Œä½œä¸ºçµé­‚ç”»å¸ˆï¼Œæˆ‘åª <del>æ˜¯è§‰å¾—è‡ªå·±èŒèŒçš„å•Š</del> åœ¨ä¹ç”»çš„çµé­‚æ˜¯å¦èƒ½å¤Ÿç»™ä½ ä¸€ç‚¹å¯å‘ã€‚å¥½å§ï¼Œè®²è¿™ä¹ˆå­¦æœ¯çš„ä¸œè¥¿ï¼Œè¿˜æ˜¯ç”¨dotæ¥ç”»å§ï¼Œçœ‹èµ·æ¥å¥½æ­£è§„å‘¢ã€‚
</p>

<p>
å¥½äº†ï¼Œå®‰å…¨å¸¦ç³»å¥½ï¼Œæˆ‘çœŸçš„è¦å¼€è½¦äº†ã€‚ä¸ºäº†é˜²æ­¢<ruby>è§£é‡Šçš„ä¸åˆ°ä½<rt>åˆè¢«å–·</rt></ruby>ï¼Œå°±ç”¨ Haskell/Scala å¥½äº†<label for="4" class="margin-toggle sidenote-number"></label><input type="checkbox" id="4" class="margin-toggle"/><span class="sidenote">
å¹¶ä¸æ˜¯è¯´è¿™ä¸¤é—¨è¯­è¨€ä¸€å®šåœ¨é„™è§†é“¾é¡¶ç«¯, è€Œæ˜¯æ‹¥æœ‰å¼ºå¤§ç±»å‹ç³»ç»Ÿçš„è¯­è¨€æ‰èƒ½ä½“ç°å‡ºèŒƒç•´è®ºçš„å†…å®¹
</span>ï¼Œå…¶å®ä¹Ÿä¸éš¾è§£é‡Šæ¸…æ¥š <del>æ‰æ€ª</del> ã€‚
</p>

<p>
è¿™é‡Œé¢å¾ˆå¤šå¾ˆè£…é€¼çš„å•è¯ï¼Œå®ƒä»¬éƒ½æ˜¯ <i>æ–œä½“</i> ï¼Œå°±ç®—æ²¡çœ‹æ‡‚ï¼ŒæŠŠè¿™äº›è¯èƒŒä¸‹æ¥ä¹Ÿè¶³å¤Ÿ<ruby>è£…å¥½ä¸€é˜µå­é€¼äº†<rt>ä¹°ä¸€é˜µå­èŒäº†</rt></ruby>ã€‚
</p>

<p>
è¿™é‡Œè¿˜æœ‰å¾ˆå¤šä»£ç , å®ƒä»¬éƒ½æˆå¯¹å‡ºç°, ç¬¬ä¸€æ®µæ˜¯ Haskell, ç¬¬äºŒæ®µæ˜¯ Scala.
</p>
</div>

<div id="outline-container-orgad04abb" class="outline-3">
<h3 id="orgad04abb"><span class="section-number-3">1.1</span> <i>Category</i></h3>
<div class="outline-text-3" id="text-1-1">
<p>
ä¸€ä¸ª <i><ruby>èŒƒç•´<rt>Category</rt></ruby></i> åŒ…å«ä¸¤ä¸ªç©æ„
</p>
<ul class="org-ul">
<li>ä¸œè¥¿ <code>O</code> ï¼ˆObjectï¼‰</li>
<li>ä¸¤ä¸ªä¸œè¥¿çš„å…³ç³»ï¼Œç®­å¤´ <code>~&gt;</code> ï¼ˆ <i><ruby>æ€å°„<rt>Morphism</rt></ruby></i> ï¼‰</li>
</ul>

<p>
è¿˜å¿…é¡»å¸¦ä¸Šä¸€äº›å±æ€§: 
</p>
<ul class="org-ul">
<li>ä¸€å®šæœ‰ä¸€ä¸ªå« id çš„ç®­å¤´ï¼Œä¹Ÿå«åš 1</li>
<li>ç®­å¤´å¯ä»¥ <i><ruby>ç»„åˆ<rt> compose</rt></ruby></i></li>
</ul>

<p>
æ©, å°±æ˜¯è¿™ä¹ˆç®€å•!
</p>


<figure>
<object type="image/svg+xml" data="images/category.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>

<figcaption><span class="figure-number">Figure 1: </span>æœ‰ä¸œè¥¿ a, b, c å’Œç®­å¤´ f, g çš„ Categoryï¼Œå…¶ä¸­ f . g è¡¨ç¤º compose f å’Œ g</figcaption>
</figure>


<div class="epigraph"><blockquote>
<p>
æ³¨æ„åˆ°ä¸ºä»€ä¹ˆæˆ‘ä¼šç®­å¤´ä»å³å¾€å·¦ï¼Œæ¥ç€çœ‹ä»£ç , ä½ ä¼šå‘ç°è¿™ä¸ªæ–¹å‘è·Ÿ compose çš„æ–¹å‘åˆšå¥½ä¸€è‡´!
</p>

</blockquote></div>

<p>
è¿™äº›ç©æ„å¯¹åº”åˆ° haskell çš„ typeclass å¤§è‡´å°±æ˜¯è¿™æ ·:
</p>

<pre class="code"><code><span style="color: #00008b;">class</span> <span style="color: #36648b;">Category</span> (c <span style="color: #b8860b;">::</span> <span style="color: #b8860b;">*</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #b8860b;">*</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #b8860b;">*</span>) <span style="color: #00008b;">where</span>
  id <span style="color: #b8860b;">::</span> c a a
  (<span style="color: #b8860b;">.</span>) <span style="color: #b8860b;">::</span> c y z <span style="color: #b8860b;">-&gt;</span> c x y <span style="color: #b8860b;">-&gt;</span> c x z
</code></pre>


<p>
è€Œ Scala å¯ä»¥ç”¨ trait æ¥è¡¨ç¤ºè¿™ä¸ª typeclass:
</p>
<pre class="code"><code><span style="color: #00008b;">trait</span> <span style="color: #36648b;">Category</span>[<span style="color: #6b8e23;">C</span>[<span style="color: #00008b;">_</span>, <span style="color: #00008b;">_</span>]] {
  <span style="color: #00008b;">val</span> <span style="color: #b8860b;">id</span>[<span style="color: #6b8e23;">A</span>]<span style="color: #00008b;">:</span> <span style="color: #36648b;">C</span>[<span style="color: #6b8e23;">A</span>, <span style="color: #6b8e23;">A</span>]
  <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">&lt;&lt;&lt;</span>(a<span style="color: #00008b;">:</span> <span style="color: #36648b;">C</span>[<span style="color: #6b8e23;">Y</span>, <span style="color: #6b8e23;">Z</span>], b<span style="color: #00008b;">:</span> <span style="color: #36648b;">C</span>[<span style="color: #6b8e23;">X</span>, <span style="color: #6b8e23;">Y</span>])<span style="color: #00008b;">:</span> <span style="color: #36648b;">C</span>[<span style="color: #6b8e23;">X</span>, <span style="color: #6b8e23;">Z</span>] 
}
</code></pre>

<p>
å¦‚æœè¿™æ˜¯ä½ ç¬¬ä¸€æ¬¡è§åˆ° Haskell ä»£ç ï¼Œæ²¡æœ‰å…³ç³»ï¼Œè¯­æ³•çœŸçš„å¾ˆç®€å• <del>æ‰æ€ª</del>
</p>
<ul class="org-ul">
<li><code>class</code> å®šä¹‰äº†ä¸€ä¸ª TypeClassï¼Œ <code>Category</code> æ˜¯è¿™ä¸ª TypeClass çš„åå­—</li>
<li>Type class ç±»ä¼¼äºå®šä¹‰ç±»å‹çš„è§„èŒƒï¼Œè§„èŒƒä¸º <code>where</code> åé¢é‚£ä¸€å¨</li>
<li>ç±»å‹è§„èŒƒçš„å¯¹è±¡æ˜¯å‚æ•° <code>(c:: * -&gt; * -&gt; *)</code> ï¼Œ <code>::</code> åé¢æ˜¯cçš„ç±»å‹</li>
<li>c æ˜¯ <i>higher kind</i> <code>* -&gt; *</code> ï¼Œè·Ÿhigher order functionçš„å®šä¹‰å·®ä¸å¤šï¼Œå®ƒæ˜¯æ¥æ”¶ç±»å‹ï¼Œæ„é€ æ–°ç±»å‹çš„ç±»å‹ã€‚è¿™é‡Œçš„ c æ¥æ”¶ä¸€ä¸ªç±»å‹ï¼Œå†æ¥æ”¶ä¸€ä¸ªç±»å‹ï¼Œå°±å¯ä»¥è¿”å›ä¸ªç±»å‹ã€‚</li>
</ul>
<ul class="org-ul">
<li><code>id:: c a a</code> è¡¨ç¤º c èŒƒç•´ä¸Šçš„ a åˆ° a çš„ç®­å¤´</li>
<li><code>.</code> çš„æ„æ€ c èŒƒç•´ä¸Šï¼Œå¦‚æœå–‚ä¸€ä¸ª y åˆ° z çš„ç®­å¤´ï¼Œå†å–‚ä¸€ä¸ª x åˆ° y çš„ç®­å¤´ï¼Œé‚£ä¹ˆå°±è¿”å› x åˆ° z çš„ç®­å¤´ã€‚</li>
</ul>

<p>
å¦å¤– compose åœ¨ haskell ä¸­ç›´æ¥æ˜¯å¥å· <code>.</code>
</p>

<p>
scala ä¸­ç”¨ <code>&lt;&lt;&lt;</code> æˆ–è€… <code>compose</code>
</p>

<p>
æ€»ä¹‹, ç”¨æ–‡å­—å†è¯»ä¸€éä¸Šé¢è¿™äº›ä»£ç å°±äº†ç„¶äº†.
</p>

<p>
èŒƒç•´ C å…¶å®å°±åŒ…å«
</p>
<ol class="org-ol">
<li>è¿”å› A å¯¹è±¡åˆ° A å¯¹è±¡çš„ id ç®­å¤´</li>
<li>å¯ä»¥ç»„åˆ Y å¯¹è±¡åˆ° Z å¯¹è±¡ å’Œ X å¯¹è±¡åˆ° Y å¯¹è±¡çš„ç®­å¤´ compose</li>
</ol>

<p>
<ruby>ç®€å•å§<rt>hen nan ba</rt></ruby>?è¿˜æ²¡æœ‰é«˜æ•°æŠ½è±¡å‘¢ã€‚
</p>
</div>

<div id="outline-container-orgafb8e40" class="outline-4">
<h4 id="orgafb8e40"><span class="section-number-4">1.1.1</span> <i>Hask</i></h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
Haskell ç±»å‹ç³»ç»ŸèŒƒç•´å«åš Hask
</p>
<p>
åœ¨ Hask èŒƒç•´ä¸Šï¼š
</p>

<ul class="org-ul">
<li>ä¸œè¥¿å°±æ˜¯ç±»å‹</li>
<li>ç®­å¤´æ˜¯ç±»å‹çš„å˜æ¢ï¼Œå³ <code>-&gt;</code></li>
<li>id å°±æ˜¯ id å‡½æ•°çš„ç±»å‹ <code>a -&gt; a</code></li>
<li>compose å½“ç„¶å°±æ˜¯å‡½æ•°ç»„åˆçš„ç±»å‹</li>
</ul>

<pre class="code"><code><span style="color: #00008b;">type</span> <span style="color: #36648b;">Hask</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">(-&gt;)</span>
<span style="color: #00008b;">instance</span> <span style="color: #36648b;">Category</span> (<span style="color: #36648b;">Hask</span><span style="color: #b8860b;">::</span> <span style="color: #b8860b;">*</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #b8860b;">*</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #b8860b;">*</span>) <span style="color: #00008b;">where</span>
  (f <span style="color: #b8860b;">.</span> g) x <span style="color: #b8860b;">=</span> f (g x)
</code></pre>

<p>
æˆ‘ä»¬çœ‹è§æ–°çš„å…³é”®å­— <code>instance</code> ï¼Œè¿™è¡¨ç¤º Hask æ˜¯ Type class Category çš„å®ä¾‹ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹ä»»æ„Haskç±»å‹, é‚£ä¹ˆå°±èƒ½æ‰¾åˆ°å®ƒçš„ id å’Œ compose
</p>

<pre class="code"><code><span style="color: #228b22;">implicit</span> <span style="color: #00008b;">val</span> <span style="color: #b8860b;">haskCat</span><span style="color: #00008b;">:</span> <span style="color: #36648b;">Category</span>[<span style="color: #6b8e23;">Hask</span>[<span style="color: #00008b;">_</span>, <span style="color: #00008b;">_</span>]] <span style="color: #00008b;">=</span> <span style="color: #00008b;">new</span> <span style="color: #36648b;">Category</span>[<span style="color: #6b8e23;">Hask</span>] {
  <span style="color: #00008b;">val</span> <span style="color: #b8860b;">id</span>[<span style="color: #6b8e23;">A</span>] <span style="color: #00008b;">=</span> identity[<span style="color: #6b8e23;">A</span>]
  <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">&lt;&lt;&lt;</span>[<span style="color: #6b8e23;">X</span>, <span style="color: #6b8e23;">Y</span>, <span style="color: #6b8e23;">Z</span>](a<span style="color: #00008b;">:</span> <span style="color: #36648b;">Hask</span>[<span style="color: #6b8e23;">Y</span>, <span style="color: #6b8e23;">Z</span>], b<span style="color: #00008b;">:</span> <span style="color: #36648b;">Hask</span>[<span style="color: #6b8e23;">X</span>, <span style="color: #6b8e23;">Y</span>]) <span style="color: #00008b;">=</span> a compose b
}
</code></pre>

<p>
Scala ä¸­, åªéœ€è¦ new è¿™ä¸ª trait å°±å¯ä»¥å®ç°è¿™ä¸ª typeclass
</p>

<p>
å…¶ä¸­: identity <code>Hask a a</code> å°±æ˜¯
</p>
<pre class="code"><code><span style="color: #36648b;">(-&gt;)</span> a a <span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">or</span>
a <span style="color: #b8860b;">-&gt;</span> a <span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">&#22240;&#20026; -&gt; &#26159;&#20013;&#32512;&#26500;&#36896;&#22120;</span>
</code></pre>

<pre class="code"><code><span style="color: #6b8e23;">A</span> <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">A</span>
</code></pre>
</div>
</div>


<div id="outline-container-org0fd3034" class="outline-4">
<h4 id="org0fd3034"><span class="section-number-4">1.1.2</span> <i>Duel</i></h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
æ¯ä¸ª Category è¿˜æœ‰ä¸€ä¸ªé•œåƒï¼Œä»€ä¹ˆéƒ½ä¸€æ ·ï¼Œé™¤äº†ç®­å¤´æ˜¯åçš„
</p>
</div>
</div>
</div>

<div id="outline-container-org883b6c3" class="outline-3">
<h3 id="org883b6c3"><span class="section-number-3">1.2</span> <i><ruby>å‡½å­<rt> Functor</rt></ruby></i></h3>
<div class="outline-text-3" id="text-1-2">
<p>
ä¸¤ä¸ªèŒƒç•´ä¸­é—´å¯ä»¥ç”¨å« Functor çš„ä¸œè¥¿æ¥è¿æ¥èµ·æ¥ï¼Œç®€ç§° Tã€‚
</p>


<figure>
<object type="image/svg+xml" data="images/functor.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>

<figcaption><span class="figure-number">Figure 2: </span>Functor C D T, ä» C åˆ° D èŒƒç•´çš„Functor T</figcaption>
</figure>

<p>
æ‰€ä»¥å¤§éƒ¨åˆ†æŠŠ Functor/Monad æ¯”å–»æˆç›’å­å…¶å®åœ¨å®šä¹‰ä¸Šæ˜¯é”™çš„ï¼Œè™½ç„¶è¿™æ ·æ¯”å–»æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œåœ¨ä½¿ç”¨ä¸Šé—®é¢˜ä¹Ÿä¸å¤§ã€‚ä½†æ˜¯ï¼ŒFunctor åªæ˜¯ä»ä¸€ä¸ªèŒƒç•´åˆ°å¦ä¸€ä¸ªèŒƒç•´çš„æ˜ å°„å…³ç³»è€Œå·²ã€‚
</p>

<ul class="org-ul">
<li>èŒƒç•´é—´ ä¸œè¥¿çš„ Functor æ ‡è®°ä¸º <code>T(O)</code></li>
<li>èŒƒç•´é—´ ç®­å¤´çš„ Functor æ ‡è®°ä¸º <code>T(~&gt;)</code></li>
<li>ä»»ä½•èŒƒç•´Cä¸Šå­˜åœ¨ä¸€ä¸ª T æŠŠæ‰€æœ‰çš„ O å’Œ ~&gt; éƒ½æ˜ å°„åˆ°è‡ªå·±ï¼Œæ ‡è®°ä¸ºid functor 1<sub>C</sub>
<ul class="org-ul">
<li>1<sub>C</sub>(O) = O</li>
<li>1<sub>C</sub>(~&gt;) = ~&gt;</li>
</ul></li>
</ul>

<pre class="code"><code><span style="color: #00008b;">class</span> (<span style="color: #36648b;">Category</span> c, <span style="color: #36648b;">Category</span> d) <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">Functor</span> c d t <span style="color: #00008b;">where</span>
  fmap <span style="color: #b8860b;">::</span> c a b <span style="color: #b8860b;">-&gt;</span> d (t a) (t b)
</code></pre>

<pre class="code"><code><span style="color: #00008b;">trait</span> <span style="color: #36648b;">Functor</span>[<span style="color: #6b8e23;">C</span>[<span style="color: #00008b;">_</span>, <span style="color: #00008b;">_</span>], <span style="color: #6b8e23;">D</span>[<span style="color: #00008b;">_</span>, <span style="color: #00008b;">_</span>], <span style="color: #6b8e23;">T</span>[<span style="color: #00008b;">_</span>]] {
  <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">fmap</span>[<span style="color: #6b8e23;">A</span>, <span style="color: #6b8e23;">B</span>](c<span style="color: #00008b;">:</span> <span style="color: #36648b;">C</span>[<span style="color: #6b8e23;">A</span>, <span style="color: #6b8e23;">B</span>])<span style="color: #00008b;">:</span> <span style="color: #36648b;">D</span>[<span style="color: #6b8e23;">T</span>[<span style="color: #6b8e23;">A</span>], <span style="color: #6b8e23;">T</span>[<span style="color: #6b8e23;">B</span>]]
}
</code></pre>

<p>
<code>Functor c d t</code> è¿™è¡¨ç¤ºä»èŒƒç•´ c åˆ°èŒƒç•´ d çš„ä¸€ä¸ª Functor t
</p>

<p>
å¦‚æœæŠŠèŒƒç•´ c å’Œ d éƒ½é™åˆ¶åˆ° Hask èŒƒç•´
</p>

<pre class="code"><code><span style="color: #00008b;">class</span> <span style="color: #36648b;">Functor</span> <span style="color: #36648b;">(-&gt;)</span> <span style="color: #36648b;">(-&gt;)</span> t <span style="color: #00008b;">where</span>
  fmap <span style="color: #b8860b;">::</span> <span style="color: #36648b;">(-&gt;)</span> a b <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">(-&gt;)</span> (t a) (t b)
</code></pre>

<pre class="code"><code><span style="color: #00008b;">trait</span> <span style="color: #36648b;">Functor</span>[<span style="color: #00008b;">=&gt;</span>[<span style="color: #00008b;">_</span>, <span style="color: #00008b;">_</span>], <span style="color: #00008b;">=&gt;</span>[<span style="color: #00008b;">_</span>, <span style="color: #00008b;">_</span>], <span style="color: #6b8e23;">T</span>[<span style="color: #00008b;">_</span>]] {
 <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">fmap</span>[<span style="color: #6b8e23;">A</span>, <span style="color: #6b8e23;">B</span>](c<span style="color: #00008b;">:</span> <span style="color: #00008b;">=&gt;</span>[<span style="color: #6b8e23;">A</span>, <span style="color: #6b8e23;">B</span>])<span style="color: #00008b;">:</span> <span style="color: #00008b;">=&gt;</span>[<span style="color: #6b8e23;">T</span>[<span style="color: #6b8e23;">A</span>], <span style="color: #6b8e23;">T</span>[<span style="color: #6b8e23;">B</span>]]
}
</code></pre>
<p>
<code>-&gt;</code> åœ¨ Haskell ä¸­æ˜¯ä¸­ç¼€ç±»å‹æ„é€ å™¨ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥å†™åœ¨ä¸­é—´çš„
</p>

<p>
è¿™æ ·å°±ä¼šå˜æˆæˆ‘ä»¬ç†Ÿæ‚‰çš„ Funtor çš„ Typeclass<label for="5" class="margin-toggle sidenote-number"></label><input type="checkbox" id="5" class="margin-toggle"/><span class="sidenote">
è¿™é‡Œå¯ä»¥æŠŠ Functor çš„ç¬¬ä¸€ç¬¬äºŒä¸ªå‚æ•°æ¶ˆæ‰, å› ä¸ºå·²ç»çŸ¥é“æ˜¯åœ¨ Hask èŒƒç•´äº†
</span>
</p>

<pre class="code"><code><span style="color: #00008b;">class</span> <span style="color: #36648b;">Functor</span> t <span style="color: #00008b;">where</span>
  fmap <span style="color: #b8860b;">::</span> (a <span style="color: #b8860b;">-&gt;</span> b) <span style="color: #b8860b;">-&gt;</span> (t a <span style="color: #b8860b;">-&gt;</span> t b)
</code></pre>

<pre class="code"><code><span style="color: #00008b;">trait</span> <span style="color: #36648b;">Functor</span>[<span style="color: #6b8e23;">T</span>[<span style="color: #00008b;">_</span>]] {
 <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">fmap</span>[<span style="color: #6b8e23;">A</span>, <span style="color: #6b8e23;">B</span>](c<span style="color: #00008b;">:</span> <span style="color: #36648b;">A</span> <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">B</span>)<span style="color: #00008b;">:</span> <span style="color: #36648b;">T</span>[<span style="color: #6b8e23;">A</span>] <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">T</span>[<span style="color: #6b8e23;">B</span>]
}
</code></pre>

<p>
è€Œ <i><ruby>è‡ªå‡½å­<rt>endofunctor</rt></ruby></i> å°±æ˜¯è¿™ç§è¿æ¥ç›¸åŒèŒƒç•´çš„ Functorï¼Œå› ä¸ºå®ƒä»èŒƒç•´ Hask åˆ°è¾¾åŒæ ·çš„èŒƒç•´ Hask
</p>
<p>
è¿™å›çœ‹ä»£ç å°±å¾ˆå®¹æ˜“å¯¹åº”ä¸Šå›¾å’Œæ¦‚å¿µäº†, è¿™é‡Œçš„è‡ªå‡½å­åªæ˜¯æ˜ å°„èŒƒç•´ <code>-&gt;</code> åˆ° <code>-&gt;</code>, ç®­å¤´å‡½æ•°é‚£ä¸ªç®­å¤´, ç±»å‹å´å˜æˆäº† t a
</p>

<p>
è¿™é‡Œçš„ fmap å°±æ˜¯ T(~&gt;)ï¼Œåœ¨ Hask èŒƒç•´ä¸Šï¼Œæ‰€ä»¥æ˜¯ T(-&gt;), è¿™ä¸ªç®­å¤´æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥ä¹Ÿèƒ½è¡¨ç¤ºæˆ T(f) å¦‚æœ <code>f:: a -&gt; b</code>
</p>
</div>
</div>

<div id="outline-container-org47bd54a" class="outline-3">
<h3 id="org47bd54a"><span class="section-number-3">1.3</span> <i><ruby>Cat<rt> +çŒ«+</rt></ruby></i></h3>
<div class="outline-text-3" id="text-1-3">
<p>
é€’å½’çš„, å½“æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ª Category çœ‹æˆä¸€ä¸ª objectï¼Œfunctor çœ‹æˆç®­å¤´ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆå¾—åˆ°äº†ä¸€ä¸ª Categoryï¼Œè¿™ç§ object æ˜¯ category çš„ category æˆ‘ä»¬å«å®ƒ &#x2013; <i>Cat</i>
</p>

<p>
å·²ç»<ruby>æ²¡<rt> meow</rt></ruby>çš„åŠæ³•ç”¨è¯­è¨€æè¿°è¿™ä¹ˆé«˜ç»´åº¦çš„äº‹æƒ…äº†ï¼Œçœ‹å›¾å§&#x2026;
</p>
</div>
</div>

<div id="outline-container-orgf52b923" class="outline-3">
<h3 id="orgf52b923"><span class="section-number-3">1.4</span> /<ruby>è‡ªç„¶å˜æ¢<rt>Natural Transformations</rt></ruby>/<a id="org403e882"></a></h3>
<div class="outline-text-3" id="text-1-4">
<p>
Functor æ˜¯èŒƒç•´é—´çš„æ˜ å°„ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ª Cat èŒƒç•´ä¸­, æŠŠèŒƒç•´çœ‹æˆæ˜¯å¯¹è±¡, é‚£ä¹ˆ Functor åœ¨ Cat èŒƒç•´åˆæ˜¯ä¸ªç®­å¤´
</p>


<figure>
<object type="image/svg+xml" data="images/natrual-transformation.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>

<figcaption><span class="figure-number">Figure 3: </span>Functor Få’ŒGï¼Œä»¥åŠ F åˆ° G çš„è‡ªç„¶å˜åŒ– &eta;</figcaption>
</figure>

<p>
è€Œ Functor é—´ä¹Ÿæœ‰æ˜ å°„ï¼Œå«åš <del>å–µçš„å˜æ¢</del> <i>è‡ªç„¶å˜æ¢</i>
</p>

<p>
èŒƒç•´ c ä¸Šçš„å‡½å­ f åˆ° g çš„è‡ªç„¶å˜åŒ–å°±å¯ä»¥è¡¨ç¤ºæˆ
</p>
<pre class="code"><code><span style="color: #00008b;">type</span> <span style="color: #36648b;">Nat</span> c f g <span style="color: #b8860b;">=</span> c (f a) (g a)
</code></pre>

<p>
Scala æ²¡æœ‰ rank n type<label for="6" class="margin-toggle sidenote-number"></label><input type="checkbox" id="6" class="margin-toggle"/><span class="sidenote">
åˆ«æ€¥, åé¢é©¬ä¸Šè®²åˆ°
</span>, åªèƒ½é  apply æ¥ meme äº†
</p>
<pre class="code"><code><span style="color: #00008b;">trait</span> <span style="color: #36648b;">Nat</span>[<span style="color: #6b8e23;">C</span>[<span style="color: #00008b;">_</span>, <span style="color: #00008b;">_</span>], <span style="color: #6b8e23;">F</span>[<span style="color: #00008b;">_</span>], <span style="color: #6b8e23;">G</span>[<span style="color: #00008b;">_</span>]] {
  <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">apply</span>[<span style="color: #6b8e23;">A</span>]<span style="color: #00008b;">:</span> <span style="color: #36648b;">C</span>[<span style="color: #6b8e23;">F</span>[<span style="color: #6b8e23;">A</span>], <span style="color: #6b8e23;">G</span>[<span style="color: #6b8e23;">A</span>]]
}
</code></pre>

<p>
Hask èŒƒç•´ä¸Šçš„è‡ªç„¶å˜åŒ–å°±å˜æˆäº†
</p>

<pre class="code"><code><span style="color: #00008b;">type</span> <span style="color: #36648b;">NatHask</span> f g <span style="color: #b8860b;">=</span> f a <span style="color: #b8860b;">-&gt;</span> g a
</code></pre>

<pre class="code"><code><span style="color: #00008b;">trait</span> <span style="color: #36648b;">NatHask</span>[<span style="color: #6b8e23;">F</span>[<span style="color: #00008b;">_</span>], <span style="color: #6b8e23;">G</span>[<span style="color: #00008b;">_</span>]] {
  <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">apply</span>[<span style="color: #6b8e23;">A</span>]<span style="color: #00008b;">:</span> <span style="color: #36648b;">F</span>[<span style="color: #6b8e23;">A</span>] <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">G</span>[<span style="color: #6b8e23;">A</span>]
}

</code></pre>

<p>
æœ‰è¶£çš„æ˜¯, è¿˜å¯ä»¥ç»§ç»­å‡ç»´åº¦, æ¯”å¦‚
</p>

<ul class="org-ul">
<li>ä¸œè¥¿æ˜¯å‡½å­</li>
<li>ç®­å¤´æ˜¯è‡ªç„¶å˜æ¢</li>
</ul>

<p>
æ­å–œä½ åˆ°è¾¾ Functor èŒƒç•´.
</p>

<p>
å½“ç„¶, è¦æˆä¸ºèŒƒç•´ï¼Œè¿˜æœ‰ä¸¤ä¸ªå±æ€§:
</p>
<ul class="org-ul">
<li>id ä¸º f a åˆ° f a çš„è‡ªç„¶å˜æ¢</li>
<li>è‡ªç„¶å˜æ¢çš„ç»„åˆ</li>
</ul>


<figure>
<object type="image/svg+xml" data="images/functor-category.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>

</figure>

<p>
åˆ«ç€æ€¥, æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹ï¼Œå¦‚æœå·²ç»ä¸çŸ¥é“å‡äº†å‡ ä¸ªç»´åº¦äº†ï¼Œæˆ‘ä»¬å‡è®¾ç±»å‹æ‰€åœ¨èŒƒç•´æ˜¯ç¬¬ä¸€ç»´åº¦
</p>
<ul class="org-ul">
<li>ä¸€ç»´ï¼š Haskï¼Œ ä¸œè¥¿æ˜¯ç±»å‹ï¼Œç®­å¤´æ˜¯ -&gt;</li>
<li>äºŒç»´ï¼š Catï¼Œ ä¸œè¥¿æ˜¯ Haskï¼Œ ç®­å¤´æ˜¯ Functor</li>
<li>ä¸‰ç»´ï¼š FunctorèŒƒç•´ï¼Œ ä¸œè¥¿æ˜¯Functorï¼Œ ç®­å¤´æ˜¯è‡ªç„¶å˜æ¢</li>
</ul>

<p>
æ„Ÿè§‰åˆ°è¾¾ä¸‰ç»´å·²ç»æ˜¯æé™äº†ï¼Œå°¼ç›è¿˜æœ‰å®Œæ²¡å®Œäº†ï¼Œæ¯å‡ä¸€ä¸ªç»´åº¦è¿˜è¦èµ·è¿™ä¹ˆå¤šè£…é€¼çš„åå­—ï¼Œå†å‡ç»´åº¦è€å­å°±ç”»ä¸å‡ºæ¥äº†
</p>

<p>
æ‰€ä»¥è¿™æ—¶å€™, éœ€è¦å¼•å…¥ String Diagramã€‚
</p>
</div>
</div>

<div id="outline-container-orgfcc68b9" class="outline-3">
<h3 id="orgfcc68b9"><span class="section-number-3">1.5</span> String Diagram</h3>
<div class="outline-text-3" id="text-1-5">
<p>
String Diagram çš„æ¦‚å¿µå¾ˆç®€å•ï¼Œå°±æ˜¯ç‚¹å˜çº¿çº¿å˜ç‚¹ã€‚
</p>

<p>
è¿˜è®°å¾—å½“æœ‰äº†è‡ªç„¶å˜æ¢ä¹‹åï¼Œä¸‰ä¸ªç»´åº¦å·²ç»æ²¡æ³•è¡¨ç¤ºäº†ï¼Œé‚£åŸæ¥çš„ç‚¹å’Œçº¿éƒ½å‡ä¸€ç»´åº¦ï¼Œå˜æˆçº¿å’Œé¢ï¼Œè¿™æ ·ï¼Œå°±è…¾å‡ºä¸€ä¸ªç‚¹æ¥è¡¨ç¤ºè‡ªç„¶å˜æ¢äº†ã€‚
</p>


<figure>
<img src="images/p1-string-diagram.png" alt="p1-string-diagram.png">

<figcaption><span class="figure-number">Figure 5: </span>String Diagramï¼šè‡ªç„¶å˜æ¢æ˜¯ç‚¹ï¼ŒFunctoræ˜¯çº¿ï¼ŒèŒƒç•´æ˜¯é¢</figcaption>
</figure>

<p>
composeçš„æ–¹å‘æ˜¯ä»å³å¾€å·¦ï¼Œä»ä¸‹åˆ°ä¸Šã€‚
</p>
</div>
</div>

<div id="outline-container-org62a6367" class="outline-3">
<h3 id="org62a6367"><span class="section-number-3">1.6</span> <i>Adjunction Functor</i> ä¼´éšå‡½å­</h3>
<div class="outline-text-3" id="text-1-6">
<p>
èŒƒç•´Cå’ŒDç›´æ¥æœ‰æ¥æœ‰å›çš„å‡½å­ï¼Œä¸ºä»€ä¹ˆè¦ä»‹ç»è¿™ä¸ªï¼Œå› ä¸ºå®ƒç›´æ¥å¯ä»¥æ¨å‡º Monad
</p>

<p>
è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä»€ä¹ˆå«æœ‰æ¥å›ã€‚
</p>


<figure>
<img src="images/p1-adjunction-functor.png" alt="p1-adjunction-functor.png">

</figure>

<p>
å…¶ä¸­ï¼š
</p>

<ul class="org-ul">
<li>ä¸€ä¸ªèŒƒç•´ C å¯ä»¥é€šè¿‡å‡½å­ G åˆ° Dï¼Œå†é€šè¿‡å‡½å­ F å›åˆ° Cï¼Œé‚£ä¹ˆ F å’Œ G å°±æ˜¯ä¼´éšå‡½å­ã€‚</li>
<li>&eta; æ˜¯ GF åˆ° 1<sub>D</sub> çš„è‡ªç„¶å˜æ¢</li>
<li>&epsilon; æ˜¯ 1<sub>C</sub> åˆ° FG çš„è‡ªç„¶å˜æ¢</li>
</ul>

<p>
åŒæ—¶æ ¹æ®åŒæ„çš„å®šä¹‰ï¼ŒG ä¸ F æ˜¯ <i>åŒæ„</i> çš„ã€‚
</p>
<p>
åŒæ„æŒ‡çš„æ˜¯è‹¥æ˜¯æœ‰
</p>
<pre class="code"><code><span style="color: #6a5acd;">f</span> <span style="color: #b8860b;">::</span> a <span style="color: #b8860b;">-&gt;</span> b
f'<span style="color: #b8860b;">::</span> b <span style="color: #b8860b;">-&gt;</span> a
</code></pre>

<p>
é‚£ä¹ˆ f ä¸ f' åŒæ„ï¼Œå› ä¸º f . f' = id = f' . f
</p>

<p>
ä¼´éšå‡½å­çš„ FG ç»„åˆæ˜¯ C èŒƒç•´çš„ id å‡½å­ F . G = 1<sub>c</sub>
</p>


<figure>
<img src="images/p1-ajunction-functor-compose.png" alt="p1-ajunction-functor-compose.png">

<figcaption><span class="figure-number">Figure 7: </span>ä¼´éšå‡½å­çš„ä¸¤ä¸ªFunctorç»„åˆ, å·¦ä¾§ä¸º F &eta;, å³ä¾§ä¸º &epsilon; F</figcaption>
</figure>

<p>
Functor ä¸ä»…æ¨ªç€å¯ä»¥ç»„åˆï¼Œç«–ç€(è‡ªç„¶å˜æ¢ç»´åº¦)ä¹Ÿæ˜¯å¯ä»¥ç»„åˆçš„ï¼Œå› ä¸ºè‡ªç„¶å˜æ¢æ˜¯ Functor èŒƒç•´çš„ç®­å¤´ã€‚
</p>


<figure>
<img src="images/p1-ajunction-functor-compose-nat.png" alt="p1-ajunction-functor-compose-nat.png">

<figcaption><span class="figure-number">Figure 8: </span>F &eta; . &epsilon; F  = F</figcaption>
</figure>

<p>
å½“åˆ°ç»„åˆ F &eta; . &epsilon; F å¾—åˆ°ä¸€ä¸ªå¼¯å¼¯æ›²æ›²çš„ F æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‹½ç€Fçš„ä¸¤æ®µä¸€æ‹‰ï¼Œå°±å¾—åˆ°äº†ç›´çš„ Fã€‚
</p>

<p>
String Diagram ç¥å¥‡çš„åœ°æ–¹æ˜¯æ‰€æœ‰çº¿éƒ½å¯ä»¥æ‹‰ä¸Šä¸‹ä¸¤ç«¯ï¼Œè¿™ä¸ªæŠ€å·§éå¸¸æœ‰ç”¨ï¼Œåœ¨ä¹‹åçš„å•å­æ¨å¯¼è¿˜éœ€è¦ç”¨åˆ°ã€‚
</p>
</div>
</div>

<div id="outline-container-org90c31b6" class="outline-3">
<h3 id="org90c31b6"><span class="section-number-3">1.7</span> ä»ä¼´éšå‡½å­åˆ° <ruby>å•å­<rt> Monad</rt></ruby></h3>
<div class="outline-text-3" id="text-1-7">
<p>
æœ‰äº†ä¼´éšå‡½å­ï¼Œå¾ˆå®¹æ˜“æ¨å‡ºå•å­ï¼Œè®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯å•å­
</p>

<ul class="org-ul">
<li>é¦–å…ˆï¼Œå®ƒæ˜¯ä¸€ä¸ª endofunctor T</li>
<li>æœ‰ä¸€ä¸ªä» i<sub>c</sub> åˆ° T çš„è‡ªç„¶å˜åŒ– &eta; (eta)</li>
<li>æœ‰ä¸€ä¸ªä» T<sup>2</sup> åˆ° T çš„è‡ªç„¶å˜åŒ– &mu; (mu)</li>
</ul>


<figure>
<img src="images/p1-monad-properties.png" alt="p1-monad-properties.png">

</figure>

<pre class="code"><code><span style="color: #00008b;">class</span> <span style="color: #36648b;">Endofunctor</span> c t <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">Monad</span> c t <span style="color: #00008b;">where</span>
  eta <span style="color: #b8860b;">::</span> c a (t a)
  mu  <span style="color: #b8860b;">::</span> c (t (t a)) (t a)
</code></pre>

<pre class="code"><code><span style="color: #00008b;">trait</span> <span style="color: #36648b;">Monad</span>[<span style="color: #6b8e23;">C</span>[<span style="color: #00008b;">_</span>, <span style="color: #00008b;">_</span>], <span style="color: #6b8e23;">T</span>[<span style="color: #00008b;">_</span>]]] <span style="color: #00008b;">extends</span> <span style="color: #36648b;">Endofunctor</span>[<span style="color: #6b8e23;">C</span>, <span style="color: #6b8e23;">T</span>] {
  <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">eta</span>[<span style="color: #6b8e23;">A</span>]<span style="color: #00008b;">:</span> <span style="color: #36648b;">C</span>[<span style="color: #6b8e23;">A</span>, <span style="color: #6b8e23;">T</span>[<span style="color: #6b8e23;">A</span>]]
  <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">mu</span>[<span style="color: #6b8e23;">A</span>]<span style="color: #00008b;">:</span> <span style="color: #36648b;">C</span>[<span style="color: #6b8e23;">T</span>[<span style="color: #6b8e23;">T</span>[<span style="color: #6b8e23;">A</span>]], <span style="color: #6b8e23;">T</span>[<span style="color: #6b8e23;">A</span>]]
}
</code></pre>
<p>
åŒæ ·ï¼ŒæŠŠ c = Hask æ›¿æ¢è¿›å»ï¼Œå°±å¾—åˆ°æ›´ç±»ä¼¼æˆ‘ä»¬ Haskell ä¸­ Monad çš„å®šä¹‰
</p>
<pre class="code"><code><span style="color: #00008b;">class</span> <span style="color: #36648b;">Endofunctor</span> m <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">Monad</span> m <span style="color: #00008b;">where</span>
  eta <span style="color: #b8860b;">::</span> a <span style="color: #b8860b;">-&gt;</span> (m a)
  mu <span style="color: #b8860b;">::</span> m m a <span style="color: #b8860b;">-&gt;</span> m a
</code></pre>

<pre class="code"><code><span style="color: #00008b;">trait</span> <span style="color: #36648b;">Monad</span>[<span style="color: #6b8e23;">M</span>[<span style="color: #00008b;">_</span>]] <span style="color: #00008b;">extends</span> <span style="color: #36648b;">Endofunctor</span>[<span style="color: #6b8e23;">M</span>] {
  <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">eta</span>[<span style="color: #6b8e23;">A</span>]<span style="color: #00008b;">:</span> <span style="color: #36648b;">A</span> <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">M</span>[<span style="color: #6b8e23;">A</span>]
  <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">mu</span>[<span style="color: #6b8e23;">A</span>]<span style="color: #00008b;">:</span> <span style="color: #36648b;">M</span>[<span style="color: #6b8e23;">M</span>[<span style="color: #6b8e23;">A</span>]] <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">M</span>[<span style="color: #6b8e23;">A</span>]
}
</code></pre>
<p>
è¦æ¨å‡ºå•å­çš„ &eta; å˜æ¢ï¼Œåªéœ€è¦è®© FG = T
</p>

<figure>
<img src="images/p1-ajunction-functor-to-monad-eta.png" alt="p1-ajunction-functor-to-monad-eta.png">

<figcaption><span class="figure-number">Figure 10: </span>ä¼´éšå‡½å­çš„ &epsilon; å°±æ˜¯å•å­çš„ &eta;</figcaption>
</figure>

<p>
åŒæ ·çš„ï¼Œå½“ FG = T, F &eta; G å°±å¯ä»¥å˜æˆ &mu;
</p>

<figure>
<img src="images/p1-ajunction-functor-to-monad-mu.png" alt="p1-ajunction-functor-to-monad-mu.png">

<figcaption><span class="figure-number">Figure 11: </span>ä¼´éšå‡½å­çš„ F &eta; G æ˜¯å‡½å­çš„ &mu;</figcaption>
</figure>
</div>

<div id="outline-container-orgce319bb" class="outline-4">
<h4 id="orgce319bb"><span class="section-number-4">1.7.1</span> ä¸‰è§’ç­‰å¼</h4>
<div class="outline-text-4" id="text-1-7-1">
<p>
ä¸‰è§’ç­‰å¼æ˜¯æŒ‡ &mu; . T &eta; = T = &mu; . &eta; T
</p>

<p>
è¦æ¨å‡ºä¸‰è§’ç­‰å¼åªéœ€è¦ç»„åˆ F &eta; G å’Œ &epsilon; F G
</p>

<figure>
<img src="images/p1-adjunction-functor-triangle.png" alt="p1-adjunction-functor-triangle.png">

<figcaption><span class="figure-number">Figure 12: </span>F &eta; G  . &epsilon; F G = F G</figcaption>
</figure>

<figure>
<img src="images/p1-monad-triangle.png" alt="p1-monad-triangle.png">

<figcaption><span class="figure-number">Figure 13: </span>F &eta; G  . &epsilon; F G= F G å¯¹åº”åˆ°Monadå°±æ˜¯ &mu; . &eta; T = T</figcaption>
</figure>

<p>
æ¢åˆ°ä»£ç ä¸Šæ¥è¯´
</p>
<pre class="code"><code>(mu <span style="color: #b8860b;">.</span> eta) m <span style="color: #b8860b;">=</span> m
</code></pre>

<p>
åŒæ ·çš„ï¼Œå·¦å³ç¿»è½¬ä¹Ÿæˆç«‹
</p>


<figure>
<img src="images/p1-adjunction-functor-triangle-reverse.png" alt="p1-adjunction-functor-triangle-reverse.png">

<figcaption><span class="figure-number">Figure 14: </span>F &eta; G . F G &epsilon; = F G</figcaption>
</figure>
<p>
<img src="images/p1-monad-triangle-reverse.png" alt="p1-monad-triangle-reverse.png">
T &eta; å°±æ˜¯ fmap eta
</p>
<pre class="code"><code>(mu <span style="color: #b8860b;">.</span> fmap eta) m <span style="color: #b8860b;">=</span> m
</code></pre>

<p>
å¦‚æœæŠŠ <code>mu . fmap</code> å†™æˆ <code>&gt;&gt;=</code> , å°±æœ‰äº†
</p>

<pre class="code"><code>m <span style="color: #6a5acd;">&gt;&gt;=</span> eta <span style="color: #b8860b;">=</span> m
</code></pre>
</div>
</div>

<div id="outline-container-orgd2e88b9" class="outline-4">
<h4 id="orgd2e88b9"><span class="section-number-4">1.7.2</span> ç»“åˆå¾‹</h4>
<div class="outline-text-4" id="text-1-7-2">
<p>
å•å­å¦ä¸€å¤§å®šå¾‹æ˜¯ç»“åˆå¾‹ï¼Œè®©æˆ‘ä»¬ä»ä¼´éšå‡½å­æ¨èµ·
</p>

<p>
å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰å‡½å­ F &eta; G å’Œ å‡½å­ F &eta; G F G, compose èµ·æ¥ä¼šå˜æˆ  F &eta; G . F &eta; G F G
<img src="images/p1-ajunction-functor-monad-laws-1.png" alt="p1-ajunction-functor-monad-laws-1.png">
</p>

<p>
ç”¨ F G = T ï¼Œ F &eta; G = &mu; ä»£æ¢é‚£ä¹ˆå°±å¾—åˆ°äº†å•å­çš„ &mu; . &mu; T
<img src="images/p1-ajunction-functor-monad-laws-2.png" alt="p1-ajunction-functor-monad-laws-2.png">
</p>

<p>
å½“ç»„åˆ F &eta; G å’Œ F G F &mu; G åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªé•œåƒçš„å›¾
<img src="images/p1-ajunction-functor-monad-laws-3.png" alt="p1-ajunction-functor-monad-laws-3.png">
</p>

<p>
å¯¹åº”åˆ°å•å­çš„ &mu; . T &mu;
</p>

<p>
ç»“åˆå¾‹æ˜¯è¯´ &mu; . &mu; T = &mu; . T &mu; , å³å›¾å·¦å³ç¿»è½¬ç»“æœæ˜¯ç›¸ç­‰çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿçœ‹å•å­çš„String Diagram ä¸å¤ªå¥½çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¼´éšå‡½å­
</p>

<p>
å¦‚æœæŠŠå·¦å›¾çš„å·¦è¾¹çš„ &mu; å¾€ä¸ŠæŒªä¸€ç‚¹ï¼Œå³è¾¹çš„ &mu; å¾€ä¸‹æŒªä¸€ç‚¹ï¼Œæ˜¯ä¸æ˜¯è·Ÿå³å›¾å°±ä¸€æ ·äº†
<img src="images/p1-ajunction-functor-monad-laws-4.png" alt="p1-ajunction-functor-monad-laws-4.png">
</p>

<p>
ç»“åˆå¾‹åæ˜ åˆ°ä»£ç ä¸­å°±æ˜¯
</p>
<pre class="code"><code>mu <span style="color: #6a5acd;">.</span> fmap mu <span style="color: #b8860b;">=</span> mu <span style="color: #b8860b;">.</span> mu
</code></pre>

<p>
ä»£ç å¾ˆéš¾çœ‹å‡ºç»“åˆåœ¨å“ªé‡Œï¼Œå› ä¸ºæ­£å¸¸çš„ç»“åˆå¾‹åº”è¯¥æ˜¯è¿™æ ·çš„ (1+2)+3 = 1+(2+3)ï¼Œä½†æ˜¯ä¸æƒ³åŠ æ³•çš„ç»´åº¦ä¸ä¸€æ ·ï¼Œè¿™é‡Œè¯´çš„æ˜¯è‡ªç„¶å˜æ¢ç»´åº¦çš„ç»“åˆï¼Œå¯ä»¥é€šè¿‡String Diagram å¾ˆæ¸…æ¥šçš„çœ‹è§ç»“åˆçš„è¿‡ç¨‹ï¼Œå³ &mu; å·¦è¾¹çš„ä¸¤ä¸ªTå’Œå…ˆ &mu; å³è¾¹ä¸¤ä¸ª T æ˜¯ç›¸ç­‰çš„ã€‚
</p>
</div>
</div>
</div>

<div id="outline-container-org60e1894" class="outline-3">
<h3 id="org60e1894"><span class="section-number-3">1.8</span> Yoneda lemma / <del>ç±³ç”°å…±</del> ç±³ç”°å¼•ç†</h3>
<div class="outline-text-3" id="text-1-8">
<p>
ç±³ç”°å¼•ç†æ˜¯è¯´æ‰€æœ‰Functor <code>f a</code> ä¸€å®šå­˜åœ¨ embed å’Œ unembedï¼Œä½¿å¾— <code>f a</code> å’Œ <code>(a -&gt; b) -&gt; F b</code> isomorphic åŒæ„
</p>

<p>
haskellè¿˜è¦å…ˆæ‰“å¼€ RankNTypes çš„ feature
</p>

<pre class="code"><code><span style="color: #228b22;">{-# LANGUAGE RankNTypes #-}</span>

<span style="color: #6a5acd;">embed</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Functor</span> f <span style="color: #b8860b;">=&gt;</span> f a <span style="color: #b8860b;">-&gt;</span> (<span style="color: #00008b;">forall</span> b <span style="color: #b8860b;">.</span> (a <span style="color: #b8860b;">-&gt;</span> b) <span style="color: #b8860b;">-&gt;</span> f b)
<span style="color: #6a5acd;">embed</span> x f <span style="color: #b8860b;">=</span> fmap f x

<span style="color: #6a5acd;">unembed</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Functor</span> f <span style="color: #b8860b;">=&gt;</span> (<span style="color: #00008b;">forall</span> b <span style="color: #b8860b;">.</span> (a <span style="color: #b8860b;">-&gt;</span> b) <span style="color: #b8860b;">-&gt;</span> f b) <span style="color: #b8860b;">-&gt;</span> f a
<span style="color: #6a5acd;">unembed</span> f <span style="color: #b8860b;">=</span> f id
</code></pre>

<p>
Scala è¯­è¨€æ²¡æœ‰ Rank N Typeæ”¯æŒ, ä½†æ˜¯ <a href="#org403e882"><ruby>è‡ªç„¶å˜æ¢<rt>Natural Transformations</rt></ruby></a> æåˆ°è¿‡å¯ä»¥ç”¨ <code>apply</code> æ¥æ¨¡æ‹Ÿ. å…¶å®å¯ä»¥ä½¿ç”¨ Cats çš„ <a href="https://typelevel.org/cats/datatypes/functionk.html">FunctionK(~&gt;)</a> æ›´æ–¹ä¾¿:
</p>
<pre class="code"><code><span style="color: #00008b;">def</span> <span style="color: #6a5acd;">embed</span>[<span style="color: #6b8e23;">F</span>[<span style="color: #00008b;">_</span>], <span style="color: #6b8e23;">A</span>](fa<span style="color: #00008b;">:</span> <span style="color: #36648b;">F</span>[<span style="color: #6b8e23;">A</span>])(<span style="color: #228b22;">implicit</span> f<span style="color: #00008b;">:</span> <span style="color: #36648b;">Functor</span>[<span style="color: #6b8e23;">F</span>])<span style="color: #00008b;">:</span> (<span style="color: #6b8e23;">A</span> <span style="color: #00008b;">=&gt;</span> ?) ~&gt; <span style="color: #6b8e23;">F</span> <span style="color: #00008b;">=</span>
  <span style="color: #6b8e23;">Lambda</span>[(<span style="color: #6b8e23;">A</span> <span style="color: #00008b;">=&gt;</span> ?) ~&gt; <span style="color: #6b8e23;">F</span>](f.fmap(<span style="color: #00008b;">_</span>)(fa))
<span style="color: #00008b;">def</span> <span style="color: #6a5acd;">unembed</span>[<span style="color: #6b8e23;">F</span>[<span style="color: #00008b;">_</span>]](fnk<span style="color: #00008b;">:</span> (<span style="color: #6b8e23;">A</span> <span style="color: #00008b;">=&gt;</span> ?) ~&gt; <span style="color: #6b8e23;">F</span>)<span style="color: #00008b;">:</span> <span style="color: #36648b;">F</span>[<span style="color: #6b8e23;">A</span>] <span style="color: #00008b;">=</span>
  fnk(identity)
</code></pre>

<p>
embed å¯ä»¥æŠŠ functor <code>f a</code> å˜æˆ <code>(a -&gt; b) -&gt; f b</code>
</p>

<p>
unembed æ˜¯åè¿‡æ¥ï¼Œ <code>(a -&gt; b) -&gt; f b</code> å˜æˆ <code>f a</code>
</p>

<p>
ä¸Šä¸ªå›¾å°±æ˜ç™½äº†
</p>

<figure>
<object type="image/svg+xml" data="images/yoneda-lemma.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>

<figcaption><span class="figure-number">Figure 15: </span>ä¹Ÿå°±æ˜¯è¯´ï¼Œå›¾ä¸­æ— è®ºçŸ¥é“a-&gt;b å†åŠ ä¸Šä»»æ„ä¸€ä¸ª F xï¼Œéƒ½èƒ½æ¨å‡ºå¦å¤–ä¸€ä¸ª F</figcaption>
</figure>
</div>

<div id="outline-container-orgdab7084" class="outline-4">
<h4 id="orgdab7084"><span class="section-number-4">1.8.1</span> Rank N Type</h4>
</div>
</div>
</div>
<div id="outline-container-orgdb03fd2" class="outline-2">
<h2 id="orgdb03fd2"><span class="section-number-2">2</span> ç¬¬äºŒéƒ¨åˆ†ï¼š<ruby>é£Ÿç”¨çŒ«å‘¢<rt> Practical Monads</rt></ruby></h2>
<div class="outline-text-2" id="text-2">
<p>
ç¬¬ä¸€éƒ¨åˆ†ç†è®ºéƒ¨åˆ†éƒ½è®²å®Œäº†ï¼Œ å¦‚æœä½ è¯»åˆ°è¿™é‡Œè¿˜æ²¡æœ‰è¢«è¿™äº›åŠç‚¸å¤©çš„æ¦‚å¿µædazeï¼Œæ¥ä¸‹æ¥å¯ä»¥çœ‹çœ‹å®ƒåˆ°åº•è·Ÿæˆ‘ä»¬ç¼–ç¨‹æœ‰é¸Ÿå…³ç³»å‘¢ï¼Ÿ
</p>

<p>
ç¬¬äºŒéƒ¨åˆ†å°†ä»‹ç»ç”±è¿™äº›æ¦‚å¿µäº§ç”Ÿçš„ä¸€äº›å®ç”¨çš„monad instancesï¼Œè¿™äº› monad éƒ½é€šè¿‡åŒæ ·çš„æŠ½è±¡æ–¹å¼ï¼Œè§£å†³äº†åˆ†ç¦»è®¡ç®—ä¸å‰¯ä½œç”¨çš„å·¥ä½œã€‚
</p>

<p>
æœ€åä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åƒ IO monad ä¸€æ ·ï¼Œé€šè¿‡ free æˆ–è€… Eff è‡ªå®šä¹‰è‡ªå·±çš„è®¡ç®—ï¼Œå’Œå¯èƒ½å¸¦å‰¯ä½œç”¨çš„è§£é‡Šå™¨ã€‚
</p>
</div>

<div id="outline-container-orgb1009ea" class="outline-3">
<h3 id="orgb1009ea"><span class="section-number-3">2.1</span> Identity</h3>
<div class="outline-text-3" id="text-2-1">
<p>
è¿™å¯èƒ½æ˜¯æœ€ç®€å•çš„ monad äº†ã€‚ä¸åŒ…å«ä»»ä½•è®¡ç®—
</p>
<pre class="code"><code><span style="color: #00008b;">newtype</span> <span style="color: #36648b;">Identity</span> a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Identity</span> { runIdentity <span style="color: #b8860b;">::</span> a }
</code></pre>

<p>
è¿™é‡Œä½¿ç”¨ <code>newtype</code> è€Œä¸æ˜¯ <code>data</code> æ˜¯å› ä¸º <code>Identity</code> ä¸ <code>runIdentity</code> æ˜¯ isomorphic ï¼ˆåŒæ„ï¼Œå¿˜äº†çš„è¯å›å»ç¿»ç¬¬ä¸€éƒ¨åˆ†ï¼‰
</p>

<pre class="code"><code><span style="color: #36648b;">Identity</span> <span style="color: #b8860b;">::</span> a <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Identity</span> a
<span style="color: #6a5acd;">runIdentity</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Identity</span> a <span style="color: #b8860b;">-&gt;</span> a
</code></pre>

<p>
æ‰€ä»¥ <code>runIdentity . Identity = id</code> ï¼Œæ‰€ä»¥ä»–ä»¬æ˜¯åŒæ„çš„ã€‚
</p>

<p>
å·¦è¾¹çš„ <code>Identity</code> æ˜¯ç±»å‹æ„é€ å™¨, æ¥æ”¶ç±»å‹ <code>a</code> è¿”å› <code>Identity a</code> ç±»å‹
</p>

<p>
å¦‚æœ a æ˜¯ Intï¼Œé‚£ä¹ˆå°±å¾—åˆ°ä¸€ä¸ª <code>Identity Int</code> ç±»å‹ã€‚
</p>

<p>
å³è¾¹çš„ <code>Identity</code> æ˜¯æ•°æ®æ„é€ å™¨ï¼Œä¹Ÿå°±æ˜¯æ„é€ å€¼ï¼Œæ¯”å¦‚ <code>Identity 1</code> ä¼šæ„é€ å‡ºä¸€ä¸ªå€¼ï¼Œå…¶ç±»å‹ä¸º <code>Identity Int</code>
</p>

<p>
å¤§æ‹¬å·æ¯”è¾ƒè¯¡å¼‚ï¼Œå¯ä»¥æƒ³è±¡æˆç»™ <code>a</code> ä¸€ä¸ª keyï¼ŒåŒè¿‡è¿™ä¸ª key å¯ä»¥æŠŠ a å–å‡ºæ¥ï¼Œæ¯”å¦‚
</p>
<pre class="code"><code><span style="color: #6a5acd;">runIdentity</span> (<span style="color: #36648b;">Identity</span> 1)
</code></pre>

<p>
ä¼šè¿”å› 1
</p>

<p>
Identity å¯ä»¥å®ç° Functor å’Œ Monadï¼Œå°±å¾—åˆ° Identity functor å’Œ Identity monad
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Functor</span> <span style="color: #36648b;">Identity</span> <span style="color: #00008b;">where</span>
  fmap f (<span style="color: #36648b;">Identity</span> a) <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Identity</span> (f a)

<span style="color: #00008b;">instance</span> <span style="color: #36648b;">Monad</span> <span style="color: #36648b;">Identity</span> <span style="color: #00008b;">where</span>
  return a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Identity</span> a
  <span style="color: #36648b;">Identity</span> a <span style="color: #b8860b;">&gt;&gt;=</span> f <span style="color: #b8860b;">=</span> f a
</code></pre>

<p>
å¯ä»¥çœ‹åˆ° Identity å³æ˜¯æ„é€ å™¨ï¼Œä¹Ÿæ˜¯è§£æ„å™¨ï¼Œåœ¨æ¨¡å¼åŒ¹é…æ˜¯å¯ä»¥ destructure å€¼ã€‚ä¾‹å¦‚ä¸Šé¢Functor å®ç°ä¸­çš„ <code>fmap f (Identity a)</code> , å‡å¦‚fmapçš„æ˜¯ <code>Identity 1</code>, é‚£ä¹ˆè¿™ä¸ªæ¨¡å¼åŒ¹é…åˆ° <code>(Identity a)</code> æ—¶ä¼šæŠŠ <code>1</code> æ”¾åˆ° <code>a</code> çš„ä½ç½®ã€‚
</p>

<p>
Identity çœ‹èµ·æ¥ä»€ä¹ˆä¹Ÿæ²¡æœ‰å¹²ï¼Œå°±è·Ÿ identity å‡½æ•°ä¸€æ ·ï¼Œä½†æ˜¯åœ¨åé¢è®²åˆ° State monadæ—¶ä½ ä¼šå‘ç°ä»–çš„ä»·å€¼ã€‚
</p>
</div>
</div>

<div id="outline-container-orgf09dbeb" class="outline-3">
<h3 id="orgf09dbeb"><span class="section-number-3">2.2</span> Maybe</h3>
<div class="outline-text-3" id="text-2-2">
<p>
è¿™æ˜¯ä¸€ä¸ªè¶…çº§ç®€å•çš„ Monadï¼Œé¦–å…ˆï¼Œéœ€è¦å®šä¹‰è¿™ä¸ªä¸€ä¸ª <ruby>ä»£æ•°æ•°æ®ç±»å‹<rt> Algebra Data Type(ADT)</rt></ruby>
</p>
<pre class="code"><code><span style="color: #00008b;">data</span> <span style="color: #36648b;">Maybe</span> a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Just</span> a <span style="color: #b8860b;">|</span> <span style="color: #36648b;">Nothing</span>
</code></pre>
<p>
Haskellä¸­å®šä¹‰ä¸€ä¸ªADTååˆ†ç®€å•ï¼Œä¸åƒScalaé‚£ä¹ˆå•°å—¦ã€‚å·¦è¾¹æ˜¯ç±»å‹æ„é€ å™¨ï¼Œå³è¾¹æœ‰æ•°æ®æ„é€ å™¨ï¼Œä½ ä¼šå‘ç°æœ‰ä¸€æ ¹ç«–çº¿ <code>|</code> ï¼Œ å®ƒåˆ†éš”ç€ä¸¤ä¸ªæ„é€ å™¨
</p>
<ul class="org-ul">
<li>Just</li>
<li>Nothing</li>
</ul>
<p>
å…¶ä¸­ a ï¼ˆä¸€å®šè¦å°å†™ï¼‰å¯ä»¥æ˜¯ä»»æ„ç±»å‹
</p>

<p>
æ‰€ä»¥ <code>Just 1</code> ä¼šå¾—åˆ°ä¸€ä¸ª <code>Num a =&gt; Mabye a</code> ç±»å‹ï¼ˆæ„æ€å°±æ˜¯ <code>Maybe a</code> ä½†æ˜¯ <code>a</code> çš„ç±»å‹çº¦æŸä¸º <code>Num</code> ï¼‰ï¼Œ <code>Nothing</code> ä¹Ÿä¼šå¾—åˆ°ä¸€ä¸ª <code>Maybe a</code> åªä¸è¿‡ <code>a</code> æ²¡æœ‰ç±»å‹çº¦æŸã€‚
</p>

<p>
æ€»ä¹‹æˆ‘ä»¬æœ‰äº†æ„é€ å™¨å¯ä»¥æ„é€ å‡º Maybe ç±»å‹ï¼Œè€Œè¿™ä¸ªç±»å‹èƒ½åšçš„äº‹æƒ…ï¼Œå°±è¦å–å†³å®ƒå®ç°äº†å“ªäº› class çš„ instance äº†ã€‚æ¯”å¦‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ª Functor
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Functor</span> <span style="color: #36648b;">Maybe</span> <span style="color: #00008b;">where</span>
  fmap f (<span style="color: #36648b;">Just</span> a) <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Just</span> (f a)
</code></pre>


<figure>
<img src="images/p2-maybe-functor.png" alt="p2-maybe-functor.png">

<figcaption><span class="figure-number">Figure 16: </span>fmap :: (a -&gt; b) -&gt; f a -&gt; f b</figcaption>
</figure>

<p>
ç„¶åï¼Œè¿˜å®ç° Monad
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Monad</span> <span style="color: #36648b;">Maybe</span> <span style="color: #00008b;">where</span>
  return a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Just</span> a
  (<span style="color: #36648b;">Just</span> a) <span style="color: #b8860b;">&gt;&gt;=</span> f <span style="color: #b8860b;">=</span> f a
  <span style="color: #36648b;">Nothing</span> <span style="color: #b8860b;">&gt;&gt;=</span> f <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Nothing</span>
</code></pre>


<figure>
<img src="images/p2-maybe-kleisli.png" alt="p2-maybe-kleisli.png">

<figcaption><span class="figure-number">Figure 17: </span>è¿˜è®°å¾—ç¬¬ä¸€éƒ¨åˆ†æåˆ°çš„ Kleisli èŒƒç•´å—ï¼Ÿ</figcaption>
</figure>

<p>
Maybe æœ‰ç”¨åœ¨äºèƒ½åˆé€‚çš„å¤„ç† <i><ruby>åå‡½æ•°<rt> Partial Function</rt></ruby></i> çš„è¿”å›å€¼ã€‚åå‡½æ•°ç›¸å¯¹äº<ruby>å…¨å‡½æ•°<rt> Total Function</rt></ruby>ï¼Œæ˜¯æŒ‡åªèƒ½å¯¹éƒ¨åˆ†è¾“å…¥è¿”å›è¾“å‡ºçš„å‡½æ•°ã€‚
</p>

<p>
æ¯”å¦‚ä¸€ä¸ªå–æ•°ç»„æŸä¸€ä½ä¸Šçš„å€¼çš„å‡½æ•°ï¼Œå°±æ˜¯åå‡½æ•°ï¼Œå› ä¸ºå‡è®¾ä½ æƒ³å–ç¬¬4ä½çš„å€¼ï¼Œä½†ä¸æ˜¯æ‰€æœ‰æ•°ç»„é•¿åº¦éƒ½å¤§äº4ï¼Œå°±ä¼šæœ‰è·å–ä¸äº†çš„å°´å°¬æƒ…å†µã€‚
</p>
<pre class="code"><code>[1,2,3] <span style="color: #b8860b;">!!</span> 4
</code></pre>

<p>
å¦‚æœä½¿ç”¨ Maybe æŠŠåå‡½æ•°å¤„ç†ä¸äº†çš„è¾“å…¥éƒ½è¿”å›æˆ Nothingï¼Œè¿™æ ·ç»“æœä¾ç„¶ä¿æŒ Maybe ç±»å‹ï¼Œä¸å½±å“åé¢çš„è®¡ç®—ã€‚
</p>
</div>
</div>

<div id="outline-container-org9155a94" class="outline-3">
<h3 id="org9155a94"><span class="section-number-3">2.3</span> Either</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Either çš„å®šä¹‰ä¹Ÿå¾ˆç®€å•
</p>
<pre class="code"><code><span style="color: #00008b;">data</span> <span style="color: #36648b;">Either</span> a b <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Left</span> a <span style="color: #b8860b;">|</span> <span style="color: #36648b;">Right</span> b
</code></pre>
</div>

<div id="outline-container-org71e011b" class="outline-4">
<h4 id="org71e011b"><span class="section-number-4">2.3.1</span> Product &amp; Coproduct</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
çœ‹è¿‡ç¬¬ä¸€éƒ¨åˆ†åº”è¯¥è¿˜èƒ½è®°å¾—æœ‰ä¸€ä¸ªä¸œè¥¿å« Duelï¼Œæ‰€ä»¥è§åˆ°å¦‚æœèŒƒç•´ä¸Šæœ‰ Coproduct é‚£ä¹ˆè‚¯å®šåœ¨duelèŒƒç•´ä¸Šä¼šæœ‰åŒæ ·çš„ä¸œè¥¿å« Productã€‚
</p>

<p>
é‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯ Coproduct
</p>


<figure>
<img src="images/p2-coproduct.png" alt="p2-coproduct.png">

<figcaption><span class="figure-number">Figure 18: </span>Coproduct</figcaption>
</figure>

<p>
åƒè¿™æ ·ï¼Œèƒ½é€šè¿‡ä¸¤ä¸ªç®­å¤´åˆ°è¾¾åŒä¸€ä¸ªä¸œè¥¿ï¼Œå°±æ˜¯ Coproductã€‚è¿™é‡Œç®­å¤´ <code>Left</code> èƒ½è®© <code>a</code> åˆ° <code>Either a b</code> ï¼Œ ç®­å¤´ <code>Right</code> ä¹Ÿèƒ½è®© <code>b</code> åˆ°è¾¾ <code>Either a b</code>
</p>

<p>
æœ‰æ„æ€çš„æ˜¯è¿˜è‚¯å®šå­˜åœ¨ä¸€ä¸ª Coproduct å’Œ ç®­å¤´ï¼Œä½¿å¾—ä¸‹å›¾æˆç«‹
<img src="images/p2-coproduct-law.png" alt="p2-coproduct-law.png">
</p>

<p>
ç®­å¤´åè¿‡æ¥ï¼Œå°±æ˜¯ Product, æ¯”å¦‚ Tuple
</p>


<figure>
<img src="images/p2-product.png" alt="p2-product.png">

<figcaption><span class="figure-number">Figure 19: </span>Product</figcaption>
</figure>

<p>
Tuple çš„ <code>fst</code> ç®­å¤´èƒ½è®© <code>(a, b)</code> åˆ°è¾¾ <code>a</code> å¯¹è±¡ï¼Œè€Œç®­å¤´ <code>snd</code> èƒ½è®©å…¶åˆ°è¾¾ <code>b</code> å¯¹è±¡ã€‚
</p>
</div>
</div>

<div id="outline-container-org5b8ddea" class="outline-4">
<h4 id="org5b8ddea"><span class="section-number-4">2.3.2</span> Either Monad</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
ç¡®åˆ‡çš„è¯´ï¼ŒEither ä¸æ˜¯ monadï¼Œ <code>Either a</code> æ‰æ˜¯ã€‚è¿˜è®°å¾— monad çš„ class å®šä¹‰å—ï¼Ÿ
</p>
<pre class="code"><code><span style="color: #00008b;">class</span> <span style="color: #36648b;">Endofunctor</span> m <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">Monad</span> m <span style="color: #00008b;">where</span>
  eta <span style="color: #b8860b;">::</span> a <span style="color: #b8860b;">-&gt;</span> (m a)
  mu <span style="color: #b8860b;">::</span> m m a <span style="color: #b8860b;">-&gt;</span> m a
</code></pre>
<p>
æ‰€ä»¥ m å¿…é¡»æ˜¯ä¸ª Endofunctorï¼Œä¹Ÿå°±æ˜¯è¦æ»¡è¶³Functor
</p>
<pre class="code"><code><span style="color: #00008b;">class</span> <span style="color: #36648b;">Functor</span> t <span style="color: #00008b;">where</span>
  fmap <span style="color: #b8860b;">::</span> (a <span style="color: #b8860b;">-&gt;</span> b) <span style="color: #b8860b;">-&gt;</span> (t a <span style="color: #b8860b;">-&gt;</span> t b)
</code></pre>
<p>
t a çš„ kind æ˜¯ *ï¼Œæ‰€ä»¥ t å¿…é¡»æ˜¯ kind * -&gt; *
ä¹Ÿå°±æ˜¯è¯´ï¼Œm å¿…é¡»æ˜¯æ¥æ”¶ä¸€ä¸ªç±»å‹å‚æ•°çš„ç±»å‹æ„é€ å™¨
</p>

<p>
è€Œ Either çš„ kind æ˜¯ * -&gt; * -&gt; *, Either a æ‰æ˜¯ * -&gt; *
</p>

<p>
æ‰€ä»¥åªèƒ½å®šä¹‰ Either a çš„ Monad
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Monad</span> (<span style="color: #36648b;">Either</span> a) <span style="color: #00008b;">where</span>
  <span style="color: #36648b;">Left</span>  l <span style="color: #b8860b;">&gt;&gt;=</span> <span style="color: #00008b;">_</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Left</span> l
  <span style="color: #36648b;">Right</span> r <span style="color: #b8860b;">&gt;&gt;=</span> k <span style="color: #b8860b;">=</span> k r
</code></pre>

<p>
å¾ˆæ˜æ˜¾çš„ï¼Œ&gt;&gt;= ä»»ä½•å‡½æ•°åˆ°<ruby>å·¦è¾¹<rt> Left</rt></ruby> éƒ½ä¸ä¼šæ”¹å˜ï¼Œåªæœ‰ &gt;&gt;= å³è¾¹æ‰èƒ½äº§ç”Ÿæ–°çš„è®¡ç®—ã€‚
</p>
</div>
</div>
</div>


<div id="outline-container-org8822b66" class="outline-3">
<h3 id="org8822b66"><span class="section-number-3">2.4</span> Reader</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Reader çš„ä½œç”¨æ˜¯ç»™ä¸€ä¸ªè®¡ç®—å–‚æ•°æ®ã€‚
</p>

<p>
åœ¨æè¿°è®¡ç®—çš„æ—¶å€™ï¼Œå¹¶ä¸éœ€è¦å…³å¿ƒè¾“å…¥æ—¶ä»€ä¹ˆï¼Œåªéœ€è¦ asks å°±å¯ä»¥æ‹¿åˆ°è¾“å…¥å€¼
</p>

<p>
è€ŒçœŸæ­£çš„è¾“å…¥ï¼Œä¼šåœ¨è¿è¡Œè®¡ç®—æ—¶ç»™äºˆã€‚
</p>

<p>
è·Ÿ Identity ä¸€æ ·ï¼Œæˆ‘ä»¬ç”¨ newtype æ¥å®šä¹‰ä¸€ä¸ªåŒæ„çš„ Reader ç±»å‹
</p>
<pre class="code"><code><span style="color: #00008b;">newtype</span> <span style="color: #36648b;">Reader</span> e a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Reader</span> { runReader <span style="color: #b8860b;">::</span> (e <span style="color: #b8860b;">-&gt;</span> a) }
</code></pre>

<p>
å…¶ä¸­
</p>
<ul class="org-ul">
<li>e æ˜¯è¾“å…¥</li>
<li>a æ˜¯ç»“æœ</li>
<li>æ„é€  Reader ç±»å‹éœ€è¦ç¡®å®š è¾“å…¥çš„ç±»å‹ e ä¸è¾“å‡ºçš„ç±»å‹ a</li>
<li><code>runReader</code> çš„ç±»å‹æ˜¯ <code>runReader:: (Reader e a) -&gt; (e -&gt; a)</code></li>
</ul>

<p>
ä¹Ÿå°±æ˜¯è¯´åœ¨æè¿°å®Œä¸€ä¸ª Reader çš„è®¡ç®—åï¼Œä½¿ç”¨ runReader å¯ä»¥å¾—åˆ°ä¸€ä¸ª e -&gt; a çš„å‡½æ•°ï¼Œä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œå°±å¯ä»¥æ¥æ”¶è¾“å…¥ï¼Œé€šè¿‡æ„é€ å¥½çš„è®¡ç®—ï¼Œç®—å‡ºç»“æœ a è¿”å›ã€‚
</p>

<p>
é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬æ¥å®ç° Reader çš„ monad instanceï¼Œå°±å¯ä»¥æè¿°ä¸€ä¸ªå¯ä»¥ ask çš„è®¡ç®—äº†ã€‚
</p>

<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Monad</span> (<span style="color: #36648b;">Reader</span> e) <span style="color: #00008b;">where</span>
    return a         <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Reader</span> <span style="color: #b8860b;">$</span> <span style="color: #b8860b;">\</span><span style="color: #00008b;">_</span> <span style="color: #b8860b;">-&gt;</span> a
    (<span style="color: #36648b;">Reader</span> g) <span style="color: #b8860b;">&gt;&gt;=</span> f <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Reader</span> <span style="color: #b8860b;">$</span> <span style="color: #b8860b;">\</span>e <span style="color: #b8860b;">-&gt;</span> runReader (f (g e)) e
</code></pre>

<p>
è·ŸEitherä¸€æ ·ï¼Œæˆ‘ä»¬åªèƒ½å®šä¹‰ Reader e çš„ monad instanceã€‚
</p>

<p>
æ³¨æ„è¿™é‡Œçš„
</p>
<ul class="org-ul">
<li>f ç±»å‹æ˜¯ <code>(a -&gt; Reader e a)</code></li>
<li>g å…¶å®å°±æ˜¯æ˜¯ destructure å‡ºæ¥çš„ runReaderï¼Œä¹Ÿå°±æ˜¯ e -&gt; a</li>
<li>æ‰€ä»¥ (g e) è¿”å› a</li>
<li>f (g e) å°±æ˜¯ <code>Reader e a</code></li>
<li>å† run ä¸€æŠŠæœ€åå¾—åˆ° a</li>
</ul>


<figure>
<img src="images/p2-reader-monad.png" alt="p2-reader-monad.png">

<figcaption><span class="figure-number">Figure 20: </span>f å‡½æ•°ï¼Œæ¥æ”¶ a è¿”å›ä¸€ä¸ª ä» e åˆ° a çš„ Reader</figcaption>
</figure>

<p>
è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Reader
</p>
<pre class="code"><code><span style="color: #00008b;">import</span> <span style="color: #36648b;">Control.Monad.Reader</span>

<span style="color: #00008b;">data</span> <span style="color: #36648b;">Environment</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Env</span>
  { fistName <span style="color: #b8860b;">::</span> <span style="color: #36648b;">String</span>
  , lastName <span style="color: #b8860b;">::</span> <span style="color: #36648b;">String</span>
  } <span style="color: #00008b;">deriving</span> (<span style="color: #36648b;">Show</span>)

<span style="color: #6a5acd;">helloworld</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Reader</span> <span style="color: #36648b;">Environment</span> <span style="color: #36648b;">String</span>
<span style="color: #6a5acd;">helloworld</span> <span style="color: #b8860b;">=</span> <span style="color: #00008b;">do</span>
  f <span style="color: #b8860b;">&lt;-</span> asks firstName
  l <span style="color: #b8860b;">&lt;-</span> asks lastName
  return <span style="color: #8b0000;">"Hello "</span> <span style="color: #b8860b;">++</span> f <span style="color: #b8860b;">++</span> l

<span style="color: #6a5acd;">runHelloworld</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">String</span>
<span style="color: #6a5acd;">runHelloworld</span> <span style="color: #b8860b;">=</span> runReader helloworld <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Env</span> <span style="color: #8b0000;">"Jichao"</span> <span style="color: #8b0000;">"Ouyang"</span>
</code></pre>

<p>
è¿™æ®µä»£ç å¾ˆç®€å•ï¼Œhelloworld è´Ÿè´£æ‰“æ‹›å‘¼ï¼Œä¹Ÿå°±æ˜¯åœ¨åå­—å‰é¢åŠ ä¸ª "Hello"ï¼Œè€Œè·Ÿè°æ‰“æ‹›å‘¼ï¼Œè¿™ä¸ªå‡½æ•°å¹¶ä¸å…³å¿ƒï¼Œè€Œå•çº¯çš„æ˜¯å‘ Environment <ruby>é—®<rt>asks</rt></ruby> å°±å¥½ã€‚
</p>


<figure>
<img src="images/p2-reader-monad-ask.png" alt="p2-reader-monad-ask.png">

<figcaption><span class="figure-number">Figure 21: </span>asks å¯ä»¥å°† e -&gt; a çš„å‡½æ•°å˜æ¢æˆ Reader e a</figcaption>
</figure>

<p>
åœ¨è¿è¡Œæ—¶ï¼Œå¯ä»¥æä¾›ç»™ Reader çš„è¾“å…¥ Env fistname lastnameã€‚
<img src="images/p2-reader-monad-run.png" alt="p2-reader-monad-run.png">
</p>
</div>

<div id="outline-container-orgca4f5da" class="outline-4">
<h4 id="orgca4f5da"><span class="section-number-4">2.4.1</span> do notation</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
è¿™å¯èƒ½æ˜¯ä½ ç¬¬ä¸€æ¬¡è§åˆ° <code>do</code> å’Œ <code>&lt;-</code>. å¦‚æœä¸æ˜¯ï¼Œéšæ„è·³è¿‡è¿™èŠ‚ã€‚
</p>

<ul class="org-ul">
<li>do ä¸­æ‰€æœ‰ &lt;- çš„å³è¾¹éƒ½æ˜¯ <code>Reader Environment String</code> ç±»å‹</li>
<li>do ä¸­çš„ return è¿”å›ç±»å‹ä¹Ÿå¿…é¡»ä¸º  <code>Reader Environment String</code></li>
<li><code>asks firstName</code> è¿”å›çš„æ˜¯ <code>Reader Environment String</code> ç±»å‹ï¼Œ <code>&lt;-</code> å¯ä»¥ç†è§£æˆå§ monad <code>Reader Environment</code> çš„å†…å®¹æ”¾åˆ°å·¦è¾¹çš„ f, æ‰€ä»¥ f çš„ç±»å‹æ˜¯ Stringã€‚</li>
</ul>

<p>
çœ‹èµ·æ¥åƒå‘½ä»¤å¼çš„è¯­å¥ï¼Œå…¶å®åªæ˜¯ <code>&gt;&gt;=</code> çš„è¯­æ³•ç³–ï¼Œä½†æ˜¯æ˜æ˜¾ç”¨doå¯è¯»æ€§è¦é«˜å¾ˆå¤šã€‚
</p>
<pre class="code"><code><span style="color: #6a5acd;">helloworld</span> <span style="color: #b8860b;">=</span> (asks firstName) <span style="color: #b8860b;">&gt;&gt;=</span>
  <span style="color: #b8860b;">\</span>f <span style="color: #b8860b;">-&gt;</span> (asks lastName) <span style="color: #b8860b;">&gt;&gt;=</span>
       <span style="color: #b8860b;">\</span>l <span style="color: #b8860b;">-&gt;</span> return <span style="color: #8b0000;">"Hello "</span> <span style="color: #b8860b;">++</span> f <span style="color: #b8860b;">++</span> l
</code></pre>
</div>
</div>
</div>


<div id="outline-container-org34fe8c3" class="outline-3">
<h3 id="org34fe8c3"><span class="section-number-3">2.5</span> Writer</h3>
<div class="outline-text-3" id="text-2-5">
<p>
é™¤äº†è¿”å›å€¼ï¼Œè®¡ç®—ä¼šéœ€è¦äº§ç”Ÿä¸€äº›é¢å¤–çš„æ•°æ®ï¼Œæ¯”å¦‚ log
</p>

<p>
æ­¤æ—¶å°±éœ€è¦ä¸€ä¸ª Writterï¼Œå…¶è¿”å›å€¼ä¼šæ˜¯ä¸€ä¸ªè¿™æ · <code>(result, log)</code> çš„ tuple
</p>

<p>
é™åˆ¶æ˜¯ log çš„ç±»å‹å¿…é¡»æ˜¯ä¸ª <ruby>å«å¹ºåŠç¾¤<rt>monoid</rt></ruby>
</p>

<pre class="code"><code><span style="color: #6a5acd;">example</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Writer</span> <span style="color: #36648b;">String</span> <span style="color: #36648b;">String</span>
<span style="color: #6a5acd;">example</span>  <span style="color: #b8860b;">=</span> <span style="color: #00008b;">do</span>
  tell <span style="color: #8b0000;">"How are you?"</span>
  tell <span style="color: #8b0000;">"I'm fine thank you, and you?"</span>
  return <span style="color: #8b0000;">"Hehe Da~"</span>

<span style="color: #6a5acd;">output</span> <span style="color: #b8860b;">::</span> (<span style="color: #36648b;">String</span>, <span style="color: #36648b;">String</span>)
<span style="color: #6a5acd;">output</span> <span style="color: #b8860b;">=</span> runWriter example
<span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">("Hehe Da~", "How are you?I'm fine thank you, and you?")</span>
</code></pre>

<p>
Writer çš„å®šä¹‰æ›´ç®€å•
</p>
<pre class="code"><code><span style="color: #00008b;">newtype</span> <span style="color: #36648b;">Writer</span> l a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Writer</span> { runWriter <span style="color: #b8860b;">::</span> (a,l) }
</code></pre>
<p>
é‡Œé¢åªæ˜¯ä¸€ä¸ª tuple è€Œå·²
</p>
<ul class="org-ul">
<li>w æ˜¯ log</li>
<li>a æ˜¯ è¿”å›å€¼</li>
</ul>

<p>
çœ‹çœ‹å¦‚ä½•å®ç° Writer monad
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> (<span style="color: #36648b;">Monoid</span> w) <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">Monad</span> (<span style="color: #36648b;">Writer</span> w) <span style="color: #00008b;">where</span>
    return a             <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Writer</span> (a,mempty)
    (<span style="color: #36648b;">Writer</span> (a,l)) <span style="color: #b8860b;">&gt;&gt;=</span> f <span style="color: #b8860b;">=</span> <span style="color: #00008b;">let</span> (a',l') <span style="color: #b8860b;">=</span> runWriter <span style="color: #b8860b;">$</span> f a <span style="color: #00008b;">in</span>
                           <span style="color: #36648b;">Writer</span> (a',l <span style="color: #b8860b;">`mappend`</span> l')
</code></pre>

<ul class="org-ul">
<li>return ä¸ä¼šæœ‰ä»»ä½• logï¼Œl æ˜¯ monoid çš„ mempty</li>
<li>f çš„ç±»å‹ä¸º <code>a -&gt; Writer l a</code></li>
<li><code>runWriter $ f a</code> è¿”å› <code>(a, l)</code></li>
</ul>


<figure>
<img src="images/p2-writer-monad.png" alt="p2-writer-monad.png">

</figure>

<p>
æ‰€ä»¥åœ¨ &gt;&gt;= æ—¶ï¼Œæˆ‘ä»¬å…ˆæŠŠ f a è¿”å›çš„ Writer runäº†ï¼Œç„¶åæŠŠä¸¤æ¬¡ log <code>mappend</code> èµ·æ¥ã€‚
<img src="images/p2-writer-monad-bind.png" alt="p2-writer-monad-bind.png">
</p>
</div>
</div>

<div id="outline-container-orge48dcf3" class="outline-3">
<h3 id="orge48dcf3"><span class="section-number-3">2.6</span> State</h3>
<div class="outline-text-3" id="text-2-6">
<p>
è·Ÿåå­—å°±çœ‹å¾—å‡ºæ¥ State monad æ˜¯ä¸ºäº†å¤„ç†çŠ¶æ€ã€‚è™½ç„¶å‡½æ•°å¼ç¼–ç¨‹ä¸åº”è¯¥æœ‰çŠ¶æ€ï¼Œä¸ç„¶ä¼šå¼•ç”¨é€æ˜æ€§ã€‚ä½†æ˜¯ï¼Œstate monadå¹¶ä¸æ˜¯åœ¨è®¡ç®—è¿‡ç¨‹ä¸­ä¿®æ”¹çŠ¶æ€ï¼Œè€Œæ˜¯é€šè¿‡æè¿°è¿™ç§å˜åŒ–ï¼Œç„¶åéœ€è¦æ—¶åœ¨è¿è¡Œè¿”å›æœ€ç»ˆç»“æœã€‚è¿™ä¸€ç‚¹è·Ÿ Reader å’Œ Writer è¿™ä¸¤ä¸ªçœ‹èµ·æ¥æ˜¯å‰¯ä½œç”¨çš„ IO æ˜¯ä¸€æ ·çš„ã€‚
</p>

<p>
å…ˆçœ‹ä¸‹ State ç±»å‹çš„å®šä¹‰
</p>
<pre class="code"><code><span style="color: #00008b;">newtype</span> <span style="color: #36648b;">State</span> s a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">State</span> { runState <span style="color: #b8860b;">::</span> s <span style="color: #b8860b;">-&gt;</span> (a, s) }
</code></pre>

<p>
å¯ä»¥çœ‹åˆ° State åªåŒ…å«ä¸€ä¸ª ä»æ—§çŠ¶æ€ s åˆ°æ–°çŠ¶æ€ s å’Œè¿”å›å€¼ a çš„ Tuple çš„å‡½æ•°ã€‚
</p>

<p>
é€šè¿‡å®ç° Monadï¼ŒState å°±å¯ä»¥å®ç°å‘½ä»¤å¼ç¼–ç¨‹ä¸­çš„å˜é‡çš„åŠŸèƒ½ã€‚
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Monad</span> (<span style="color: #36648b;">State</span> s) <span style="color: #00008b;">where</span>
  return a        <span style="color: #b8860b;">=</span> <span style="color: #36648b;">State</span> <span style="color: #b8860b;">$</span> <span style="color: #b8860b;">\</span>s <span style="color: #b8860b;">-&gt;</span> (a,s)
  (<span style="color: #36648b;">State</span> x) <span style="color: #b8860b;">&gt;&gt;=</span> f <span style="color: #b8860b;">=</span> <span style="color: #36648b;">State</span> <span style="color: #b8860b;">$</span> <span style="color: #b8860b;">\</span>s <span style="color: #b8860b;">-&gt;</span> <span style="color: #00008b;">let</span> (v,s') <span style="color: #b8860b;">=</span> x s <span style="color: #00008b;">in</span>
                                 runState (f v) s'
</code></pre>
<p>
return å¾ˆç®€å•ï¼Œå°±ä¸ç”¨è§£é‡Šäº†ã€‚
</p>


<figure>
<img src="images/p2-state-monad.png" alt="p2-state-monad.png">

</figure>

<p>
x ç±»å‹æ˜¯ <code>s -&gt; (a, s)</code> ,æ‰€ä»¥ x s ä¹‹åä¼šè¿”å› ç»“æœå’ŒçŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¿è¡Œå½“å‰ Stateï¼ŒæŠŠç»“æœ v ä¼ ç»™å‡½æ•° fï¼Œè¿”å›çš„ State å†æ¥ç€ä¸Šæ¬¡çŠ¶æ€è¿è¡Œã€‚
</p>


<figure>
<img src="images/p2-state-monad-bind.png" alt="p2-state-monad-bind.png">

<figcaption><span class="figure-number">Figure 24: </span>State x &gt;&gt;= f årunStateçš„æ•°æ®æµï¼ˆå•Šå•Šå•Šï¼Œç”»æ­ªäº†ï¼Œæ„Ÿè§‰éœ€è¦è„‰åŠ¨ä¸€ä¸‹ï¼‰</figcaption>
</figure>

<p>
ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆæ–¹ä¾¿ï¼ŒState æä¾› <code>get</code> <code>put</code> <code>moidfy</code> ä¸‰ä¸ªæ–¹ä¾¿çš„å‡½æ•°å¯ä»¥ç”Ÿæˆä¿®æ”¹çŠ¶æ€çš„State monad
</p>

<pre class="code"><code><span style="color: #00008b;">import</span> <span style="color: #36648b;">Control.Monad.Trans.State.Strict</span>
<span style="color: #6a5acd;">test</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">State</span> <span style="color: #36648b;">Int</span> <span style="color: #36648b;">Int</span>
<span style="color: #6a5acd;">test</span> <span style="color: #b8860b;">=</span> <span style="color: #00008b;">do</span>
  a <span style="color: #b8860b;">&lt;-</span> get
  modify (<span style="color: #b8860b;">+</span>1)
  b <span style="color: #b8860b;">&lt;-</span> get
  return (a <span style="color: #b8860b;">+</span> b)

<span style="color: #6a5acd;">main</span> <span style="color: #b8860b;">=</span> print <span style="color: #b8860b;">$</span> show <span style="color: #b8860b;">$</span> runState test 3
<span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">(7, 4)</span>
</code></pre>
</div>
</div>


<div id="outline-container-org26de6b2" class="outline-3">
<h3 id="org26de6b2"><span class="section-number-3">2.7</span> Validation</h3>
<div class="outline-text-3" id="text-2-7">
<p>
å¦‚æœä½ æœ‰æ³¨æ„åˆ°ï¼Œå‰é¢çš„ Either å¯ä»¥ç”¨åœ¨å¤„ç†é”™è¯¯å’Œæ­£ç¡®çš„è·¯å¾„åˆ†æ”¯ï¼Œä½†æ˜¯é—®é¢˜æ˜¯é”™è¯¯åªå‘ç”Ÿä¸€æ¬¡ã€‚
</p>

<div class="epigraph"><blockquote>
<p>
Validation æ²¡æœ‰åœ¨æ ‡å‡†åº“ä¸­ï¼Œä½†æ˜¯æˆ‘è§‰å¾—å¥½æœ‰ç”¨å•Šï¼Œä½ å¯ä»¥åœ¨ ekmett çš„ <a href="https://github.com/ekmett/either">github</a> ä¸­æ‰¾åˆ°æºç 
</p>

</blockquote></div>

<p>
æƒ³è±¡ä¸€ä¸‹è¿™ç§åœºæ™¯ï¼Œç”¨æˆ·æäº¤ä¸€ä¸ªè¡¨å•ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸€ä¸ªfieldè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œéœ€è¦æŠŠé”™è¯¯çš„å“ªå‡ ä¸ªfieldçš„é”™è¯¯æ¶ˆæ¯è¿”å›ã€‚æ˜¾ç„¶å¦‚æœä½¿ç”¨ Either æ¥åšï¼Œåªèƒ½è¿”å›ç¬¬ä¸€ä¸ªfieldçš„é”™è¯¯ä¿¡æ¯ï¼Œåé¢çš„è®¡ç®—éƒ½ä¼šè¢«è·³è¿‡ã€‚
</p>

<p>
é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œ Validation æ›´é€‚åˆ
</p>
<pre class="code"><code><span style="color: #00008b;">data</span> <span style="color: #36648b;">Validation</span> e a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Failure</span> e <span style="color: #b8860b;">|</span> <span style="color: #36648b;">Success</span> a
</code></pre>

<p>
ADTå®šä¹‰çœ‹èµ·æ¥è·Ÿ Either æ˜¯ä¸€æ ·çš„ï¼Œä¸åŒçš„æ˜¯ <ruby>å·¦è¾¹<rt>Left</rt></ruby> Failure æ˜¯ <ruby>å«å¹ºåŠç¾¤<rt>Monoid</rt></ruby>
</p>
</div>

<div id="outline-container-orgb29cfa0" class="outline-4">
<h4 id="orgb29cfa0"><span class="section-number-4">2.7.1</span> <ruby>å«å¹ºåŠç¾¤<rt>Monoid</rt></ruby></h4>
<div class="outline-text-4" id="text-2-7-1">
<p>
monoid é¦–å…ˆå¾—æ˜¯ <ruby>åŠç¾¤<rt>Semigroup</rt></ruby> ï¼Œç„¶åå† å«å¹ºã€‚
</p>
<pre class="code"><code><span style="color: #00008b;">class</span> <span style="color: #36648b;">Semigroup</span> a <span style="color: #00008b;">where</span>
  (<span style="color: #b8860b;">&lt;&gt;</span>) <span style="color: #b8860b;">::</span> a <span style="color: #b8860b;">-&gt;</span> a <span style="color: #b8860b;">-&gt;</span> a
  (<span style="color: #b8860b;">&lt;&gt;</span>) <span style="color: #b8860b;">=</span> mappend
</code></pre>

<p>
åŠç¾¤éå¸¸ç®€å•ï¼Œåªè¦æ˜¯å¯ä»¥ <code>&lt;&gt;</code> (mappend) çš„ç±»å‹å°±æ˜¯äº†ã€‚
</p>

<p>
å«å¹ºåªéœ€è¦æœ‰ä¸€ä¸ª <code>mempty</code> çš„ å¹ºå…ƒå°±è¡Œ
</p>
<pre class="code"><code><span style="color: #00008b;">class</span> <span style="color: #36648b;">Monoid</span> a <span style="color: #00008b;">where</span>
  mempty  <span style="color: #b8860b;">::</span> a
  mappend <span style="color: #b8860b;">::</span> a <span style="color: #b8860b;">-&gt;</span> a <span style="color: #b8860b;">-&gt;</span> a
</code></pre>

<p>
æ¯”å¦‚ List å°±æ˜¯ Semigroup
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Semigroup</span> [a] <span style="color: #00008b;">where</span>
  (<span style="color: #b8860b;">&lt;&gt;</span>) <span style="color: #b8860b;">=</span> (<span style="color: #b8860b;">++</span>)
</code></pre>
<p>
ä¹Ÿæ˜¯ Monoid
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Monoid</span> [a] <span style="color: #00008b;">where</span>
  mempty  <span style="color: #b8860b;">=</span> <span style="color: #36648b;">[]</span>
  mappend <span style="color: #b8860b;">=</span> (<span style="color: #b8860b;">++</span>)
</code></pre>

<p>
Monoid çš„ <code>&lt;&gt;</code> æ»¡è¶³ï¼š
</p>
<ul class="org-ul">
<li>mempty &lt;&gt; a = a</li>
<li>a &lt;&gt; b &lt;&gt; c = a &lt;&gt; (b &lt;&gt; c)</li>
</ul>
</div>
</div>
<div id="outline-container-orgc96495d" class="outline-4">
<h4 id="orgc96495d"><span class="section-number-4">2.7.2</span> å›åˆ° Validation</h4>
<div class="outline-text-4" id="text-2-7-2">
<p>
ç°åœ¨è®© Failure e æ»¡è¶³ Monoidï¼Œå°±å¯ä»¥ <code>mappend</code> é”™è¯¯ä¿¡æ¯äº†ã€‚
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Semigroup</span> e <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">Semigroup</span> (<span style="color: #36648b;">Validation</span> e a) <span style="color: #00008b;">where</span>
  <span style="color: #36648b;">Failure</span> e1 <span style="color: #b8860b;">&lt;&gt;</span> <span style="color: #36648b;">Failure</span> e2 <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Failure</span> (e1 <span style="color: #b8860b;">&lt;&gt;</span> e2)
  <span style="color: #36648b;">Failure</span> <span style="color: #00008b;">_</span>  <span style="color: #b8860b;">&lt;&gt;</span> <span style="color: #36648b;">Success</span> a2 <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Success</span> a2
  <span style="color: #36648b;">Success</span> a1 <span style="color: #b8860b;">&lt;&gt;</span> <span style="color: #36648b;">Failure</span> <span style="color: #00008b;">_</span>  <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Success</span> a1
  <span style="color: #36648b;">Success</span> a1 <span style="color: #b8860b;">&lt;&gt;</span> <span style="color: #36648b;">Success</span> <span style="color: #00008b;">_</span>  <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Success</span> a1
</code></pre>

<p>
ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹ Validation ä¸ Either æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚
</p>

<p>
å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªformï¼Œéœ€è¦è¾“å…¥å§“åä¸ç”µè¯ï¼ŒéªŒè¯éœ€è¦å§“åæ˜¯éç©ºè€Œç”µè¯æ˜¯11ä½æ•°å­—ã€‚
</p>

<p>
é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªå‡½æ•°å»åˆ›å»ºåŒ…å«å§“åå’Œç”µè¯çš„model
</p>
<pre class="code"><code><span style="color: #00008b;">data</span> <span style="color: #36648b;">Info</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Info</span> {name<span style="color: #36648b;">:</span> <span style="color: #36648b;">String</span>, phone<span style="color: #36648b;">:</span> <span style="color: #36648b;">String</span>} <span style="color: #00008b;">deriving</span> <span style="color: #36648b;">Show</span>
</code></pre>

<p>
ç„¶åæˆ‘ä»¬éœ€è¦éªŒè¯å‡½æ•°
</p>
<pre class="code"><code><span style="color: #6a5acd;">notEmpty</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">String</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">String</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Validation</span> [<span style="color: #36648b;">String</span>] <span style="color: #36648b;">String</span>
<span style="color: #6a5acd;">notEmpty</span> desc <span style="color: #8b0000;">""</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Failure</span> [desc <span style="color: #b8860b;">&lt;&gt;</span> <span style="color: #8b0000;">" cannot be empty!"</span>]
<span style="color: #6a5acd;">notEmpty</span> <span style="color: #00008b;">_</span> field <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Success</span> field
</code></pre>
<p>
notEmpty æ£€æŸ¥å­—ç¬¦æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ˜¯ç©ºè¿”å› Failure åŒ…å«é”™è¯¯ä¿¡æ¯ï¼Œè‹¥æ˜¯éç©ºåˆ™è¿”å› Success åŒ…å« field
</p>

<p>
åŒæ ·çš„å¯ä»¥åˆ›å»º 11ä½æ•°å­—çš„éªŒè¯å‡½æ•°
</p>
<pre class="code"><code><span style="color: #6a5acd;">phoneNumberLength</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">String</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">String</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Validation</span> [<span style="color: #36648b;">String</span>] <span style="color: #36648b;">String</span>
<span style="color: #6a5acd;">phoneNumberLength</span> desc field <span style="color: #b8860b;">|</span> (length field) <span style="color: #b8860b;">==</span> 11 <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Success</span> field
                             <span style="color: #b8860b;">|</span> otherwise <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Failure</span> [desc <span style="color: #b8860b;">&lt;&gt;</span> <span style="color: #8b0000;">"'s length is not 11"</span>]
</code></pre>
<p>
å®ç° Validation çš„ Applicative instanceï¼Œè¿™æ ·å°±å¯ä»¥æŠŠå‡½æ•°è°ƒç”¨liftæˆå¸¦æœ‰éªŒè¯çš„ Applicative
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Semigroup</span> e <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">Applicative</span> (<span style="color: #36648b;">Validation</span> e) <span style="color: #00008b;">where</span>
  pure <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Success</span>
  <span style="color: #36648b;">Failure</span> e1 <span style="color: #b8860b;">&lt;*&gt;</span> <span style="color: #36648b;">Failure</span> e2 <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Failure</span> e1 <span style="color: #b8860b;">&lt;&gt;</span> <span style="color: #36648b;">Failure</span> e2
  <span style="color: #36648b;">Failure</span> e1 <span style="color: #b8860b;">&lt;*&gt;</span> <span style="color: #36648b;">Success</span> <span style="color: #00008b;">_</span>  <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Failure</span> e1
  <span style="color: #36648b;">Success</span> <span style="color: #00008b;">_</span>  <span style="color: #b8860b;">&lt;*&gt;</span> <span style="color: #36648b;">Failure</span> e2 <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Failure</span> e2
  <span style="color: #36648b;">Success</span> f <span style="color: #b8860b;">&lt;*&gt;</span> <span style="color: #36648b;">Success</span> a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Success</span> (f a)
</code></pre>
<ul class="org-ul">
<li>å¤±è´¥åº”ç”¨åˆ°å¤±è´¥ä¼š concat èµ·æ¥</li>
<li>å¤±è´¥è·Ÿåº”ç”¨æˆ–è¢«æˆåŠŸåº”ç”¨è¿˜æ˜¯å¤±è´¥</li>
<li>åªæœ‰æˆåŠŸåº”ç”¨åˆ°æˆåŠŸæ‰èƒ½æˆåŠŸï¼Œè¿™å¾ˆç¬¦åˆéªŒè¯çš„é€»è¾‘ï¼Œä¸€æ—¦éªŒè¯ä¸­å‘ç”Ÿä»»ä½•é”™è¯¯ï¼Œéƒ½åº”è¯¥è¿”å›å¤±è´¥ã€‚</li>
</ul>

<pre class="code"><code><span style="color: #6a5acd;">createInfo</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">String</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">String</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Validation</span> [<span style="color: #36648b;">String</span>] <span style="color: #36648b;">Info</span>
<span style="color: #6a5acd;">createInfo</span> name phone <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Info</span> <span style="color: #b8860b;">&lt;$&gt;</span> notEmpty <span style="color: #8b0000;">"name"</span> name <span style="color: #b8860b;">&lt;*&gt;</span> phoneNumberLength <span style="color: #8b0000;">"phone"</span> phone
</code></pre>

<p>
ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¸¦validationçš„ createInfo æ¥å®‰å…¨çš„åˆ›å»º Info äº†
</p>

<pre class="code"><code><span style="color: #6a5acd;">createInfo</span> <span style="color: #8b0000;">"jichao"</span> <span style="color: #8b0000;">"12345678910"</span> <span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">Success Info "jichao" "12345678910"</span>
<span style="color: #6a5acd;">createInfo</span> <span style="color: #8b0000;">""</span> <span style="color: #8b0000;">"123"</span> <span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">Failure ["name cannot be empty!", "phone's length is not 11"]</span>
</code></pre>
</div>
</div>
</div>

<div id="outline-container-org97478b7" class="outline-3">
<h3 id="org97478b7"><span class="section-number-3">2.8</span> Cont</h3>
<div class="outline-text-3" id="text-2-8">
<p>
Cont æ˜¯ <ruby>Continuation Passing Style<rt>CPS</rt></ruby> çš„ monadï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯åŒ…å« cps è®¡ç®— monadã€‚
</p>

<p>
å…ˆçœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯ CPSï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªåŠ æ³•
</p>
<pre class="code"><code><span style="color: #6a5acd;">add</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Int</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Int</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Int</span>
<span style="color: #6a5acd;">add</span> <span style="color: #b8860b;">=</span> (<span style="color: #b8860b;">+</span>)
</code></pre>

<p>
ä½†æ˜¯å¦‚æœä½ æƒ³åœ¨ç®—æ³•åŠ æ³•åï¼Œèƒ½å¤Ÿç»§ç»­è¿›è¡Œä¸€ä¸ªå…¶ä»–çš„è®¡ç®—ï¼Œé‚£ä¹ˆå°±å¯ä»¥å†™ä¸€ä¸ª cpsç‰ˆæœ¬çš„åŠ æ³•
</p>
<pre class="code"><code><span style="color: #6a5acd;">addCPS</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Int</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Int</span> <span style="color: #b8860b;">-&gt;</span> (<span style="color: #36648b;">Int</span> <span style="color: #b8860b;">-&gt;</span> r) <span style="color: #b8860b;">-&gt;</span> r
<span style="color: #6a5acd;">addCPS</span> a b k <span style="color: #b8860b;">=</span> k (a <span style="color: #b8860b;">+</span> b)
</code></pre>

<p>
éå¸¸ç®€å•ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ª Cont monad æ¥åŒ…ä½ CPS è®¡ç®—ï¼Œé¦–å…ˆï¼Œæ¥çœ‹ ADT å®šä¹‰
</p>
<pre class="code"><code><span style="color: #00008b;">newtype</span> <span style="color: #36648b;">Cont</span> r a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Cont</span> { runCont <span style="color: #b8860b;">::</span> ((a <span style="color: #b8860b;">-&gt;</span> r) <span style="color: #b8860b;">-&gt;</span> r) }
</code></pre>

<p>
åˆæ˜¯ä¸€ä¸ªåŒæ„çš„ç±»å‹ï¼ŒCont æ„é€ å™¨åªéœ€è¦ä¸€ä¸ª runCountï¼Œä¹Ÿå°±æ˜¯è®©ä»–èƒ½ç»§ç»­è®¡ç®—çš„ä¸€ä¸ªå‡½æ•°ã€‚
</p>

<p>
å®Œäº†ä¹‹åæ¥æŠŠä¹‹å‰çš„ addCPS æ”¹æˆ Cont
</p>
<pre class="code"><code><span style="color: #6a5acd;">add</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Int</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Int</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Cont</span> k <span style="color: #36648b;">Int</span>
<span style="color: #6a5acd;">add</span> a b <span style="color: #b8860b;">=</span> return (a <span style="color: #b8860b;">+</span> b)
</code></pre>

<p>
æ³¨æ„åˆ° addCPS æ¥æ”¶åˆ° a å’Œ b ä¹‹åè¿”å›çš„ç±»å‹æ˜¯ <code>(Int -&gt; r) -&gt; r</code> ï¼Œè€Œ Cont ç‰ˆæœ¬çš„ <code>add</code> è¿”å› <code>Cont k Int</code>
</p>

<p>
æ˜æ˜¾æ„é€  <code>Cont k Int</code> ä¹Ÿæ­£æ˜¯éœ€è¦ <code>(Int -&gt; r) -&gt; r</code> ï¼Œæ‰€ä»¥ Cont å°±æ˜¯ç®—äº† k çš„æŠ½è±¡äº†ã€‚
</p>

<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Monad</span> (<span style="color: #36648b;">Cont</span> r) <span style="color: #00008b;">where</span>
    return a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Cont</span> (<span style="color: #b8860b;">$</span> a)
    m <span style="color: #b8860b;">&gt;&gt;=</span> k  <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Cont</span> <span style="color: #b8860b;">$</span> <span style="color: #b8860b;">\</span>c <span style="color: #b8860b;">-&gt;</span> runCont m <span style="color: #b8860b;">$</span> <span style="color: #b8860b;">\</span>a <span style="color: #b8860b;">-&gt;</span> runCont (k a) c
</code></pre>

<p>
<code>($ a)</code> æ¯”è¾ƒæœ‰æ„æ€, æˆ‘ä»¬éƒ½çŸ¥é“ <code>f $ g a</code> å…¶å®å°±æ˜¯ <code>f(g a)</code>, æ‰€ä»¥ <code>$</code> å…¶å®å°±æ˜¯ä¸€ä¸ª apply å·¦è¾¹çš„å‡½æ•°åˆ°å³è¾¹è¡¨è¾¾å¼çš„ä¸­ç¼€å‡½æ•°, å¦‚æœå†™æˆå‰ç¼€åˆ™æ˜¯
<code>($ (g a) f)</code>. æ˜¯åçš„æ˜¯å› ä¸º <code>$</code> æ˜¯æœ‰ç»“åˆ, éœ€è¦å³è¾¹è¡¨è¾¾å¼å…ˆæ±‚å€¼, æ‰€ä»¥åªç»™ä¸€ä¸ª a å°±ç›¸å½“äº <code>($ a) = \f -&gt; f a</code>
</p>

<p>
å›åˆ° Monad Cont&#x2026;
</p>
<pre class="example">
ob-haskell
</pre>
</div>
</div>
</div>

<div id="outline-container-org4624c6a" class="outline-2">
<h2 id="org4624c6a"><span class="section-number-2">3</span> ç¬¬ä¸‰éƒ¨åˆ†:<ruby>æåŸºçŒ«å‘¢<rt>Advanced Monads</rt></ruby></h2>
<div class="outline-text-2" id="text-3">
<p>
ç¬¬äºŒéƒ¨åˆ†ä»‹ç»äº†ä¸€äº›å®ç”¨çš„monad instancesï¼Œè¿™äº› monad éƒ½é€šè¿‡åŒæ ·çš„æŠ½è±¡æ–¹å¼ï¼Œè§£å†³äº†åˆ†ç¦»è®¡ç®—ä¸å‰¯ä½œç”¨çš„å·¥ä½œã€‚
</p>

<p>
é€šè¿‡å®ƒä»¬å¯ä»¥è§£å†³å¤§å¤šæ•°çš„åŸºæœ¬é—®é¢˜ï¼Œä½†æ˜¯æ­£å¯¹äºå¤æ‚ä¸šåŠ¡é€»è¾‘ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦ä¸€äº›æ›´é«˜é˜¶çš„ monad æˆ–è€… patternã€‚
</p>

<p>
å½“æœ‰äº†ç¬¬ä¸€éƒ¨åˆ†çš„ç†è®ºåŸºç¡€å’Œç¬¬äºŒéƒ¨åˆ†çš„å®è·µï¼Œè¿™éƒ¨åˆ†è¦ä»‹ç»çš„çŒ«å‘¢å…¶å®å¹¶ä¸æ˜¯å¾ˆæåŸºã€‚é€šè¿‡è¿™ä¸€éƒ¨åˆ†ä»‹ç»çš„æåŸºçŒ«å‘¢ï¼Œ
æˆ‘ä»¬è¿˜å¯ä»¥åƒ IO monad ä¸€æ ·ï¼Œé€šè¿‡ free æˆ–è€… Eff è‡ªå®šä¹‰è‡ªå·±çš„è®¡ç®—ï¼Œå’Œå¯èƒ½å¸¦å‰¯ä½œç”¨çš„è§£é‡Šå™¨ã€‚
</p>
</div>

<div id="outline-container-orgeb61fb5" class="outline-3">
<h3 id="orgeb61fb5"><span class="section-number-3">3.1</span> RWS</h3>
<div class="outline-text-3" id="text-3-1">
<p>
RWS æ˜¯ç¼©å†™ Reader Writer State monad, æ‰€ä»¥æ˜æ˜¾æ˜¯ä¸‰ä¸ªmonadçš„åˆä½“ã€‚å¦‚æœå·²ç»å¿˜è®° Reader Writer æˆ–è€… Stateï¼Œè¯·åˆ°ç¬¬äºŒéƒ¨åˆ†å¤ä¹ ä¸€ä¸‹ã€‚
</p>

<p>
ä¸€æ—¦æŠŠä¸‰ä¸ª monad åˆä½“ï¼Œæ„å‘³ç€å¯ä»¥åœ¨åŒä¸€ä¸ª monad ä½¿ç”¨ä¸‰ä¸ª monad çš„æ–¹æ³•ï¼Œæ¯”å¦‚ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨ Reader çš„ ask, State çš„ get, put, å’Œ Writer çš„ tell
</p>

<pre class="code"><code><span style="color: #6a5acd;">readWriteState</span> <span style="color: #b8860b;">=</span> <span style="color: #00008b;">do</span>
  e <span style="color: #b8860b;">&lt;-</span> ask
  a <span style="color: #b8860b;">&lt;-</span> get
  <span style="color: #00008b;">let</span> res <span style="color: #b8860b;">=</span> a <span style="color: #b8860b;">+</span> e
  put res
  tell [res]
  return res
<span style="color: #6a5acd;">runRWS</span> readWriteState 1 2
<span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">(3 3 [3])</span>
</code></pre>

<p>
æ³¨æ„åˆ°è·Ÿ Reader å’Œ State ä¸€æ ·ï¼Œrunçš„æ—¶å€™è¾“å…¥åˆå§‹å€¼
</p>

<p>
å…¶ä¸­ 1 ä¸º Reader çš„å€¼ï¼Œ2 ä¸º State çš„åˆå§‹çŠ¶æ€.
</p>
</div>
</div>

<div id="outline-container-orgb9ad244" class="outline-3">
<h3 id="orgb9ad244"><span class="section-number-3">3.2</span> Monad Transform</h3>
<div class="outline-text-3" id="text-3-2">
<p>
ä½ ä¼šå‘ç° RWS ä¸€èµ·ç”¨æŒºå¥½çš„ï¼Œèƒ½è¯»èƒ½å†™èƒ½æ‰“ logï¼Œä½†æ˜¯å·²ç»å›ºå®šå¥½æ­é…äº†ï¼Œåªèƒ½æ˜¯ RWS ï¼Œå¦‚æœæˆ‘è¿˜æƒ³åŠ å…¥å…¶å®ƒçš„ Monadï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ
</p>

<p>
è¿™æ—¶å€™ï¼Œç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯åŠ ä¸ª Tï¼Œæ¯”å¦‚å¯¹äº Readerï¼Œæˆ‘ä»¬æœ‰ ReaderTï¼ŒRWSï¼Œä¹Ÿæœ‰å¯¹åº”çš„ RWSTã€‚å…¶ä¸­ T ä»£è¡¨ Transformã€‚
</p>
</div>

<div id="outline-container-org8bbcf26" class="outline-4">
<h4 id="org8bbcf26"><span class="section-number-4">3.2.1</span> ReaderT</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
è®©æˆ‘æ¥é€šè¿‡ç®€å•çš„ ReaderT æ¥è§£é‡Šåˆ°åº•ä»€ä¹ˆæ˜¯ T å§, é¦–å…ˆè·Ÿ Reader ä¸€æ ·æˆ‘ä»¬æœ‰ä¸ª runReaderT
</p>

<pre class="code"><code><span style="color: #00008b;">newtype</span> <span style="color: #36648b;">ReaderT</span> e m a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">ReaderT</span> { runReaderT <span style="color: #b8860b;">::</span> e <span style="color: #b8860b;">-&gt;</span> m a }
</code></pre>

<p>
æ¯”è¾ƒä¸€ä¸‹ Reader çš„å®šä¹‰
</p>
<pre class="code"><code><span style="color: #00008b;">newtype</span> <span style="color: #36648b;">Reader</span> e a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Reader</span> { runReader <span style="color: #b8860b;">::</span> (e <span style="color: #b8860b;">-&gt;</span> a) }
</code></pre>

<p>
æœ‰æ²¡æœ‰å‘ç°å¤šäº†ä¸€ä¸ª m, ä¹Ÿå°±æ˜¯è¯´, <code>runReader e</code> ä¼šè¿”å› a, ä½†æ˜¯ <code>runReaderT e</code> åˆ™ä¼šè¿”å› <code>m a</code>
</p>


<figure>
<img src="images/p3-ReaderT.png" alt="p3-ReaderT.png">

</figure>

<pre class="code"><code><span style="color: #00008b;">instance</span> (<span style="color: #36648b;">Monad</span> m) <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">Monad</span> (<span style="color: #36648b;">ReaderT</span> e m) <span style="color: #00008b;">where</span>
    return   <span style="color: #b8860b;">=</span> lift <span style="color: #b8860b;">.</span> return
    r <span style="color: #b8860b;">&gt;&gt;=</span> k  <span style="color: #b8860b;">=</span> <span style="color: #36648b;">ReaderT</span> <span style="color: #b8860b;">$</span> <span style="color: #b8860b;">\</span> e <span style="color: #b8860b;">-&gt;</span> <span style="color: #00008b;">do</span>
        a <span style="color: #b8860b;">&lt;-</span> runReaderT r e
        runReaderT (k a) e
</code></pre>

<p>
å†çœ‹çœ‹ monad çš„å®ç°, ä¹Ÿæ˜¯ä¸€æ ·çš„, å…ˆ run ä¸€ä¸‹ <code>r e</code> å¾—åˆ°ç»“æœ <code>a</code>, åº”ç”¨å‡½æ•° <code>k</code> åˆ° <code>a</code>, å† run ä¸€æŠŠ.
</p>


<p>
é—®é¢˜æ˜¯, è¿™é‡Œçš„ <code>return</code> é‡Œé¢çš„ <code>lift</code> æ˜¯å“ªæ¥çš„?
</p>

<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">MonadTrans</span> (<span style="color: #36648b;">ReaderT</span> e) <span style="color: #00008b;">where</span>
  lift m <span style="color: #b8860b;">=</span> <span style="color: #36648b;">ReaderT</span> (const m)
</code></pre>


<figure>
<img src="images/p3-MonadTrans-ReaderT-e-m.png" alt="p3-MonadTrans-ReaderT-e-m.png">

</figure>

<p>
è¿™ä¸ªå‡½æ•° <code>lift</code> è¢«å®šä¹‰åœ¨ MonadTrans çš„å®ä¾‹ä¸­, ç®€å•çš„æŠŠ m æ”¾åˆ° ReaderT ç»“æœä¸­.
</p>

<p>
ä¾‹å¦‚, <code>lift (Just 1)</code> ä¼šå¾—åˆ° ReaderT, å…¶ä¸­ e éšæ„, m ä¸º Maybe Num
</p>

<p>
é‡ç‚¹éœ€è¦ä½“ä¼šçš„æ˜¯, Reader å¯ä»¥è¶Šè¿‡ Maybe ç›´æ¥æ“ä½œåˆ° Num, å®Œäº†å†åŒ…å›æ¥.
</p>

<p>
æœ‰äº† ReaderT, æ­é… Id Monad å°±å¾ˆå®¹æ˜“åˆ›å»ºå‡ºæ¥ Reader Monad
</p>

<pre class="code"><code><span style="color: #00008b;">type</span> <span style="color: #36648b;">Reader</span> r a<span style="color: #b8860b;">=</span> <span style="color: #36648b;">ReaderT</span> r <span style="color: #36648b;">Identity</span> a
</code></pre>

<p>
è¶Šè¿‡ Id read åˆ° Id å†…éƒ¨, å®Œäº†å†ç”¨ Id åŒ…å›æ¥, ä¸å°±æ˜¯ Reader äº†ä¹ˆ
</p>

<pre class="code"><code><span style="color: #36648b;">ReaderT</span> { runReaderT <span style="color: #b8860b;">::</span> r <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Identity</span> a }
<span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">Identity a is a</span>
<span style="color: #36648b;">ReaderT</span> { runReaderT <span style="color: #b8860b;">::</span> r <span style="color: #b8860b;">-&gt;</span> a }
</code></pre>
</div>
</div>
</div>

<div id="outline-container-org89b5397" class="outline-3">
<h3 id="org89b5397"><span class="section-number-3">3.3</span> Alternative</h3>
<div class="outline-text-3" id="text-3-3">
<p>
è¿™ä¸ª typeclass æä¾› <code>&lt;|&gt;</code> å‡½æ•°, è¡¨ç¤ºè¦ä¹ˆè®¡ç®—å·¦è¾¹, è¦ä¹ˆè®¡ç®—å³è¾¹
</p>

<pre class="code"><code><span style="color: #00008b;">class</span> <span style="color: #36648b;">Applicative</span> f <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">Alternative</span> f <span style="color: #00008b;">where</span>
    empty <span style="color: #b8860b;">::</span> f a
    (<span style="color: #b8860b;">&lt;|&gt;</span>) <span style="color: #b8860b;">::</span> f a <span style="color: #b8860b;">-&gt;</span> f a <span style="color: #b8860b;">-&gt;</span> f a
</code></pre>


<figure>
<img src="images/p3-Alternative.png" alt="p3-Alternative.png">

</figure>

<p>
å…¶å®å°±æ˜¯ Applicative çš„ <code>æˆ–</code>
</p>

<p>
æ¯”å¦‚:
</p>
<pre class="code"><code><span style="color: #36648b;">Just</span> 1 <span style="color: #b8860b;">&lt;|&gt;</span> <span style="color: #36648b;">Just</span> 2 <span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">Just 1</span>
<span style="color: #36648b;">Just</span> 1 <span style="color: #b8860b;">&lt;|&gt;</span> <span style="color: #36648b;">Nothing</span> <span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">Just 1</span>
<span style="color: #36648b;">Nothing</span> <span style="color: #6a5acd;">&lt;|&gt;</span> <span style="color: #36648b;">Just</span> 1 <span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">Just 1</span>
<span style="color: #36648b;">Nothing</span> <span style="color: #6a5acd;">&lt;|&gt;</span> <span style="color: #36648b;">Nothing</span> <span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">Nothing</span>
</code></pre>
</div>
</div>

<div id="outline-container-orgc4f6987" class="outline-3">
<h3 id="orgc4f6987"><span class="section-number-3">3.4</span> MonadPlus</h3>
<div class="outline-text-3" id="text-3-4">
<p>
è¿™è·Ÿ Alternative æ˜¯ä¸€æ¯›ä¸€æ ·çš„, åªæ˜¯é™åˆ¶çš„æ›´ç»†, å¿…é¡»æ˜¯ Monadæ‰è¡Œ
</p>

<pre class="code"><code><span style="color: #00008b;">class</span> (<span style="color: #36648b;">Alternative</span> m, <span style="color: #36648b;">Monad</span> m) <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">MonadPlus</span> m <span style="color: #00008b;">where</span>
   mzero <span style="color: #b8860b;">::</span> m a
   mzero <span style="color: #b8860b;">=</span> empty
   mplus <span style="color: #b8860b;">::</span> m a <span style="color: #b8860b;">-&gt;</span> m a <span style="color: #b8860b;">-&gt;</span> m a
   mplus <span style="color: #b8860b;">=</span> (<span style="color: #b8860b;">&lt;|&gt;</span>)
</code></pre>

<p>
çœ‹, å®ç°ä¸­ç›´æ¥å°±è°ƒç”¨äº† Alternative çš„ <code>empty</code> å’Œ <code>&lt;|&gt;</code>
</p>
</div>
</div>

<div id="outline-container-orgb2e026f" class="outline-3">
<h3 id="orgb2e026f"><span class="section-number-3">3.5</span> ST Monad</h3>
<div class="outline-text-3" id="text-3-5">
<p>
ST Monad è·Ÿ State Monad çš„åŠŸèƒ½æœ‰äº›åƒ, ä¸è¿‡æ›´å‰å®³çš„æ˜¯, ä»–ä¸æ˜¯ immutable çš„, è€Œæ˜¯ "immutable" çš„åœ¨åŸåœ°åšä¿®æ”¹. æ”¹å®Œä¹‹å runST åˆç„¶ä»–å›åˆ°äº† immutable çš„ Haskell ä¸–ç•Œ.
</p>

<pre class="code"><code><span style="color: #6a5acd;">sumST</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Num</span> a <span style="color: #b8860b;">=&gt;</span> [a] <span style="color: #b8860b;">-&gt;</span> a
<span style="color: #6a5acd;">sumST</span> xs <span style="color: #b8860b;">=</span> runST <span style="color: #b8860b;">$</span> <span style="color: #00008b;">do</span>           <span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">do &#21518;&#38754;&#30340;&#20107;&#24773;&#20250;&#26159;&#19981;&#38169;&#30340;&#20869;&#23384;&#25805;&#20316;, runST &#21487;&#20197;&#25226;&#23427;&#25289;&#20250;&#32431;&#30340;&#19990;&#30028;</span>
    n <span style="color: #b8860b;">&lt;-</span> newSTRef 0             <span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">&#22312;&#20869;&#23384;&#20013;&#21019;&#24314;&#19968;&#22359;&#24182;&#25351;&#21040; STRef</span>
    forM_ xs <span style="color: #b8860b;">$</span> <span style="color: #b8860b;">\</span>x <span style="color: #b8860b;">-&gt;</span> <span style="color: #00008b;">do</span>         <span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">&#36825;&#36319;&#21629;&#20196;&#24335;&#30340;for&#24490;&#29615;&#25913;&#20889;&#21464;&#37327;&#26159;&#19968;&#27611;&#19968;&#26679;&#30340;</span>
        modifySTRef n (<span style="color: #b8860b;">+</span>x)
    readSTRef n                 <span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">&#36820;&#22238;&#25913;&#23436;&#20043;&#21518;&#30340; n &#30340;&#20540;</span>
</code></pre>
</div>
</div>

<div id="outline-container-orge48b2c0" class="outline-3">
<h3 id="orge48b2c0"><span class="section-number-3">3.6</span> Free Monad</h3>
<div class="outline-text-3" id="text-3-6">
<p>
ä¸Šä¸€ç« è¯´è¿‡çš„ RWS Monad æ¯•ç«Ÿæ˜¯å›ºå®šæ­é…ï¼Œå½“ä½ çš„ä¸šåŠ¡éœ€è¦æ›´å¤šçš„ Monad æ¥è¡¨ç¤º Effect æ—¶ï¼Œ
æˆ‘ä»¬å°±éœ€è¦æœ‰é‚£ä¹ˆä¸ªå°çŒªæ‰‹å¸®æˆ‘ä»¬å®šä¹‰è‡ªå·±çš„ Monadã€‚
</p>

<p>
é‚£å°±æ˜¯ Free, Free å¯ä»¥å°†ä»»æ„ datatype lift æˆä¸º Monad
</p>
</div>

<div id="outline-container-orge5eedb7" class="outline-4">
<h4 id="orge5eedb7"><span class="section-number-4">3.6.1</span> Free</h4>
<div class="outline-text-4" id="text-3-6-1">
<p>
å…ˆçœ‹ Free ä»€ä¹ˆå®šä¹‰:
</p>

<pre class="code"><code><span style="color: #00008b;">data</span> <span style="color: #36648b;">Free</span> f a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Roll</span> (f (<span style="color: #36648b;">Free</span> f a)) <span style="color: #b8860b;">|</span> <span style="color: #36648b;">Return</span> a
</code></pre>

<p>
å…¶ä¸­ <code>f</code> å°±æ˜¯ä½ ä¸šåŠ¡éœ€è¦çš„ effect ç±»å‹, <code>a</code> æ˜¯è¿™ä¸ª effect æ‰€äº§ç”Ÿçš„è¿”å›å€¼ç±»å‹ã€‚
</p>

<p>
å³è¾¹ä¸¤ç§æ„é€ å‡½æ•°ï¼Œå¦‚æœæŠŠ <code>Role</code> æ”¹æˆ <code>Cons</code>, <code>Return</code> æ”¹æˆ <code>Nil</code> çš„è¯, æ˜¯ä¸æ˜¯è·Ÿ List å…¶å®æ˜¯ <ruby>åŒæ„<rt>isomophic</rt></ruby> çš„å‘¢? æ‰€ä»¥å¦‚æœæƒ³è±¡æˆ List, é‚£ä¹ˆ <code>f</code> åœ¨è¿™é‡Œå°±ç›¸å½“äº List ä¸­çš„ä¸€ä¸ªå…ƒç´ .
</p>

<p>
åˆ°é‚£æ—¶, <code>&gt;&gt;=</code> çš„æ“ä½œåˆè·Ÿ List ç•¥æœ‰ä¸åŒ, æˆ‘ä»¬éƒ½çŸ¥é“ <code>&gt;&gt;=</code> ä¼šæŠŠæ¯ä¸€ä¸ªå…ƒç´  map æˆ List, ç„¶å flatten, ä½† Free å…¶å®æ˜¯ç”¨æ¥æ„å»º
é¡ºåºçš„ effect çš„, æ‰€ä»¥:
</p>

<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Functor</span> f <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">Monad</span> (<span style="color: #36648b;">Free</span> f) <span style="color: #00008b;">where</span>
  return a        <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Return</span> a
  <span style="color: #36648b;">Return</span> a <span style="color: #b8860b;">&gt;&gt;=</span> fn <span style="color: #b8860b;">=</span> fn a
  <span style="color: #36648b;">Roll</span> ffa <span style="color: #b8860b;">&gt;&gt;=</span> fn <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Roll</span> <span style="color: #b8860b;">$</span> fmap (<span style="color: #b8860b;">&gt;&gt;=</span> fn) ffa
</code></pre>

<p>
ä½ ä¼šå‘ç° <code>&gt;&gt;=</code> ä¼šé€’å½’çš„ <code>fmap</code> åˆ° <code>Roll</code> ä¸Š, ç›´åˆ°æœ€åä¸€ä¸ª <code>Return</code>.
</p>

<p>
æ¯”å¦‚, å¦‚æœä½ æœ‰ä¸€ä¸ª program æœ‰ä¸‰ç§å‰¯ä½œç”¨ Eff1, Eff2, Eff3
</p>

<pre class="code"><code><span style="color: #00008b;">data</span> <span style="color: #36648b;">Eff</span> a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Eff1</span> a <span style="color: #b8860b;">|</span> <span style="color: #36648b;">Eff2</span> a <span style="color: #b8860b;">|</span> <span style="color: #36648b;">Eff3</span> a
<span style="color: #6a5acd;">program</span> <span style="color: #b8860b;">=</span> <span style="color: #00008b;">do</span>
 a <span style="color: #b8860b;">&lt;-</span> liftF <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff1</span> 1
 b <span style="color: #b8860b;">&lt;-</span> liftF <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff2</span> 2
 c <span style="color: #b8860b;">&lt;-</span> liftF <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff3</span> 3
 return a <span style="color: #b8860b;">+</span> b <span style="color: #b8860b;">+</span> c
</code></pre>

<p>
å¦‚æœæˆ‘ä»¬æŠŠ program å±•å¼€, æ¯ä¸€æ­¥ <code>&gt;&gt;=</code> å¤§æ¦‚æ˜¯è¿™æ ·:
</p>

<pre class="code"><code>liftF <span style="color: #6a5acd;">$</span> <span style="color: #36648b;">Eff1</span> 1
</code></pre>

<p>
å±•å¼€æ—¢æ˜¯:
</p>

<pre class="code"><code><span style="color: #36648b;">Roll</span> (<span style="color: #36648b;">Eff1</span> (<span style="color: #36648b;">Return</span> 1))
</code></pre>

<p>
ä»£å…¥åˆ° program å³:
</p>
<pre class="code"><code><span style="color: #6a5acd;">program</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Roll</span> (<span style="color: #36648b;">Eff1</span> (<span style="color: #36648b;">Return</span> 1)) <span style="color: #b8860b;">&gt;&gt;=</span> <span style="color: #b8860b;">\</span>a <span style="color: #b8860b;">-&gt;</span> <span style="color: #00008b;">do</span>
   b <span style="color: #b8860b;">&lt;-</span> liftF <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff2</span> 2
   c <span style="color: #b8860b;">&lt;-</span> liftF <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff3</span> 3
   return a <span style="color: #b8860b;">+</span> b <span style="color: #b8860b;">+</span> c
</code></pre>

<p>
ç”¨ Free çš„ <code>&gt;&gt;=</code> å…¬å¼ <code>Roll ffa &gt;&gt;= fn = Roll $ fmap (&gt;&gt;= fn) ffa</code> å»å±•å¼€ä¸Šé¢å°±å¾—åˆ°:
</p>

<pre class="code"><code><span style="color: #6a5acd;">program</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Roll</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff1</span> (<span style="color: #36648b;">Return</span> 1 <span style="color: #b8860b;">&gt;&gt;=</span> fn1)) <span style="color: #00008b;">where</span>
  fn1 <span style="color: #b8860b;">=</span> <span style="color: #b8860b;">\</span>a <span style="color: #b8860b;">-&gt;</span> <span style="color: #00008b;">do</span>
   b <span style="color: #b8860b;">&lt;-</span> liftF <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff2</span> 2
   c <span style="color: #b8860b;">&lt;-</span> liftF <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff3</span> 3
   return a <span style="color: #b8860b;">+</span> b <span style="color: #b8860b;">+</span> c
</code></pre>

<p>
<code>Return 1 &gt;&gt;= fn1</code> æˆ‘ä»¬éƒ½çŸ¥é“æ€ä¹ˆå±•å¼€:
</p>

<pre class="code"><code><span style="color: #6a5acd;">program</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Roll</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff1</span> (fn1 1) <span style="color: #00008b;">where</span>
  fn1 <span style="color: #b8860b;">=</span> <span style="color: #b8860b;">\</span>a <span style="color: #b8860b;">-&gt;</span> <span style="color: #00008b;">do</span>
   b <span style="color: #b8860b;">&lt;-</span> liftF <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff2</span> 2
   c <span style="color: #b8860b;">&lt;-</span> liftF <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff3</span> 3
   return a <span style="color: #b8860b;">+</span> b <span style="color: #b8860b;">+</span> c
</code></pre>

<p>
å±•å¼€ <code>fn1</code>
</p>

<pre class="code"><code><span style="color: #6a5acd;">program</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Roll</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff1</span> <span style="color: #00008b;">do</span>
   b <span style="color: #b8860b;">&lt;-</span> liftF <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff2</span> 2
   c <span style="color: #b8860b;">&lt;-</span> liftF <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff3</span> 3
   return 1 <span style="color: #b8860b;">+</span> b <span style="color: #b8860b;">+</span> c
</code></pre>


<p>
åŒæ ·çš„æ­¥éª¤å±•å¼€ Eff2
</p>
<pre class="code"><code><span style="color: #6a5acd;">program</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Roll</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff1</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Roll</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff2</span> <span style="color: #00008b;">do</span>
   c <span style="color: #b8860b;">&lt;-</span> liftF <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff3</span> 3
   return 1 <span style="color: #b8860b;">+</span> 2 <span style="color: #b8860b;">+</span> c
</code></pre>

<p>
å’Œ Eff3
</p>

<pre class="code"><code><span style="color: #6a5acd;">program</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Roll</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff1</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Roll</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff2</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Roll</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff3</span> <span style="color: #00008b;">do</span>
   return 1 <span style="color: #b8860b;">+</span> 2 <span style="color: #b8860b;">+</span> 3
</code></pre>

<p>
æœ€åçš„ program æ˜¯ä¸æ˜¯å¾ˆåƒ List çš„ Cons å’Œ Nil å‘¢?
</p>

<pre class="code"><code><span style="color: #6a5acd;">program</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Roll</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff1</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Roll</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff2</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Roll</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Eff3</span> <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Return</span> 1 <span style="color: #b8860b;">+</span> 2 <span style="color: #b8860b;">+</span> 3
</code></pre>


<p>
ä½†æ˜¯, ç»†å¿ƒçš„ä½ å¯èƒ½æ—©éƒ½å‘ç°äº† <code>Eff</code> è¿™è´§å¿…é¡»æ˜¯ä¸ª <code>Functor</code> æ‰è¡Œ. é‚£æˆ‘ä»¬å¦‚ä½•éšä¾¿å®šä¹‰ä¸€ä¸ª <code>data Eff</code> ç›´æ¥èƒ½ç”Ÿæˆ <code>Functor Eff</code> çš„å®ä¾‹å‘¢?
</p>
</div>
</div>

<div id="outline-container-orge26c319" class="outline-4">
<h4 id="orge26c319"><span class="section-number-4">3.6.2</span> Coyoneda</h4>
<div class="outline-text-4" id="text-3-6-2">
<p>
å¸Œæœ›ä½ è¿˜ä¾ç„¶è®°å¾—ç¬¬ä¸€éƒ¨åˆ†çš„ç±³ç”° <del>å…±</del> å¼•ç†
</p>

<pre class="code"><code><span style="color: #00008b;">data</span> <span style="color: #36648b;">CoYoneda</span> f a <span style="color: #b8860b;">=</span> forall b<span style="color: #b8860b;">.</span> <span style="color: #36648b;">CoYoneda</span> (b <span style="color: #b8860b;">-&gt;</span> a) (f b)
</code></pre>


<figure>
<img src="images/p3-CoYoneda.png" alt="p3-CoYoneda.png">

</figure>

<p>
äº‹å®ä¸Šå¾ˆç®€å•å¯ä»¥æŠŠä»»ä½• <code>f</code> å˜æˆ <code>CoYoneda f</code>
</p>

<pre class="code"><code><span style="color: #6a5acd;">phi</span> <span style="color: #b8860b;">::</span> f a <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">CoYoneda</span> f a
<span style="color: #6a5acd;">phi</span> fa <span style="color: #b8860b;">=</span> <span style="color: #36648b;">CoYoneda</span> id fa
</code></pre>


<figure>
<img src="images/p3-CoYoneda-phi.png" alt="p3-CoYoneda-phi.png">

</figure>

<p>
è¯€çªå°±æ˜¯ <code>id</code>, ä¹Ÿå°±æ˜¯ä½ æŠŠ <code>b</code> å˜æˆ <code>a</code>, å†æŠŠ <code>fa</code> æ”¾åˆ° <code>CoYoneda</code> é‡Œå°±å¥½äº†
</p>

<p>
å½“ <code>f</code> æ˜¯ <code>Functor</code> æ—¶, åˆå¯ä»¥æŠŠ <code>CoYoneda</code> å˜æˆ <code>f</code>
</p>

<pre class="code"><code><span style="color: #6a5acd;">psi</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Functor</span> f <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">CoYoneda</span> f a <span style="color: #b8860b;">-&gt;</span> f a
<span style="color: #6a5acd;">psi</span> (<span style="color: #36648b;">CoYoneda</span> g fa) <span style="color: #b8860b;">=</span> fmap g fa
</code></pre>


<figure>
<img src="images/p3-CoYoneda-psi.png" alt="p3-CoYoneda-psi.png">

</figure>

<p>
åè¿‡æ¥çš„è¿™ä¸ªä¸é‡è¦, é‡è¦çš„æ˜¯ <code>phi</code>, å› ä¸ºå¦‚æœä½ å¯ä»¥æŠŠä»»ä½• <code>f</code> å˜æˆ <code>CoYoneda f</code>, è€Œ <code>CoYoneda f</code> åˆæ˜¯ <code>Functor</code>,
æˆ‘ä»¬ä¸å°±å…è´¹å¾—åˆ°ä¸€ä¸ª <code>Functor</code>?
</p>

<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Functor</span> (<span style="color: #36648b;">Coyoneda</span> f) <span style="color: #00008b;">where</span>
  fmap f (<span style="color: #36648b;">Coyoneda</span> g fb) <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Coyoneda</span> (f <span style="color: #b8860b;">.</span> g) fb
</code></pre>
</div>
</div>

<div id="outline-container-orgded5027" class="outline-4">
<h4 id="orgded5027"><span class="section-number-4">3.6.3</span> Free Functor</h4>
<div class="outline-text-4" id="text-3-6-3">
<p>
æ¯”å¦‚æˆ‘ä»¬çš„ <code>Eff</code> å°±å¯ä»¥ç›´æ¥é€šè¿‡ <code>phi</code> å˜æˆ <code>CoYoneda Eff</code>, ä»è€Œå¾—åˆ°å…è´¹çš„ Functor
</p>

<pre class="code"><code><span style="color: #00008b;">data</span> <span style="color: #36648b;">Eff</span> a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Eff1</span> a <span style="color: #b8860b;">|</span> <span style="color: #36648b;">Eff2</span> a <span style="color: #b8860b;">|</span> <span style="color: #36648b;">Eff3</span> a
<span style="color: #6a5acd;">program</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Roll</span> (phi (<span style="color: #36648b;">Eff1</span> (<span style="color: #36648b;">Roll</span> (phi (<span style="color: #36648b;">Eff2</span> (<span style="color: #36648b;">Return</span> <span style="color: #36648b;">Int</span>))))))
</code></pre>


<figure>
<img src="images/p3-Free.png" alt="p3-Free.png">

</figure>
</div>
</div>

<div id="outline-container-org6a6fe6e" class="outline-4">
<h4 id="org6a6fe6e"><span class="section-number-4">3.6.4</span> Interpreter</h4>
<div class="outline-text-4" id="text-3-6-4">
<p>
æ„é€ å®Œä¸€ä¸ª free program å,æˆ‘ä»¬å¾—åˆ°çš„æ˜¯ä¸€ä¸ªåµŒå¥—çš„æ•°æ®ç»“æ„, å½“æˆ‘ä»¬éœ€è¦ run è¿™ä¸ª program æ—¶, æˆ‘ä»¬éœ€è¦ foldMap ä¸€ä¸ª
Interpreter å»ä¸€å±‚å±‚æ‹¨å¼€ è¿™ä¸ª free program.
</p>

<pre class="code"><code><span style="color: #6a5acd;">foldMap</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Monad</span> m <span style="color: #b8860b;">=&gt;</span> (<span style="color: #00008b;">forall</span> x <span style="color: #b8860b;">.</span> f x <span style="color: #b8860b;">-&gt;</span> m x) <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Free</span> f a <span style="color: #b8860b;">-&gt;</span> m a
<span style="color: #6a5acd;">foldMap</span> <span style="color: #00008b;">_</span> (<span style="color: #36648b;">Return</span> a)  <span style="color: #b8860b;">=</span> return a
<span style="color: #6a5acd;">foldMap</span> f (<span style="color: #36648b;">Roll</span> a) <span style="color: #b8860b;">=</span> f a <span style="color: #b8860b;">&gt;&gt;=</span> foldMap f
</code></pre>
</div>
</div>
</div>

<div id="outline-container-orgd2bf013" class="outline-3">
<h3 id="orgd2bf013"><span class="section-number-3">3.7</span> Free Monoid</h3>
</div>
<div id="outline-container-org1cda92c" class="outline-3">
<h3 id="org1cda92c"><span class="section-number-3">3.8</span> Eff</h3>
</div>

<div id="outline-container-orgc20f404" class="outline-3">
<h3 id="orgc20f404"><span class="section-number-3">3.9</span> Comonad</h3>
</div>
</div>

<div id="outline-container-orgc6d2063" class="outline-2">
<h2 id="orgc6d2063"><span class="section-number-2">4</span> References</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li><a href="http://dev.stephendiehl.com/hask">http://dev.stephendiehl.com/hask</a></li>
<li><a href="https://en.wikibooks.org/wiki/Haskell/Category_theory">https://en.wikibooks.org/wiki/Haskell/Category_theory</a></li>
<li><a href="https://www.youtube.com/watch?v=ZKmodCApZwk">https://www.youtube.com/watch?v=ZKmodCApZwk</a></li>
<li><a href="https://www.youtube.com/watch?v=kiXjcqxVogE&amp;list=PL50ABC4792BD0A086&amp;index=5">https://www.youtube.com/watch?v=kiXjcqxVogE&amp;list=PL50ABC4792BD0A086&amp;index=5</a></li>
<li><a href="https://wiki.haskell.org/All_About_Monads">https://wiki.haskell.org/All_About_Monads</a></li>
</ul>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="https://en.wikipedia.org/wiki/Cheshire_Cat">https://en.wikipedia.org/wiki/Cheshire_Cat</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
å¦‚æœæ²¡çœ‹å°±åˆšå¥½ä¸è¦çœ‹äº†, ç¡®å®æœ‰äº›è¯¯å¯¼
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara">
ç­‰ç­‰, å†™å‰ç«¯æ€ä¹ˆäº†? JavaScript åªæ˜¯æˆ‘è§‰å¾—é¡ºæ‰‹çš„è‹¥å¹²è¯­è¨€ä¹‹ä¸€, JSç”¨æˆ·é‚£ä¹ˆå¤š, å†™ä¹¦å½“ç„¶è¦ç”¨ JS å•¦, éš¾é“ç”¨ Idris é‚£è¿˜èƒ½å–å¾—æ‰å—? <del>å½“ç„¶æœ€åç”¨JSä¹Ÿæ²¡æ€ä¹ˆå–æ‰&#x2026;</del>
</p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4">4</a></sup> <div class="footpara"><p class="footpara">
å¹¶ä¸æ˜¯è¯´è¿™ä¸¤é—¨è¯­è¨€ä¸€å®šåœ¨é„™è§†é“¾é¡¶ç«¯, è€Œæ˜¯æ‹¥æœ‰å¼ºå¤§ç±»å‹ç³»ç»Ÿçš„è¯­è¨€æ‰èƒ½ä½“ç°å‡ºèŒƒç•´è®ºçš„å†…å®¹
</p></div></div>

<div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5">5</a></sup> <div class="footpara"><p class="footpara">
è¿™é‡Œå¯ä»¥æŠŠ Functor çš„ç¬¬ä¸€ç¬¬äºŒä¸ªå‚æ•°æ¶ˆæ‰, å› ä¸ºå·²ç»çŸ¥é“æ˜¯åœ¨ Hask èŒƒç•´äº†
</p></div></div>

<div class="footdef"><sup><a id="fn.6" class="footnum" href="#fnr.6">6</a></sup> <div class="footpara"><p class="footpara">
åˆ«æ€¥, åé¢é©¬ä¸Šè®²åˆ°
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<footer>
  <p>Author: æ¬§é˜³ç»§è¶… <a aria-label="Follow @jcouyang on GitHub" data-count-aria-label="# followers on GitHub" data-count-api="/users/jcouyang#followers" data-count-href="/jcouyang/followers" href="https://github.com/jcouyang" class="github-button">Follow @jcouyang</a></p>
  <p>Modified: 2019-03-27 Wed 06:03</p>
  <p>Generated by: <a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.1 (<a href="https://orgmode.org">Org</a> mode 9.2.2) &#215; <a href="https://github.com/jcouyang/orgpress">OrgPress</a></p>
  <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Unported License</a>.
  <input type="swiftype" class="st-default-search-input" placeholder="Search"/>
  <a class="gumroad-button" href="https://gum.co/grokking-monad?wanted=true" target="_blank" data-gumroad-single-product="true">èŒƒç•´è®ºè£…é€¼æŒ‡å—ï¼Œè¯·è‡ªè§‰æ’é˜Ÿè£…é€¼</a>
  <div id="danmaku-comments"></div>
  <div id="disqus_thread"></div>
</footer>
</div>
</body>
</html>
