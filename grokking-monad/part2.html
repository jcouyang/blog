<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2020-01-05 Sun 13:03 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>èŒƒç•´è®ºå®Œå…¨è£…é€¼æ‰‹å†Œ / Grokking Monad</title>
<meta name="generator" content="Org mode">
<meta name="author" content="æ¬§é˜³ç»§è¶…">
<meta name="description" content="å·äºŒ é£Ÿç”¨çŒ«å‘¢"
>
<link rel="icon" href="/favicon.ico">
<meta name="theme-color" content="#ffffff">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/toc.css"/>
<link rel="stylesheet" href="/style/tufte.css"/>
<link rel="alternate" type="application/rss+xml" title="Jichao Ouyang" href="https://feeds.oyanglul.us/JichaoOuyangsBlog"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJRFJGX"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<header>
    <a accesskey="h" href="/index.html"> HOME </a> |
    <a href="#" id="edit-in-github">EDIT</a> |
    <a href="https://feeds.oyanglul.us/JichaoOuyangsBlog">RSS</a> |
    <a href="https://blog.oyanglul.us/theindex">INDEX</a> |
    <a accesskey="H" href="/jichao.ouyang.html">ABOUT</a> |
    <a href="https://github.com/jcouyang/blog">GITHUB</a>
</header>
</div>
<div id="content">
<header>
<h1 class="title">èŒƒç•´è®ºå®Œå…¨è£…é€¼æ‰‹å†Œ / Grokking Monad</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org2b83b31">ç¬¬äºŒéƒ¨åˆ†ï¼š<ruby>é£Ÿç”¨çŒ«å‘¢<rt> Practical Monads</rt></ruby></a>
<ul>
<li><a href="#orgba82471">Identity æœ¬èº«å°±æœ‰</a></li>
<li><a href="#orgf8c951a">Maybe å¯èƒ½ä¼šæœ‰</a></li>
<li><a href="#org1c69b13">Either è¦ä¹ˆæœ‰è¦ä¹ˆæœ‰</a>
<ul>
<li><a href="#org17bfad6">Product &amp; Coproduct</a></li>
<li><a href="#orge19ba66">Either Monad</a></li>
</ul>
</li>
<li><a href="#orgec20723">Reader å·®ä¸€ç‚¹å°±æœ‰</a>
<ul>
<li><a href="#org59b28eb">do notation</a></li>
</ul>
</li>
<li><a href="#org7505ce4">Writer å…‰å‡ºè¿›æ²¡æœ‰</a></li>
<li><a href="#org30a3b76">State å˜åŒ–ä¼šæœ‰</a></li>
<li><a href="#org105da09">Validation æ£€æŸ¥æ£€æŸ¥</a>
<ul>
<li><a href="#org9f94784"><ruby>å«å¹ºåŠç¾¤<rt>Monoid</rt></ruby></a></li>
<li><a href="#orgd0bcad5">å›åˆ° Validation</a></li>
</ul>
</li>
<li><a href="#orgbfc4526">Cont æ¥ä¸‹æ¥æœ‰</a></li>
<li><a href="#org05e7f17">Summary</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li><a href="./part1.html">ç¬¬ä¸€éƒ¨åˆ†ï¼šèŒƒç•´è®º</a></li>
<li><b><a href="./part2.html">ç¬¬äºŒéƒ¨åˆ†ï¼šé£Ÿç”¨çŒ«å‘¢</a></b> ğŸ‘ˆ</li>
<li><a href="./part3.html">ç¬¬ä¸‰éƒ¨åˆ†ï¼šæåŸºçŒ«å‘¢</a></li>
</ul>

<div id="outline-container-org2b83b31" class="outline-2">
<h2 id="org2b83b31">ç¬¬äºŒéƒ¨åˆ†ï¼š<ruby>é£Ÿç”¨çŒ«å‘¢<rt> Practical Monads</rt></ruby></h2>
<div class="outline-text-2" id="text-org2b83b31">

<figure>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1c/Alice_through_the_looking_glass.jpg/761px-Alice_through_the_looking_glass.jpg" alt="761px-Alice_through_the_looking_glass.jpg">

</figure>

<div class="epigraph"><blockquote>
<p>
â€œIf I had a world of my own, everything would be nonsense. 
Nothing would be what it is, because everything would be what it isn't.
And contrary wise, what is, it wouldn't be. And what it wouldn't be, it would. You see?â€
â€• Lewis Carroll, Alice's Adventures in Wonderland &amp; Through the Looking-Glass 
</p>

</blockquote></div>

<p>
å¦‚æœæœ‰ä¸€ä¸ªå•å­çš„ä¸–ç•Œ, é‚£ä¸€åˆ‡éƒ½è¯´ä¸é€šäº†.
æ²¡æœ‰ä»€ä¹ˆæ˜¯åº”è¯¥çš„, å› ä¸ºæ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯å®ƒä¸æ˜¯çš„ä¸œè¥¿.
åè¿‡æ¥è¯´, æ˜¯åˆä¸ä¼šæ˜¯, è€Œä¸ä¼šæ˜¯çš„åˆä¼šæ˜¯. æ‡‚æ²¡?
</p>

<p>
åˆ°åº•ä»€ä¹ˆæ˜¯, ä»€ä¹ˆä¸æ˜¯, æˆ‘ä»¬çœ‹ç¼–ç¨‹ä¸–ç•Œé‡Œåˆ°åº•ä»€ä¹ˆæ˜¯å•å­ï¼Ÿ
</p>

<p>
è¿™ä¸€éƒ¨åˆ†å°†ä»‹ç»ç”±ä¸€äº›å®ç”¨çš„<ruby>å•å­å®ä¾‹<rt>monad instances</rt></ruby>ï¼Œé€šè¿‡è¿™äº›å•å­å®ä¾‹ï¼Œè§£å†³äº†åˆ†ç¦»è®¡ç®—ä¸å‰¯ä½œç”¨, å·²ç»ç»„åˆæ€§çš„é—®é¢˜ã€‚
</p>
</div>

<div id="outline-container-orgba82471" class="outline-3">
<h3 id="orgba82471">Identity æœ¬èº«å°±æœ‰<label for="1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="1" class="margin-toggle"/><span class="sidenote">
ä»æ¥æ²¡è§è¿‡æœ‰äººç»™è¿™äº›æ•°æ®ç±»å‹æŒ‰è¿‡ä¸­æ–‡åå­—, ä¸ç„¶æˆ‘æ¥, è¿™æ ·ä¹Ÿæ›´å¥½çš„ä½“ä¼šè¿™äº›æ•°æ®ç±»å‹çš„æ„å›¾.
</span></h3>
<div class="outline-text-3" id="text-orgba82471">
<p>
<ruby>æœ¬èº«å°±æœ‰å•å­<rt> Identity Monad</rt></ruby> å¯èƒ½æ˜¯æœ€ç®€å•çš„å•å­äº†ã€‚æœ¬èº«ä¸åŒ…å«ä»»ä½•è®¡ç®—, ä¸”åªæœ‰ä¸€ä¸ªæ„é€ å™¨:
</p>
<pre class="code"><code><span style="color: #00008b;">newtype</span> <span style="color: #36648b;">Identity</span> a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Identity</span> { runIdentity <span style="color: #b8860b;">::</span> a }
</code></pre>

<pre class="code"><code><span style="color: #00008b;">case</span> <span style="color: #00008b;">class</span> <span style="color: #36648b;">Identity</span>[<span style="color: #6b8e23;">A</span>](run<span style="color: #00008b;">:</span> <span style="color: #36648b;">A</span>)
</code></pre>

<p>
è¿™é‡Œä½¿ç”¨ <code>newtype</code> è€Œä¸æ˜¯ <code>data</code> æ˜¯å› ä¸º <code>Identity</code> ä¸ <code>runIdentity</code> æ˜¯åŒæ„çš„<label for="2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="2" class="margin-toggle"/><span class="sidenote">
è§ <a href="part1.html#orgf0aed70">ç¬¬ä¸€éƒ¨åˆ† ä¼´éšå‡½å­</a>
</span>.
</p>

<pre class="code"><code><span style="color: #36648b;">Identity</span> <span style="color: #b8860b;">::</span> a <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Identity</span> a
<span style="color: #6a5acd;">runIdentity</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Identity</span> a <span style="color: #b8860b;">-&gt;</span> a
</code></pre>

<p>
ä½ çœ‹ <code>runIdentity . Identity = id</code> ï¼Œæ‰€ä»¥ä»–ä»¬æ˜¯åŒæ„çš„ã€‚
</p>

<p>
å·¦è¾¹çš„ <code>Identity</code> æ˜¯ç±»å‹æ„é€ å™¨<label for="3" class="margin-toggle sidenote-number"></label><input type="checkbox" id="3" class="margin-toggle"/><span class="sidenote">
ä¹Ÿå°±æ˜¯ Kind * -&gt; *, å› ä¸ºå®ƒéå¸¸çš„ nice, ä¸€å®šè¦ç­‰åˆ° a æ‰å‡ºç±»å‹
</span>, æ¥æ”¶ç±»å‹ <code>a</code> è¿”å› <code>Identity a</code> ç±»å‹
</p>

<p>
å¦‚æœ a æ˜¯ Intï¼Œé‚£ä¹ˆå°±å¾—åˆ°ä¸€ä¸ª <code>Identity Int</code> ç±»å‹ã€‚
</p>

<p>
å³è¾¹çš„ <code>Identity</code> æ˜¯æ•°æ®æ„é€ å™¨ï¼Œä¹Ÿå°±æ˜¯æ„é€ å€¼ï¼Œæ¯”å¦‚ <code>Identity 1</code> ä¼šæ„é€ å‡ºä¸€ä¸ªå€¼ï¼Œå…¶ç±»å‹ä¸º <code>Identity Int</code>
</p>

<p>
å¤§æ‹¬å·æ¯”è¾ƒè¯¡å¼‚ï¼Œå¯ä»¥æƒ³è±¡æˆç»™ <code>a</code> ä¸€ä¸ª keyï¼ŒåŒè¿‡è¿™ä¸ª key å¯ä»¥æŠŠ a å–å‡ºæ¥ï¼Œæ¯”å¦‚
</p>
<pre class="code"><code><span style="color: #6a5acd;">runIdentity</span> (<span style="color: #36648b;">Identity</span> 1)
</code></pre>

<pre class="code"><code><span style="color: #6b8e23;">Identity</span>(<span style="color: #6b8e23;">1</span>).run
</code></pre>

<p>
ä¼šè¿”å› 1
</p>

<p>
Identity å¯ä»¥å®ç° Functor å’Œ Monadï¼Œå°±å¾—åˆ° Identity functor å’Œ Identity monad:
</p>

<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Functor</span> <span style="color: #36648b;">Identity</span> <span style="color: #00008b;">where</span>
  fmap f (<span style="color: #36648b;">Identity</span> a) <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Identity</span> (f a)

<span style="color: #00008b;">instance</span> <span style="color: #36648b;">Monad</span> <span style="color: #36648b;">Identity</span> <span style="color: #00008b;">where</span>
  return a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Identity</span> a
  <span style="color: #36648b;">Identity</span> a <span style="color: #b8860b;">&gt;&gt;=</span> f <span style="color: #b8860b;">=</span> f a
</code></pre>

<p>
è€Œ Scala åˆ™éœ€è¦ç”¨ <code>implicit</code> æ¥å®ç° typeclass:
</p>

<pre class="code"><code><span style="color: #228b22;">implicit</span> <span style="color: #00008b;">val</span> <span style="color: #b8860b;">identityFunctor</span><span style="color: #00008b;">:</span> <span style="color: #36648b;">Functor</span>[<span style="color: #6b8e23;">Identity</span>] <span style="color: #00008b;">=</span> <span style="color: #00008b;">new</span> <span style="color: #36648b;">Functor</span>[<span style="color: #6b8e23;">Identity</span>] {
  <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">fmap</span>[<span style="color: #6b8e23;">A</span>, <span style="color: #6b8e23;">B</span>](f<span style="color: #00008b;">:</span> <span style="color: #36648b;">A</span> <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">B</span>)<span style="color: #00008b;">:</span> <span style="color: #36648b;">Identity</span>[<span style="color: #6b8e23;">A</span>] <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">Identity</span>[<span style="color: #6b8e23;">B</span>] <span style="color: #00008b;">=</span> {
    <span style="color: #00008b;">case</span> <span style="color: #36648b;">Identity</span>(<span style="color: #b8860b;">a</span>) <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">Identity</span>(f(a))
  }
}

<span style="color: #228b22;">implicit</span> <span style="color: #00008b;">val</span> <span style="color: #b8860b;">identityMonad</span><span style="color: #00008b;">:</span> <span style="color: #36648b;">Monad</span>[<span style="color: #6b8e23;">Identity</span>] <span style="color: #00008b;">=</span> <span style="color: #00008b;">new</span> <span style="color: #36648b;">Monad</span>[<span style="color: #6b8e23;">Identity</span>] {
  <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">pure</span>[<span style="color: #6b8e23;">A</span>](a<span style="color: #00008b;">:</span> <span style="color: #36648b;">A</span>)<span style="color: #00008b;">:</span> <span style="color: #36648b;">Id</span>[<span style="color: #6b8e23;">A</span>] <span style="color: #00008b;">=</span> <span style="color: #6b8e23;">Identity</span>(a)
  <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">flatMap</span>[<span style="color: #6b8e23;">A</span>, <span style="color: #6b8e23;">B</span>](f<span style="color: #00008b;">:</span> <span style="color: #36648b;">A</span> <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">Identity</span>[<span style="color: #6b8e23;">B</span>])<span style="color: #00008b;">:</span> <span style="color: #36648b;">Identity</span>[<span style="color: #6b8e23;">A</span>] <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">Identity</span>[<span style="color: #6b8e23;">B</span>] <span style="color: #00008b;">=</span> {
    <span style="color: #00008b;">case</span> <span style="color: #36648b;">Identity</span>(<span style="color: #b8860b;">a</span>) <span style="color: #00008b;">=&gt;</span> f(a)
  }
}
</code></pre>

<p>
å¯ä»¥çœ‹åˆ° Identity å³æ˜¯<ruby>æ„é€ å™¨<rt>constructor</rt></ruby>ï¼Œä¹Ÿæ˜¯<ruby>è§£æ„å™¨<rt>destructure</rt></ruby>ï¼Œåˆ©ç”¨æ¨¡å¼åŒ¹é…æ˜¯å¯ä»¥è§£æ„å‡ºå€¼çš„ã€‚
</p>

<p>
ä¾‹å¦‚ä¸Šé¢ Functor å®ç°ä¸­çš„ <code>fmap f (Identity a)</code>, å‡å¦‚ <code>fmap</code> çš„æ˜¯ <code>Identity 1</code>,
é‚£ä¹ˆè¿™ä¸ªæ¨¡å¼åŒ¹é…åˆ° <code>(Identity a)</code> æ—¶ä¼šé€šè¿‡è§£æ„å™¨æŠŠ <code>1</code> æ”¾åˆ° <code>a</code> çš„ä½ç½®ã€‚
</p>

<p>
Identity çœ‹èµ·æ¥ä»€ä¹ˆä¹Ÿæ²¡æœ‰å¹²ï¼Œå°±è·Ÿ identity å‡½æ•°ä¸€æ ·ï¼Œä½†æ˜¯å®é™…ä¸Š, å®ƒä¹Ÿè·Ÿ identity ç›¸å¯¹äºå‡½æ•°ä¸€æ ·
ç›¸å¯¹äºç±»å‹éå¸¸æœ‰ç”¨.
</p>
</div>
</div>

<div id="outline-container-orgf8c951a" class="outline-3">
<h3 id="orgf8c951a">Maybe å¯èƒ½ä¼šæœ‰</h3>
<div class="outline-text-3" id="text-orgf8c951a">
<p>
<ruby>å¯èƒ½ä¼šæœ‰å•å­<rt>Maybe Monad</rt></ruby>æ˜¯ä¸€ä¸ªè¶…çº§ç®€å•çš„ä½†æ¯”æœ¬èº«å°±æœ‰ç¨ç¨å¤æ‚çš„å•å­.
</p>

<p>
å› ä¸ºå®ƒæ‹¥æœ‰æ¯”æœ¬èº«å°±æœ‰å¤šä¸€ä¸ªçš„ç±»å‹æ„é€ å™¨ï¼Œç±»ä¼¼è¿™æ ·çš„å«åš <ruby>ä»£æ•°æ•°æ®ç±»å‹<rt> Algebra Data Type(ADT)</rt></ruby>
</p>

<pre class="code"><code><span style="color: #00008b;">data</span> <span style="color: #36648b;">Maybe</span> a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Just</span> a <span style="color: #b8860b;">|</span> <span style="color: #36648b;">Nothing</span>
</code></pre>

<p>
ä½ çœ‹, ä¸ç®¡æ˜¯ <code>Just</code> è¿˜æ˜¯ <code>Nothing</code> éƒ½å¯ä»¥æ„é€ å‡ºä¸€ä¸ª <code>Maybe</code> ç±»å‹çš„æ•°æ®æ¥.
</p>

<p>
ADT åœ¨ Scala å¯ä»¥ç”¨ trait è¡¨ç¤º, è€Œä¸”, Scala ä¸­çš„ <code>Maybe</code> å«åš <code>Option</code>:
</p>

<pre class="code"><code><span style="color: #00008b;">trait</span> <span style="color: #36648b;">Option</span>[+<span style="color: #6b8e23;">A</span>]
<span style="color: #00008b;">case</span> <span style="color: #00008b;">class</span> <span style="color: #36648b;">Some</span>[<span style="color: #6b8e23;">A</span>](a<span style="color: #00008b;">:</span> <span style="color: #36648b;">A</span>) <span style="color: #00008b;">extends</span> <span style="color: #36648b;">Option</span>[<span style="color: #6b8e23;">A</span>]
<span style="color: #00008b;">case</span> <span style="color: #00008b;">object</span> <span style="color: #6b8e23;">None</span> <span style="color: #00008b;">extends</span> <span style="color: #36648b;">Option</span>[<span style="color: #6b8e23;">Nothing</span>]
</code></pre>

<p>
Haskell ä¸­å®šä¹‰ä¸€ä¸ª ADT ååˆ†ç®€å•ï¼Œä¸åƒ Scala é‚£ä¹ˆå•°å—¦ã€‚å·¦è¾¹æ˜¯ç±»å‹æ„é€ å™¨ï¼Œå³è¾¹æœ‰æ•°æ®æ„é€ å™¨ï¼Œä½ ä¼šå‘ç°æœ‰ä¸€æ ¹ç«–çº¿ <code>|</code> ï¼Œ å®ƒåˆ†éš”ç€ä¸¤ä¸ªæ„é€ å™¨
</p>
<ul class="org-ul">
<li><code>Just</code></li>
<li><code>Nothing</code></li>
</ul>

<p>
å…¶ä¸­ <code>a</code> <label for="4" class="margin-toggle sidenote-number"></label><input type="checkbox" id="4" class="margin-toggle"/><span class="sidenote">
ä¸€å®šè¦è®°å¾—å°å†™å“¦
</span>è¡¨ç¤ºæ˜¯ä»»æ„ç±»å‹.
</p>

<p>
æ‰€ä»¥ <code>Just 1</code> ä¼šå¾—åˆ°ä¸€ä¸ª <code>Num a =&gt; Mabye a</code> ç±»å‹<label for="5" class="margin-toggle sidenote-number"></label><input type="checkbox" id="5" class="margin-toggle"/><span class="sidenote">
æ„æ€å°±æ˜¯ <code>Maybe a</code> ä½†æ˜¯ <code>a</code> çš„ç±»å‹çº¦æŸä¸º <code>Num</code>
</span>ï¼Œ
<code>Nothing</code> ä¹Ÿä¼šå¾—åˆ°ä¸€ä¸ª <code>Maybe a</code> åªä¸è¿‡ <code>a</code> æ²¡æœ‰ç±»å‹çº¦æŸã€‚
</p>

<p>
æ€»ä¹‹æˆ‘ä»¬æœ‰äº†æ„é€ å™¨å¯ä»¥æ„é€ å‡º <code>Maybe</code> ç±»å‹ï¼Œè€Œè¿™ä¸ªç±»å‹èƒ½åšçš„äº‹æƒ…ï¼Œå°±è¦å–å†³å®ƒå®ç°äº†å“ªäº› typeclass çš„ instance äº†ã€‚æ¯”å¦‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‡½å­.
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Functor</span> <span style="color: #36648b;">Maybe</span> <span style="color: #00008b;">where</span>
  fmap f (<span style="color: #36648b;">Just</span> a) <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Just</span> (f a)
  fmap f <span style="color: #36648b;">Nothing</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Nothing</span>
</code></pre>

<pre class="code"><code><span style="color: #228b22;">implicit</span> <span style="color: #00008b;">val</span> <span style="color: #b8860b;">optionFunctor</span><span style="color: #00008b;">:</span> <span style="color: #36648b;">Functor</span>[<span style="color: #6b8e23;">Option</span>] <span style="color: #00008b;">=</span> <span style="color: #00008b;">new</span> <span style="color: #36648b;">Functor</span>[<span style="color: #6b8e23;">Option</span>] {
  <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">fmap</span>[<span style="color: #6b8e23;">A</span>, <span style="color: #6b8e23;">B</span>](f<span style="color: #00008b;">:</span> <span style="color: #36648b;">A</span> <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">B</span>)<span style="color: #00008b;">:</span> <span style="color: #36648b;">Option</span>[<span style="color: #6b8e23;">A</span>] <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">Option</span>[<span style="color: #6b8e23;">B</span>] <span style="color: #00008b;">=</span> {
    <span style="color: #00008b;">case</span> <span style="color: #36648b;">Some</span>(<span style="color: #b8860b;">a</span>) <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">Some</span>(f(a))
    <span style="color: #00008b;">case</span> <span style="color: #6b8e23;">None</span> <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">None</span>
  }
}
</code></pre>


<figure>
<img src="images/p2-maybe-functor.png" alt="p2-maybe-functor.png">

<figcaption><span class="figure-number">Figure 2: </span>fmap :: (a -&gt; b) -&gt; f a -&gt; f b</figcaption>
</figure>

<p>
çœ‹æ¸…æ¥šäº†, è™šçº¿ç®­å¤´å³ <code>fmap</code>, å›¾ä¸Šè¡¨ç¤ºçš„ <code>fmap</code> æ˜¯ <code>(a -&gt; b) - - -&gt; (Maybe a -&gt; Maybe b)</code> ç”±äºè¿™é‡Œçš„ç®­å¤´éƒ½æ˜¯åœ¨ <code>-&gt;</code> èŒƒç•´, æ‰€ä»¥ <code>- - -&gt;</code> å°±æ˜¯ <code>-&gt;</code> äº†.
</p>

<p>
å³: <code>fmap :: (a -&gt; b) -&gt; f a -&gt; f b</code>
</p>

<p>
ä¸ä»…å¦‚æ­¤ï¼Œè¿˜å¯ä»¥å®ç°å•å­:
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Monad</span> <span style="color: #36648b;">Maybe</span> <span style="color: #00008b;">where</span>
  return a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Just</span> a
  (<span style="color: #36648b;">Just</span> a) <span style="color: #b8860b;">&gt;&gt;=</span> f <span style="color: #b8860b;">=</span> f a
  <span style="color: #36648b;">Nothing</span> <span style="color: #b8860b;">&gt;&gt;=</span> f <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Nothing</span>
</code></pre>

<pre class="code"><code><span style="color: #228b22;">implicit</span> <span style="color: #00008b;">val</span> <span style="color: #b8860b;">optionMonad</span><span style="color: #00008b;">:</span> <span style="color: #36648b;">Monad</span>[<span style="color: #6b8e23;">Option</span>] <span style="color: #00008b;">=</span> <span style="color: #00008b;">new</span> <span style="color: #36648b;">Monad</span>[<span style="color: #6b8e23;">Option</span>] {
  <span style="color: #00008b;">def</span> <span style="color: #6a5acd;">flatMap</span>[<span style="color: #6b8e23;">A</span>, <span style="color: #6b8e23;">B</span>](f<span style="color: #00008b;">:</span> <span style="color: #36648b;">A</span> <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">Option</span>[<span style="color: #6b8e23;">B</span>])<span style="color: #00008b;">:</span> <span style="color: #36648b;">Option</span>[<span style="color: #6b8e23;">A</span>] <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">Option</span>[<span style="color: #6b8e23;">B</span>] <span style="color: #00008b;">=</span> {
    <span style="color: #00008b;">case</span> <span style="color: #36648b;">Some</span>(<span style="color: #b8860b;">a</span>) <span style="color: #00008b;">=&gt;</span> f(a)
    <span style="color: #00008b;">case</span> <span style="color: #6b8e23;">None</span> <span style="color: #00008b;">=&gt;</span> <span style="color: #6b8e23;">None</span>
  }
}
</code></pre>


<figure>
<img src="images/p2-maybe-kleisli.png" alt="p2-maybe-kleisli.png">

<figcaption><span class="figure-number">Figure 3: </span>è¿˜è®°å¾—ç¬¬ä¸€éƒ¨åˆ†æåˆ°çš„ Kleisli èŒƒç•´å—ï¼Ÿ</figcaption>
</figure>

<p>
Maybe æœ‰ç”¨åœ¨äºèƒ½åˆé€‚çš„å¤„ç† <i><ruby>åå‡½æ•°<rt> Partial Function</rt></ruby></i> çš„è¿”å›å€¼ã€‚
åå‡½æ•°ç›¸å¯¹äº <i><ruby>å…¨å‡½æ•°<rt> Total Function</rt></ruby></i> æ˜¯æŒ‡åªèƒ½å¯¹éƒ¨åˆ†è¾“å…¥è¿”å›è¾“å‡ºçš„å‡½æ•°ã€‚
</p>

<p>
æ¯”å¦‚ä¸€ä¸ªå–æ•°ç»„æŸä¸€ä½ä¸Šçš„å€¼çš„å‡½æ•°ï¼Œå°±æ˜¯åå‡½æ•°ï¼Œå› ä¸ºå‡è®¾ä½ æƒ³å–ç¬¬4ä½çš„å€¼ï¼Œä½†ä¸æ˜¯æ‰€æœ‰æ•°ç»„é•¿åº¦éƒ½å¤§äº4ï¼Œå°±ä¼šæœ‰è·å–ä¸äº†çš„å°´å°¬æƒ…å†µã€‚
</p>
<pre class="code"><code>[1,2,3] <span style="color: #b8860b;">!!</span> 4
</code></pre>

<pre class="code"><code><span style="color: #6b8e23;">List</span>(<span style="color: #6b8e23;">1</span>,<span style="color: #6b8e23;">2</span>,<span style="color: #6b8e23;">3</span>).get(<span style="color: #6b8e23;">4</span>)
</code></pre>

<p>
å¦‚æœä½¿ç”¨ Maybe æŠŠåå‡½æ•°å¤„ç†ä¸äº†çš„è¾“å…¥éƒ½è¿”å›æˆ Nothingï¼Œè¿™æ ·ç»“æœä¾ç„¶ä¿æŒ Maybe ç±»å‹ï¼Œä¸å½±å“åé¢çš„è®¡ç®—ã€‚
</p>
</div>
</div>

<div id="outline-container-org1c69b13" class="outline-3">
<h3 id="org1c69b13">Either è¦ä¹ˆæœ‰è¦ä¹ˆæœ‰</h3>
<div class="outline-text-3" id="text-org1c69b13">
<p>
Either çš„å®šä¹‰ä¹Ÿå¾ˆç®€å•
</p>
<pre class="code"><code><span style="color: #00008b;">data</span> <span style="color: #36648b;">Either</span> a b <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Left</span> a <span style="color: #b8860b;">|</span> <span style="color: #36648b;">Right</span> b
</code></pre>

<pre class="code"><code><span style="color: #00008b;">trait</span> <span style="color: #36648b;">Either</span>[+<span style="color: #6b8e23;">A</span>, +<span style="color: #6b8e23;">B</span>]
<span style="color: #00008b;">case</span> <span style="color: #00008b;">class</span> <span style="color: #36648b;">Left</span>[+<span style="color: #6b8e23;">A</span>, +<span style="color: #6b8e23;">B</span>](a<span style="color: #00008b;">:</span> <span style="color: #36648b;">A</span>) <span style="color: #00008b;">extends</span> <span style="color: #36648b;">Either</span>[<span style="color: #6b8e23;">A</span>, <span style="color: #6b8e23;">B</span>]
<span style="color: #00008b;">case</span> <span style="color: #00008b;">class</span> <span style="color: #36648b;">Right</span>[+<span style="color: #6b8e23;">A</span>, +<span style="color: #6b8e23;">B</span>](b<span style="color: #00008b;">:</span> <span style="color: #36648b;">B</span>) <span style="color: #00008b;">extends</span> <span style="color: #36648b;">Either</span>[<span style="color: #6b8e23;">A</span>, <span style="color: #6b8e23;">B</span>]
</code></pre>
</div>


<div id="outline-container-org17bfad6" class="outline-4">
<h4 id="org17bfad6">Product &amp; Coproduct</h4>
<div class="outline-text-4" id="text-org17bfad6">
<p>
çœ‹è¿‡ç¬¬ä¸€éƒ¨åˆ†åº”è¯¥è¿˜èƒ½è®°å¾—æœ‰ä¸€ä¸ªä¸œè¥¿å« Duelï¼Œæ‰€ä»¥è§åˆ°å¦‚æœèŒƒç•´ä¸Šæœ‰ Coproduct é‚£ä¹ˆè‚¯å®šåœ¨duelèŒƒç•´ä¸Šä¼šæœ‰åŒæ ·çš„ä¸œè¥¿å« Productã€‚
</p>

<p>
é‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯ Coproduct
</p>


<figure>
<img src="images/p2-coproduct.png" alt="p2-coproduct.png">

<figcaption><span class="figure-number">Figure 4: </span>Coproduct</figcaption>
</figure>

<p>
åƒè¿™æ ·ï¼Œèƒ½é€šè¿‡ä¸¤ä¸ªç®­å¤´åˆ°è¾¾åŒä¸€ä¸ªä¸œè¥¿ï¼Œå°±æ˜¯ Coproductã€‚è¿™é‡Œç®­å¤´ <code>Left</code> èƒ½è®© <code>a</code> åˆ° <code>Either a b</code> ï¼Œ ç®­å¤´ <code>Right</code> ä¹Ÿèƒ½è®© <code>b</code> åˆ°è¾¾ <code>Either a b</code>
</p>

<p>
æœ‰æ„æ€çš„æ˜¯è¿˜è‚¯å®šå­˜åœ¨ä¸€ä¸ª Coproduct å’Œ ç®­å¤´ï¼Œä½¿å¾—ä¸‹å›¾æˆç«‹
<img src="images/p2-coproduct-law.png" alt="p2-coproduct-law.png">
</p>

<p>
ç®­å¤´åè¿‡æ¥ï¼Œå°±æ˜¯ Product, æ¯”å¦‚ Tuple
</p>


<figure>
<img src="images/p2-product.png" alt="p2-product.png">

<figcaption><span class="figure-number">Figure 5: </span>Product</figcaption>
</figure>

<p>
Tuple çš„ <code>fst</code> ç®­å¤´èƒ½è®© <code>(a, b)</code> åˆ°è¾¾ <code>a</code> å¯¹è±¡ï¼Œè€Œç®­å¤´ <code>snd</code> èƒ½è®©å…¶åˆ°è¾¾ <code>b</code> å¯¹è±¡ã€‚
</p>
</div>
</div>

<div id="outline-container-orge19ba66" class="outline-4">
<h4 id="orge19ba66">Either Monad</h4>
<div class="outline-text-4" id="text-orge19ba66">
<p>
ç¡®åˆ‡çš„è¯´ï¼ŒEither ä¸æ˜¯ monadï¼Œ <code>Either a</code> æ‰æ˜¯ã€‚è¿˜è®°å¾— monad çš„ class å®šä¹‰å—ï¼Ÿ
</p>
<pre class="code"><code><span style="color: #00008b;">class</span> <span style="color: #36648b;">Endofunctor</span> m <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">Monad</span> m <span style="color: #00008b;">where</span>
  eta <span style="color: #b8860b;">::</span> a <span style="color: #b8860b;">-&gt;</span> (m a)
  mu <span style="color: #b8860b;">::</span> m m a <span style="color: #b8860b;">-&gt;</span> m a
</code></pre>
<p>
æ‰€ä»¥ m å¿…é¡»æ˜¯ä¸ª Endofunctorï¼Œä¹Ÿå°±æ˜¯è¦æ»¡è¶³ Functor
</p>
<pre class="code"><code><span style="color: #00008b;">class</span> <span style="color: #36648b;">Functor</span> t <span style="color: #00008b;">where</span>
  fmap <span style="color: #b8860b;">::</span> (a <span style="color: #b8860b;">-&gt;</span> b) <span style="color: #b8860b;">-&gt;</span> (t a <span style="color: #b8860b;">-&gt;</span> t b)
</code></pre>
<p>
t a çš„ kind æ˜¯ *ï¼Œæ‰€ä»¥ t å¿…é¡»æ˜¯ kind * -&gt; *
ä¹Ÿå°±æ˜¯è¯´ï¼Œm å¿…é¡»æ˜¯æ¥æ”¶ä¸€ä¸ªç±»å‹å‚æ•°çš„ç±»å‹æ„é€ å™¨
</p>

<p>
è€Œ Either çš„ kind æ˜¯ * -&gt; * -&gt; *, Either a æ‰æ˜¯ * -&gt; *
</p>

<p>
æ‰€ä»¥åªèƒ½å®šä¹‰ Either a çš„ Monad
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Monad</span> (<span style="color: #36648b;">Either</span> a) <span style="color: #00008b;">where</span>
  <span style="color: #36648b;">Left</span>  l <span style="color: #b8860b;">&gt;&gt;=</span> <span style="color: #00008b;">_</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Left</span> l
  <span style="color: #36648b;">Right</span> r <span style="color: #b8860b;">&gt;&gt;=</span> k <span style="color: #b8860b;">=</span> k r
</code></pre>

<p>
å¾ˆæ˜æ˜¾çš„ï¼Œ&gt;&gt;= ä»»ä½•å‡½æ•°åˆ°<ruby>å·¦è¾¹<rt> Left</rt></ruby> éƒ½ä¸ä¼šæ”¹å˜ï¼Œåªæœ‰ &gt;&gt;= å³è¾¹æ‰èƒ½äº§ç”Ÿæ–°çš„è®¡ç®—ã€‚
</p>
</div>
</div>
</div>


<div id="outline-container-orgec20723" class="outline-3">
<h3 id="orgec20723">Reader å·®ä¸€ç‚¹å°±æœ‰</h3>
<div class="outline-text-3" id="text-orgec20723">
<p>
Reader çš„ä½œç”¨æ˜¯ç»™ä¸€ä¸ªè®¡ç®—å–‚æ•°æ®ã€‚
</p>

<p>
åœ¨æè¿°è®¡ç®—çš„æ—¶å€™ï¼Œå¹¶ä¸éœ€è¦å…³å¿ƒè¾“å…¥æ—¶ä»€ä¹ˆï¼Œåªéœ€è¦ asks å°±å¯ä»¥æ‹¿åˆ°è¾“å…¥å€¼
</p>

<p>
è€ŒçœŸæ­£çš„è¾“å…¥ï¼Œä¼šåœ¨è¿è¡Œè®¡ç®—æ—¶ç»™äºˆã€‚
</p>

<p>
è·Ÿ Identity ä¸€æ ·ï¼Œæˆ‘ä»¬ç”¨ newtype æ¥å®šä¹‰ä¸€ä¸ªåŒæ„çš„ Reader ç±»å‹
</p>
<pre class="code"><code><span style="color: #00008b;">newtype</span> <span style="color: #36648b;">Reader</span> e a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Reader</span> { runReader <span style="color: #b8860b;">::</span> (e <span style="color: #b8860b;">-&gt;</span> a) }
</code></pre>

<p>
å…¶ä¸­
</p>
<ul class="org-ul">
<li>e æ˜¯è¾“å…¥</li>
<li>a æ˜¯ç»“æœ</li>
<li>æ„é€  Reader ç±»å‹éœ€è¦ç¡®å®š è¾“å…¥çš„ç±»å‹ e ä¸è¾“å‡ºçš„ç±»å‹ a</li>
<li><code>runReader</code> çš„ç±»å‹æ˜¯ <code>runReader:: (Reader e a) -&gt; (e -&gt; a)</code></li>
</ul>

<p>
ä¹Ÿå°±æ˜¯è¯´åœ¨æè¿°å®Œä¸€ä¸ª Reader çš„è®¡ç®—åï¼Œä½¿ç”¨ runReader å¯ä»¥å¾—åˆ°ä¸€ä¸ª e -&gt; a çš„å‡½æ•°ï¼Œä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œå°±å¯ä»¥æ¥æ”¶è¾“å…¥ï¼Œé€šè¿‡æ„é€ å¥½çš„è®¡ç®—ï¼Œç®—å‡ºç»“æœ a è¿”å›ã€‚
</p>

<p>
é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬æ¥å®ç° Reader çš„ monad instanceï¼Œå°±å¯ä»¥æè¿°ä¸€ä¸ªå¯ä»¥ ask çš„è®¡ç®—äº†ã€‚
</p>

<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Monad</span> (<span style="color: #36648b;">Reader</span> e) <span style="color: #00008b;">where</span>
    return a         <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Reader</span> <span style="color: #b8860b;">$</span> <span style="color: #b8860b;">\</span><span style="color: #00008b;">_</span> <span style="color: #b8860b;">-&gt;</span> a
    (<span style="color: #36648b;">Reader</span> g) <span style="color: #b8860b;">&gt;&gt;=</span> f <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Reader</span> <span style="color: #b8860b;">$</span> <span style="color: #b8860b;">\</span>e <span style="color: #b8860b;">-&gt;</span> runReader (f (g e)) e
</code></pre>

<p>
è·ŸEitherä¸€æ ·ï¼Œæˆ‘ä»¬åªèƒ½å®šä¹‰ Reader e çš„ monad instanceã€‚
</p>

<p>
æ³¨æ„è¿™é‡Œçš„
</p>
<ul class="org-ul">
<li>f ç±»å‹æ˜¯ <code>(a -&gt; Reader e a)</code></li>
<li>g å…¶å®å°±æ˜¯æ˜¯ destructure å‡ºæ¥çš„ runReaderï¼Œä¹Ÿå°±æ˜¯ e -&gt; a</li>
<li>æ‰€ä»¥ (g e) è¿”å› a</li>
<li>f (g e) å°±æ˜¯ <code>Reader e a</code></li>
<li>å† run ä¸€æŠŠæœ€åå¾—åˆ° a</li>
</ul>


<figure>
<img src="images/p2-reader-monad.png" alt="p2-reader-monad.png">

<figcaption><span class="figure-number">Figure 6: </span>f å‡½æ•°ï¼Œæ¥æ”¶ a è¿”å›ä¸€ä¸ª ä» e åˆ° a çš„ Reader</figcaption>
</figure>

<p>
è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Reader
</p>
<pre class="code"><code><span style="color: #00008b;">import</span> <span style="color: #36648b;">Control.Monad.Reader</span>

<span style="color: #00008b;">data</span> <span style="color: #36648b;">Environment</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Env</span>
  { fistName <span style="color: #b8860b;">::</span> <span style="color: #36648b;">String</span>
  , lastName <span style="color: #b8860b;">::</span> <span style="color: #36648b;">String</span>
  } <span style="color: #00008b;">deriving</span> (<span style="color: #36648b;">Show</span>)

<span style="color: #6a5acd;">helloworld</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Reader</span> <span style="color: #36648b;">Environment</span> <span style="color: #36648b;">String</span>
<span style="color: #6a5acd;">helloworld</span> <span style="color: #b8860b;">=</span> <span style="color: #00008b;">do</span>
  f <span style="color: #b8860b;">&lt;-</span> asks firstName
  l <span style="color: #b8860b;">&lt;-</span> asks lastName
  return <span style="color: #8b0000;">"Hello "</span> <span style="color: #b8860b;">++</span> f <span style="color: #b8860b;">++</span> l

<span style="color: #6a5acd;">runHelloworld</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">String</span>
<span style="color: #6a5acd;">runHelloworld</span> <span style="color: #b8860b;">=</span> runReader helloworld <span style="color: #b8860b;">$</span> <span style="color: #36648b;">Env</span> <span style="color: #8b0000;">"Jichao"</span> <span style="color: #8b0000;">"Ouyang"</span>
</code></pre>

<p>
è¿™æ®µä»£ç å¾ˆç®€å•ï¼Œhelloworld è´Ÿè´£æ‰“æ‹›å‘¼ï¼Œä¹Ÿå°±æ˜¯åœ¨åå­—å‰é¢åŠ ä¸ª "Hello"ï¼Œè€Œè·Ÿè°æ‰“æ‹›å‘¼ï¼Œè¿™ä¸ªå‡½æ•°å¹¶ä¸å…³å¿ƒï¼Œè€Œå•çº¯çš„æ˜¯å‘ Environment <ruby>é—®<rt>asks</rt></ruby> å°±å¥½ã€‚
</p>


<figure>
<img src="images/p2-reader-monad-ask.png" alt="p2-reader-monad-ask.png">

<figcaption><span class="figure-number">Figure 7: </span>asks å¯ä»¥å°† e -&gt; a çš„å‡½æ•°å˜æ¢æˆ Reader e a</figcaption>
</figure>

<p>
åœ¨è¿è¡Œæ—¶ï¼Œå¯ä»¥æä¾›ç»™ Reader çš„è¾“å…¥ Env fistname lastnameã€‚
<img src="images/p2-reader-monad-run.png" alt="p2-reader-monad-run.png">
</p>
</div>

<div id="outline-container-org59b28eb" class="outline-4">
<h4 id="org59b28eb">do notation</h4>
<div class="outline-text-4" id="text-org59b28eb">
<p>
è¿™å¯èƒ½æ˜¯ä½ ç¬¬ä¸€æ¬¡è§åˆ° <code>do</code> å’Œ <code>&lt;-</code>. å¦‚æœä¸æ˜¯ï¼Œéšæ„è·³è¿‡è¿™èŠ‚ã€‚
</p>

<ul class="org-ul">
<li>do ä¸­æ‰€æœ‰ &lt;- çš„å³è¾¹éƒ½æ˜¯ <code>Reader Environment String</code> ç±»å‹</li>
<li>do ä¸­çš„ return è¿”å›ç±»å‹ä¹Ÿå¿…é¡»ä¸º  <code>Reader Environment String</code></li>
<li><code>asks firstName</code> è¿”å›çš„æ˜¯ <code>Reader Environment String</code> ç±»å‹ï¼Œ <code>&lt;-</code> å¯ä»¥ç†è§£æˆå§ monad <code>Reader Environment</code> çš„å†…å®¹æ”¾åˆ°å·¦è¾¹çš„ f, æ‰€ä»¥ f çš„ç±»å‹æ˜¯ Stringã€‚</li>
</ul>

<p>
çœ‹èµ·æ¥åƒå‘½ä»¤å¼çš„è¯­å¥ï¼Œå…¶å®åªæ˜¯ <code>&gt;&gt;=</code> çš„è¯­æ³•ç³–ï¼Œä½†æ˜¯æ˜æ˜¾ç”¨doå¯è¯»æ€§è¦é«˜å¾ˆå¤šã€‚
</p>
<pre class="code"><code><span style="color: #6a5acd;">helloworld</span> <span style="color: #b8860b;">=</span> (asks firstName) <span style="color: #b8860b;">&gt;&gt;=</span>
  <span style="color: #b8860b;">\</span>f <span style="color: #b8860b;">-&gt;</span> (asks lastName) <span style="color: #b8860b;">&gt;&gt;=</span>
       <span style="color: #b8860b;">\</span>l <span style="color: #b8860b;">-&gt;</span> return <span style="color: #8b0000;">"Hello "</span> <span style="color: #b8860b;">++</span> f <span style="color: #b8860b;">++</span> l
</code></pre>
</div>
</div>
</div>


<div id="outline-container-org7505ce4" class="outline-3">
<h3 id="org7505ce4">Writer å…‰å‡ºè¿›æ²¡æœ‰</h3>
<div class="outline-text-3" id="text-org7505ce4">
<p>
é™¤äº†è¿”å›å€¼ï¼Œè®¡ç®—ä¼šéœ€è¦äº§ç”Ÿä¸€äº›é¢å¤–çš„æ•°æ®ï¼Œæ¯”å¦‚ log
</p>

<p>
æ­¤æ—¶å°±éœ€è¦ä¸€ä¸ª Writterï¼Œå…¶è¿”å›å€¼ä¼šæ˜¯ä¸€ä¸ªè¿™æ · <code>(result, log)</code> çš„ tuple
</p>

<p>
é™åˆ¶æ˜¯ log çš„ç±»å‹å¿…é¡»æ˜¯ä¸ª <ruby>å«å¹ºåŠç¾¤<rt>monoid</rt></ruby>
</p>

<pre class="code"><code><span style="color: #6a5acd;">example</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Writer</span> <span style="color: #36648b;">String</span> <span style="color: #36648b;">String</span>
<span style="color: #6a5acd;">example</span>  <span style="color: #b8860b;">=</span> <span style="color: #00008b;">do</span>
  tell <span style="color: #8b0000;">"How are you?"</span>
  tell <span style="color: #8b0000;">"I'm fine thank you, and you?"</span>
  return <span style="color: #8b0000;">"Hehe Da~"</span>

<span style="color: #6a5acd;">output</span> <span style="color: #b8860b;">::</span> (<span style="color: #36648b;">String</span>, <span style="color: #36648b;">String</span>)
<span style="color: #6a5acd;">output</span> <span style="color: #b8860b;">=</span> runWriter example
<span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">("Hehe Da~", "How are you?I'm fine thank you, and you?")</span>
</code></pre>

<p>
Writer çš„å®šä¹‰æ›´ç®€å•
</p>
<pre class="code"><code><span style="color: #00008b;">newtype</span> <span style="color: #36648b;">Writer</span> l a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Writer</span> { runWriter <span style="color: #b8860b;">::</span> (a,l) }
</code></pre>
<p>
é‡Œé¢åªæ˜¯ä¸€ä¸ª tuple è€Œå·²
</p>
<ul class="org-ul">
<li>w æ˜¯ log</li>
<li>a æ˜¯ è¿”å›å€¼</li>
</ul>

<p>
çœ‹çœ‹å¦‚ä½•å®ç° Writer monad
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> (<span style="color: #36648b;">Monoid</span> w) <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">Monad</span> (<span style="color: #36648b;">Writer</span> w) <span style="color: #00008b;">where</span>
    return a             <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Writer</span> (a,mempty)
    (<span style="color: #36648b;">Writer</span> (a,l)) <span style="color: #b8860b;">&gt;&gt;=</span> f <span style="color: #b8860b;">=</span> <span style="color: #00008b;">let</span> (a',l') <span style="color: #b8860b;">=</span> runWriter <span style="color: #b8860b;">$</span> f a <span style="color: #00008b;">in</span>
                           <span style="color: #36648b;">Writer</span> (a',l <span style="color: #b8860b;">`mappend`</span> l')
</code></pre>

<ul class="org-ul">
<li>return ä¸ä¼šæœ‰ä»»ä½• logï¼Œl æ˜¯ monoid çš„ mempty</li>
<li>f çš„ç±»å‹ä¸º <code>a -&gt; Writer l a</code></li>
<li><code>runWriter $ f a</code> è¿”å› <code>(a, l)</code></li>
</ul>


<figure>
<img src="images/p2-writer-monad.png" alt="p2-writer-monad.png">

</figure>

<p>
æ‰€ä»¥åœ¨ &gt;&gt;= æ—¶ï¼Œæˆ‘ä»¬å…ˆæŠŠ f a è¿”å›çš„ Writer runäº†ï¼Œç„¶åæŠŠä¸¤æ¬¡ log <code>mappend</code> èµ·æ¥ã€‚
<img src="images/p2-writer-monad-bind.png" alt="p2-writer-monad-bind.png">
</p>
</div>
</div>

<div id="outline-container-org30a3b76" class="outline-3">
<h3 id="org30a3b76">State å˜åŒ–ä¼šæœ‰</h3>
<div class="outline-text-3" id="text-org30a3b76">
<p>
è·Ÿåå­—å°±çœ‹å¾—å‡ºæ¥ State monad æ˜¯ä¸ºäº†å¤„ç†çŠ¶æ€ã€‚è™½ç„¶å‡½æ•°å¼ç¼–ç¨‹ä¸åº”è¯¥æœ‰çŠ¶æ€ï¼Œä¸ç„¶ä¼šå¼•ç”¨é€æ˜æ€§ã€‚ä½†æ˜¯ï¼Œstate monadå¹¶ä¸æ˜¯åœ¨è®¡ç®—è¿‡ç¨‹ä¸­ä¿®æ”¹çŠ¶æ€ï¼Œè€Œæ˜¯é€šè¿‡æè¿°è¿™ç§å˜åŒ–ï¼Œç„¶åéœ€è¦æ—¶åœ¨è¿è¡Œè¿”å›æœ€ç»ˆç»“æœã€‚è¿™ä¸€ç‚¹è·Ÿ Reader å’Œ Writer è¿™ä¸¤ä¸ªçœ‹èµ·æ¥æ˜¯å‰¯ä½œç”¨çš„ IO æ˜¯ä¸€æ ·çš„ã€‚
</p>

<p>
å…ˆçœ‹ä¸‹ State ç±»å‹çš„å®šä¹‰
</p>
<pre class="code"><code><span style="color: #00008b;">newtype</span> <span style="color: #36648b;">State</span> s a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">State</span> { runState <span style="color: #b8860b;">::</span> s <span style="color: #b8860b;">-&gt;</span> (a, s) }
</code></pre>

<p>
å¯ä»¥çœ‹åˆ° State åªåŒ…å«ä¸€ä¸ª ä»æ—§çŠ¶æ€ s åˆ°æ–°çŠ¶æ€ s å’Œè¿”å›å€¼ a çš„ Tuple çš„å‡½æ•°ã€‚
</p>

<p>
é€šè¿‡å®ç° Monadï¼ŒState å°±å¯ä»¥å®ç°å‘½ä»¤å¼ç¼–ç¨‹ä¸­çš„å˜é‡çš„åŠŸèƒ½ã€‚
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Monad</span> (<span style="color: #36648b;">State</span> s) <span style="color: #00008b;">where</span>
  return a        <span style="color: #b8860b;">=</span> <span style="color: #36648b;">State</span> <span style="color: #b8860b;">$</span> <span style="color: #b8860b;">\</span>s <span style="color: #b8860b;">-&gt;</span> (a,s)
  (<span style="color: #36648b;">State</span> x) <span style="color: #b8860b;">&gt;&gt;=</span> f <span style="color: #b8860b;">=</span> <span style="color: #36648b;">State</span> <span style="color: #b8860b;">$</span> <span style="color: #b8860b;">\</span>s <span style="color: #b8860b;">-&gt;</span> <span style="color: #00008b;">let</span> (v,s') <span style="color: #b8860b;">=</span> x s <span style="color: #00008b;">in</span>
                                 runState (f v) s'
</code></pre>
<p>
return å¾ˆç®€å•ï¼Œå°±ä¸ç”¨è§£é‡Šäº†ã€‚
</p>


<figure>
<img src="images/p2-state-monad.png" alt="p2-state-monad.png">

</figure>

<p>
x ç±»å‹æ˜¯ <code>s -&gt; (a, s)</code> ,æ‰€ä»¥ x s ä¹‹åä¼šè¿”å› ç»“æœå’ŒçŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¿è¡Œå½“å‰ Stateï¼ŒæŠŠç»“æœ v ä¼ ç»™å‡½æ•° fï¼Œè¿”å›çš„ State å†æ¥ç€ä¸Šæ¬¡çŠ¶æ€è¿è¡Œã€‚
</p>


<figure>
<img src="images/p2-state-monad-bind.png" alt="p2-state-monad-bind.png">

<figcaption><span class="figure-number">Figure 10: </span>State x &gt;&gt;= f årunStateçš„æ•°æ®æµï¼ˆå•Šå•Šå•Šï¼Œç”»æ­ªäº†ï¼Œæ„Ÿè§‰éœ€è¦è„‰åŠ¨ä¸€ä¸‹ï¼‰</figcaption>
</figure>

<p>
ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆæ–¹ä¾¿ï¼ŒState æä¾› <code>get</code> <code>put</code> <code>moidfy</code> ä¸‰ä¸ªæ–¹ä¾¿çš„å‡½æ•°å¯ä»¥ç”Ÿæˆä¿®æ”¹çŠ¶æ€çš„State monad
</p>

<pre class="code"><code><span style="color: #00008b;">import</span> <span style="color: #36648b;">Control.Monad.Trans.State.Strict</span>
<span style="color: #6a5acd;">test</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">State</span> <span style="color: #36648b;">Int</span> <span style="color: #36648b;">Int</span>
<span style="color: #6a5acd;">test</span> <span style="color: #b8860b;">=</span> <span style="color: #00008b;">do</span>
  a <span style="color: #b8860b;">&lt;-</span> get
  modify (<span style="color: #b8860b;">+</span>1)
  b <span style="color: #b8860b;">&lt;-</span> get
  return (a <span style="color: #b8860b;">+</span> b)

<span style="color: #6a5acd;">main</span> <span style="color: #b8860b;">=</span> print <span style="color: #b8860b;">$</span> show <span style="color: #b8860b;">$</span> runState test 3
<span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">(7, 4)</span>
</code></pre>
</div>
</div>


<div id="outline-container-org105da09" class="outline-3">
<h3 id="org105da09">Validation æ£€æŸ¥æ£€æŸ¥</h3>
<div class="outline-text-3" id="text-org105da09">
<p>
å¦‚æœä½ æœ‰æ³¨æ„åˆ°ï¼Œå‰é¢çš„ Either å¯ä»¥ç”¨åœ¨å¤„ç†é”™è¯¯å’Œæ­£ç¡®çš„è·¯å¾„åˆ†æ”¯ï¼Œä½†æ˜¯é—®é¢˜æ˜¯é”™è¯¯åªå‘ç”Ÿä¸€æ¬¡ã€‚
</p>

<div class="epigraph"><blockquote>
<p>
Validation æ²¡æœ‰åœ¨æ ‡å‡†åº“ä¸­ï¼Œä½†æ˜¯æˆ‘è§‰å¾—å¥½æœ‰ç”¨å•Šï¼Œä½ å¯ä»¥åœ¨ ekmett çš„ <a href="https://github.com/ekmett/either">github</a> ä¸­æ‰¾åˆ°æºç 
</p>

</blockquote></div>

<p>
æƒ³è±¡ä¸€ä¸‹è¿™ç§åœºæ™¯ï¼Œç”¨æˆ·æäº¤ä¸€ä¸ªè¡¨å•ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸€ä¸ªfieldè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œéœ€è¦æŠŠé”™è¯¯çš„å“ªå‡ ä¸ªfieldçš„é”™è¯¯æ¶ˆæ¯è¿”å›ã€‚æ˜¾ç„¶å¦‚æœä½¿ç”¨ Either æ¥åšï¼Œåªèƒ½è¿”å›ç¬¬ä¸€ä¸ªfieldçš„é”™è¯¯ä¿¡æ¯ï¼Œåé¢çš„è®¡ç®—éƒ½ä¼šè¢«è·³è¿‡ã€‚
</p>

<p>
é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œ Validation æ›´é€‚åˆ
</p>
<pre class="code"><code><span style="color: #00008b;">data</span> <span style="color: #36648b;">Validation</span> e a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Failure</span> e <span style="color: #b8860b;">|</span> <span style="color: #36648b;">Success</span> a
</code></pre>

<p>
ADTå®šä¹‰çœ‹èµ·æ¥è·Ÿ Either æ˜¯ä¸€æ ·çš„ï¼Œä¸åŒçš„æ˜¯ <ruby>å·¦è¾¹<rt>Left</rt></ruby> Failure æ˜¯ <ruby>å«å¹ºåŠç¾¤<rt>Monoid</rt></ruby>
</p>
</div>

<div id="outline-container-org9f94784" class="outline-4">
<h4 id="org9f94784"><ruby>å«å¹ºåŠç¾¤<rt>Monoid</rt></ruby></h4>
<div class="outline-text-4" id="text-org9f94784">
<p>
monoid é¦–å…ˆå¾—æ˜¯ <ruby>åŠç¾¤<rt>Semigroup</rt></ruby> ï¼Œç„¶åå† å«å¹ºã€‚
</p>
<pre class="code"><code><span style="color: #00008b;">class</span> <span style="color: #36648b;">Semigroup</span> a <span style="color: #00008b;">where</span>
  (<span style="color: #b8860b;">&lt;&gt;</span>) <span style="color: #b8860b;">::</span> a <span style="color: #b8860b;">-&gt;</span> a <span style="color: #b8860b;">-&gt;</span> a
  (<span style="color: #b8860b;">&lt;&gt;</span>) <span style="color: #b8860b;">=</span> mappend
</code></pre>

<p>
åŠç¾¤éå¸¸ç®€å•ï¼Œåªè¦æ˜¯å¯ä»¥ <code>&lt;&gt;</code> (mappend) çš„ç±»å‹å°±æ˜¯äº†ã€‚
</p>

<p>
å«å¹ºåªéœ€è¦æœ‰ä¸€ä¸ª <code>mempty</code> çš„ å¹ºå…ƒå°±è¡Œ
</p>
<pre class="code"><code><span style="color: #00008b;">class</span> <span style="color: #36648b;">Monoid</span> a <span style="color: #00008b;">where</span>
  mempty  <span style="color: #b8860b;">::</span> a
  mappend <span style="color: #b8860b;">::</span> a <span style="color: #b8860b;">-&gt;</span> a <span style="color: #b8860b;">-&gt;</span> a
</code></pre>

<p>
æ¯”å¦‚ List å°±æ˜¯ Semigroup
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Semigroup</span> [a] <span style="color: #00008b;">where</span>
  (<span style="color: #b8860b;">&lt;&gt;</span>) <span style="color: #b8860b;">=</span> (<span style="color: #b8860b;">++</span>)
</code></pre>
<p>
ä¹Ÿæ˜¯ Monoid
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Monoid</span> [a] <span style="color: #00008b;">where</span>
  mempty  <span style="color: #b8860b;">=</span> <span style="color: #36648b;">[]</span>
  mappend <span style="color: #b8860b;">=</span> (<span style="color: #b8860b;">++</span>)
</code></pre>

<p>
Monoid çš„ <code>&lt;&gt;</code> æ»¡è¶³ï¼š
</p>
<ul class="org-ul">
<li>mempty &lt;&gt; a = a</li>
<li>a &lt;&gt; b &lt;&gt; c = a &lt;&gt; (b &lt;&gt; c)</li>
</ul>
</div>
</div>
<div id="outline-container-orgd0bcad5" class="outline-4">
<h4 id="orgd0bcad5">å›åˆ° Validation</h4>
<div class="outline-text-4" id="text-orgd0bcad5">
<p>
ç°åœ¨è®© Failure e æ»¡è¶³ Monoidï¼Œå°±å¯ä»¥ <code>mappend</code> é”™è¯¯ä¿¡æ¯äº†ã€‚
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Semigroup</span> e <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">Semigroup</span> (<span style="color: #36648b;">Validation</span> e a) <span style="color: #00008b;">where</span>
  <span style="color: #36648b;">Failure</span> e1 <span style="color: #b8860b;">&lt;&gt;</span> <span style="color: #36648b;">Failure</span> e2 <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Failure</span> (e1 <span style="color: #b8860b;">&lt;&gt;</span> e2)
  <span style="color: #36648b;">Failure</span> <span style="color: #00008b;">_</span>  <span style="color: #b8860b;">&lt;&gt;</span> <span style="color: #36648b;">Success</span> a2 <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Success</span> a2
  <span style="color: #36648b;">Success</span> a1 <span style="color: #b8860b;">&lt;&gt;</span> <span style="color: #36648b;">Failure</span> <span style="color: #00008b;">_</span>  <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Success</span> a1
  <span style="color: #36648b;">Success</span> a1 <span style="color: #b8860b;">&lt;&gt;</span> <span style="color: #36648b;">Success</span> <span style="color: #00008b;">_</span>  <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Success</span> a1
</code></pre>

<p>
ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹ Validation ä¸ Either æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚
</p>

<p>
å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªformï¼Œéœ€è¦è¾“å…¥å§“åä¸ç”µè¯ï¼ŒéªŒè¯éœ€è¦å§“åæ˜¯éç©ºè€Œç”µè¯æ˜¯11ä½æ•°å­—ã€‚
</p>

<p>
é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªå‡½æ•°å»åˆ›å»ºåŒ…å«å§“åå’Œç”µè¯çš„model
</p>
<pre class="code"><code><span style="color: #00008b;">data</span> <span style="color: #36648b;">Info</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Info</span> {name<span style="color: #36648b;">:</span> <span style="color: #36648b;">String</span>, phone<span style="color: #36648b;">:</span> <span style="color: #36648b;">String</span>} <span style="color: #00008b;">deriving</span> <span style="color: #36648b;">Show</span>
</code></pre>

<p>
ç„¶åæˆ‘ä»¬éœ€è¦éªŒè¯å‡½æ•°
</p>
<pre class="code"><code><span style="color: #6a5acd;">notEmpty</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">String</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">String</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Validation</span> [<span style="color: #36648b;">String</span>] <span style="color: #36648b;">String</span>
<span style="color: #6a5acd;">notEmpty</span> desc <span style="color: #8b0000;">""</span> <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Failure</span> [desc <span style="color: #b8860b;">&lt;&gt;</span> <span style="color: #8b0000;">" cannot be empty!"</span>]
<span style="color: #6a5acd;">notEmpty</span> <span style="color: #00008b;">_</span> field <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Success</span> field
</code></pre>
<p>
notEmpty æ£€æŸ¥å­—ç¬¦æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ˜¯ç©ºè¿”å› Failure åŒ…å«é”™è¯¯ä¿¡æ¯ï¼Œè‹¥æ˜¯éç©ºåˆ™è¿”å› Success åŒ…å« field
</p>

<p>
åŒæ ·çš„å¯ä»¥åˆ›å»º 11ä½æ•°å­—çš„éªŒè¯å‡½æ•°
</p>
<pre class="code"><code><span style="color: #6a5acd;">phoneNumberLength</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">String</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">String</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Validation</span> [<span style="color: #36648b;">String</span>] <span style="color: #36648b;">String</span>
<span style="color: #6a5acd;">phoneNumberLength</span> desc field <span style="color: #b8860b;">|</span> (length field) <span style="color: #b8860b;">==</span> 11 <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Success</span> field
                             <span style="color: #b8860b;">|</span> otherwise <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Failure</span> [desc <span style="color: #b8860b;">&lt;&gt;</span> <span style="color: #8b0000;">"'s length is not 11"</span>]
</code></pre>
<p>
å®ç° Validation çš„ Applicative instanceï¼Œè¿™æ ·å°±å¯ä»¥æŠŠå‡½æ•°è°ƒç”¨liftæˆå¸¦æœ‰éªŒè¯çš„ Applicative
</p>
<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Semigroup</span> e <span style="color: #b8860b;">=&gt;</span> <span style="color: #36648b;">Applicative</span> (<span style="color: #36648b;">Validation</span> e) <span style="color: #00008b;">where</span>
  pure <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Success</span>
  <span style="color: #36648b;">Failure</span> e1 <span style="color: #b8860b;">&lt;*&gt;</span> <span style="color: #36648b;">Failure</span> e2 <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Failure</span> e1 <span style="color: #b8860b;">&lt;&gt;</span> <span style="color: #36648b;">Failure</span> e2
  <span style="color: #36648b;">Failure</span> e1 <span style="color: #b8860b;">&lt;*&gt;</span> <span style="color: #36648b;">Success</span> <span style="color: #00008b;">_</span>  <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Failure</span> e1
  <span style="color: #36648b;">Success</span> <span style="color: #00008b;">_</span>  <span style="color: #b8860b;">&lt;*&gt;</span> <span style="color: #36648b;">Failure</span> e2 <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Failure</span> e2
  <span style="color: #36648b;">Success</span> f <span style="color: #b8860b;">&lt;*&gt;</span> <span style="color: #36648b;">Success</span> a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Success</span> (f a)
</code></pre>
<ul class="org-ul">
<li>å¤±è´¥åº”ç”¨åˆ°å¤±è´¥ä¼š concat èµ·æ¥</li>
<li>å¤±è´¥è·Ÿåº”ç”¨æˆ–è¢«æˆåŠŸåº”ç”¨è¿˜æ˜¯å¤±è´¥</li>
<li>åªæœ‰æˆåŠŸåº”ç”¨åˆ°æˆåŠŸæ‰èƒ½æˆåŠŸï¼Œè¿™å¾ˆç¬¦åˆéªŒè¯çš„é€»è¾‘ï¼Œä¸€æ—¦éªŒè¯ä¸­å‘ç”Ÿä»»ä½•é”™è¯¯ï¼Œéƒ½åº”è¯¥è¿”å›å¤±è´¥ã€‚</li>
</ul>

<pre class="code"><code><span style="color: #6a5acd;">createInfo</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">String</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">String</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Validation</span> [<span style="color: #36648b;">String</span>] <span style="color: #36648b;">Info</span>
<span style="color: #6a5acd;">createInfo</span> name phone <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Info</span> <span style="color: #b8860b;">&lt;$&gt;</span> notEmpty <span style="color: #8b0000;">"name"</span> name <span style="color: #b8860b;">&lt;*&gt;</span> phoneNumberLength <span style="color: #8b0000;">"phone"</span> phone
</code></pre>

<p>
ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¸¦validationçš„ createInfo æ¥å®‰å…¨çš„åˆ›å»º Info äº†
</p>

<pre class="code"><code><span style="color: #6a5acd;">createInfo</span> <span style="color: #8b0000;">"jichao"</span> <span style="color: #8b0000;">"12345678910"</span> <span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">Success Info "jichao" "12345678910"</span>
<span style="color: #6a5acd;">createInfo</span> <span style="color: #8b0000;">""</span> <span style="color: #8b0000;">"123"</span> <span style="color: #8c8c8c; font-style: italic;">-- </span><span style="color: #8c8c8c; font-style: italic;">Failure ["name cannot be empty!", "phone's length is not 11"]</span>
</code></pre>
</div>
</div>
</div>

<div id="outline-container-orgbfc4526" class="outline-3">
<h3 id="orgbfc4526">Cont æ¥ä¸‹æ¥æœ‰</h3>
<div class="outline-text-3" id="text-orgbfc4526">
<p>
Cont æ˜¯ <ruby>Continuation Passing Style<rt>CPS</rt></ruby> çš„ monadï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯åŒ…å« cps è®¡ç®— monadã€‚
</p>

<p>
å…ˆçœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯ CPSï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªåŠ æ³•
</p>
<pre class="code"><code><span style="color: #6a5acd;">add</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Int</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Int</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Int</span>
<span style="color: #6a5acd;">add</span> <span style="color: #b8860b;">=</span> (<span style="color: #b8860b;">+</span>)
</code></pre>

<p>
ä½†æ˜¯å¦‚æœä½ æƒ³åœ¨ç®—æ³•åŠ æ³•åï¼Œèƒ½å¤Ÿç»§ç»­è¿›è¡Œä¸€ä¸ªå…¶ä»–çš„è®¡ç®—ï¼Œé‚£ä¹ˆå°±å¯ä»¥å†™ä¸€ä¸ª cpsç‰ˆæœ¬çš„åŠ æ³•
</p>
<pre class="code"><code><span style="color: #6a5acd;">addCPS</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Int</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Int</span> <span style="color: #b8860b;">-&gt;</span> (<span style="color: #36648b;">Int</span> <span style="color: #b8860b;">-&gt;</span> r) <span style="color: #b8860b;">-&gt;</span> r
<span style="color: #6a5acd;">addCPS</span> a b k <span style="color: #b8860b;">=</span> k (a <span style="color: #b8860b;">+</span> b)
</code></pre>

<p>
éå¸¸ç®€å•ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ª Cont monad æ¥åŒ…ä½ CPS è®¡ç®—ï¼Œé¦–å…ˆï¼Œæ¥çœ‹ ADT å®šä¹‰
</p>
<pre class="code"><code><span style="color: #00008b;">newtype</span> <span style="color: #36648b;">Cont</span> r a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Cont</span> { runCont <span style="color: #b8860b;">::</span> ((a <span style="color: #b8860b;">-&gt;</span> r) <span style="color: #b8860b;">-&gt;</span> r) }
</code></pre>

<p>
åˆæ˜¯ä¸€ä¸ªåŒæ„çš„ç±»å‹ï¼ŒCont æ„é€ å™¨åªéœ€è¦ä¸€ä¸ª runCountï¼Œä¹Ÿå°±æ˜¯è®©ä»–èƒ½ç»§ç»­è®¡ç®—çš„ä¸€ä¸ªå‡½æ•°ã€‚
</p>

<p>
å®Œäº†ä¹‹åæ¥æŠŠä¹‹å‰çš„ addCPS æ”¹æˆ Cont
</p>
<pre class="code"><code><span style="color: #6a5acd;">add</span> <span style="color: #b8860b;">::</span> <span style="color: #36648b;">Int</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Int</span> <span style="color: #b8860b;">-&gt;</span> <span style="color: #36648b;">Cont</span> k <span style="color: #36648b;">Int</span>
<span style="color: #6a5acd;">add</span> a b <span style="color: #b8860b;">=</span> return (a <span style="color: #b8860b;">+</span> b)
</code></pre>

<p>
æ³¨æ„åˆ° addCPS æ¥æ”¶åˆ° a å’Œ b ä¹‹åè¿”å›çš„ç±»å‹æ˜¯ <code>(Int -&gt; r) -&gt; r</code> ï¼Œè€Œ Cont ç‰ˆæœ¬çš„ <code>add</code> è¿”å› <code>Cont k Int</code>
</p>

<p>
æ˜æ˜¾æ„é€  <code>Cont k Int</code> ä¹Ÿæ­£æ˜¯éœ€è¦ <code>(Int -&gt; r) -&gt; r</code> ï¼Œæ‰€ä»¥ Cont å°±æ˜¯ç®—äº† k çš„æŠ½è±¡äº†ã€‚
</p>

<pre class="code"><code><span style="color: #00008b;">instance</span> <span style="color: #36648b;">Monad</span> (<span style="color: #36648b;">Cont</span> r) <span style="color: #00008b;">where</span>
    return a <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Cont</span> (<span style="color: #b8860b;">$</span> a)
    m <span style="color: #b8860b;">&gt;&gt;=</span> k  <span style="color: #b8860b;">=</span> <span style="color: #36648b;">Cont</span> <span style="color: #b8860b;">$</span> <span style="color: #b8860b;">\</span>c <span style="color: #b8860b;">-&gt;</span> runCont m <span style="color: #b8860b;">$</span> <span style="color: #b8860b;">\</span>a <span style="color: #b8860b;">-&gt;</span> runCont (k a) c
</code></pre>

<p>
<code>($ a)</code> æ¯”è¾ƒæœ‰æ„æ€, æˆ‘ä»¬éƒ½çŸ¥é“ <code>f $ g a</code> å…¶å®å°±æ˜¯ <code>f(g a)</code>, æ‰€ä»¥ <code>$</code> å…¶å®å°±æ˜¯ä¸€ä¸ª apply å·¦è¾¹çš„å‡½æ•°åˆ°å³è¾¹è¡¨è¾¾å¼çš„ä¸­ç¼€å‡½æ•°, å¦‚æœå†™æˆå‰ç¼€åˆ™æ˜¯
<code>($ (g a) f)</code>. æ˜¯åçš„æ˜¯å› ä¸º <code>$</code> æ˜¯æœ‰ç»“åˆ, éœ€è¦å³è¾¹è¡¨è¾¾å¼å…ˆæ±‚å€¼, æ‰€ä»¥åªç»™ä¸€ä¸ª a å°±ç›¸å½“äº <code>($ a) = \f -&gt; f a</code>
</p>

<p>
å›åˆ° Monad Cont&#x2026;
</p>
</div>
</div>

<div id="outline-container-org05e7f17" class="outline-3">
<h3 id="org05e7f17">Summary</h3>
<div class="outline-text-3" id="text-org05e7f17">
<p>
ç¬¬äºŒéƒ¨åˆ†é£Ÿç”¨éƒ¨åˆ†ä¹Ÿè®²å®Œäº†ï¼Œ ä¸çŸ¥æ˜¯å¦ä»¥åŠå¤§è‡´äº†è§£äº†monadçš„å°¿æ€§å„ç§åŸºæœ¬ç©æ³•å‘¢ï¼Ÿé€šè¿‡è¿™äº›å¸¸ç”¨çš„åŸºæœ¬çš„ monad instanceï¼Œè§£å†³å‘½ä»¤å¼ç¼–ç¨‹ä¸­çš„ä¸€äº›ç®€å•é—®é¢˜åº”è¯¥æ˜¯å¤Ÿäº†ã€‚
</p>

<p>
ä¸è¿‡ï¼Œæ¥ä¸‹æ¥è¿˜æœ‰æ›´å˜æ€çš„çŒ«ï¼Œå°±å…ˆå«å¥¹ <del>æåŸº</del> çŒ«å‘¢å¥½äº†ã€‚
</p>

<ul class="org-ul">
<li>ğŸ‘‰ <a href="./part3.html">ç¬¬ä¸‰éƒ¨åˆ†ï¼š<ruby>æåŸºçŒ«å‘¢<rt> Advanced Monads</rt></ruby></a></li>
</ul>

<p>
å½“ç„¶æˆ‘åˆè¿˜æ²¡ç©ºå…¨éƒ¨å†™å®Œï¼Œå¦‚æœè¿˜æœ‰å¾ˆå¤šäºº<ruby>é¢„å®š<rt>åªè¦998</rt></ruby> Gumroad ä¸Šçš„  <script src="https://gumroad.com/js/gumroad.js"></script><a class="gumroad-button" href="https://gum.co/grokking-monad" target="_blank">Grokking Monad</a> ç”µå­ä¹¦çš„è¯ï¼Œæˆ‘å¯èƒ½ä¼šç¨å¾®å†™å¾—å¿«ä¸€äº›ã€‚æ¯•ç«Ÿï¼Œå†™äº†ä¹Ÿæ²¡äººæ„Ÿå…´è¶£ä¹Ÿæ€ªæµªè´¹æ—¶é—´çš„ã€‚ä¸è¿‡ï¼Œæˆ‘çŒœä¹Ÿæ²¡å‡ ä¸ªäººèƒ½çœ‹åˆ°è¿™ä¸€è¡Œï¼Œå°±å½“æ˜¯æˆ‘åˆè‡ªè¨€è‡ªè¯­å§ï¼Œæ€ä¹ˆåˆçªç„¶è§‰å¾—è‡ªå·±å¥½åˆ†è£‚ï¼Œè¯¶~ï¼Œä¸ºä»€ä¹ˆæˆ‘è¦è¯´åˆï¼Ÿ
</p>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
ä»æ¥æ²¡è§è¿‡æœ‰äººç»™è¿™äº›æ•°æ®ç±»å‹æŒ‰è¿‡ä¸­æ–‡åå­—, ä¸ç„¶æˆ‘æ¥, è¿™æ ·ä¹Ÿæ›´å¥½çš„ä½“ä¼šè¿™äº›æ•°æ®ç±»å‹çš„æ„å›¾.
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
è§ <a href="part1.html#orgf0aed70">ç¬¬ä¸€éƒ¨åˆ† ä¼´éšå‡½å­</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara">
ä¹Ÿå°±æ˜¯ Kind * -&gt; *, å› ä¸ºå®ƒéå¸¸çš„ nice, ä¸€å®šè¦ç­‰åˆ° a æ‰å‡ºç±»å‹
</p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4">4</a></sup> <div class="footpara"><p class="footpara">
ä¸€å®šè¦è®°å¾—å°å†™å“¦
</p></div></div>

<div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5">5</a></sup> <div class="footpara"><p class="footpara">
æ„æ€å°±æ˜¯ <code>Maybe a</code> ä½†æ˜¯ <code>a</code> çš„ç±»å‹çº¦æŸä¸º <code>Num</code>
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<footer>
  <p>Author: æ¬§é˜³ç»§è¶…
    <a class="github-button" href="https://github.com/sponsors/jcouyang" data-icon="octicon-heart" aria-label="Sponsor @jcouyang on GitHub">Sponsor</a>
    <a aria-label="Follow @jcouyang on GitHub" data-count-aria-label="# followers on GitHub" data-count-api="/users/jcouyang#followers" data-count-href="/jcouyang/followers" href="https://github.com/jcouyang" class="github-button">Follow</a>
  </p>
  <p>Created: 2017-02-10 Fri 00:00</p>
  <p>Generated by: <a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.2 (<a href="https://orgmode.org">Org</a> mode 9.2.6) &#215; <a href="https://github.com/jcouyang/orgpress">OrgPress</a></p>
  <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Unported License</a>.
  <input type="swiftype" class="st-default-search-input" placeholder="Search"/>
  <a class="gumroad-button" href="https://gum.co/grokking-monad?wanted=true" target="_blank" data-gumroad-single-product="true">èŒƒç•´è®ºè£…é€¼æŒ‡å—ï¼Œè¯·è‡ªè§‰æ’é˜Ÿè£…é€¼</a>
  <div id="danmaku-comments"></div>
  <div id="disqus_thread"></div>
</footer>
</div>
</body>
</html>
