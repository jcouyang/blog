<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2019-03-27 Wed 02:21 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>èŒƒç•´è®ºå®Œå…¨è£…é€¼æ‰‹å†Œ / Grokking Monad</title>
<meta name="generator" content="Org mode">
<meta name="author" content="æ¬§é˜³ç»§è¶…">
<link rel="icon" href="/favicon.ico">
<meta name="theme-color" content="#ffffff">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/toc.css"/>
<link rel="stylesheet" href="/style/tufte.css"/>
<link rel="alternate" type="application/rss+xml" title="Jichao Ouyang" href="https://feeds.oyanglul.us/JichaoOuyangsBlog"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJRFJGX"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<header>
    <a accesskey="h" href="/index.html"> HOME </a> |
    <a href="#" id="edit-in-github">EDIT</a> |
    <a href="https://feeds.oyanglul.us/JichaoOuyangsBlog">RSS</a> |
    <a accesskey="H" href="/jichao.ouyang.html">ABOUT</a> |
    <a href="https://github.com/jcouyang/blog">GITHUB</a>
</header>
</div>
<div id="content">
<header>
<h1 class="title">èŒƒç•´è®ºå®Œå…¨è£…é€¼æ‰‹å†Œ / Grokking Monad</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org369c743">ç¬¬äºŒéƒ¨åˆ†ï¼š<ruby>é£Ÿç”¨çŒ«å‘¢<rt> Practical Monads</rt></ruby></a>
<ul>
<li><a href="#org44f1045">Identity</a></li>
<li><a href="#org97d133d">Maybe</a></li>
<li><a href="#org90af663">Either</a>
<ul>
<li><a href="#org245b438">Product &amp; Coproduct</a></li>
<li><a href="#org65e60d6">Either Monad</a></li>
</ul>
</li>
<li><a href="#orgdc1e08d">Reader</a>
<ul>
<li><a href="#org35a68ff">do notation</a></li>
</ul>
</li>
<li><a href="#org19815bf">Writer</a></li>
<li><a href="#org9c1b96b">State</a></li>
<li><a href="#org44f0c0f">Validation</a>
<ul>
<li><a href="#org29e6753"><ruby>å«å¹ºåŠç¾¤<rt>Monoid</rt></ruby></a></li>
<li><a href="#orgb04c087">å›åˆ° Validation</a></li>
</ul>
</li>
<li><a href="#orga3b85dc">Cont</a></li>
<li><a href="#org7359a6e">Summary</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li><a href="./part1.html">ç¬¬ä¸€éƒ¨åˆ†ï¼šèŒƒç•´è®º</a></li>
<li><b><a href="./part2.html">ç¬¬äºŒéƒ¨åˆ†ï¼šé£Ÿç”¨çŒ«å‘¢</a></b> ğŸ‘ˆ</li>
<li><a href="./part3.html">ç¬¬ä¸‰éƒ¨åˆ†ï¼šæåŸºçŒ«å‘¢</a></li>
</ul>

<div id="outline-container-org369c743" class="outline-2">
<h2 id="org369c743">ç¬¬äºŒéƒ¨åˆ†ï¼š<ruby>é£Ÿç”¨çŒ«å‘¢<rt> Practical Monads</rt></ruby></h2>
<div class="outline-text-2" id="text-org369c743">
<p>
ç¬¬ä¸€éƒ¨åˆ†ç†è®ºéƒ¨åˆ†éƒ½è®²å®Œäº†ï¼Œ å¦‚æœä½ è¯»åˆ°è¿™é‡Œè¿˜æ²¡æœ‰è¢«è¿™äº›åŠç‚¸å¤©çš„æ¦‚å¿µædazeï¼Œæ¥ä¸‹æ¥å¯ä»¥çœ‹çœ‹å®ƒåˆ°åº•è·Ÿæˆ‘ä»¬ç¼–ç¨‹æœ‰é¸Ÿå…³ç³»å‘¢ï¼Ÿ
</p>

<p>
ç¬¬äºŒéƒ¨åˆ†å°†ä»‹ç»ç”±è¿™äº›æ¦‚å¿µäº§ç”Ÿçš„ä¸€äº›å®ç”¨çš„monad instancesï¼Œè¿™äº› monad éƒ½é€šè¿‡åŒæ ·çš„æŠ½è±¡æ–¹å¼ï¼Œè§£å†³äº†åˆ†ç¦»è®¡ç®—ä¸å‰¯ä½œç”¨çš„å·¥ä½œã€‚
</p>

<p>
æœ€åä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åƒ IO monad ä¸€æ ·ï¼Œé€šè¿‡ free æˆ–è€… Eff è‡ªå®šä¹‰è‡ªå·±çš„è®¡ç®—ï¼Œå’Œå¯èƒ½å¸¦å‰¯ä½œç”¨çš„è§£é‡Šå™¨ã€‚
</p>
</div>

<div id="outline-container-org44f1045" class="outline-3">
<h3 id="org44f1045">Identity</h3>
<div class="outline-text-3" id="text-org44f1045">
<p>
è¿™å¯èƒ½æ˜¯æœ€ç®€å•çš„ monad äº†ã€‚ä¸åŒ…å«ä»»ä½•è®¡ç®—
</p>
<pre class="code"><code><span style="font-weight: bold;">newtype</span> <span style="font-weight: bold; text-decoration: underline;">Identity</span> a <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Identity</span> { runIdentity <span style="font-weight: bold; font-style: italic;">::</span> a }
</code></pre>

<p>
è¿™é‡Œä½¿ç”¨ <code>newtype</code> è€Œä¸æ˜¯ <code>data</code> æ˜¯å› ä¸º <code>Identity</code> ä¸ <code>runIdentity</code> æ˜¯ isomorphic ï¼ˆåŒæ„ï¼Œå¿˜äº†çš„è¯å›å»ç¿»ç¬¬ä¸€éƒ¨åˆ†ï¼‰
</p>

<pre class="code"><code><span style="font-weight: bold; text-decoration: underline;">Identity</span> <span style="font-weight: bold; font-style: italic;">::</span> a <span style="font-weight: bold; font-style: italic;">-&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Identity</span> a
<span style="font-weight: bold;">runIdentity</span> <span style="font-weight: bold; font-style: italic;">::</span> <span style="font-weight: bold; text-decoration: underline;">Identity</span> a <span style="font-weight: bold; font-style: italic;">-&gt;</span> a
</code></pre>

<p>
æ‰€ä»¥ <code>runIdentity . Identity = id</code> ï¼Œæ‰€ä»¥ä»–ä»¬æ˜¯åŒæ„çš„ã€‚
</p>

<p>
å·¦è¾¹çš„ <code>Identity</code> æ˜¯ç±»å‹æ„é€ å™¨, æ¥æ”¶ç±»å‹ <code>a</code> è¿”å› <code>Identity a</code> ç±»å‹
</p>

<p>
å¦‚æœ a æ˜¯ Intï¼Œé‚£ä¹ˆå°±å¾—åˆ°ä¸€ä¸ª <code>Identity Int</code> ç±»å‹ã€‚
</p>

<p>
å³è¾¹çš„ <code>Identity</code> æ˜¯æ•°æ®æ„é€ å™¨ï¼Œä¹Ÿå°±æ˜¯æ„é€ å€¼ï¼Œæ¯”å¦‚ <code>Identity 1</code> ä¼šæ„é€ å‡ºä¸€ä¸ªå€¼ï¼Œå…¶ç±»å‹ä¸º <code>Identity Int</code>
</p>

<p>
å¤§æ‹¬å·æ¯”è¾ƒè¯¡å¼‚ï¼Œå¯ä»¥æƒ³è±¡æˆç»™ <code>a</code> ä¸€ä¸ª keyï¼ŒåŒè¿‡è¿™ä¸ª key å¯ä»¥æŠŠ a å–å‡ºæ¥ï¼Œæ¯”å¦‚
</p>
<pre class="code"><code><span style="font-weight: bold;">runIdentity</span> (<span style="font-weight: bold; text-decoration: underline;">Identity</span> 1)
</code></pre>

<p>
ä¼šè¿”å› 1
</p>

<p>
Identity å¯ä»¥å®ç° Functor å’Œ Monadï¼Œå°±å¾—åˆ° Identity functor å’Œ Identity monad
</p>
<pre class="code"><code><span style="font-weight: bold;">instance</span> <span style="font-weight: bold; text-decoration: underline;">Functor</span> <span style="font-weight: bold; text-decoration: underline;">Identity</span> <span style="font-weight: bold;">where</span>
  fmap f (<span style="font-weight: bold; text-decoration: underline;">Identity</span> a) <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Identity</span> (f a)

<span style="font-weight: bold;">instance</span> <span style="font-weight: bold; text-decoration: underline;">Monad</span> <span style="font-weight: bold; text-decoration: underline;">Identity</span> <span style="font-weight: bold;">where</span>
  return a <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Identity</span> a
  <span style="font-weight: bold; text-decoration: underline;">Identity</span> a <span style="font-weight: bold; font-style: italic;">&gt;&gt;=</span> f <span style="font-weight: bold; font-style: italic;">=</span> f a
</code></pre>

<p>
å¯ä»¥çœ‹åˆ° Identity å³æ˜¯æ„é€ å™¨ï¼Œä¹Ÿæ˜¯è§£æ„å™¨ï¼Œåœ¨æ¨¡å¼åŒ¹é…æ˜¯å¯ä»¥ destructure å€¼ã€‚ä¾‹å¦‚ä¸Šé¢Functor å®ç°ä¸­çš„ <code>fmap f (Identity a)</code> , å‡å¦‚fmapçš„æ˜¯ <code>Identity 1</code>, é‚£ä¹ˆè¿™ä¸ªæ¨¡å¼åŒ¹é…åˆ° <code>(Identity a)</code> æ—¶ä¼šæŠŠ <code>1</code> æ”¾åˆ° <code>a</code> çš„ä½ç½®ã€‚
</p>

<p>
Identity çœ‹èµ·æ¥ä»€ä¹ˆä¹Ÿæ²¡æœ‰å¹²ï¼Œå°±è·Ÿ identity å‡½æ•°ä¸€æ ·ï¼Œä½†æ˜¯åœ¨åé¢è®²åˆ° State monadæ—¶ä½ ä¼šå‘ç°ä»–çš„ä»·å€¼ã€‚
</p>
</div>
</div>

<div id="outline-container-org97d133d" class="outline-3">
<h3 id="org97d133d">Maybe</h3>
<div class="outline-text-3" id="text-org97d133d">
<p>
è¿™æ˜¯ä¸€ä¸ªè¶…çº§ç®€å•çš„ Monadï¼Œé¦–å…ˆï¼Œéœ€è¦å®šä¹‰è¿™ä¸ªä¸€ä¸ª <ruby>ä»£æ•°æ•°æ®ç±»å‹<rt> Algebra Data Type(ADT)</rt></ruby>
</p>
<pre class="code"><code><span style="font-weight: bold;">data</span> <span style="font-weight: bold; text-decoration: underline;">Maybe</span> a <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Just</span> a <span style="font-weight: bold; font-style: italic;">|</span> <span style="font-weight: bold; text-decoration: underline;">Nothing</span>
</code></pre>
<p>
Haskellä¸­å®šä¹‰ä¸€ä¸ªADTååˆ†ç®€å•ï¼Œä¸åƒScalaé‚£ä¹ˆå•°å—¦ã€‚å·¦è¾¹æ˜¯ç±»å‹æ„é€ å™¨ï¼Œå³è¾¹æœ‰æ•°æ®æ„é€ å™¨ï¼Œä½ ä¼šå‘ç°æœ‰ä¸€æ ¹ç«–çº¿ <code>|</code> ï¼Œ å®ƒåˆ†éš”ç€ä¸¤ä¸ªæ„é€ å™¨
</p>
<ul class="org-ul">
<li>Just</li>
<li>Nothing</li>
</ul>
<p>
å…¶ä¸­ a ï¼ˆä¸€å®šè¦å°å†™ï¼‰å¯ä»¥æ˜¯ä»»æ„ç±»å‹
</p>

<p>
æ‰€ä»¥ <code>Just 1</code> ä¼šå¾—åˆ°ä¸€ä¸ª <code>Num a =&gt; Mabye a</code> ç±»å‹ï¼ˆæ„æ€å°±æ˜¯ <code>Maybe a</code> ä½†æ˜¯ <code>a</code> çš„ç±»å‹çº¦æŸä¸º <code>Num</code> ï¼‰ï¼Œ <code>Nothing</code> ä¹Ÿä¼šå¾—åˆ°ä¸€ä¸ª <code>Maybe a</code> åªä¸è¿‡ <code>a</code> æ²¡æœ‰ç±»å‹çº¦æŸã€‚
</p>

<p>
æ€»ä¹‹æˆ‘ä»¬æœ‰äº†æ„é€ å™¨å¯ä»¥æ„é€ å‡º Maybe ç±»å‹ï¼Œè€Œè¿™ä¸ªç±»å‹èƒ½åšçš„äº‹æƒ…ï¼Œå°±è¦å–å†³å®ƒå®ç°äº†å“ªäº› class çš„ instance äº†ã€‚æ¯”å¦‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ª Functor
</p>
<pre class="code"><code><span style="font-weight: bold;">instance</span> <span style="font-weight: bold; text-decoration: underline;">Functor</span> <span style="font-weight: bold; text-decoration: underline;">Maybe</span> <span style="font-weight: bold;">where</span>
  fmap f (<span style="font-weight: bold; text-decoration: underline;">Just</span> a) <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Just</span> (f a)
</code></pre>


<figure>
<img src="images/p2-maybe-functor.png" alt="p2-maybe-functor.png">

<figcaption><span class="figure-number">Figure 1: </span>fmap :: (a -&gt; b) -&gt; f a -&gt; f b</figcaption>
</figure>

<p>
ç„¶åï¼Œè¿˜å®ç° Monad
</p>
<pre class="code"><code><span style="font-weight: bold;">instance</span> <span style="font-weight: bold; text-decoration: underline;">Monad</span> <span style="font-weight: bold; text-decoration: underline;">Maybe</span> <span style="font-weight: bold;">where</span>
  return a <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Just</span> a
  (<span style="font-weight: bold; text-decoration: underline;">Just</span> a) <span style="font-weight: bold; font-style: italic;">&gt;&gt;=</span> f <span style="font-weight: bold; font-style: italic;">=</span> f a
  <span style="font-weight: bold; text-decoration: underline;">Nothing</span> <span style="font-weight: bold; font-style: italic;">&gt;&gt;=</span> f <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Nothing</span>
</code></pre>


<figure>
<img src="images/p2-maybe-kleisli.png" alt="p2-maybe-kleisli.png">

<figcaption><span class="figure-number">Figure 2: </span>è¿˜è®°å¾—ç¬¬ä¸€éƒ¨åˆ†æåˆ°çš„ Kleisli èŒƒç•´å—ï¼Ÿ</figcaption>
</figure>

<p>
Maybe æœ‰ç”¨åœ¨äºèƒ½åˆé€‚çš„å¤„ç† <i><ruby>åå‡½æ•°<rt> Partial Function</rt></ruby></i> çš„è¿”å›å€¼ã€‚åå‡½æ•°ç›¸å¯¹äº<ruby>å…¨å‡½æ•°<rt> Total Function</rt></ruby>ï¼Œæ˜¯æŒ‡åªèƒ½å¯¹éƒ¨åˆ†è¾“å…¥è¿”å›è¾“å‡ºçš„å‡½æ•°ã€‚
</p>

<p>
æ¯”å¦‚ä¸€ä¸ªå–æ•°ç»„æŸä¸€ä½ä¸Šçš„å€¼çš„å‡½æ•°ï¼Œå°±æ˜¯åå‡½æ•°ï¼Œå› ä¸ºå‡è®¾ä½ æƒ³å–ç¬¬4ä½çš„å€¼ï¼Œä½†ä¸æ˜¯æ‰€æœ‰æ•°ç»„é•¿åº¦éƒ½å¤§äº4ï¼Œå°±ä¼šæœ‰è·å–ä¸äº†çš„å°´å°¬æƒ…å†µã€‚
</p>
<pre class="code"><code>[1,2,3] <span style="font-weight: bold; font-style: italic;">!!</span> 4
</code></pre>

<p>
å¦‚æœä½¿ç”¨ Maybe æŠŠåå‡½æ•°å¤„ç†ä¸äº†çš„è¾“å…¥éƒ½è¿”å›æˆ Nothingï¼Œè¿™æ ·ç»“æœä¾ç„¶ä¿æŒ Maybe ç±»å‹ï¼Œä¸å½±å“åé¢çš„è®¡ç®—ã€‚
</p>
</div>
</div>

<div id="outline-container-org90af663" class="outline-3">
<h3 id="org90af663">Either</h3>
<div class="outline-text-3" id="text-org90af663">
<p>
Either çš„å®šä¹‰ä¹Ÿå¾ˆç®€å•
</p>
<pre class="code"><code><span style="font-weight: bold;">data</span> <span style="font-weight: bold; text-decoration: underline;">Either</span> a b <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Left</span> a <span style="font-weight: bold; font-style: italic;">|</span> <span style="font-weight: bold; text-decoration: underline;">Right</span> b
</code></pre>
</div>

<div id="outline-container-org245b438" class="outline-4">
<h4 id="org245b438">Product &amp; Coproduct</h4>
<div class="outline-text-4" id="text-org245b438">
<p>
çœ‹è¿‡ç¬¬ä¸€éƒ¨åˆ†åº”è¯¥è¿˜èƒ½è®°å¾—æœ‰ä¸€ä¸ªä¸œè¥¿å« Duelï¼Œæ‰€ä»¥è§åˆ°å¦‚æœèŒƒç•´ä¸Šæœ‰ Coproduct é‚£ä¹ˆè‚¯å®šåœ¨duelèŒƒç•´ä¸Šä¼šæœ‰åŒæ ·çš„ä¸œè¥¿å« Productã€‚
</p>

<p>
é‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯ Coproduct
</p>


<figure>
<img src="images/p2-coproduct.png" alt="p2-coproduct.png">

<figcaption><span class="figure-number">Figure 3: </span>Coproduct</figcaption>
</figure>

<p>
åƒè¿™æ ·ï¼Œèƒ½é€šè¿‡ä¸¤ä¸ªç®­å¤´åˆ°è¾¾åŒä¸€ä¸ªä¸œè¥¿ï¼Œå°±æ˜¯ Coproductã€‚è¿™é‡Œç®­å¤´ <code>Left</code> èƒ½è®© <code>a</code> åˆ° <code>Either a b</code> ï¼Œ ç®­å¤´ <code>Right</code> ä¹Ÿèƒ½è®© <code>b</code> åˆ°è¾¾ <code>Either a b</code>
</p>

<p>
æœ‰æ„æ€çš„æ˜¯è¿˜è‚¯å®šå­˜åœ¨ä¸€ä¸ª Coproduct å’Œ ç®­å¤´ï¼Œä½¿å¾—ä¸‹å›¾æˆç«‹
<img src="images/p2-coproduct-law.png" alt="p2-coproduct-law.png">
</p>

<p>
ç®­å¤´åè¿‡æ¥ï¼Œå°±æ˜¯ Product, æ¯”å¦‚ Tuple
</p>


<figure>
<img src="images/p2-product.png" alt="p2-product.png">

<figcaption><span class="figure-number">Figure 4: </span>Product</figcaption>
</figure>

<p>
Tuple çš„ <code>fst</code> ç®­å¤´èƒ½è®© <code>(a, b)</code> åˆ°è¾¾ <code>a</code> å¯¹è±¡ï¼Œè€Œç®­å¤´ <code>snd</code> èƒ½è®©å…¶åˆ°è¾¾ <code>b</code> å¯¹è±¡ã€‚
</p>
</div>
</div>

<div id="outline-container-org65e60d6" class="outline-4">
<h4 id="org65e60d6">Either Monad</h4>
<div class="outline-text-4" id="text-org65e60d6">
<p>
ç¡®åˆ‡çš„è¯´ï¼ŒEither ä¸æ˜¯ monadï¼Œ <code>Either a</code> æ‰æ˜¯ã€‚è¿˜è®°å¾— monad çš„ class å®šä¹‰å—ï¼Ÿ
</p>
<pre class="code"><code><span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Endofunctor</span> m <span style="font-weight: bold; font-style: italic;">=&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Monad</span> m <span style="font-weight: bold;">where</span>
  eta <span style="font-weight: bold; font-style: italic;">::</span> a <span style="font-weight: bold; font-style: italic;">-&gt;</span> (m a)
  mu <span style="font-weight: bold; font-style: italic;">::</span> m m a <span style="font-weight: bold; font-style: italic;">-&gt;</span> m a
</code></pre>
<p>
æ‰€ä»¥ m å¿…é¡»æ˜¯ä¸ª Endofunctorï¼Œä¹Ÿå°±æ˜¯è¦æ»¡è¶³Functor
</p>
<pre class="code"><code><span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Functor</span> t <span style="font-weight: bold;">where</span>
  fmap <span style="font-weight: bold; font-style: italic;">::</span> (a <span style="font-weight: bold; font-style: italic;">-&gt;</span> b) <span style="font-weight: bold; font-style: italic;">-&gt;</span> (t a <span style="font-weight: bold; font-style: italic;">-&gt;</span> t b)
</code></pre>
<p>
t a çš„ kind æ˜¯ *ï¼Œæ‰€ä»¥ t å¿…é¡»æ˜¯ kind * -&gt; *
ä¹Ÿå°±æ˜¯è¯´ï¼Œm å¿…é¡»æ˜¯æ¥æ”¶ä¸€ä¸ªç±»å‹å‚æ•°çš„ç±»å‹æ„é€ å™¨
</p>

<p>
è€Œ Either çš„ kind æ˜¯ * -&gt; * -&gt; *, Either a æ‰æ˜¯ * -&gt; *
</p>

<p>
æ‰€ä»¥åªèƒ½å®šä¹‰ Either a çš„ Monad
</p>
<pre class="code"><code><span style="font-weight: bold;">instance</span> <span style="font-weight: bold; text-decoration: underline;">Monad</span> (<span style="font-weight: bold; text-decoration: underline;">Either</span> a) <span style="font-weight: bold;">where</span>
  <span style="font-weight: bold; text-decoration: underline;">Left</span>  l <span style="font-weight: bold; font-style: italic;">&gt;&gt;=</span> <span style="font-weight: bold;">_</span> <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Left</span> l
  <span style="font-weight: bold; text-decoration: underline;">Right</span> r <span style="font-weight: bold; font-style: italic;">&gt;&gt;=</span> k <span style="font-weight: bold; font-style: italic;">=</span> k r
</code></pre>

<p>
å¾ˆæ˜æ˜¾çš„ï¼Œ&gt;&gt;= ä»»ä½•å‡½æ•°åˆ°<ruby>å·¦è¾¹<rt> Left</rt></ruby> éƒ½ä¸ä¼šæ”¹å˜ï¼Œåªæœ‰ &gt;&gt;= å³è¾¹æ‰èƒ½äº§ç”Ÿæ–°çš„è®¡ç®—ã€‚
</p>
</div>
</div>
</div>


<div id="outline-container-orgdc1e08d" class="outline-3">
<h3 id="orgdc1e08d">Reader</h3>
<div class="outline-text-3" id="text-orgdc1e08d">
<p>
Reader çš„ä½œç”¨æ˜¯ç»™ä¸€ä¸ªè®¡ç®—å–‚æ•°æ®ã€‚
</p>

<p>
åœ¨æè¿°è®¡ç®—çš„æ—¶å€™ï¼Œå¹¶ä¸éœ€è¦å…³å¿ƒè¾“å…¥æ—¶ä»€ä¹ˆï¼Œåªéœ€è¦ asks å°±å¯ä»¥æ‹¿åˆ°è¾“å…¥å€¼
</p>

<p>
è€ŒçœŸæ­£çš„è¾“å…¥ï¼Œä¼šåœ¨è¿è¡Œè®¡ç®—æ—¶ç»™äºˆã€‚
</p>

<p>
è·Ÿ Identity ä¸€æ ·ï¼Œæˆ‘ä»¬ç”¨ newtype æ¥å®šä¹‰ä¸€ä¸ªåŒæ„çš„ Reader ç±»å‹
</p>
<pre class="code"><code><span style="font-weight: bold;">newtype</span> <span style="font-weight: bold; text-decoration: underline;">Reader</span> e a <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Reader</span> { runReader <span style="font-weight: bold; font-style: italic;">::</span> (e <span style="font-weight: bold; font-style: italic;">-&gt;</span> a) }
</code></pre>

<p>
å…¶ä¸­
</p>
<ul class="org-ul">
<li>e æ˜¯è¾“å…¥</li>
<li>a æ˜¯ç»“æœ</li>
<li>æ„é€  Reader ç±»å‹éœ€è¦ç¡®å®š è¾“å…¥çš„ç±»å‹ e ä¸è¾“å‡ºçš„ç±»å‹ a</li>
<li><code>runReader</code> çš„ç±»å‹æ˜¯ <code>runReader:: (Reader e a) -&gt; (e -&gt; a)</code></li>
</ul>

<p>
ä¹Ÿå°±æ˜¯è¯´åœ¨æè¿°å®Œä¸€ä¸ª Reader çš„è®¡ç®—åï¼Œä½¿ç”¨ runReader å¯ä»¥å¾—åˆ°ä¸€ä¸ª e -&gt; a çš„å‡½æ•°ï¼Œä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œå°±å¯ä»¥æ¥æ”¶è¾“å…¥ï¼Œé€šè¿‡æ„é€ å¥½çš„è®¡ç®—ï¼Œç®—å‡ºç»“æœ a è¿”å›ã€‚
</p>

<p>
é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬æ¥å®ç° Reader çš„ monad instanceï¼Œå°±å¯ä»¥æè¿°ä¸€ä¸ªå¯ä»¥ ask çš„è®¡ç®—äº†ã€‚
</p>

<pre class="code"><code><span style="font-weight: bold;">instance</span> <span style="font-weight: bold; text-decoration: underline;">Monad</span> (<span style="font-weight: bold; text-decoration: underline;">Reader</span> e) <span style="font-weight: bold;">where</span>
    return a         <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Reader</span> <span style="font-weight: bold; font-style: italic;">$</span> <span style="font-weight: bold; font-style: italic;">\</span><span style="font-weight: bold;">_</span> <span style="font-weight: bold; font-style: italic;">-&gt;</span> a
    (<span style="font-weight: bold; text-decoration: underline;">Reader</span> g) <span style="font-weight: bold; font-style: italic;">&gt;&gt;=</span> f <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Reader</span> <span style="font-weight: bold; font-style: italic;">$</span> <span style="font-weight: bold; font-style: italic;">\</span>e <span style="font-weight: bold; font-style: italic;">-&gt;</span> runReader (f (g e)) e
</code></pre>

<p>
è·ŸEitherä¸€æ ·ï¼Œæˆ‘ä»¬åªèƒ½å®šä¹‰ Reader e çš„ monad instanceã€‚
</p>

<p>
æ³¨æ„è¿™é‡Œçš„
</p>
<ul class="org-ul">
<li>f ç±»å‹æ˜¯ <code>(a -&gt; Reader e a)</code></li>
<li>g å…¶å®å°±æ˜¯æ˜¯ destructure å‡ºæ¥çš„ runReaderï¼Œä¹Ÿå°±æ˜¯ e -&gt; a</li>
<li>æ‰€ä»¥ (g e) è¿”å› a</li>
<li>f (g e) å°±æ˜¯ <code>Reader e a</code></li>
<li>å† run ä¸€æŠŠæœ€åå¾—åˆ° a</li>
</ul>


<figure>
<img src="images/p2-reader-monad.png" alt="p2-reader-monad.png">

<figcaption><span class="figure-number">Figure 5: </span>f å‡½æ•°ï¼Œæ¥æ”¶ a è¿”å›ä¸€ä¸ª ä» e åˆ° a çš„ Reader</figcaption>
</figure>

<p>
è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Reader
</p>
<pre class="code"><code><span style="font-weight: bold;">import</span> <span style="font-weight: bold; text-decoration: underline;">Control.Monad.Reader</span>

<span style="font-weight: bold;">data</span> <span style="font-weight: bold; text-decoration: underline;">Environment</span> <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Env</span>
  { fistName <span style="font-weight: bold; font-style: italic;">::</span> <span style="font-weight: bold; text-decoration: underline;">String</span>
  , lastName <span style="font-weight: bold; font-style: italic;">::</span> <span style="font-weight: bold; text-decoration: underline;">String</span>
  } <span style="font-weight: bold;">deriving</span> (<span style="font-weight: bold; text-decoration: underline;">Show</span>)

<span style="font-weight: bold;">helloworld</span> <span style="font-weight: bold; font-style: italic;">::</span> <span style="font-weight: bold; text-decoration: underline;">Reader</span> <span style="font-weight: bold; text-decoration: underline;">Environment</span> <span style="font-weight: bold; text-decoration: underline;">String</span>
<span style="font-weight: bold;">helloworld</span> <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold;">do</span>
  f <span style="font-weight: bold; font-style: italic;">&lt;-</span> asks firstName
  l <span style="font-weight: bold; font-style: italic;">&lt;-</span> asks lastName
  return <span style="font-style: italic;">"Hello "</span> <span style="font-weight: bold; font-style: italic;">++</span> f <span style="font-weight: bold; font-style: italic;">++</span> l

<span style="font-weight: bold;">runHelloworld</span> <span style="font-weight: bold; font-style: italic;">::</span> <span style="font-weight: bold; text-decoration: underline;">String</span>
<span style="font-weight: bold;">runHelloworld</span> <span style="font-weight: bold; font-style: italic;">=</span> runReader helloworld <span style="font-weight: bold; font-style: italic;">$</span> <span style="font-weight: bold; text-decoration: underline;">Env</span> <span style="font-style: italic;">"Jichao"</span> <span style="font-style: italic;">"Ouyang"</span>
</code></pre>

<p>
è¿™æ®µä»£ç å¾ˆç®€å•ï¼Œhelloworld è´Ÿè´£æ‰“æ‹›å‘¼ï¼Œä¹Ÿå°±æ˜¯åœ¨åå­—å‰é¢åŠ ä¸ª "Hello"ï¼Œè€Œè·Ÿè°æ‰“æ‹›å‘¼ï¼Œè¿™ä¸ªå‡½æ•°å¹¶ä¸å…³å¿ƒï¼Œè€Œå•çº¯çš„æ˜¯å‘ Environment <ruby>é—®<rt>asks</rt></ruby> å°±å¥½ã€‚
</p>


<figure>
<img src="images/p2-reader-monad-ask.png" alt="p2-reader-monad-ask.png">

<figcaption><span class="figure-number">Figure 6: </span>asks å¯ä»¥å°† e -&gt; a çš„å‡½æ•°å˜æ¢æˆ Reader e a</figcaption>
</figure>

<p>
åœ¨è¿è¡Œæ—¶ï¼Œå¯ä»¥æä¾›ç»™ Reader çš„è¾“å…¥ Env fistname lastnameã€‚
<img src="images/p2-reader-monad-run.png" alt="p2-reader-monad-run.png">
</p>
</div>

<div id="outline-container-org35a68ff" class="outline-4">
<h4 id="org35a68ff">do notation</h4>
<div class="outline-text-4" id="text-org35a68ff">
<p>
è¿™å¯èƒ½æ˜¯ä½ ç¬¬ä¸€æ¬¡è§åˆ° <code>do</code> å’Œ <code>&lt;-</code>. å¦‚æœä¸æ˜¯ï¼Œéšæ„è·³è¿‡è¿™èŠ‚ã€‚
</p>

<ul class="org-ul">
<li>do ä¸­æ‰€æœ‰ &lt;- çš„å³è¾¹éƒ½æ˜¯ <code>Reader Environment String</code> ç±»å‹</li>
<li>do ä¸­çš„ return è¿”å›ç±»å‹ä¹Ÿå¿…é¡»ä¸º  <code>Reader Environment String</code></li>
<li><code>asks firstName</code> è¿”å›çš„æ˜¯ <code>Reader Environment String</code> ç±»å‹ï¼Œ <code>&lt;-</code> å¯ä»¥ç†è§£æˆå§ monad <code>Reader Environment</code> çš„å†…å®¹æ”¾åˆ°å·¦è¾¹çš„ f, æ‰€ä»¥ f çš„ç±»å‹æ˜¯ Stringã€‚</li>
</ul>

<p>
çœ‹èµ·æ¥åƒå‘½ä»¤å¼çš„è¯­å¥ï¼Œå…¶å®åªæ˜¯ <code>&gt;&gt;=</code> çš„è¯­æ³•ç³–ï¼Œä½†æ˜¯æ˜æ˜¾ç”¨doå¯è¯»æ€§è¦é«˜å¾ˆå¤šã€‚
</p>
<pre class="code"><code><span style="font-weight: bold;">helloworld</span> <span style="font-weight: bold; font-style: italic;">=</span> (asks firstName) <span style="font-weight: bold; font-style: italic;">&gt;&gt;=</span>
  <span style="font-weight: bold; font-style: italic;">\</span>f <span style="font-weight: bold; font-style: italic;">-&gt;</span> (asks lastName) <span style="font-weight: bold; font-style: italic;">&gt;&gt;=</span>
       <span style="font-weight: bold; font-style: italic;">\</span>l <span style="font-weight: bold; font-style: italic;">-&gt;</span> return <span style="font-style: italic;">"Hello "</span> <span style="font-weight: bold; font-style: italic;">++</span> f <span style="font-weight: bold; font-style: italic;">++</span> l
</code></pre>
</div>
</div>
</div>


<div id="outline-container-org19815bf" class="outline-3">
<h3 id="org19815bf">Writer</h3>
<div class="outline-text-3" id="text-org19815bf">
<p>
é™¤äº†è¿”å›å€¼ï¼Œè®¡ç®—ä¼šéœ€è¦äº§ç”Ÿä¸€äº›é¢å¤–çš„æ•°æ®ï¼Œæ¯”å¦‚ log
</p>

<p>
æ­¤æ—¶å°±éœ€è¦ä¸€ä¸ª Writterï¼Œå…¶è¿”å›å€¼ä¼šæ˜¯ä¸€ä¸ªè¿™æ · <code>(result, log)</code> çš„ tuple
</p>

<p>
é™åˆ¶æ˜¯ log çš„ç±»å‹å¿…é¡»æ˜¯ä¸ª <ruby>å«å¹ºåŠç¾¤<rt>monoid</rt></ruby>
</p>

<pre class="code"><code><span style="font-weight: bold;">example</span> <span style="font-weight: bold; font-style: italic;">::</span> <span style="font-weight: bold; text-decoration: underline;">Writer</span> <span style="font-weight: bold; text-decoration: underline;">String</span> <span style="font-weight: bold; text-decoration: underline;">String</span>
<span style="font-weight: bold;">example</span>  <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold;">do</span>
  tell <span style="font-style: italic;">"How are you?"</span>
  tell <span style="font-style: italic;">"I'm fine thank you, and you?"</span>
  return <span style="font-style: italic;">"Hehe Da~"</span>

<span style="font-weight: bold;">output</span> <span style="font-weight: bold; font-style: italic;">::</span> (<span style="font-weight: bold; text-decoration: underline;">String</span>, <span style="font-weight: bold; text-decoration: underline;">String</span>)
<span style="font-weight: bold;">output</span> <span style="font-weight: bold; font-style: italic;">=</span> runWriter example
<span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">("Hehe Da~", "How are you?I'm fine thank you, and you?")</span>
</code></pre>

<p>
Writer çš„å®šä¹‰æ›´ç®€å•
</p>
<pre class="code"><code><span style="font-weight: bold;">newtype</span> <span style="font-weight: bold; text-decoration: underline;">Writer</span> l a <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Writer</span> { runWriter <span style="font-weight: bold; font-style: italic;">::</span> (a,l) }
</code></pre>
<p>
é‡Œé¢åªæ˜¯ä¸€ä¸ª tuple è€Œå·²
</p>
<ul class="org-ul">
<li>w æ˜¯ log</li>
<li>a æ˜¯ è¿”å›å€¼</li>
</ul>

<p>
çœ‹çœ‹å¦‚ä½•å®ç° Writer monad
</p>
<pre class="code"><code><span style="font-weight: bold;">instance</span> (<span style="font-weight: bold; text-decoration: underline;">Monoid</span> w) <span style="font-weight: bold; font-style: italic;">=&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Monad</span> (<span style="font-weight: bold; text-decoration: underline;">Writer</span> w) <span style="font-weight: bold;">where</span>
    return a             <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Writer</span> (a,mempty)
    (<span style="font-weight: bold; text-decoration: underline;">Writer</span> (a,l)) <span style="font-weight: bold; font-style: italic;">&gt;&gt;=</span> f <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold;">let</span> (a',l') <span style="font-weight: bold; font-style: italic;">=</span> runWriter <span style="font-weight: bold; font-style: italic;">$</span> f a <span style="font-weight: bold;">in</span>
                           <span style="font-weight: bold; text-decoration: underline;">Writer</span> (a',l <span style="font-weight: bold; font-style: italic;">`mappend`</span> l')
</code></pre>

<ul class="org-ul">
<li>return ä¸ä¼šæœ‰ä»»ä½• logï¼Œl æ˜¯ monoid çš„ mempty</li>
<li>f çš„ç±»å‹ä¸º <code>a -&gt; Writer l a</code></li>
<li><code>runWriter $ f a</code> è¿”å› <code>(a, l)</code></li>
</ul>


<figure>
<img src="images/p2-writer-monad.png" alt="p2-writer-monad.png">

</figure>

<p>
æ‰€ä»¥åœ¨ &gt;&gt;= æ—¶ï¼Œæˆ‘ä»¬å…ˆæŠŠ f a è¿”å›çš„ Writer runäº†ï¼Œç„¶åæŠŠä¸¤æ¬¡ log <code>mappend</code> èµ·æ¥ã€‚
<img src="images/p2-writer-monad-bind.png" alt="p2-writer-monad-bind.png">
</p>
</div>
</div>

<div id="outline-container-org9c1b96b" class="outline-3">
<h3 id="org9c1b96b">State</h3>
<div class="outline-text-3" id="text-org9c1b96b">
<p>
è·Ÿåå­—å°±çœ‹å¾—å‡ºæ¥ State monad æ˜¯ä¸ºäº†å¤„ç†çŠ¶æ€ã€‚è™½ç„¶å‡½æ•°å¼ç¼–ç¨‹ä¸åº”è¯¥æœ‰çŠ¶æ€ï¼Œä¸ç„¶ä¼šå¼•ç”¨é€æ˜æ€§ã€‚ä½†æ˜¯ï¼Œstate monadå¹¶ä¸æ˜¯åœ¨è®¡ç®—è¿‡ç¨‹ä¸­ä¿®æ”¹çŠ¶æ€ï¼Œè€Œæ˜¯é€šè¿‡æè¿°è¿™ç§å˜åŒ–ï¼Œç„¶åéœ€è¦æ—¶åœ¨è¿è¡Œè¿”å›æœ€ç»ˆç»“æœã€‚è¿™ä¸€ç‚¹è·Ÿ Reader å’Œ Writer è¿™ä¸¤ä¸ªçœ‹èµ·æ¥æ˜¯å‰¯ä½œç”¨çš„ IO æ˜¯ä¸€æ ·çš„ã€‚
</p>

<p>
å…ˆçœ‹ä¸‹ State ç±»å‹çš„å®šä¹‰
</p>
<pre class="code"><code><span style="font-weight: bold;">newtype</span> <span style="font-weight: bold; text-decoration: underline;">State</span> s a <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">State</span> { runState <span style="font-weight: bold; font-style: italic;">::</span> s <span style="font-weight: bold; font-style: italic;">-&gt;</span> (a, s) }
</code></pre>

<p>
å¯ä»¥çœ‹åˆ° State åªåŒ…å«ä¸€ä¸ª ä»æ—§çŠ¶æ€ s åˆ°æ–°çŠ¶æ€ s å’Œè¿”å›å€¼ a çš„ Tuple çš„å‡½æ•°ã€‚
</p>

<p>
é€šè¿‡å®ç° Monadï¼ŒState å°±å¯ä»¥å®ç°å‘½ä»¤å¼ç¼–ç¨‹ä¸­çš„å˜é‡çš„åŠŸèƒ½ã€‚
</p>
<pre class="code"><code><span style="font-weight: bold;">instance</span> <span style="font-weight: bold; text-decoration: underline;">Monad</span> (<span style="font-weight: bold; text-decoration: underline;">State</span> s) <span style="font-weight: bold;">where</span>
  return a        <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">State</span> <span style="font-weight: bold; font-style: italic;">$</span> <span style="font-weight: bold; font-style: italic;">\</span>s <span style="font-weight: bold; font-style: italic;">-&gt;</span> (a,s)
  (<span style="font-weight: bold; text-decoration: underline;">State</span> x) <span style="font-weight: bold; font-style: italic;">&gt;&gt;=</span> f <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">State</span> <span style="font-weight: bold; font-style: italic;">$</span> <span style="font-weight: bold; font-style: italic;">\</span>s <span style="font-weight: bold; font-style: italic;">-&gt;</span> <span style="font-weight: bold;">let</span> (v,s') <span style="font-weight: bold; font-style: italic;">=</span> x s <span style="font-weight: bold;">in</span>
                                 runState (f v) s'
</code></pre>
<p>
return å¾ˆç®€å•ï¼Œå°±ä¸ç”¨è§£é‡Šäº†ã€‚
</p>


<figure>
<img src="images/p2-state-monad.png" alt="p2-state-monad.png">

</figure>

<p>
x ç±»å‹æ˜¯ <code>s -&gt; (a, s)</code> ,æ‰€ä»¥ x s ä¹‹åä¼šè¿”å› ç»“æœå’ŒçŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¿è¡Œå½“å‰ Stateï¼ŒæŠŠç»“æœ v ä¼ ç»™å‡½æ•° fï¼Œè¿”å›çš„ State å†æ¥ç€ä¸Šæ¬¡çŠ¶æ€è¿è¡Œã€‚
</p>


<figure>
<img src="images/p2-state-monad-bind.png" alt="p2-state-monad-bind.png">

<figcaption><span class="figure-number">Figure 9: </span>State x &gt;&gt;= f årunStateçš„æ•°æ®æµï¼ˆå•Šå•Šå•Šï¼Œç”»æ­ªäº†ï¼Œæ„Ÿè§‰éœ€è¦è„‰åŠ¨ä¸€ä¸‹ï¼‰</figcaption>
</figure>

<p>
ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆæ–¹ä¾¿ï¼ŒState æä¾› <code>get</code> <code>put</code> <code>moidfy</code> ä¸‰ä¸ªæ–¹ä¾¿çš„å‡½æ•°å¯ä»¥ç”Ÿæˆä¿®æ”¹çŠ¶æ€çš„State monad
</p>

<pre class="code"><code><span style="font-weight: bold;">import</span> <span style="font-weight: bold; text-decoration: underline;">Control.Monad.Trans.State.Strict</span>
<span style="font-weight: bold;">test</span> <span style="font-weight: bold; font-style: italic;">::</span> <span style="font-weight: bold; text-decoration: underline;">State</span> <span style="font-weight: bold; text-decoration: underline;">Int</span> <span style="font-weight: bold; text-decoration: underline;">Int</span>
<span style="font-weight: bold;">test</span> <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold;">do</span>
  a <span style="font-weight: bold; font-style: italic;">&lt;-</span> get
  modify (<span style="font-weight: bold; font-style: italic;">+</span>1)
  b <span style="font-weight: bold; font-style: italic;">&lt;-</span> get
  return (a <span style="font-weight: bold; font-style: italic;">+</span> b)

<span style="font-weight: bold;">main</span> <span style="font-weight: bold; font-style: italic;">=</span> print <span style="font-weight: bold; font-style: italic;">$</span> show <span style="font-weight: bold; font-style: italic;">$</span> runState test 3
<span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">(7, 4)</span>
</code></pre>
</div>
</div>


<div id="outline-container-org44f0c0f" class="outline-3">
<h3 id="org44f0c0f">Validation</h3>
<div class="outline-text-3" id="text-org44f0c0f">
<p>
å¦‚æœä½ æœ‰æ³¨æ„åˆ°ï¼Œå‰é¢çš„ Either å¯ä»¥ç”¨åœ¨å¤„ç†é”™è¯¯å’Œæ­£ç¡®çš„è·¯å¾„åˆ†æ”¯ï¼Œä½†æ˜¯é—®é¢˜æ˜¯é”™è¯¯åªå‘ç”Ÿä¸€æ¬¡ã€‚
</p>

<div class="epigraph"><blockquote>
<p>
Validation æ²¡æœ‰åœ¨æ ‡å‡†åº“ä¸­ï¼Œä½†æ˜¯æˆ‘è§‰å¾—å¥½æœ‰ç”¨å•Šï¼Œä½ å¯ä»¥åœ¨ ekmett çš„ <a href="https://github.com/ekmett/either">github</a> ä¸­æ‰¾åˆ°æºç 
</p>

</blockquote></div>

<p>
æƒ³è±¡ä¸€ä¸‹è¿™ç§åœºæ™¯ï¼Œç”¨æˆ·æäº¤ä¸€ä¸ªè¡¨å•ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸€ä¸ªfieldè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œéœ€è¦æŠŠé”™è¯¯çš„å“ªå‡ ä¸ªfieldçš„é”™è¯¯æ¶ˆæ¯è¿”å›ã€‚æ˜¾ç„¶å¦‚æœä½¿ç”¨ Either æ¥åšï¼Œåªèƒ½è¿”å›ç¬¬ä¸€ä¸ªfieldçš„é”™è¯¯ä¿¡æ¯ï¼Œåé¢çš„è®¡ç®—éƒ½ä¼šè¢«è·³è¿‡ã€‚
</p>

<p>
é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œ Validation æ›´é€‚åˆ
</p>
<pre class="code"><code><span style="font-weight: bold;">data</span> <span style="font-weight: bold; text-decoration: underline;">Validation</span> e a <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Failure</span> e <span style="font-weight: bold; font-style: italic;">|</span> <span style="font-weight: bold; text-decoration: underline;">Success</span> a
</code></pre>

<p>
ADTå®šä¹‰çœ‹èµ·æ¥è·Ÿ Either æ˜¯ä¸€æ ·çš„ï¼Œä¸åŒçš„æ˜¯ <ruby>å·¦è¾¹<rt>Left</rt></ruby> Failure æ˜¯ <ruby>å«å¹ºåŠç¾¤<rt>Monoid</rt></ruby>
</p>
</div>

<div id="outline-container-org29e6753" class="outline-4">
<h4 id="org29e6753"><ruby>å«å¹ºåŠç¾¤<rt>Monoid</rt></ruby></h4>
<div class="outline-text-4" id="text-org29e6753">
<p>
monoid é¦–å…ˆå¾—æ˜¯ <ruby>åŠç¾¤<rt>Semigroup</rt></ruby> ï¼Œç„¶åå† å«å¹ºã€‚
</p>
<pre class="code"><code><span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Semigroup</span> a <span style="font-weight: bold;">where</span>
  (<span style="font-weight: bold; font-style: italic;">&lt;&gt;</span>) <span style="font-weight: bold; font-style: italic;">::</span> a <span style="font-weight: bold; font-style: italic;">-&gt;</span> a <span style="font-weight: bold; font-style: italic;">-&gt;</span> a
  (<span style="font-weight: bold; font-style: italic;">&lt;&gt;</span>) <span style="font-weight: bold; font-style: italic;">=</span> mappend
</code></pre>

<p>
åŠç¾¤éå¸¸ç®€å•ï¼Œåªè¦æ˜¯å¯ä»¥ <code>&lt;&gt;</code> (mappend) çš„ç±»å‹å°±æ˜¯äº†ã€‚
</p>

<p>
å«å¹ºåªéœ€è¦æœ‰ä¸€ä¸ª <code>mempty</code> çš„ å¹ºå…ƒå°±è¡Œ
</p>
<pre class="code"><code><span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Monoid</span> a <span style="font-weight: bold;">where</span>
  mempty  <span style="font-weight: bold; font-style: italic;">::</span> a
  mappend <span style="font-weight: bold; font-style: italic;">::</span> a <span style="font-weight: bold; font-style: italic;">-&gt;</span> a <span style="font-weight: bold; font-style: italic;">-&gt;</span> a
</code></pre>

<p>
æ¯”å¦‚ List å°±æ˜¯ Semigroup
</p>
<pre class="code"><code><span style="font-weight: bold;">instance</span> <span style="font-weight: bold; text-decoration: underline;">Semigroup</span> [a] <span style="font-weight: bold;">where</span>
  (<span style="font-weight: bold; font-style: italic;">&lt;&gt;</span>) <span style="font-weight: bold; font-style: italic;">=</span> (<span style="font-weight: bold; font-style: italic;">++</span>)
</code></pre>
<p>
ä¹Ÿæ˜¯ Monoid
</p>
<pre class="code"><code><span style="font-weight: bold;">instance</span> <span style="font-weight: bold; text-decoration: underline;">Monoid</span> [a] <span style="font-weight: bold;">where</span>
  mempty  <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">[]</span>
  mappend <span style="font-weight: bold; font-style: italic;">=</span> (<span style="font-weight: bold; font-style: italic;">++</span>)
</code></pre>

<p>
Monoid çš„ <code>&lt;&gt;</code> æ»¡è¶³ï¼š
</p>
<ul class="org-ul">
<li>mempty &lt;&gt; a = a</li>
<li>a &lt;&gt; b &lt;&gt; c = a &lt;&gt; (b &lt;&gt; c)</li>
</ul>
</div>
</div>
<div id="outline-container-orgb04c087" class="outline-4">
<h4 id="orgb04c087">å›åˆ° Validation</h4>
<div class="outline-text-4" id="text-orgb04c087">
<p>
ç°åœ¨è®© Failure e æ»¡è¶³ Monoidï¼Œå°±å¯ä»¥ <code>mappend</code> é”™è¯¯ä¿¡æ¯äº†ã€‚
</p>
<pre class="code"><code><span style="font-weight: bold;">instance</span> <span style="font-weight: bold; text-decoration: underline;">Semigroup</span> e <span style="font-weight: bold; font-style: italic;">=&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Semigroup</span> (<span style="font-weight: bold; text-decoration: underline;">Validation</span> e a) <span style="font-weight: bold;">where</span>
  <span style="font-weight: bold; text-decoration: underline;">Failure</span> e1 <span style="font-weight: bold; font-style: italic;">&lt;&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Failure</span> e2 <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Failure</span> (e1 <span style="font-weight: bold; font-style: italic;">&lt;&gt;</span> e2)
  <span style="font-weight: bold; text-decoration: underline;">Failure</span> <span style="font-weight: bold;">_</span>  <span style="font-weight: bold; font-style: italic;">&lt;&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Success</span> a2 <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Success</span> a2
  <span style="font-weight: bold; text-decoration: underline;">Success</span> a1 <span style="font-weight: bold; font-style: italic;">&lt;&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Failure</span> <span style="font-weight: bold;">_</span>  <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Success</span> a1
  <span style="font-weight: bold; text-decoration: underline;">Success</span> a1 <span style="font-weight: bold; font-style: italic;">&lt;&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Success</span> <span style="font-weight: bold;">_</span>  <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Success</span> a1
</code></pre>

<p>
ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹ Validation ä¸ Either æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚
</p>

<p>
å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªformï¼Œéœ€è¦è¾“å…¥å§“åä¸ç”µè¯ï¼ŒéªŒè¯éœ€è¦å§“åæ˜¯éç©ºè€Œç”µè¯æ˜¯11ä½æ•°å­—ã€‚
</p>

<p>
é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªå‡½æ•°å»åˆ›å»ºåŒ…å«å§“åå’Œç”µè¯çš„model
</p>
<pre class="code"><code><span style="font-weight: bold;">data</span> <span style="font-weight: bold; text-decoration: underline;">Info</span> <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Info</span> {name<span style="font-weight: bold; text-decoration: underline;">:</span> <span style="font-weight: bold; text-decoration: underline;">String</span>, phone<span style="font-weight: bold; text-decoration: underline;">:</span> <span style="font-weight: bold; text-decoration: underline;">String</span>} <span style="font-weight: bold;">deriving</span> <span style="font-weight: bold; text-decoration: underline;">Show</span>
</code></pre>

<p>
ç„¶åæˆ‘ä»¬éœ€è¦éªŒè¯å‡½æ•°
</p>
<pre class="code"><code><span style="font-weight: bold;">notEmpty</span> <span style="font-weight: bold; font-style: italic;">::</span> <span style="font-weight: bold; text-decoration: underline;">String</span> <span style="font-weight: bold; font-style: italic;">-&gt;</span> <span style="font-weight: bold; text-decoration: underline;">String</span> <span style="font-weight: bold; font-style: italic;">-&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Validation</span> [<span style="font-weight: bold; text-decoration: underline;">String</span>] <span style="font-weight: bold; text-decoration: underline;">String</span>
<span style="font-weight: bold;">notEmpty</span> desc <span style="font-style: italic;">""</span> <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Failure</span> [desc <span style="font-weight: bold; font-style: italic;">&lt;&gt;</span> <span style="font-style: italic;">" cannot be empty!"</span>]
<span style="font-weight: bold;">notEmpty</span> <span style="font-weight: bold;">_</span> field <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Success</span> field
</code></pre>
<p>
notEmpty æ£€æŸ¥å­—ç¬¦æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ˜¯ç©ºè¿”å› Failure åŒ…å«é”™è¯¯ä¿¡æ¯ï¼Œè‹¥æ˜¯éç©ºåˆ™è¿”å› Success åŒ…å« field
</p>

<p>
åŒæ ·çš„å¯ä»¥åˆ›å»º 11ä½æ•°å­—çš„éªŒè¯å‡½æ•°
</p>
<pre class="code"><code><span style="font-weight: bold;">phoneNumberLength</span> <span style="font-weight: bold; font-style: italic;">::</span> <span style="font-weight: bold; text-decoration: underline;">String</span> <span style="font-weight: bold; font-style: italic;">-&gt;</span> <span style="font-weight: bold; text-decoration: underline;">String</span> <span style="font-weight: bold; font-style: italic;">-&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Validation</span> [<span style="font-weight: bold; text-decoration: underline;">String</span>] <span style="font-weight: bold; text-decoration: underline;">String</span>
<span style="font-weight: bold;">phoneNumberLength</span> desc field <span style="font-weight: bold; font-style: italic;">|</span> (length field) <span style="font-weight: bold; font-style: italic;">==</span> 11 <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Success</span> field
                             <span style="font-weight: bold; font-style: italic;">|</span> otherwise <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Failure</span> [desc <span style="font-weight: bold; font-style: italic;">&lt;&gt;</span> <span style="font-style: italic;">"'s length is not 11"</span>]
</code></pre>
<p>
å®ç° Validation çš„ Applicative instanceï¼Œè¿™æ ·å°±å¯ä»¥æŠŠå‡½æ•°è°ƒç”¨liftæˆå¸¦æœ‰éªŒè¯çš„ Applicative
</p>
<pre class="code"><code><span style="font-weight: bold;">instance</span> <span style="font-weight: bold; text-decoration: underline;">Semigroup</span> e <span style="font-weight: bold; font-style: italic;">=&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Applicative</span> (<span style="font-weight: bold; text-decoration: underline;">Validation</span> e) <span style="font-weight: bold;">where</span>
  pure <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Success</span>
  <span style="font-weight: bold; text-decoration: underline;">Failure</span> e1 <span style="font-weight: bold; font-style: italic;">&lt;*&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Failure</span> e2 <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Failure</span> e1 <span style="font-weight: bold; font-style: italic;">&lt;&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Failure</span> e2
  <span style="font-weight: bold; text-decoration: underline;">Failure</span> e1 <span style="font-weight: bold; font-style: italic;">&lt;*&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Success</span> <span style="font-weight: bold;">_</span>  <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Failure</span> e1
  <span style="font-weight: bold; text-decoration: underline;">Success</span> <span style="font-weight: bold;">_</span>  <span style="font-weight: bold; font-style: italic;">&lt;*&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Failure</span> e2 <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Failure</span> e2
  <span style="font-weight: bold; text-decoration: underline;">Success</span> f <span style="font-weight: bold; font-style: italic;">&lt;*&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Success</span> a <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Success</span> (f a)
</code></pre>
<ul class="org-ul">
<li>å¤±è´¥åº”ç”¨åˆ°å¤±è´¥ä¼š concat èµ·æ¥</li>
<li>å¤±è´¥è·Ÿåº”ç”¨æˆ–è¢«æˆåŠŸåº”ç”¨è¿˜æ˜¯å¤±è´¥</li>
<li>åªæœ‰æˆåŠŸåº”ç”¨åˆ°æˆåŠŸæ‰èƒ½æˆåŠŸï¼Œè¿™å¾ˆç¬¦åˆéªŒè¯çš„é€»è¾‘ï¼Œä¸€æ—¦éªŒè¯ä¸­å‘ç”Ÿä»»ä½•é”™è¯¯ï¼Œéƒ½åº”è¯¥è¿”å›å¤±è´¥ã€‚</li>
</ul>

<pre class="code"><code><span style="font-weight: bold;">createInfo</span> <span style="font-weight: bold; font-style: italic;">::</span> <span style="font-weight: bold; text-decoration: underline;">String</span> <span style="font-weight: bold; font-style: italic;">-&gt;</span> <span style="font-weight: bold; text-decoration: underline;">String</span> <span style="font-weight: bold; font-style: italic;">-&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Validation</span> [<span style="font-weight: bold; text-decoration: underline;">String</span>] <span style="font-weight: bold; text-decoration: underline;">Info</span>
<span style="font-weight: bold;">createInfo</span> name phone <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Info</span> <span style="font-weight: bold; font-style: italic;">&lt;$&gt;</span> notEmpty <span style="font-style: italic;">"name"</span> name <span style="font-weight: bold; font-style: italic;">&lt;*&gt;</span> phoneNumberLength <span style="font-style: italic;">"phone"</span> phone
</code></pre>

<p>
ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¸¦validationçš„ createInfo æ¥å®‰å…¨çš„åˆ›å»º Info äº†
</p>

<pre class="code"><code><span style="font-weight: bold;">createInfo</span> <span style="font-style: italic;">"jichao"</span> <span style="font-style: italic;">"12345678910"</span> <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">Success Info "jichao" "12345678910"</span>
<span style="font-weight: bold;">createInfo</span> <span style="font-style: italic;">""</span> <span style="font-style: italic;">"123"</span> <span style="font-weight: bold; font-style: italic;">-- </span><span style="font-weight: bold; font-style: italic;">Failure ["name cannot be empty!", "phone's length is not 11"]</span>
</code></pre>
</div>
</div>
</div>

<div id="outline-container-orga3b85dc" class="outline-3">
<h3 id="orga3b85dc">Cont</h3>
<div class="outline-text-3" id="text-orga3b85dc">
<p>
Cont æ˜¯ <ruby>Continuation Passing Style<rt>CPS</rt></ruby> çš„ monadï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯åŒ…å« cps è®¡ç®— monadã€‚
</p>

<p>
å…ˆçœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯ CPSï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªåŠ æ³•
</p>
<pre class="code"><code><span style="font-weight: bold;">add</span> <span style="font-weight: bold; font-style: italic;">::</span> <span style="font-weight: bold; text-decoration: underline;">Int</span> <span style="font-weight: bold; font-style: italic;">-&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Int</span> <span style="font-weight: bold; font-style: italic;">-&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Int</span>
<span style="font-weight: bold;">add</span> <span style="font-weight: bold; font-style: italic;">=</span> (<span style="font-weight: bold; font-style: italic;">+</span>)
</code></pre>

<p>
ä½†æ˜¯å¦‚æœä½ æƒ³åœ¨ç®—æ³•åŠ æ³•åï¼Œèƒ½å¤Ÿç»§ç»­è¿›è¡Œä¸€ä¸ªå…¶ä»–çš„è®¡ç®—ï¼Œé‚£ä¹ˆå°±å¯ä»¥å†™ä¸€ä¸ª cpsç‰ˆæœ¬çš„åŠ æ³•
</p>
<pre class="code"><code><span style="font-weight: bold;">addCPS</span> <span style="font-weight: bold; font-style: italic;">::</span> <span style="font-weight: bold; text-decoration: underline;">Int</span> <span style="font-weight: bold; font-style: italic;">-&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Int</span> <span style="font-weight: bold; font-style: italic;">-&gt;</span> (<span style="font-weight: bold; text-decoration: underline;">Int</span> <span style="font-weight: bold; font-style: italic;">-&gt;</span> r) <span style="font-weight: bold; font-style: italic;">-&gt;</span> r
<span style="font-weight: bold;">addCPS</span> a b k <span style="font-weight: bold; font-style: italic;">=</span> k (a <span style="font-weight: bold; font-style: italic;">+</span> b)
</code></pre>

<p>
éå¸¸ç®€å•ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ª Cont monad æ¥åŒ…ä½ CPS è®¡ç®—ï¼Œé¦–å…ˆï¼Œæ¥çœ‹ ADT å®šä¹‰
</p>
<pre class="code"><code><span style="font-weight: bold;">newtype</span> <span style="font-weight: bold; text-decoration: underline;">Cont</span> r a <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Cont</span> { runCont <span style="font-weight: bold; font-style: italic;">::</span> ((a <span style="font-weight: bold; font-style: italic;">-&gt;</span> r) <span style="font-weight: bold; font-style: italic;">-&gt;</span> r) }
</code></pre>

<p>
åˆæ˜¯ä¸€ä¸ªåŒæ„çš„ç±»å‹ï¼ŒCont æ„é€ å™¨åªéœ€è¦ä¸€ä¸ª runCountï¼Œä¹Ÿå°±æ˜¯è®©ä»–èƒ½ç»§ç»­è®¡ç®—çš„ä¸€ä¸ªå‡½æ•°ã€‚
</p>

<p>
å®Œäº†ä¹‹åæ¥æŠŠä¹‹å‰çš„ addCPS æ”¹æˆ Cont
</p>
<pre class="code"><code><span style="font-weight: bold;">add</span> <span style="font-weight: bold; font-style: italic;">::</span> <span style="font-weight: bold; text-decoration: underline;">Int</span> <span style="font-weight: bold; font-style: italic;">-&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Int</span> <span style="font-weight: bold; font-style: italic;">-&gt;</span> <span style="font-weight: bold; text-decoration: underline;">Cont</span> k <span style="font-weight: bold; text-decoration: underline;">Int</span>
<span style="font-weight: bold;">add</span> a b <span style="font-weight: bold; font-style: italic;">=</span> return (a <span style="font-weight: bold; font-style: italic;">+</span> b)
</code></pre>

<p>
æ³¨æ„åˆ° addCPS æ¥æ”¶åˆ° a å’Œ b ä¹‹åè¿”å›çš„ç±»å‹æ˜¯ <code>(Int -&gt; r) -&gt; r</code> ï¼Œè€Œ Cont ç‰ˆæœ¬çš„ <code>add</code> è¿”å› <code>Cont k Int</code>
</p>

<p>
æ˜æ˜¾æ„é€  <code>Cont k Int</code> ä¹Ÿæ­£æ˜¯éœ€è¦ <code>(Int -&gt; r) -&gt; r</code> ï¼Œæ‰€ä»¥ Cont å°±æ˜¯ç®—äº† k çš„æŠ½è±¡äº†ã€‚
</p>

<pre class="code"><code><span style="font-weight: bold;">instance</span> <span style="font-weight: bold; text-decoration: underline;">Monad</span> (<span style="font-weight: bold; text-decoration: underline;">Cont</span> r) <span style="font-weight: bold;">where</span>
    return a <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Cont</span> (<span style="font-weight: bold; font-style: italic;">$</span> a)
    m <span style="font-weight: bold; font-style: italic;">&gt;&gt;=</span> k  <span style="font-weight: bold; font-style: italic;">=</span> <span style="font-weight: bold; text-decoration: underline;">Cont</span> <span style="font-weight: bold; font-style: italic;">$</span> <span style="font-weight: bold; font-style: italic;">\</span>c <span style="font-weight: bold; font-style: italic;">-&gt;</span> runCont m <span style="font-weight: bold; font-style: italic;">$</span> <span style="font-weight: bold; font-style: italic;">\</span>a <span style="font-weight: bold; font-style: italic;">-&gt;</span> runCont (k a) c
</code></pre>

<p>
<code>($ a)</code> æ¯”è¾ƒæœ‰æ„æ€, æˆ‘ä»¬éƒ½çŸ¥é“ <code>f $ g a</code> å…¶å®å°±æ˜¯ <code>f(g a)</code>, æ‰€ä»¥ <code>$</code> å…¶å®å°±æ˜¯ä¸€ä¸ª apply å·¦è¾¹çš„å‡½æ•°åˆ°å³è¾¹è¡¨è¾¾å¼çš„ä¸­ç¼€å‡½æ•°, å¦‚æœå†™æˆå‰ç¼€åˆ™æ˜¯
<code>($ (g a) f)</code>. æ˜¯åçš„æ˜¯å› ä¸º <code>$</code> æ˜¯æœ‰ç»“åˆ, éœ€è¦å³è¾¹è¡¨è¾¾å¼å…ˆæ±‚å€¼, æ‰€ä»¥åªç»™ä¸€ä¸ª a å°±ç›¸å½“äº <code>($ a) = \f -&gt; f a</code>
</p>

<p>
å›åˆ° Monad Cont&#x2026;
</p>
</div>
</div>

<div id="outline-container-org7359a6e" class="outline-3">
<h3 id="org7359a6e">Summary</h3>
<div class="outline-text-3" id="text-org7359a6e">
<p>
ç¬¬äºŒéƒ¨åˆ†é£Ÿç”¨éƒ¨åˆ†ä¹Ÿè®²å®Œäº†ï¼Œ ä¸çŸ¥æ˜¯å¦ä»¥åŠå¤§è‡´äº†è§£äº†monadçš„å°¿æ€§å„ç§åŸºæœ¬ç©æ³•å‘¢ï¼Ÿé€šè¿‡è¿™äº›å¸¸ç”¨çš„åŸºæœ¬çš„ monad instanceï¼Œè§£å†³å‘½ä»¤å¼ç¼–ç¨‹ä¸­çš„ä¸€äº›ç®€å•é—®é¢˜åº”è¯¥æ˜¯å¤Ÿäº†ã€‚
</p>

<p>
ä¸è¿‡ï¼Œæ¥ä¸‹æ¥è¿˜æœ‰æ›´å˜æ€çš„çŒ«ï¼Œå°±å…ˆå«å¥¹ <del>æåŸº</del> çŒ«å‘¢å¥½äº†ã€‚
</p>

<ul class="org-ul">
<li>ğŸ‘‰ <a href="./part3.html">ç¬¬ä¸‰éƒ¨åˆ†ï¼š<ruby>æåŸºçŒ«å‘¢<rt> Advanced Monads</rt></ruby></a></li>
</ul>

<p>
å½“ç„¶æˆ‘åˆè¿˜æ²¡ç©ºå…¨éƒ¨å†™å®Œï¼Œå¦‚æœè¿˜æœ‰å¾ˆå¤šäºº<ruby>é¢„å®š<rt>åªè¦998</rt></ruby> Gumroad ä¸Šçš„  <script src="https://gumroad.com/js/gumroad.js"></script><a class="gumroad-button" href="https://gum.co/grokking-monad" target="_blank">Grokking Monad</a> ç”µå­ä¹¦çš„è¯ï¼Œæˆ‘å¯èƒ½ä¼šç¨å¾®å†™å¾—å¿«ä¸€äº›ã€‚æ¯•ç«Ÿï¼Œå†™äº†ä¹Ÿæ²¡äººæ„Ÿå…´è¶£ä¹Ÿæ€ªæµªè´¹æ—¶é—´çš„ã€‚ä¸è¿‡ï¼Œæˆ‘çŒœä¹Ÿæ²¡å‡ ä¸ªäººèƒ½çœ‹åˆ°è¿™ä¸€è¡Œï¼Œå°±å½“æ˜¯æˆ‘åˆè‡ªè¨€è‡ªè¯­å§ï¼Œæ€ä¹ˆåˆçªç„¶è§‰å¾—è‡ªå·±å¥½åˆ†è£‚ï¼Œè¯¶~ï¼Œä¸ºä»€ä¹ˆæˆ‘è¦è¯´åˆï¼Ÿ
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<footer>
  <p>Author: æ¬§é˜³ç»§è¶… <a aria-label="Follow @jcouyang on GitHub" data-count-aria-label="# followers on GitHub" data-count-api="/users/jcouyang#followers" data-count-href="/jcouyang/followers" href="https://github.com/jcouyang" class="github-button">Follow @jcouyang</a></p>
  <p>Modified: 2019-03-27 Wed 02:21</p>
  <p>Generated by: <a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.1 (<a href="https://orgmode.org">Org</a> mode 9.2.2) &#215; <a href="https://github.com/jcouyang/orgpress">OrgPress</a></p>
  <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Unported License</a>.
  <input type="swiftype" class="st-default-search-input" placeholder="Search"/>
  <a class="gumroad-button" href="https://gum.co/grokking-monad?wanted=true" target="_blank" data-gumroad-single-product="true">èŒƒç•´è®ºè£…é€¼æŒ‡å—ï¼Œè¯·è‡ªè§‰æ’é˜Ÿè£…é€¼</a>
  <div id="danmaku-comments"></div>
  <div id="disqus_thread"></div>
</footer>
</div>
</body>
</html>
