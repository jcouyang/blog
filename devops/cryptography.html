<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-10-08 Sat 11:06 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cryptography Cheat Sheet for Developers</title>
<meta name="author" content="Jichao Ouyang" />
<meta name="description" content="With Examples in Haskell!" />
<meta name="keywords" content="devops,secops,haskell,cryptography,security,cipher,symmetric,asymmetric,hmac,pbkdf,scrypt,bcrypt,curve25519,ecc,rsa,dsa,ecdsa" />
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico">
<meta name="theme-color" content="#ffffff">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style/toc.css"/>
<link rel="stylesheet" href="/style/tufte.css"/>
<link rel="stylesheet" href="/style/main.css"/>
<link rel="alternate" type="application/rss+xml" title="Jichao Ouyang" href="https://feeds.oyanglul.us/JichaoOuyangsBlog"/>
<meta property="og:title" content="Cryptography Cheat Sheet for Developers" />
<meta property="og:description" content="With Examples in Haskell!" />
<meta property="og:type" content="article" />
</head>
<body>
<div id="preamble" class="status">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJRFJGX"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<header>
    <a accesskey="h" href="/index.html"> HOME </a> |
    <a href="#" id="edit-in-github">EDIT</a> |
    <a href="https://feeds.oyanglul.us/JichaoOuyangsBlog">RSS</a> |
    <a href="https://blog.oyanglul.us/theindex">INDEX</a> |
    <a accesskey="H" href="/jichao.ouyang.html">ABOUT</a> |
    <a href="https://github.com/jcouyang/blog">GITHUB</a>
</header>
</div>
<div id="content" class="content">
<header>
<h1 class="title">Cryptography Cheat Sheet for Developers</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org5ab163c">The Sheet</a></li>
<li><a href="#org65db9e5">Prerequisites</a></li>
<li><a href="#org00c190e">Encoding</a>
<ul>
<li><a href="#orgecda775">Base</a></li>
<li><a href="#org8ac329d">Privacy-Enhanced Mail(PEM)</a></li>
<li><a href="#orgb649ec6">Public Key Cryptography Standard(PKCS)</a>
<ul>
<li><a href="#orge92c707">PKCS #8</a></li>
<li><a href="#org25be44f">PKCS #1</a></li>
</ul>
</li>
<li><a href="#orge1123cf">JSON Web Token(JWT)</a>
<ul>
<li><a href="#orge86d136">JSON Web Signature (JWS)</a></li>
<li><a href="#orgd6726fb">JSON Web Encryption (JWE)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0d0ad90">Hash Function</a></li>
<li><a href="#org2004a58">Message Authentication Code(MAC)</a>
<ul>
<li><a href="#org7735b84">HMAC</a></li>
<li><a href="#org4b420e2">Poly1305</a></li>
</ul>
</li>
<li><a href="#org9e02139">Key Derivation Function(KDF)</a>
<ul>
<li><a href="#org2ba445d">Password Based Key Derivation Function (PBKDF2)</a></li>
<li><a href="#org7ab1382">Scrypt</a></li>
<li><a href="#org44cb6d9">HMAC-based Extract-and-Expand Key Derivation Function (HKDF)</a></li>
</ul>
</li>
<li><a href="#orge0161ed">Symmetric Ciphers</a>
<ul>
<li><a href="#org35b7d8d">AES</a>
<ul>
<li><a href="#org673c0ba">Counter Mode(CTR)</a></li>
<li><a href="#org199504d">Galois/Counter Mode Synthetic Initialization Vector (GCM-SIV)</a></li>
</ul>
</li>
<li><a href="#org06e81f3">ChaCha20</a>
<ul>
<li><a href="#orgd8a7e34">ChaCha20-Poly1305</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0f69fc6">Asymmetric Ciphers</a>
<ul>
<li><a href="#org85be216">Key Exchange</a></li>
<li><a href="#org7a7fafb">Elliptic Curve Cryptography (ECC)</a>
<ul>
<li><a href="#orga15423f">Elliptic Curve Diffie-Hellman (ECDH)</a></li>
<li><a href="#orge323d23">Curve25519/X25519</a></li>
<li><a href="#org6f2d77a">Elliptic Curve Digital Signature Algorithm (ECDSA)</a></li>
<li><a href="#org68b6afc">Edwards-Curve Digital Signature Algorithm (EdDSA)</a></li>
</ul>
</li>
<li><a href="#org36c9406">RSA</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<p>
This is just a quick reference of cryptography, for developers just be able to tell when and how to use what. Click the reference links(and links there(and links there&#x2026;)) <del>to read</del> to chase the raddit.
</p>

<div class="epigraph"><blockquote>
<p>
RULE No.1 of cryptography: DO NOT implement or invent new cipher yourself!!!
</p>

</blockquote></div>

<p>
Haskell is chosen as programming language for examples since it is concise, interactive, typesafe and cryptonite!<label for="1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="1" class="margin-toggle"/><span class="sidenote">
actually Haskell is chosen because I learnt most of the content in this article while implementing <code>age</code>  in Haskell for my new experimental project <a href="https://github.com/jcouyang/dhall-secret/pull/1">https://github.com/jcouyang/dhall-secret/pull/1</a>  PR welcome btw :)
</span>
</p>

<div id="outline-container-org5ab163c" class="outline-2">
<h2 id="org5ab163c">The Sheet</h2>
<div class="outline-text-2" id="text-org5ab163c">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">Variants/Schemes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><a href="#org00c190e">Encoding/Format</a></td>
<td class="org-left"><a href="#orgecda775">Base</a></td>
<td class="org-left">Base16 Base32 Base64</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">JWT</td>
<td class="org-left"><a href="#orge86d136">JWS</a> <a href="#orgd6726fb">JWE</a> JWK</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">PEM</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><a href="#orgb649ec6">PKCS</a></td>
<td class="org-left">PKCS1 PKCS5 PKCS8 PKCS12/PFX</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><a href="#org0d0ad90">Hash</a></td>
<td class="org-left">MD5</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">SHA</td>
<td class="org-left">SHA1 SHA2 SHA3</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">BLAKE2</td>
<td class="org-left">Blake2b Black2s</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><a href="#org2004a58">MAC</a></td>
<td class="org-left"><a href="#org7735b84">HMAC</a></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><a href="#org4b420e2">Poly1305</a></td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><a href="#org9e02139">KDF</a></td>
<td class="org-left"><a href="#org2ba445d">PBKDF2</a></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><a href="#org44cb6d9">HKDF</a></td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">Bcrypt</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><a href="#org7ab1382">Scrypt​</a></td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><a href="#orge0161ed">Symetric</a></td>
<td class="org-left">AES</td>
<td class="org-left">AES-GCM <a href="#org199504d">AES-GCM-SIV</a></td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">ChaCha20</td>
<td class="org-left"><a href="#orgd8a7e34">ChaCha20-Poly1305</a></td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"><a href="#org0f69fc6">Asymetric</a></td>
<td class="org-left">ECC</td>
<td class="org-left"><a href="#org6f2d77a">ECDSA</a> <a href="#org68b6afc">EdDSA</a> <a href="#orga15423f">ECDH</a> <a href="#orge323d23">X25519</a> Ed25519</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left"><a href="#org36c9406">RSA</a></td>
<td class="org-left">RSASSA-PKCS RSASSA-PSS</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">RSAES-OAEP</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-org65db9e5" class="outline-2">
<h2 id="org65db9e5">Prerequisites</h2>
<div class="outline-text-2" id="text-org65db9e5">
<p>
All you need is just <a href="https://nixos.org/download.html#download-nix">nix</a>!
</p>

<p>
All codes in examples are executable in interative repl GHCi.
</p>

<p>
Please run the following to get into GHCi and config it correctly before trying any example.
</p>
<pre class="example" id="org97c828c">
nix-shell -p "haskellPackages.ghcWithPackages (pkgs: [ pkgs.cryptonite pkgs.memory ])" --run ghci
GHCi, version 9.0.2: https://www.haskell.org/ghc/  :? for help
ghci&gt; :set -XOverloadedStrings
ghci&gt; import Data.ByteString
</pre>

<p>
<code>openssl</code> CLI will be used in few examples as well.
</p>
</div>
</div>

<div id="outline-container-org00c190e" class="outline-2">
<h2 id="org00c190e">Encoding</h2>
<div class="outline-text-2" id="text-org00c190e">
<div class="epigraph"><blockquote>
<p>
Encoding is not Encryption!!! It is just converting bytes from one format to another, for purposes like easier to store, transit etc. Although it looks scrambled, any one can convert it back and forth.
</p>

</blockquote></div>
</div>

<div id="outline-container-orgecda775" class="outline-3">
<h3 id="orgecda775">Base</h3>
<div class="outline-text-3" id="text-orgecda775">
<p>
Most developers are very familiar with <code>base64</code><label for="2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="2" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc4648">https://datatracker.ietf.org/doc/html/rfc4648</a> 
</span>
</p>
<pre class="example" id="orgcd1bc7c">
ghci&gt; import Data.ByteArray.Encoding
ghci&gt; convertToBase Base64 ("hello world" :: ByteString) :: ByteString
"aGVsbG8gd29ybGQ="
ghci&gt; convertFromBase Base64 ("aGVsbG8gd29ybGQ=" :: ByteString) :: Either String ByteString
Right "hello world"
ghci&gt; convertToBase Base16 ("hello world" :: ByteString) :: ByteString
"68656c6c6f20776f726c64"
ghci&gt; convertFromBase Base16 ("68656c6c6f20776f726c64" :: ByteString) :: Either String ByteString
Right "hello world"
</pre>

<p>
The number 64 or 16 indicates how large the alphabets table is. The larger the table, usually the shorter encoded message.
</p>

<p>
For instance base64 has 64 alphabets(actually 63, <code>=</code> is for padding), hence each alphabet can describe 2^6 aka 6bit.
</p>

<p>
base16 is basically just hex since one alphabet map to 2^4(4bit) using US-ASCII.
</p>

<p>
The following example of base64 data from message "hel" <label for="3" class="margin-toggle sidenote-number"></label><input type="checkbox" id="3" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc4648#section-9">https://datatracker.ietf.org/doc/html/rfc4648#section-9</a> 
</span>
</p>

<pre class="example" id="org9294658">
Input:   h        e        l
Hex:     6   8    6   5    6   c  
8-bit:   01101000 01100101 01101100
6-bit:   011010 000110 010101 1101100
Decimal: 26     6      21     44     
Output:  a      G      V      s      
</pre>
</div>
</div>

<div id="outline-container-org8ac329d" class="outline-3">
<h3 id="org8ac329d">Privacy-Enhanced Mail(PEM)</h3>
<div class="outline-text-3" id="text-org8ac329d">
<p>
PEM<label for="4" class="margin-toggle sidenote-number"></label><input type="checkbox" id="4" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc1421">https://datatracker.ietf.org/doc/html/rfc1421</a>
</span> is baseline format for most of the public key encryption, which contains
</p>
<ul class="org-ul">
<li>Boundary</li>
<li>Headers</li>
<li>Body</li>
</ul>

<p>
Example PEM:
</p>
<pre class="example" id="org9b079ed">
-----BEGIN PRIVACY-ENHANCED MESSAGE-----
Proc-Type: 4,ENCRYPTED
Content-Domain: RFC822
DEK-Info: DES-CBC,F8143EDE5960C597
Originator-ID-Symmetric: linn@zendia.enet.dec.com,,
Recipient-ID-Symmetric: linn@zendia.enet.dec.com,ptf-kmc,3
Key-Info: DES-ECB,RSA-MD2,9FD3AAD2F2691B9A,
          B70665BB9BF7CBCDA60195DB94F727D3
Recipient-ID-Symmetric: pem-dev@tis.com,ptf-kmc,4
Key-Info: DES-ECB,RSA-MD2,161A3F75DC82EF26,
          E2EF532C65CBCFF79F83A2658132DB47

LLrHB0eJzyhP+/fSStdW8okeEnv47jxe7SJ/iN72ohNcUk2jHEUSoH1nvNSIWL9M
8tEjmF/zxB+bATMtPjCUWbz8Lr9wloXIkjHUlBLpvXR0UrUzYbkNpk0agV2IzUpk
J6UiRRGcDSvzrsoK+oNvqu6z7Xs5Xfz5rDqUcMlK1Z6720dcBWGGsDLpTpSCnpot
dXd/H5LMDWnonNvPCwQUHt==
-----END PRIVACY-ENHANCED MESSAGE-----
</pre>
</div>
</div>

<div id="outline-container-orgb649ec6" class="outline-3">
<h3 id="orgb649ec6">Public Key Cryptography Standard(PKCS)</h3>
<div class="outline-text-3" id="text-orgb649ec6">
<p>
There are a lot of PKCS #X standards, maybe the most common one is RSA keys since you
may have seen it quite often(something like <code>server.key</code>) when updating a website's certificate.
</p>
</div>
<div id="outline-container-orge92c707" class="outline-4">
<h4 id="orge92c707">PKCS #8</h4>
<div class="outline-text-4" id="text-orge92c707">
<p>
PKCS8<label for="5" class="margin-toggle sidenote-number"></label><input type="checkbox" id="5" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc5958">https://datatracker.ietf.org/doc/html/rfc5958</a>
</span> in usually used as syntax of unencrypted RSA private key,
</p>

<p>
you can simply generate a RSA key via openssl:
</p>
<pre class="example" id="orgbe2c984">
nix-shell -p openssl
[nix-shell:/tmp]$ openssl genpkey -algorithm rsa -out test.key
[nix-shell:/tmp]$ cat test.key
-----BEGIN PRIVATE KEY-----
MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQC6LU2ZNdy32+HL
...
c581/XSSIu1kZpptICNGM4MiDJyGoysNX7417wXgwr8YEb6fbMAMGjjYKbF9BlpY
yRdkNiEmIKL4/ZQoTLdyQR4vJQ==
-----END PRIVATE KEY-----
</pre>

<pre class="example" id="orgc2132d6">
[nix-shell:/tmp]$ openssl rsa -in test.key -noout -text
RSA Private-Key: (2048 bit, 2 primes)
modulus:
    00:e9:6a:68:ab:7b:73:f0:14:72:24:e5:35:f1:c2:
    ...
publicExponent: 65537 (0x10001)
privateExponent:
    00:c0:6f:a1:11:d7:ba:f2:f0:f8:56:20:be:c3:ad:
    ...
prime1:
    00:fb:d7:d5:fd:2c:b5:b2:cd:92:b0:ea:60:83:29:
    ...
prime2:
    ...
exponent1:
    00:e5:8f:16:15:92:9d:85:00:71:c8:25:bc:17:92:
    ...
exponent2:
    3e:6e:01:ad:b7:63:36:96:90:f9:ed:38:c4:10:bf:
    ...
coefficient:
    00:89:e1:69:2b:78:97:a9:91:88:39:7a:75:08:f0:
    ...
</pre>

<p>
The output is readable text but the original PKCS8 is in Abstract Syntax Notation One(ASN.1)<label for="6" class="margin-toggle sidenote-number"></label><input type="checkbox" id="6" class="margin-toggle"/><span class="sidenote">
<a href="https://www.itu.int/en/ITU-T/asn1/Pages/introduction.aspx">https://www.itu.int/en/ITU-T/asn1/Pages/introduction.aspx</a>
</span> syntax and DER encoded.
</p>

<p>
Private key is kind of too long as example, lets use public key to explain.
</p>
</div>
</div>
<div id="outline-container-org25be44f" class="outline-4">
<h4 id="org25be44f">PKCS #1</h4>
<div class="outline-text-4" id="text-org25be44f">
<p>
RSA Public key can be generate from private key:
</p>

<pre class="example" id="orgacf4627">
[nix-shell:/tmp]$ openssl rsa -in test.key -outform PEM -pubout
writing RSA key
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA6Wpoq3tz8BRyJOU18cJK
D+4lVGBz94lpRLfAAK3mjEWbIbeQ/uElnyGbq0Fe+XRMBdVpI5B5PQbM8kf6sNYv
n7BM+dRVq1LuRGmxjL/i+CW7VRWiIZxHWNF/eCaqn3j2hij81NK22m13eFMSOELo
76G6TDtEbv5rqJdhrJw6BlCbslHXNr4rT+q0R2ajricbY/xig/bz6mOetjgxoL6X
WiuJibtAYqGa7+iQse1icFz3SWCwwZjYE46uW1rUI7iyugRBhdVMiypPDj00wdak
77NiaiFw91Vl1EfZo09b8ztcSjBKWeE0tte8Iy5+AhKsC59/hE2wIFj5TnxVE4JC
kwIDAQAB
-----END PUBLIC KEY-----
</pre>

<p>
The output of the public key is in PKCS1 in ASN.1 syntax DER encoded in PEM format.
</p>

<p>
PKCS1 represent RSA public key ASN.1 as
</p>
<pre class="example" id="orgd462151">
RSAPublicKey:

      RSAPublicKey ::= SEQUENCE {
          modulus           INTEGER,  -- n
          publicExponent    INTEGER   -- e
      }
</pre>

<p>
You can read the same information as ASN.1 from
</p>
<pre class="example" id="orgf576231">
[nix-shell:/tmp]$ openssl rsa -in test.key -pubout -out test.pem
[nix-shell:/tmp]$ openssl rsa -in test.pem -pubin -noout -text
RSA Public-Key: (2048 bit)
Modulus:
    00:e9:6a:68:ab:7b:73:f0:14:72:24:e5:35:f1:c2:
    4a:0f:ee:25:54:60:73:f7:89:69:44:b7:c0:00:ad:
    e6:8c:45:9b:21:b7:90:fe:e1:25:9f:21:9b:ab:41:
    5e:f9:74:4c:05:d5:69:23:90:79:3d:06:cc:f2:47:
    fa:b0:d6:2f:9f:b0:4c:f9:d4:55:ab:52:ee:44:69:
    b1:8c:bf:e2:f8:25:bb:55:15:a2:21:9c:47:58:d1:
    7f:78:26:aa:9f:78:f6:86:28:fc:d4:d2:b6:da:6d:
    77:78:53:12:38:42:e8:ef:a1:ba:4c:3b:44:6e:fe:
    6b:a8:97:61:ac:9c:3a:06:50:9b:b2:51:d7:36:be:
    2b:4f:ea:b4:47:66:a3:ae:27:1b:63:fc:62:83:f6:
    f3:ea:63:9e:b6:38:31:a0:be:97:5a:2b:89:89:bb:
    40:62:a1:9a:ef:e8:90:b1:ed:62:70:5c:f7:49:60:
    b0:c1:98:d8:13:8e:ae:5b:5a:d4:23:b8:b2:ba:04:
    41:85:d5:4c:8b:2a:4f:0e:3d:34:c1:d6:a4:ef:b3:
    62:6a:21:70:f7:55:65:d4:47:d9:a3:4f:5b:f3:3b:
    5c:4a:30:4a:59:e1:34:b6:d7:bc:23:2e:7e:02:12:
    ac:0b:9f:7f:84:4d:b0:20:58:f9:4e:7c:55:13:82:
    42:93
Exponent: 65537 (0x10001)
</pre>

<p>
So far all these PKCS are UNENCRYPTED, they are just encoded in certain format.
</p>

<p>
There is a common standard for store and exchange certs and keys that is encypted - PKCS #12 Personal Information Exchange Syntax<label for="7" class="margin-toggle sidenote-number"></label><input type="checkbox" id="7" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc7292">https://datatracker.ietf.org/doc/html/rfc7292</a>
</span> aka PFX<label for="8" class="margin-toggle sidenote-number"></label><input type="checkbox" id="8" class="margin-toggle"/><span class="sidenote">
This is the common format when you get a new cert.
</span>
</p>
</div>
</div>
</div>

<div id="outline-container-orge1123cf" class="outline-3">
<h3 id="orge1123cf">JSON Web Token(JWT)</h3>
<div class="outline-text-3" id="text-orge1123cf">
<div class="epigraph"><blockquote>
<p>
JSON Web Token (JWT) is a compact, URL-safe means of representing claims to be transferred between two parties<label for="9" class="margin-toggle sidenote-number"></label><input type="checkbox" id="9" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc7519">https://datatracker.ietf.org/doc/html/rfc7519</a>
</span>
</p>

</blockquote></div>
<p>
JWT is either a JWS or JWE
</p>
</div>
<div id="outline-container-orge86d136" class="outline-4">
<h4 id="orge86d136">JSON Web Signature (JWS)</h4>
<div class="outline-text-4" id="text-orge86d136">
<p>
JWS<label for="10" class="margin-toggle sidenote-number"></label><input type="checkbox" id="10" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc7515">https://datatracker.ietf.org/doc/html/rfc7515</a>
</span> is commonly used in OIDC<label for="11" class="margin-toggle sidenote-number"></label><input type="checkbox" id="11" class="margin-toggle"/><span class="sidenote">
<a href="https://openid.net/specs/openid-connect-core-1_0.html">https://openid.net/specs/openid-connect-core-1_0.html</a> 
</span> as <code>id_token</code> and sometimes <code>access_token</code> too.
</p>

<p>
The message is NOT ENCTYPTED, so anyone can actually see the claims in the JSON.
</p>
<pre class="example" id="orgeeda908">
BASE64URL(UTF8(JWS Protected Header)) || '.' ||
BASE64URL(JWS Payload) || '.' ||
BASE64URL(JWS Signature)
</pre>

<p>
A example of JWS:(with line breaks for display purposes only):
</p>
<pre class="example" id="orga68e009">
eyJ0eXAiOiJKV1QiLA0KICJhbGciOiJIUzI1NiJ9
.
eyJpc3MiOiJqb2UiLA0KICJleHAiOjEzMDA4MTkzODAsDQogImh0dHA6Ly9leGFt
cGxlLmNvbS9pc19yb290Ijp0cnVlfQ
.
dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk
</pre>

<p>
JWS Signature basically is MAC, of <code>header || payload</code>
</p>
</div>
</div>

<div id="outline-container-orgd6726fb" class="outline-4">
<h4 id="orgd6726fb">JSON Web Encryption (JWE)</h4>
<div class="outline-text-4" id="text-orgd6726fb">
<p>
As the name indicate JWE<label for="12" class="margin-toggle sidenote-number"></label><input type="checkbox" id="12" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc7516">https://datatracker.ietf.org/doc/html/rfc7516</a> 
</span> can be use to encrypt messages, JWE is in the following format, where Ciphertext is the encrypted
message.
</p>

<pre class="example" id="orgcec5176">
BASE64URL(UTF8(JWE Protected Header)) ||
      '.' || BASE64URL(JWE Encrypted Key) || '.' || BASE64URL(JWE
      Initialization Vector) || '.' || BASE64URL(JWE Ciphertext) || '.'
      || BASE64URL(JWE Authentication Tag)
</pre>

<p>
example:(with line breaks for display purposes only)
</p>
<pre class="example" id="org651a02d">
eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.
OKOawDo13gRp2ojaHV7LFpZcgV7T6DVZKTyKOMTYUmKoTCVJRgckCL9kiMT03JGe
ipsEdY3mx_etLbbWSrFr05kLzcSr4qKAq7YN7e9jwQRb23nfa6c9d-StnImGyFDb
Sv04uVuxIp5Zms1gNxKKK2Da14B8S4rzVRltdYwam_lDp5XnZAYpQdb76FdIKLaV
mqgfwX7XWRxv2322i-vDxRfqNzo_tETKzpVLzfiwQyeyPGLBIO56YJ7eObdv0je8
1860ppamavo35UgoRdbYaBcoh9QcfylQr66oc6vFWXRcZ_ZT2LawVCWTIy3brGPi
6UklfCpIMfIjf7iGdXKHzg.
48V1_ALb6US04U3b.
5eym8TW_c8SuK0ltJ3rpYIzOeDQz7TALvtu6UG9oMo4vpzs9tX_EFShS8iB7j6ji
SdiwkIr3ajwQzaBtQD_A.
XFBoMYUZodetZdvTiFvSkQ
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0d0ad90" class="outline-2">
<h2 id="org0d0ad90">Hash Function</h2>
<div class="outline-text-2" id="text-org0d0ad90">
<p>
Hash function can map bytes to another ONE WAY only but not the other way around.
Common hash functions are SHA2, SHA3, MD5, Blake2&#x2026;
Modern hash functions such as SHA2, SHA3, Blake2 are consider secure hash functions. Old funtions such as MD5 and SHA1 are not secure since collisions found, and should avoid using them.
</p>

<p>
Hash functions are commonly used to proof the content not tampered, for example if you download an executable file form internet, you should compare the hash provided by the site and the one caclulated locally. Collisions found will indicate the function is not secure anymore, for example if someone hijack the content and replace with another malware which can calculate to the same hash.
</p>

<pre class="example" id="org9e029a5">
ghci&gt; import Crypto.Hash
ghci&gt; hash ("hello world"::ByteString) :: Digest SHA1
2aae6c35c94fcfb415dbe95f408b9ce91ee846ed
ghci&gt; hash ("hello world"::ByteString) :: Digest MD5
5eb63bbbe01eeed093cb22bb8f5acdc3
ghci&gt; hash ("hello world"::ByteString) :: Digest SHA256
b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9
ghci&gt; hash ("hello world"::ByteString) :: Digest SHA3_256
644bcc7e564373040999aac89e7622f3ca71fba1d972fd94a31c3bfbf24e3938
ghci&gt; hash ("hello world"::ByteString) :: Digest Blake2s_256
9aec6806794561107e594b1f6a8a6b0c92a0cba9acf5e5e93cca06f781813b0b
ghci&gt; hash ("hello world"::ByteString) :: Digest Blake2b_256
256c83b297114d201b30179f3f0ef0cace9783622da5974326b436178aeef610
</pre>

<p>
The number <code>256</code> in SHA and Blake indicates the output bits length, usually more bits means higher collisions resistance.
</p>

<div class="epigraph"><blockquote>
<p>
Hashing is NOT encryption!!! DO NOT store hash of password in database. Although hash function is not reversible, if I have a large enough dictionary, I can definitly tell from database the password <code>5eb63bbbe01eeed093cb22bb8f5acdc3</code> is <code>hello world</code>
</p>

</blockquote></div>

<p>
There is example of Blake2b of "abc" and C implementation in rfc7693 <label for="13" class="margin-toggle sidenote-number"></label><input type="checkbox" id="13" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc7693#appendix-A">https://datatracker.ietf.org/doc/html/rfc7693#appendix-A</a> 
</span>
</p>
</div>
</div>

<div id="outline-container-org2004a58" class="outline-2">
<h2 id="org2004a58">Message Authentication Code(MAC)</h2>
<div class="outline-text-2" id="text-org2004a58">
<p>
MAC is basically a hash function + key.
</p>
</div>


<div id="outline-container-org7735b84" class="outline-3">
<h3 id="org7735b84">HMAC</h3>
<div class="outline-text-3" id="text-org7735b84">
<p>
For example HMAC<label for="14" class="margin-toggle sidenote-number"></label><input type="checkbox" id="14" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc2104">https://datatracker.ietf.org/doc/html/rfc2104</a> 
</span> SHA256 is HMAC scramble the message with a key and hash with SHA256.
</p>

<pre class="example" id="org4f9903a">
ghci&gt; import Crypto.MAC.HMAC
ghci&gt; import Crypto.Hash
ghci&gt; hmacGetDigest $ hmac ("secret key"::ByteString) ("hello world"::ByteString) :: Digest SHA256
c61b5198df58639edb9892514756b89a36856d826e5d85023ab181b48ea5d018
ghci&gt; hmacGetDigest $ hmac ("secret key"::ByteString) ("hello world"::ByteString) :: Digest Blake2b_256
198e317eba56eee5056b88f527c895d6235ace9153fdf6467e38c2758073328c
</pre>

<p>
The scramble part is defined in rfc2104<label for="14" class="margin-toggle sidenote-number"></label><input type="checkbox" id="14" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc2104">https://datatracker.ietf.org/doc/html/rfc2104</a> 
</span>, <code>H</code> is hash function e.g. SHA256, <code>K</code> is secret key and <code>,</code> is concat
</p>
<pre class="example" id="org53f68ef">
ipad = the byte 0x36 repeated B times
opad = the byte 0x5C repeated B times
H(K XOR opad, H(K XOR ipad, text))
</pre>

<p>
MAC can be used in senario like:
</p>

<ul class="org-ul">
<li>Exchange private message, append a MAC of the message to proof it is not tampered, very similar to usage of hash function, but hash function is mainly use for public messages, for example a file from public website that everyone can download.</li>
<li>Pseudo Random Generator(PRG),  <code>HMAC(salt, seed)</code> generate a pretty random enough key can be used in KDF</li>
</ul>
</div>
</div>



<div id="outline-container-org4b420e2" class="outline-3">
<h3 id="org4b420e2">Poly1305</h3>
<div class="outline-text-3" id="text-org4b420e2">
<p>
Poly1305<label for="15" class="margin-toggle sidenote-number"></label><input type="checkbox" id="15" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc8439">https://datatracker.ietf.org/doc/html/rfc8439</a>
</span> is fast MAC
</p>
</div>
</div>
</div>

<div id="outline-container-org9e02139" class="outline-2">
<h2 id="org9e02139">Key Derivation Function(KDF)</h2>
<div class="outline-text-2" id="text-org9e02139">
<p>
KDF is a function generates pseudo random key from password. Password is something we usually used to encrypt a file, or login to a website, because it is easy to remember or note for human, but not random enough to use directly as key to encrypt, and not secure to store in database.
</p>

<p>
You can think of KDF as just MAC, but run many iterations and consume some CPU and RAM.
</p>
</div>

<div id="outline-container-org2ba445d" class="outline-3">
<h3 id="org2ba445d">Password Based Key Derivation Function (PBKDF2)</h3>
<div class="outline-text-3" id="text-org2ba445d">
<p>
The following example of PBKDF<label for="16" class="margin-toggle sidenote-number"></label><input type="checkbox" id="16" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc2898">https://datatracker.ietf.org/doc/html/rfc2898</a>
</span> using HMAC SHA256, iterate 1000 times, and output length 32 bytes.
</p>
<pre class="example" id="org8071d8b">
ghci&gt; import Crypto.KDF.PBKDF2
ghci&gt; generate (prfHMAC SHA256 :: PRF ByteString) (Parameters {iterCounts = 1000, outputLength = 32}) ("password":: ByteString) ("salt"::ByteString) :: ByteString
"c,(\DC2\228mF\EOT\DLE+\167a\142\157m}/\129(\246&amp;kJ\ETX&amp;M*\EOT`\183\220\179"
</pre>
<p>
The output is 32 bytes length pseudo random bytestring, we can output hex format with base16 encoding
</p>

<pre class="example" id="org41fc878">
ghci&gt; convertToBase Base16 $ (generate (prfHMAC SHA256 :: PRF ByteString) (Parameters {iterCounts = 1000, outputLength = 32}) ("password":: ByteString) ("salt"::ByteString) :: ByteString) :: ByteString
"632c2812e46d4604102ba7618e9d6d7d2f8128f6266b4a03264d2a0460b7dcb3"
</pre>

<p>
It is secure to store parameters( <span class="underline">salt</span>, <span class="underline">iterations count</span>, <span class="underline">output length</span>), together with the output bytes in database, in senario such as login, a server can run the same function again with the salt, iterations and length from the record, and compare the output bytes with the one stored in the database.
</p>

<p>
Since PBKDF2 hash each password with HMAC and a random salt many iterations, it is resistanct to dictionary attacks<label for="17" class="margin-toggle sidenote-number"></label><input type="checkbox" id="17" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc4949#page-102">https://datatracker.ietf.org/doc/html/rfc4949#page-102</a> 
</span>.
</p>

<p>
PBKDF2 is a common KDF but it is consider less secure than modern KDF such as Scrypt, Argon2.
</p>
</div>
</div>
<div id="outline-container-org7ab1382" class="outline-3">
<h3 id="org7ab1382">Scrypt</h3>
<div class="outline-text-3" id="text-org7ab1382">
<p>
The following is a example of deriving 32 bytes length key in 1024 iterations, block size 8 and parallel 2 using Scrypt<label for="18" class="margin-toggle sidenote-number"></label><input type="checkbox" id="18" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc7914">https://datatracker.ietf.org/doc/html/rfc7914</a>
</span>.
</p>
<pre class="example" id="org4b974fe">
ghci&gt; import Crypto.KDF.Scrypt
ghci&gt; generate (Parameters {n=1024,r=8,p=2,outputLength=32}) ("password":: ByteString) ("salt"::ByteString) ::ByteString
"\ETBeHl\244\197Y\DEL\181\&amp;0\141\SYN\185\151\148\215\211\160\189.\148d\185\172\177\202\&amp;2\ETX\SUB\133\223\237"
</pre>
</div>
</div>
<div id="outline-container-org44cb6d9" class="outline-3">
<h3 id="org44cb6d9">HMAC-based Extract-and-Expand Key Derivation Function (HKDF)</h3>
<div class="outline-text-3" id="text-org44cb6d9">
<p>
Example of HKDF<label for="19" class="margin-toggle sidenote-number"></label><input type="checkbox" id="19" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc5869">https://datatracker.ietf.org/doc/html/rfc5869</a>
</span>:
</p>
<pre class="example" id="org7ccce15">
ghci&gt; import Crypto.KDF.HKDF
ghci&gt; import Crypto.Hash (SHA256)
ghci&gt; let pkr = extract ("salt" :: ByteString) ("secret" :: ByteString) :: PRK SHA256
ghci| in expand pkr ("payload" :: ByteString) 32 :: ByteString
"\DC4\147\223\v%\175\f\177\143\132\202\142\233\236\135\153\253\CANs\213wh\149\193\128\240\192t\DC1\UST,"
</pre>
</div>
</div>
</div>
<div id="outline-container-orge0161ed" class="outline-2">
<h2 id="orge0161ed">Symmetric Ciphers</h2>
<div class="outline-text-2" id="text-orge0161ed">
<p>
Symmetric ciphers is very straightforward to use, encryption and decryption is based on the same key.
</p>

<p>
Basically symmetric encryption use a Pseudo Random Key(PRK) xor the message. The
</p>
</div>
<div id="outline-container-org35b7d8d" class="outline-3">
<h3 id="org35b7d8d">AES</h3>
<div class="outline-text-3" id="text-org35b7d8d">
</div>
<div id="outline-container-org673c0ba" class="outline-4">
<h4 id="org673c0ba">Counter Mode(CTR)</h4>
<div class="outline-text-4" id="text-org673c0ba">
<p>
AES requires a initial vector(IV), aka nonce. The following is a example of AES 256 CTR mode with a random 256-bit key and 0 as IV:
</p>
<div class="epigraph"><blockquote>
<p>
In practice key should derive key from password with a secure KDF, and iv should be a random number.
</p>

</blockquote></div>

<pre class="example" id="org5e067c8">
ghci&gt; import Crypto.Random
ghci&gt; import Crypto.Cipher.Types
ghci&gt; import Crypto.Cipher.AES (AES256)
ghci&gt; import Crypto.Error
ghci&gt; do
ghci| cipher &lt;- (getRandomBytes 32 :: IO ByteString) &gt;&gt;= (throwCryptoErrorIO . cipherInit) :: IO AES256
ghci| return $ ctrCombine cipher nullIV ("message"::ByteString)
ghci| 
"\208\207\SI\191\206\DELN"
</pre>
</div>
</div>

<div id="outline-container-org199504d" class="outline-4">
<h4 id="org199504d">Galois/Counter Mode Synthetic Initialization Vector (GCM-SIV)</h4>
<div class="outline-text-4" id="text-org199504d">
<p>
CTR is good enough for common encryption case, while GCM<label for="20" class="margin-toggle sidenote-number"></label><input type="checkbox" id="20" class="margin-toggle"/><span class="sidenote">
<a href="https://csrc.nist.gov/publications/detail/sp/800-38d/final">https://csrc.nist.gov/publications/detail/sp/800-38d/final</a>
</span>-SIV<label for="21" class="margin-toggle sidenote-number"></label><input type="checkbox" id="21" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc8452">https://datatracker.ietf.org/doc/html/rfc8452</a>
</span> added Authenticated Encryption with Additional Data (AEAD)<label for="22" class="margin-toggle sidenote-number"></label><input type="checkbox" id="22" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc5116">https://datatracker.ietf.org/doc/html/rfc5116</a>
</span>, and SIV to nonce misuse-resistant.
</p>

<p>
AEAD basically bind extra data, or context to cipher text and generate a MAC, aka authentication tag, to be able to verify cipher text's integrity(not tampered), and authenticity(not cut-and-paste).
</p>

<p>
The following is example of AES-GCM-SIV encryption of "message" with additional data "context" and a nonce.
</p>

<pre class="example" id="org6dd723c">
ghci&gt; import Crypto.Cipher.AESGCMSIV
ghci&gt; do
ghci| key :: ByteString &lt;- getRandomBytes 32
ghci| nonce &lt;- generateNonce
ghci| throwCryptoErrorIO $ do
ghci| aes :: AES256 &lt;- cipherInit key
ghci| return $ encrypt aes nonce ("context" :: ByteString) ("message" :: ByteString) 
ghci| 
(AuthTag {unAuthTag = "\239|\229V\USNT3\ACKf\NAK\STXC\251\134\FS"},"\149\229\142SW\209Z")
</pre>
</div>
</div>
</div>
<div id="outline-container-org06e81f3" class="outline-3">
<h3 id="org06e81f3">ChaCha20</h3>
<div class="outline-text-3" id="text-org06e81f3">
<p>
ChaCha20 is high speed stream cipher, a vairant of Salsa20, usually combine with Poly1305 as AEAD construction.
</p>
</div>
<div id="outline-container-orgd8a7e34" class="outline-4">
<h4 id="orgd8a7e34">ChaCha20-Poly1305</h4>
<div class="outline-text-4" id="text-orgd8a7e34">
<p>
ChaCha20-Poly1305<label for="15" class="margin-toggle sidenote-number"></label><input type="checkbox" id="15" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc8439">https://datatracker.ietf.org/doc/html/rfc8439</a>
</span> requires very similar inputs to AES:
</p>

<ul class="org-ul">
<li>a 32 bytes (256-bit) key, can derive key from password with a secure KDF</li>
<li>a 12 bytes (96-bit) nonce aka IV</li>
</ul>

<p>
There are more steps to encrypt a message due to it is stream cipher aka state cipher, which is different from block cipher such as AES, block cipher generate fixed length key to encrypt fixed length message, while stream cipher can produce state to generate keystream for next chunk of data.
</p>

<ul class="org-ul">
<li>AEAD need to add and finalize before encrypt, and cannot modify later on</li>
<li>encrypt can call multiple times based on current state</li>
<li>finalise a state will generate auth tag</li>
</ul>

<pre class="example" id="org808eb42">
ghci&gt; import Crypto.Error
ghci&gt; import Crypto.Cipher.ChaChaPoly1305
ghci| do
ghci| key &lt;- getRandomBytes 32 :: IO ByteString
ghci| nonce &lt;- getRandomBytes 12 :: IO ByteString
ghci| throwCryptoErrorIO $ do
ghci| st1 &lt;- nonce12 nonce &gt;&gt;= initialize key
ghci| let
ghci|   st2 = finalizeAAD $ appendAAD ("context":: ByteString) st1
ghci|   (out, st3) = encrypt ("message":: ByteString) st2
ghci|   auth = finalize st3
ghci| return $ (convertToBase Base16 out :: ByteString, convertToBase Base16 auth :: ByteString)
("f0dd593fb3cac0","4a29dd7ae8b51ac748b37092ed485e88")
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0f69fc6" class="outline-2">
<h2 id="org0f69fc6">Asymmetric Ciphers</h2>
<div class="outline-text-2" id="text-org0f69fc6">
<p>
Asymmetric ciphers aka public key cryptography, is more complex than symmetric(in term of usage not cipher implementation), because instead of using the same key to encrypt and decrypt, asymmetric needs public and private key pair.
</p>

<p>
Common scenarios of asymmetric ciphers are:
</p>
<ul class="org-ul">
<li>Encrypt data by public key and decrypt by private key</li>
<li>Sign message(MAC) by private key and verify by public key</li>
<li>Exchange key between 2 parties publicly</li>
</ul>
</div>

<div id="outline-container-org85be216" class="outline-3">
<h3 id="org85be216">Key Exchange</h3>
<div class="outline-text-3" id="text-org85be216">
<p>
Key exchange usually happen when two parties want to establish a secure connection on a public channel, for example TLS Handshake.
</p>

<ul class="org-ul">
<li>Client and Server each has a key pair, only client has access to the private key</li>
<li>Server has a key pair, only server has access to the private key</li>
<li>(Client private key * Base) * Server public key = shared key = Client public key (Base * Server Private key)</li>
</ul>

<p>
Where private * base = public key
<code>*</code> is a math irreversible operation that is associative, e.g. exponent of huge number
</p>
</div>
</div>

<div id="outline-container-org7a7fafb" class="outline-3">
<h3 id="org7a7fafb">Elliptic Curve Cryptography (ECC)</h3>
<div class="outline-text-3" id="text-org7a7fafb">
<p>
Compared to RSA, ECC offers equivalent security with smaller key sizes(in bits).<label for="23" class="margin-toggle sidenote-number"></label><input type="checkbox" id="23" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc4492">https://datatracker.ietf.org/doc/html/rfc4492</a>
</span>
</p>

<table>


<colgroup>
<col  class="org-right">

<col  class="org-right">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-right">Symmetric</td>
<td class="org-right">ECC</td>
<td class="org-right">DH/DSA/</td>
</tr>

<tr>
<td class="org-right">80</td>
<td class="org-right">163</td>
<td class="org-right">1024</td>
</tr>

<tr>
<td class="org-right">112</td>
<td class="org-right">233</td>
<td class="org-right">2048</td>
</tr>

<tr>
<td class="org-right">128</td>
<td class="org-right">283</td>
<td class="org-right">3072</td>
</tr>

<tr>
<td class="org-right">192</td>
<td class="org-right">409</td>
<td class="org-right">7680</td>
</tr>

<tr>
<td class="org-right">256</td>
<td class="org-right">571</td>
<td class="org-right">15360</td>
</tr>
</tbody>
</table>
</div>


<div id="outline-container-orga15423f" class="outline-4">
<h4 id="orga15423f">Elliptic Curve Diffie-Hellman (ECDH)</h4>
<div class="outline-text-4" id="text-orga15423f">
<p>
ECDH process is very simple:
</p>
<ol class="org-ol">
<li><p>
choose a curve, there are a lot of curves available.
</p>
<pre class="example" id="org79c5fee">
   ghci&gt; :info CurveName
type CurveName :: *
data CurveName
  = SEC_p112r1
  | SEC_p112r2
  | SEC_p128r1
  ...
</pre></li>
<li>Alice generate a private key</li>
<li>Bob generate a private key</li>
<li>Alice's private key * Base point * Bob's public key = share key = Alice's public key * Base point * Bob's private key</li>
</ol>

<pre class="example" id="org25c24ec">
ghci&gt; import Crypto.PubKey.ECC.DH
ghci&gt; import Crypto.PubKey.ECC.Types
ghci&gt; let curve = getCurveByName SEC_p384r1
ghci&gt; do
ghci| alicePrivateKey &lt;- generatePrivate curve
ghci| let alicePublicKey = calculatePublic curve alicePrivateKey
ghci| bobPrivateKey &lt;- generatePrivate curve
ghci| let bobPublicKey = calculatePublic curve bobPrivateKey
ghci| let aliceSharedKey = getShared curve alicePrivateKey bobPublicKey
ghci| let bobSharedKey = getShared curve bobPrivateKey alicePublicKey
ghci| return (aliceSharedKey == bobSharedKey)
ghci| 
True
</pre>
</div>
</div>

<div id="outline-container-orge323d23" class="outline-4">
<h4 id="orge323d23">Curve25519/X25519</h4>
<div class="outline-text-4" id="text-orge323d23">
<p>
Another popular curve is Curve25519, which is 128-bit level, Curve448 is 256-bit level security.<label for="24" class="margin-toggle sidenote-number"></label><input type="checkbox" id="24" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc7748">https://datatracker.ietf.org/doc/html/rfc7748</a>
</span>
</p>

<pre class="example" id="orgef15328">
do
alicePrivateKey &lt;- generateSecretKey
let alicePublicKey = toPublic alicePrivateKey
bobPrivateKey &lt;- generateSecretKey
let bobPublicKey = toPublic bobPrivateKey
let aliceSharedKey = dh bobPublicKey alicePrivateKey
let bobSharedKey = dh alicePublicKey bobPrivateKey
return (aliceSharedKey == bobSharedKey)
</pre>
</div>
</div>


<div id="outline-container-org6f2d77a" class="outline-4">
<h4 id="org6f2d77a">Elliptic Curve Digital Signature Algorithm (ECDSA)</h4>
<div class="outline-text-4" id="text-org6f2d77a">
<p>
ECDSA<label for="25" class="margin-toggle sidenote-number"></label><input type="checkbox" id="25" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc6979">https://datatracker.ietf.org/doc/html/rfc6979</a>
</span> won't encrypt the message, but just generate signature from sender's private key.
</p>

<p>
The following example is how Alice sign the message with ECDSA on Curve25519 with her private key, and Bob
can verify the message is from Alice public key.
</p>

<pre class="example" id="org463694b">
ghci&gt; import Crypto.PubKey.ECC.ECDSA
ghci&gt; import Crypto.PubKey.ECC.Generate
ghci&gt; import Crypto.Hash.Algorithms
ghci&gt; do
ghci| (alicePublicKey, alicePrivateKey) &lt;- generate curve
ghci| toBob &lt;- sign alicePrivateKey SHA256 ("message to Bob"::ByteString)
ghci| return $ verify SHA256 alicePublicKey toBob ("message to Bob"::ByteString)
ghci| 
True
</pre>
</div>
</div>

<div id="outline-container-org68b6afc" class="outline-4">
<h4 id="org68b6afc">Edwards-Curve Digital Signature Algorithm (EdDSA)</h4>
<div class="outline-text-4" id="text-org68b6afc">
<p>
Usage of EdDSA<label for="26" class="margin-toggle sidenote-number"></label><input type="checkbox" id="26" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc8032">https://datatracker.ietf.org/doc/html/rfc8032</a> 
</span> is basically the same as ECDSA, but on another curve edwards25519 or edwards448
</p>
</div>
</div>
</div>

<div id="outline-container-org36c9406" class="outline-3">
<h3 id="org36c9406">RSA</h3>
<div class="outline-text-3" id="text-org36c9406">
<p>
RSA<label for="27" class="margin-toggle sidenote-number"></label><input type="checkbox" id="27" class="margin-toggle"/><span class="sidenote">
<a href="https://datatracker.ietf.org/doc/html/rfc8017">https://datatracker.ietf.org/doc/html/rfc8017</a>
</span> is the most popular public key crypto, the following is a example of digital sign message with 2048-bit RSA key, in RSASSA-PKCS1-v1_5 scheme SHA256:
</p>
<pre class="example" id="org1ea7491">
ghci&gt; import Crypto.PubKey.RSA
ghci&gt; import Crypto.PubKey.RSA.PKCS15
ghci&gt; import Crypto.Hash.Algorithms
ghci&gt; (publicKey, privateKey) &lt;- generate 256 65537
ghci&gt; sign Nothing (Just SHA256) privateKey ("to Bob"::ByteString)
Right "=\161\243j\STX]\251g=\234\GSx&gt;\159\248\128#\DEL\235\188\240\221U\232{\176\DLE\231\210\229z2\SI\212\212\216\235\239bO\205&amp;t\248\SOH\249K.\191R\169\175#\183\f\239\141\142\201\144\&amp;0\174[\ESC\228T`\136\239\221\EOT\214\235\&amp;8\NAK\255\245l\148\228?\FS\254N'pO\221\"n'\249&lt;\242\RS\146\DELl\210\157~[\254)\SYN@\249\232\ENQs\RSl\177u\213\207\239\129\159\ETX&amp;\141\DC13\243\250\232\187\222\DLEF\207\222\231\EM\186M\245Hv\238\n\ACK\SOw\254\196\173&amp;\209N\245\217\&amp;4m\234\161l\158\173\225;\SYN\187\217\v\r\199\b\193\v\167{Dk\234\194\174\133\150@\148\DEL\190\193\141\DC1\140S\141\GS\135\n\161)\253\179\241\199\230k&lt;G\135\158\225\DC2?h\211\240#;\183\192\182\168eS\\\195V\135mZ\rA\173\197\139\193\135\174\233\138&amp;r\SIK\197\156\r\a\DELV\ETX\218\FS\188d\NAKw\222\252\ESC\SO"
</pre>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
actually Haskell is chosen because I learnt most of the content in this article while implementing <code>age</code>  in Haskell for my new experimental project <a href="https://github.com/jcouyang/dhall-secret/pull/1">https://github.com/jcouyang/dhall-secret/pull/1</a>  PR welcome btw :)
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc4648">https://datatracker.ietf.org/doc/html/rfc4648</a> 
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc4648#section-9">https://datatracker.ietf.org/doc/html/rfc4648#section-9</a> 
</p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4" role="doc-backlink">4</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc1421">https://datatracker.ietf.org/doc/html/rfc1421</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5" role="doc-backlink">5</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc5958">https://datatracker.ietf.org/doc/html/rfc5958</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.6" class="footnum" href="#fnr.6" role="doc-backlink">6</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://www.itu.int/en/ITU-T/asn1/Pages/introduction.aspx">https://www.itu.int/en/ITU-T/asn1/Pages/introduction.aspx</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.7" class="footnum" href="#fnr.7" role="doc-backlink">7</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc7292">https://datatracker.ietf.org/doc/html/rfc7292</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.8" class="footnum" href="#fnr.8" role="doc-backlink">8</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
This is the common format when you get a new cert.
</p></div></div>

<div class="footdef"><sup><a id="fn.9" class="footnum" href="#fnr.9" role="doc-backlink">9</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc7519">https://datatracker.ietf.org/doc/html/rfc7519</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.10" class="footnum" href="#fnr.10" role="doc-backlink">10</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc7515">https://datatracker.ietf.org/doc/html/rfc7515</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.11" class="footnum" href="#fnr.11" role="doc-backlink">11</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://openid.net/specs/openid-connect-core-1_0.html">https://openid.net/specs/openid-connect-core-1_0.html</a> 
</p></div></div>

<div class="footdef"><sup><a id="fn.12" class="footnum" href="#fnr.12" role="doc-backlink">12</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc7516">https://datatracker.ietf.org/doc/html/rfc7516</a> 
</p></div></div>

<div class="footdef"><sup><a id="fn.13" class="footnum" href="#fnr.13" role="doc-backlink">13</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc7693#appendix-A">https://datatracker.ietf.org/doc/html/rfc7693#appendix-A</a> 
</p></div></div>

<div class="footdef"><sup><a id="fn.14" class="footnum" href="#fnr.14" role="doc-backlink">14</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc2104">https://datatracker.ietf.org/doc/html/rfc2104</a> 
</p></div></div>

<div class="footdef"><sup><a id="fn.15" class="footnum" href="#fnr.15" role="doc-backlink">15</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc8439">https://datatracker.ietf.org/doc/html/rfc8439</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.16" class="footnum" href="#fnr.16" role="doc-backlink">16</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc2898">https://datatracker.ietf.org/doc/html/rfc2898</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.17" class="footnum" href="#fnr.17" role="doc-backlink">17</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc4949#page-102">https://datatracker.ietf.org/doc/html/rfc4949#page-102</a> 
</p></div></div>

<div class="footdef"><sup><a id="fn.18" class="footnum" href="#fnr.18" role="doc-backlink">18</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc7914">https://datatracker.ietf.org/doc/html/rfc7914</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.19" class="footnum" href="#fnr.19" role="doc-backlink">19</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc5869">https://datatracker.ietf.org/doc/html/rfc5869</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.20" class="footnum" href="#fnr.20" role="doc-backlink">20</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://csrc.nist.gov/publications/detail/sp/800-38d/final">https://csrc.nist.gov/publications/detail/sp/800-38d/final</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.21" class="footnum" href="#fnr.21" role="doc-backlink">21</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc8452">https://datatracker.ietf.org/doc/html/rfc8452</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.22" class="footnum" href="#fnr.22" role="doc-backlink">22</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc5116">https://datatracker.ietf.org/doc/html/rfc5116</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.23" class="footnum" href="#fnr.23" role="doc-backlink">23</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc4492">https://datatracker.ietf.org/doc/html/rfc4492</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.24" class="footnum" href="#fnr.24" role="doc-backlink">24</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc7748">https://datatracker.ietf.org/doc/html/rfc7748</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.25" class="footnum" href="#fnr.25" role="doc-backlink">25</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc6979">https://datatracker.ietf.org/doc/html/rfc6979</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.26" class="footnum" href="#fnr.26" role="doc-backlink">26</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc8032">https://datatracker.ietf.org/doc/html/rfc8032</a> 
</p></div></div>

<div class="footdef"><sup><a id="fn.27" class="footnum" href="#fnr.27" role="doc-backlink">27</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
<a href="https://datatracker.ietf.org/doc/html/rfc8017">https://datatracker.ietf.org/doc/html/rfc8017</a>
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<footer>
  <p>Author: Jichao Ouyang
    <a class="github-button" href="https://github.com/sponsors/jcouyang" data-icon="octicon-heart" aria-label="Sponsor @jcouyang on GitHub">Sponsor</a>
    <a aria-label="Follow @jcouyang on GitHub" data-count-aria-label="# followers on GitHub" data-count-api="/users/jcouyang#followers" data-count-href="/jcouyang/followers" href="https://github.com/jcouyang" class="github-button">Follow</a>
    <a href="https://twitter.com/oyanglulu" class="twitter-follow-button" data-show-screen-name="false" data-show-count="false">Follow @oyanglulu</a>
  </p>
  <p>Created: 2022-09-17 Sat 00:00</p>
  <p>Generated by: <a href="https://www.gnu.org/software/emacs/">Emacs</a> 28.1 (<a href="https://orgmode.org">Org</a> mode 9.5.3) &#215; <a href="https://github.com/jcouyang/orgpress">OrgPress</a></p>
  <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Unported License</a>.
  <input type="swiftype" class="st-default-search-input" placeholder="Search"/>
  <a class="gumroad-button" href="https://gum.co/grokking-monad?wanted=true" target="_blank" data-gumroad-single-product="true">范畴论装逼指南，请自觉排队装逼</a>
  <div id="danmaku-comments"></div>
  <div id="disqus_thread"></div>
</footer>
</div>
</body>
</html>
